"use strict";(self.webpackChunkwhiteboard_bridge=self.webpackChunkwhiteboard_bridge||[]).push([[378],{63314:function(e,t,n){var r,i=n(48764).Buffer;function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){return d(e)||f(e)||A(e)||h()}function s(e,t,n){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},s(e,t,n||e)}function c(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){c(a,r,i,o,s,"next",e)}function s(e){c(a,r,i,o,s,"throw",e)}o(void 0)}))}}function l(e,t){return d(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||A(e,t)||h()}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e){if(Array.isArray(e))return e}function p(e){return function(e){if(Array.isArray(e))return E(e)}(e)||f(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function v(e){var t="function"==typeof Map?new Map:void 0;return v=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return m(e,arguments,x(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)},v(e)}function m(e,t,n){return m=S()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&y(i,n.prototype),i},m.apply(null,arguments)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}function y(e,t){return y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},y(e,t)}function b(e){var t=S();return function(){var n,r=x(e);if(t){var i=x(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return k(this,n)}}function k(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?w(e):t}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,n){return t&&I(e.prototype,t),n&&I(e,n),e}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=A(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function A(e,t){if(e){if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?E(e,t):void 0}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n(12419),n(74819),n(35666),n(78011),n(69070),n(33321),n(38880),n(49337),n(36210),n(82526),n(30489),n(83710),n(41539),n(39714),n(9653),n(91058),n(43371),n(68304),n(18264),n(39575),n(16716),n(44363),n(24812),n(68309),n(89554),n(54747),n(21249),n(69600),n(74916),n(23123),n(92222),n(3843),n(32564),n(88674),n(40561),n(4723),n(15306),n(82772),n(78285),n(47042),n(43290),n(47941),n(66992),n(33948),n(44048),n(69826),n(57327),n(5212),n(2707),n(78783),n(60285),n(64765),n(79753),n(24603),n(41817),n(34553),n(60514),n(19601),n(94953),n(35192),n(33161),n(61874),n(9494),n(5735),n(83753),n(32165),n(26541),n(94986),n(85827),n(96644),n(15218),n(54678),n(26699),n(32023),n(55994),n(65069),n(51532),n(70189),n(82481),n(56977),n(27852),n(23157),n(38478),n(73210),n(4129),n(91038),n(58734),n(50915),n(79841),n(83112),n(82472),n(92990),n(18927),n(33105),n(35035),n(74345),n(7174),n(32846),n(44731),n(77209),n(96319),n(58867),n(37789),n(33739),n(29368),n(14483),n(12056),n(3462),n(30678),n(27462),n(33824),n(55021),n(12974),n(15016),n(29254);var O=Object.create,R=Object.defineProperty,N=Object.defineProperties,L=Object.getOwnPropertyDescriptor,j=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertyNames,F=Object.getOwnPropertySymbols,z=Object.getPrototypeOf,B=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,V=function(e,t,n){return t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},W=function(e,t){for(var n in t||(t={}))B.call(t,n)&&V(e,n,t[n]);if(F){var r,i=T(F(t));try{for(i.s();!(r=i.n()).done;){n=r.value;U.call(t,n)&&V(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},H=function(e,t){return N(e,j(t))},_=function(e){return R(e,"__esModule",{value:!0})},G=function(e,t){for(var n in _(e),t)R(e,n,{get:t[n],enumerable:!0})},Y=function(e){return function(e,t,n){if(t&&"object"==M(t)||"function"==typeof t){var r,i=T(D(t));try{var a=function(){var i=r.value;!B.call(e,i)&&"default"!==i&&R(e,i,{get:function(){return t[i]},enumerable:!(n=L(t,i))||n.enumerable})};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return e}(_(R(null!=e?O(z(e)):{},"default",e&&e.__esModule&&"default"in e?{get:function(){return e.default},enumerable:!0}:{value:e,enumerable:!0})),e)},X=function(e,t,n,r){for(var i,a=r>1?void 0:r?L(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&R(t,n,a),a};G(t,{AdminObserverId:function(){return an},AkkoVersion:function(){return He},AnimationMode:function(){return yp},ApplianceNames:function(){return fI},AsyncModuleLoadMode:function(){return vx},CNode:function(){return Sh},CursorNames:function(){return fM},DefaultHotKeys:function(){return Hx},DeviceType:function(){return up},DisplayerConsumer:function(){return GP},EventPhase:function(){return Sr},EventScope:function(){return Wn},InvisiblePlugin:function(){return ZP},KeyboardKind:function(){return Rx},LoggerReportMode:function(){return vT},NullIdentifier:function(){return mt},ObserverMode:function(){return jM},PPTKind:function(){return mC},PPTTaskStatus:function(){return gC},PPTTaskStep:function(){return yC},PlayerConsumer:function(){return XP},PlayerPhase:function(){return NM},RenderEngine:function(){return rP},RoomConsumer:function(){return YP},RoomErrorLevel:function(){return dM},RoomPhase:function(){return hM},ScenePathType:function(){return mI},ScreenType:function(){return xT},ShapeType:function(){return dI},UpdateEventKind:function(){return bi},ViewMode:function(){return iP},ViewVisionMode:function(){return TP},WhiteVersion:function(){return MT},WhiteWebSdk:function(){return PT},autorun:function(){return Ix.autorun},contentModeAspectFill:function(){return oI},contentModeAspectFillScale:function(){return sI},contentModeAspectFit:function(){return cI},contentModeAspectFitScale:function(){return lI},contentModeAspectFitSpace:function(){return uI},contentModeScale:function(){return aI},createPPTTask:function(){return SC},createPlugins:function(){return QP},injectCustomStyle:function(){return xM},isPlayer:function(){return uP},isRoom:function(){return cP},listenDisposed:function(){return Ao},listenUpdated:function(){return Mo},previewPPT:function(){return KS},reaction:function(){return Ix.reaction},setAsyncModuleLoadMode:function(){return wx},toJS:function(){return Jx},unlistenDisposed:function(){return Eo},unlistenUpdated:function(){return To}});var Q={sdkVersion:"2.16.35",defaultRegion:"cn-hz",modules:{identifier:"link.netless/white-model-render",origin:"https://sdk.netless.link"},shuntApiHosts:["api.netless.link","api.whiteboard.agora.io"],hosts:{pptApi:["api.netless.link"]},log:{argusOptions:{reportResourceURL:"https://rest-argus-ad.agoralab.co/v3/report",vid:3}}};(0,Y(n(68949)).configure)({useProxies:window.__netlessMobXUseProxies,isolateGlobalState:!0});Y(n(35827));var K={};G(K,{ActionFrameType:function(){return Vn},AdminObserverId:function(){return an},AkkoApp:function(){return eu},AkkoFetcher:function(){return mn},AkkoVersion:function(){return He},Environment:function(){return Ur},EventPhase:function(){return Sr},EventScope:function(){return Wn},FramePicker:function(){return sr},ImagePhase:function(){return ea},KickReason:function(){return yi},Library:function(){return li},MagixPhase:function(){return Dc},NullIdentifier:function(){return mt},ReconstructorFactory:function(){return $c},ReconstructorPhase:function(){return Xc},ReconstructorSeekingResult:function(){return Qc},SocketErrorCode:function(){return Vi},UpdateEventKind:function(){return bi},__context:function(){return wi},copy:function(){return bs},createBuffer:function(){return ye},createElement:function(){return Ra},event:function(){return Er},findClass:function(){return ys},findClassId:function(){return gs},findIdentifierWith:function(){return Bo},getAuthorId:function(){return Mi},getClassReflection:function(){return Ci},getCurrentTimestamp:function(){return Pi},getEnvironment:function(){return Ii},getLibrary:function(){return Si},getResource:function(){return Hr},getSnapshot:function(){return Ri},getUser:function(){return Ei},getUserIds:function(){return Oi},getUsersCount:function(){return Ai},hasUser:function(){return Ti},isAkkoObject:function(){return xi},isAkkoWrappedObject:function(){return mo},isAkkoWrappedObjectAccessible:function(){return vs},isBuffer:function(){return ke},isInstanceOf:function(){return ms},listenDisposed:function(){return Ao},listenUpdated:function(){return Mo},noEffects:function(){return Cr},resolve:function(){return Ie},socketFactory:function(){return Wi},transient:function(){return xr},translateToAckFrame:function(){return or},unlistenDisposed:function(){return Eo},unlistenUpdated:function(){return To},wrapBuffer:function(){return be}});var q=Y(n(8322)),Z=Object.defineProperty,J=Object.defineProperties,$=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,re=function(e,t,n){return t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},ie=function(e,t){for(var n in t||(t={}))te.call(t,n)&&re(e,n,t[n]);if(ee){var r,i=T(ee(t));try{for(i.s();!(r=i.n()).done;){n=r.value;ne.call(t,n)&&re(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},ae=function(e,t){return J(e,$(t))},oe=function(){function e(){C(this,e)}return P(e,[{key:"id",get:function(){return void 0===this._id&&(this._id="".concat(e.nextBufferId),e.nextBufferId+=1),this._id}}]),e}();oe.nextBufferId=0;var se=function(){for(var e={},t=0;t<256;++t){var n=t.toString(16);1===n.length&&(e["0"+n]=t),e[n]=t}return Object.freeze(e)}(),ce=function(){for(var e=[],t=0;t<256;++t){var n=t.toString(16);1===n.length?e[t]="0"+n:e[t]=n}return Object.freeze(e)}();function ue(e,t,n){for(var r=new String(new Number(n).toString(16)),i=16-r.length,a=0;a<8;++a){var o=2*a-i;if(o<-1)e.setUint8(t+a,0);else if(-1===o){var s=r.substr(0,1),c=se[s];e.setUint8(t+a,c)}else{var u=r.substr(o,2),l=se[u];e.setUint8(t+a,l)}}}function le(e,t){for(var n="",r=0;r<8;++r){var i=e.getUint8(t+r);n+=ce[i]}return parseInt(n,16)}var he,de,pe=function(e){g(n,e);var t=b(n);function n(e,r){var i;return C(this,n),(i=t.call(this)).buffer=e,i.create=r,i}return P(n,[{key:"readonly",get:function(){return!0}},{key:"byteLength",get:function(){return this.buffer.byteLength}},{key:"primitiveBuffer",get:function(){return this.buffer}},{key:"isEqualsTo",value:function(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t)if(this.getUint8(t)!==e.getUint8(t))return!1;return!0}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.buffer.length-e,n=this.create(t),r=n.buffer,i=0;i<t;++i)r.writeUInt8(this.buffer.readUInt8(e+i),i);return n}},{key:"getFloat64",value:function(e){return this.buffer.readDoubleLE(e)}},{key:"getUint16",value:function(e){return this.buffer.readUInt16LE(e)}},{key:"getInt32",value:function(e){return this.buffer.readInt32LE(e)}},{key:"getUint32",value:function(e){return this.buffer.readUInt32LE(e)}},{key:"getUint8",value:function(e){return this.buffer.readUInt8(e)}},{key:"getUint64",value:function(e){return le(this,e)}}]),n}(oe),fe=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"readonly",get:function(){return!1}},{key:"freeze",value:function(){return Object.setPrototypeOf(this,pe.prototype),this}},{key:"fill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.byteLength-n,i=e.primitiveBuffer;if(i instanceof ArrayBuffer){for(var a=new DataView(i),o=this.buffer.byteLength-t,s=Math.min(r,o),c=0;c<s;++c)this.buffer.writeUInt8(a.getUint8(c+n),c+t);return s}return i.copy(this.buffer,t,n,n+r)}},{key:"setFloat64",value:function(e,t){this.buffer.writeDoubleLE(t,e)}},{key:"setUint16",value:function(e,t){this.buffer.writeUInt16LE(t,e)}},{key:"setInt32",value:function(e,t){this.buffer.writeInt32LE(t,e)}},{key:"setUint32",value:function(e,t){this.buffer.writeUInt32LE(t,e)}},{key:"setUint8",value:function(e,t){this.buffer.writeUInt8(t,e)}},{key:"setUint64",value:function(e,t){ue(this,e,t)}}]),n}(pe),ve=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this)).arrayBuffer=e,r.dataView=new DataView(e),r}return P(n,[{key:"readonly",get:function(){return!0}},{key:"byteLength",get:function(){return this.arrayBuffer.byteLength}},{key:"primitiveBuffer",get:function(){return this.arrayBuffer}},{key:"isEqualsTo",value:function(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t)if(this.getUint8(t)!==e.getUint8(t))return!1;return!0}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dataView.byteLength-e,n=new ArrayBuffer(t),r=new DataView(n),i=0;i<t;++i)r.setUint8(i,this.dataView.getUint8(e+i));return new me(n)}},{key:"getFloat64",value:function(e){return this.dataView.getFloat64(e,!0)}},{key:"getUint16",value:function(e){return this.dataView.getUint16(e,!0)}},{key:"getInt32",value:function(e){return this.dataView.getInt32(e,!0)}},{key:"getUint32",value:function(e){return this.dataView.getUint32(e,!0)}},{key:"getUint8",value:function(e){return this.dataView.getUint8(e)}},{key:"getUint64",value:function(e){return le(this,e)}}]),n}(oe),me=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"readonly",get:function(){return!1}},{key:"freeze",value:function(){return Object.setPrototypeOf(this,ve.prototype),this}},{key:"fill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,i=e.primitiveBuffer,a=this.dataView.byteLength-t,o=Math.min(r,a);if(i instanceof ArrayBuffer)for(var s=new DataView(i),c=0;c<o;++c)this.dataView.setUint8(c+t,s.getUint8(c+n));else for(var u=0;u<o;++u)this.dataView.setUint8(u+t,i.readUInt8(u+n));return o}},{key:"setFloat64",value:function(e,t){this.dataView.setFloat64(e,t,!0)}},{key:"setUint16",value:function(e,t){this.dataView.setUint16(e,t,!0)}},{key:"setInt32",value:function(e,t){this.dataView.setInt32(e,t,!0)}},{key:"setUint32",value:function(e,t){this.dataView.setUint32(e,t,!0)}},{key:"setUint8",value:function(e,t){this.dataView.setUint8(e,t)}},{key:"setUint64",value:function(e,t){ue(this,e,t)}}]),n}(ve),ge=new function e(){var t=this;C(this,e),this.create=function(e){return t.nodeBuffer?new fe(t.nodeBuffer.alloc(e),t.create):new me(new ArrayBuffer(e))},this.wrap=function(e){return t.nodeBuffer&&e instanceof t.nodeBuffer?new fe(e,t.create):new me(e)},this.nodeBuffer="function"==typeof i?n.g.Buffer:null},ye=ge.create,be=ge.wrap;function ke(e){return e instanceof pe||e instanceof ve}(de=he||(he={})).Any="any",de.Never="never",de.Undefined="undefined",de.Null="null",de.String="string",de.Number="number",de.Boolean="boolean",de.Function="function",de.Object="object",de.And="and",de.Or="or",de.Generic="generic",de.Generator="generator",de.Reference="reference",de.GlobalReference="globalReference";var we=function(){function e(){C(this,e),this.singletonMap=e.createSingletonMap()}return P(e,[{key:"getSingletonType",value:function(e){return this.singletonMap[e]}},{key:"getFunctionType",value:function(){return{typeEnum:he.Function}}},{key:"getObjectType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=e.index,r=e.properties;return{typeEnum:he.Object,key:t||this.getSingletonType(he.Undefined),index:n||this.getSingletonType(he.Undefined),properties:r||{}}}},{key:"getCompoundType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{typeEnum:e,children:t}}},{key:"getGenericType",value:function(e){return{index:e,typeEnum:he.Generic}}},{key:"getGeneratorType",value:function(e){var t=e.template,n=e.params;return{typeEnum:he.Generator,template:t,params:n||[]}}},{key:"getReferenceType",value:function(e){return{typeEnum:he.Reference,name:e}}},{key:"getGlobalReferenceType",value:function(e,t){return{typeEnum:he.GlobalReference,path:e,name:t}}}],[{key:"createSingletonMap",value:function(){for(var e={},t=0,n=[he.Any,he.Never,he.Undefined,he.Null,he.String,he.Number,he.Boolean];t<n.length;t++){var r=n[t];e[r]={typeEnum:r}}return Object.freeze(e)}}]),e}(),Se=new we,xe=(Se.getSingletonType.bind(Se),Se.getFunctionType.bind(Se),Se.getObjectType.bind(Se),Se.getCompoundType.bind(Se),Se.getGenericType.bind(Se),Se.getGeneratorType.bind(Se),Se.getReferenceType.bind(Se),Se.getGlobalReferenceType.bind(Se),function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).name="RuntimeError",r}return n}(v(Error))),Ce=function(){function e(t,n,r,i){C(this,e),this.akkoVersion=t,this.akkoObjectBaseClass=n,this.libraryFactory=r,this.onCreatedLibrary=i,this.classHandlers={}}return P(e,[{key:"baseClass",value:function(){return this.akkoObjectBaseClass}},{key:"wrapSuperClass",value:function(e){if(e===Object)return this.akkoObjectBaseClass;if("function"!=typeof e)return e;for(var t=e;t!==this.akkoObjectBaseClass;){var n=Object.getPrototypeOf(t.prototype);if(!n)throw new xe("class ".concat(e.name," can't be extended, it's out of library"));t=n.constructor}return e}},{key:"declareClass",value:function(e){var t=e.classId,n=e.clazz,r=e.superClass,i=e.memberDecorators;if(this.classHandlers[t])throw new xe("class id ".concat(t," was declared"));this.classHandlers[t]={classId:t,clazz:n,superClass:r,memberDecorators:i||{}}}},{key:"createLibrary",value:function(e,t){var n={};for(var r in t.classes){var i,a=t.classes[r],o=this.classHandlers[r],s=[],c=T(a.members);try{for(c.s();!(i=c.n()).done;){var u=i.value,l=o.memberDecorators[u.name];s.push(ae(ie({},u),{decorators:l||Object.freeze([])}))}}catch(e){c.e(e)}finally{c.f()}n[r]={classId:o.classId,clazz:o.clazz,superClass:o.superClass,objectFormatId:a.objectFormatId,members:s}}var h=this.libraryFactory({appIdentifier:t.identifier,appVersion:t.version,akkoVersion:t.akko,formatBase64:t.formatBase64,formatHash:t.formatHash,rootConstructor:e,classDeclarations:n});return Object.defineProperty(e,"__library",{enumerable:!1,configurable:!1,writable:!1,value:h}),this.onCreatedLibrary(h),e}}]),e}();function Ie(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map((function(e){return Pe(e)})).forEach((function(t){e=0!==e.length&&Me(t)?Te(e,t):t})),e.join("/")}function Pe(e){var t=e.split("/");return t.length>0&&("."===t[0]&&t.shift(),""===t[t.length-1]&&t.pop()),t}function Me(e){return e.length>0&&""!==e[0]}function Te(e,t){var n=Ae(e),r=Ae(t);if(n.pureCells.length>r.doubleDotsCount){for(var i=0;i<r.doubleDotsCount;++i)n.pureCells.pop();return[].concat(p(Ee(n.doubleDotsCount)),p(n.pureCells),p(r.pureCells))}var a=r.doubleDotsCount-n.pureCells.length;return[].concat(p(Ee(n.doubleDotsCount+a)),p(r.pureCells))}function Ae(e){var t,n=[],r=0,i=T(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;".."===a?r+=1:n.push(a)}}catch(e){i.e(e)}finally{i.f()}return{doubleDotsCount:r,pureCells:n}}function Ee(e){for(var t=[],n=0;n<e;++n)t.push("..");return t}var Oe,Re,Ne=function e(t){var n=this;C(this,e),this.contextsStack=[],this.context=function(e){switch(e){case"index":var t=function(e){var t=new Ce(e.akkoVersion,e.akkoObjectBaseClass,e.libraryFactory,e.onCreatedLibrary);return Object.freeze({baseClass:t.baseClass.bind(t),wrapSuperClass:t.wrapSuperClass.bind(t),declareClass:t.declareClass.bind(t),createLibrary:t.createLibrary.bind(t),creator:e.coreFunctions.creator,updater:e.coreFunctions.updater,wrapper:e.coreFunctions.wrapper,unwrapper:e.coreFunctions.unwrapper,jsxUnwrapper:e.coreFunctions.jsxUnwrapper,getter:e.coreFunctions.getter,setter:e.coreFunctions.setter,caller:e.coreFunctions.caller,remover:e.coreFunctions.remover,prefix:e.coreFunctions.prefix,postfix:e.coreFunctions.postfix})}({akkoVersion:n.akkoVersion,akkoObjectBaseClass:n.akkoObjectBaseClass,libraryFactory:n.libraryFactory,coreFunctions:n.coreFunctions,onCreatedLibrary:function(){return n.contextsStack.pop()}});return n.contextsStack.push(t),t;case"module":var r=n.contextsStack[n.contextsStack.length-1];if(!r)throw new xe("can't import index out of library");return r;default:throw new xe("unexpect mode ".concat(JSON.stringify(e)))}},this.isAkkoObject=function(e){return e instanceof n.akkoObjectBaseClass},this.getLibrary=function(e){if("function"==typeof e){var t=e.__library;if("object"==M(t))return t}else if(n.isAkkoObject(e))return n.getLibrary(e.constructor)},this.akkoVersion=t.akkoVersion,this.akkoObjectBaseClass=t.akkoObjectBaseClass,this.libraryFactory=t.libraryFactory,this.coreFunctions=Object.freeze(ie({},t.coreFunctions))};function Le(e){return e.type===Oe.Property}function je(e){return e.type===Oe.Method}!function(e){e.Method="method",e.Property="property"}(Oe||(Oe={})),function(e){e.Value="value",e.Readonly="readonly",e.Writeonly="writeonly",e.Accessible="accessible"}(Re||(Re={}));var De=function(){function e(t){var n=this;C(this,e),this.invoker=t,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var e=Date.now();if(e>=n.fireAt)n.timer=null,n.fireAt=-1,n.invoker();else{var t=n.fireAt-e;n.timer=setTimeout(n.invokeWhenTimeout,t)}}}return P(e,[{key:"isRunning",get:function(){return null!==this.timer}},{key:"refreshAndInvokeAfterInterval",value:function(e){var t=Date.now();if(null===this.timer)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var n=t+e;n<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=n}}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}},{key:"dispose",value:function(){this.cancel(),this.invoker=e.emptyInvoker}}],[{key:"emptyInvoker",value:function(){}}]),e}();function Fe(e){return"object"==("undefined"==typeof window?"undefined":M(window))&&"requestIdleCallback"in window?new Be(e):new ze}var ze=function(){function e(){C(this,e)}return P(e,[{key:"invokeOnIdle",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Promise((function(t,r){try{t(e.apply(void 0,n))}catch(e){r(e)}}))}},{key:"invoke",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}}]),e}(),Be=function(){function e(t){var n=this;C(this,e),this.queue=[],this.isWaitingIdle=!1,this.onFire=function(){try{if(n.queue.length>0){var e,t=n.config,r=t.checkingTimeMod,i=t.maxInvokingDuration,a=t.maxPaddingDuration,o=Date.now();for(e=0;e<n.queue.length;++e){var s=n.queue[e];if(n.handle(s),o<s.beginAt+a&&0!==e&&e%r==0&&Date.now()-o>i)break}n.queue.splice(0,e+1),n.isWaitingIdle=!1,n.queue.length>0&&n.requestNextFire()}}catch(r){console.error("[Error] IdleQueue is crash (akko-core)"),console.error(r)}},this.handle=function(e){var t=e.invoker,n=e.params,r=e.resolve,i=e.reject;try{r(t.apply(void 0,p(n)))}catch(e){i(e)}},this.config=Object.freeze(ie({},t))}return P(e,[{key:"invoke",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.queue.length>0&&this.queue.splice(0).forEach(this.handle),e.apply(void 0,n)}},{key:"invokeOnIdle",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new Promise((function(n,i){var a=Date.now();t.queue.push({invoker:e,params:r,beginAt:a,resolve:n,reject:i}),!t.isWaitingIdle&&1===t.queue.length&&(t.isWaitingIdle=!0,t.requestNextFire())}))}},{key:"requestNextFire",value:function(){window.requestIdleCallback(this.onFire,{timeout:this.config.timeout})}}]),e}(),Ue=function(){function e(t,n){C(this,e),this.isFreezed=!1,this.shouldInvokeAfterFreeze=!1,this.latestInvokeTimestamp=0,this.timer=-1,this._limitDuration=t,this.invoker=n,this.invokeWhenTimeout=this.invokeWhenTimeout.bind(this)}return P(e,[{key:"limitDuration",get:function(){return this._limitDuration},set:function(e){if(this._limitDuration!==e){if(this._limitDuration=e,-1!==this.timer){clearTimeout(this.timer);var t=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,t)}this.invoke()}}},{key:"isWaitingToInvoke",get:function(){return this.shouldInvokeAfterFreeze||-1!==this.timer}},{key:"invoke",value:function(){if(this.isFreezed)this.shouldInvokeAfterFreeze=!0;else if(-1===this.timer){var e=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,e)}}},{key:"nextInvokeTimeDuration",value:function(){var e=Date.now(),t=this.latestInvokeTimestamp+this.limitDuration-e;return Math.max(0,t)}},{key:"invokeWhenTimeout",value:function(){this.timer=-1,this.latestInvokeTimestamp=Date.now(),this.invoker()}},{key:"cancel",value:function(){this.isFreezed?this.shouldInvokeAfterFreeze=!1:-1!==this.timer&&(clearTimeout(this.timer),this.timer=-1)}},{key:"freeze",value:function(){this.isFreezed||(-1!==this.timer&&(clearTimeout(this.timer),this.timer=-1,this.shouldInvokeAfterFreeze=!0),this.isFreezed=!0)}},{key:"unfreeze",value:function(){!this.isFreezed||(this.isFreezed=!1,this.shouldInvokeAfterFreeze&&(this.shouldInvokeAfterFreeze=!1,this.invoke()))}}]),e}(),Ve=Object.freeze(["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]),We=function(){function e(t,n,r,i){C(this,e),this.x=t,this.y=n,this.z=r,this.suffix=i,Object.freeze(this)}return P(e,[{key:"withoutSuffix",value:function(){return new e(this.x,this.y,this.z)}},{key:"toString",value:function(){var e="".concat(this.x,".").concat(this.y,".").concat(this.z);return this.suffix&&(e+="-".concat(this.suffix.greekLetter,".").concat(this.suffix.number)),e}}],[{key:"parse",value:function(t){if(!/^\d+\.\d+\.\d+(-\w+\.\d+)?$/i.test(t))throw new Error("invalid version format ".concat(JSON.stringify(t)));var n,r=t.match(/-\w+\.\d+$/),i=t;r&&(n=e.parseSuffix(t,r[0].replace(/^-/i,"")),i=t.substring(0,t.length-r[0].length));var a=l(e.parseVersionArray(t,i),3);return new e(a[0],a[1],a[2],n)}},{key:"parseSuffix",value:function(e,t){var n=t.split("."),r=n[0];if(-1===Ve.indexOf(r))throw new Error("invalid Greek letter ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));var i=parseInt(n[1],10);if(!Number.isSafeInteger(i))throw new Error("invalid version number ".concat(JSON.stringify(i)," of ").concat(JSON.stringify(e)));return Object.freeze({greekLetter:r,number:i})}},{key:"parseVersionArray",value:function(e,t){var n,r=[],i=T(t.split("."));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=parseInt(a,10);if(!Number.isSafeInteger(o))throw new Error("invalid version number ".concat(JSON.stringify(a)," of ").concat(JSON.stringify(e)));r.push(o)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"compare",value:function(e,t){var n=e.x-t.x;if(0!==n||0!==(n=e.y-t.y)||0!==(n=e.z-t.z))return n;if(!e.suffix&&t.suffix)return 1;if(e.suffix&&!t.suffix)return-1;if(!e.suffix&&!t.suffix)return 0;var r=e.suffix.greekLetter,i=t.suffix.greekLetter;return 0!==(n=Ve.indexOf(r)-Ve.indexOf(i))?n:e.suffix.number-t.suffix.number}}]),e}(),He="1.4.4",_e=Y(n(8322)),Ge=Object.defineProperty,Ye=Object.defineProperties,Xe=Object.getOwnPropertyDescriptors,Qe=Object.getOwnPropertySymbols,Ke=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable,Ze=function(e,t,n){return t in e?Ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Je=function(e,t){for(var n in t||(t={}))Ke.call(t,n)&&Ze(e,n,t[n]);if(Qe){var r,i=T(Qe(t));try{for(i.s();!(r=i.n()).done;){n=r.value;qe.call(t,n)&&Ze(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e};var $e,et,tt,nt=Math.pow(2,32),rt=(Math.pow(2,16),nt-1),it=function(){function e(){C(this,e),this._length=0,this.bufferChunks=[],this.appendNewChunk()}return P(e,[{key:"length",get:function(){return this._length}},{key:"toBuffer",value:function(){var e,t=ye(this.length),n=0,r=T(this.bufferChunks);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.fill(i.buffer,n,0,i.length),n+=i.length}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"generateHash",value:function(e,t){for(var n=0,r=e;;){if(n>=this.bufferChunks.length)return"";var i=this.bufferChunks[n].length;if(r<i)break;r-=i,n+=1}for(var a=t,o=new q.default,s=[0];n<this.bufferChunks.length;++n){for(var c=this.bufferChunks[n],u=c.buffer,l=c.length,h=r;h<l;++h)if(s[0]=u.getUint8(h),o.appendBinary(String.fromCharCode.apply(String,s)),(a-=1)<=0)return o.end(!0);r=0}return o.end(!0)}},{key:"pushBuffer",value:function(e,t,n){var r=Math.min(n,this.currentChunk.buffer.byteLength-this.currentChunk.length);r>0&&(this.currentChunk.buffer.fill(e,this.currentChunk.length,t,r),this.currentChunk.length+=r,this._length+=r);var i=n-r;i>0&&(this.currentChunk={buffer:e.slice(t+r,i),length:i},this.bufferChunks.push(this.currentChunk),this._length+=i)}},{key:"pushUint8",value:function(e){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint8(this.currentChunk.length,e),this.currentChunk.length+=1,this._length+=1}},{key:"pushUint8Holder",value:function(){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=1,this._length+=1,function(n){return t.setUint8(e,n)}}},{key:"pushUint16",value:function(e){this.currentChunk.length+2>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint16(this.currentChunk.length,e),this.currentChunk.length+=2,this._length+=2}},{key:"pushInt32",value:function(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setInt32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32",value:function(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32Holder",value:function(){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=4,this._length+=4,function(n){return t.setUint32(e,n)}}},{key:"pushFloat64",value:function(e){this.currentChunk.length+8>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setFloat64(this.currentChunk.length,e),this.currentChunk.length+=8,this._length+=8}},{key:"appendNewChunk",value:function(){var e=ye(256);this.currentChunk={buffer:e,length:0},this.bufferChunks.push(this.currentChunk)}}]),e}();!function(e){e[e.Never=0]="Never",e[e.Undefined=1]="Undefined",e[e.Null=2]="Null",e[e.String=3]="String",e[e.Integer32=4]="Integer32",e[e.Integer53=5]="Integer53",e[e.Float=6]="Float",e[e.Function=7]="Function",e[e.Object=8]="Object",e[e.Array=9]="Array",e[e.True=10]="True",e[e.False=11]="False",e[e.Buffer=12]="Buffer",e[e.HangUpObject=13]="HangUpObject"}($e||($e={})),function(e){e[e.Array=0]="Array",e[e.DeducedObject=1]="DeducedObject",e[e.AssertedObject=2]="AssertedObject",e[e.HangUpObject=3]="HangUpObject"}(et||(et={})),function(e){e[e.Array=0]="Array",e[e.Object=1]="Object",e[e.HangUpObject=2]="HangUpObject"}(tt||(tt={}));var at="__identifier",ot="__hangUpMetadata",st=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};C(this,e),this.decorateObjectEnums=Object.freeze([1]),this.decorateObject=t}return P(e,[{key:"createObject",value:function(e,t){var n=0===t?[]:{};return Object.defineProperty(n,at,{enumerable:!1,configurable:!0,value:e}),n}},{key:"findIdentifier",value:function(e){return e[at]}},{key:"findHangUpMetadata",value:function(e){return e[ot]}},{key:"checkObjectEnum",value:function(e){return e.constructor===Array?0:ot in e?2:1}},{key:"length",value:function(e){return e.length}},{key:"keys",value:function(e){return Object.keys(e)}},{key:"hasKey",value:function(e,t){return t in e}},{key:"getValue",value:function(e,t){return e[t]}},{key:"setValue",value:function(e,t,n){e[t]=n}},{key:"completeHangUpObject",value:function(e,t){Object.defineProperty(e,ot,{enumerable:!1,configurable:!0,value:Object.freeze(Je({},t))})}}]),e}();function ct(){var e={id:-1};return e.key=e,e.index=e,e.properties=Object.freeze({}),Object.freeze(e)}var ut="0".charCodeAt(0),lt="9".charCodeAt(0)+1,ht="a".charCodeAt(0),dt="f".charCodeAt(0)+1,pt=15,ft=function(){function e(){C(this,e);for(var t=[],n=[],r=0;r<16;++r){var i=r.toString(16).charCodeAt(0);t[r]=i,n[i]=r}this.integerToCode=Object.freeze(t),this.codeToInteger=Object.freeze(n)}return P(e,[{key:"cleanUnmeaningZero",value:function(e,t){for(;e.length>t&&0===this.codeToInteger[e[e.length-1]];)e.pop()}},{key:"pushInt53",value:function(e,t){var n=0|t,r=(t-n)/nt;this.pushUint32(e,n),this.pushUint32(e,r)}},{key:"readInt53",value:function(e,t){var n=this.readInt32(e,t);return this.readInt32(e,t+8)*nt+n}},{key:"pushUint32",value:function(e,t){var n=e.length;e[n]=this.integerToCode[t&pt],e[n+1]=this.integerToCode[t>>4&pt],e[n+2]=this.integerToCode[t>>8&pt],e[n+3]=this.integerToCode[t>>12&pt],e[n+4]=this.integerToCode[t>>16&pt],e[n+5]=this.integerToCode[t>>20&pt],e[n+6]=this.integerToCode[t>>24&pt],e[n+7]=this.integerToCode[t>>28&pt]}},{key:"readUint32",value:function(e,t){var n=this.readInt32(e,t);return n<0&&(n+=nt),n}},{key:"readInt32",value:function(e,t){for(var n=0,r=0;r<8;++r){var i=this.codeToInteger[e.charCodeAt(t+r)];if(void 0===i)return NaN;n|=i<<4*r}return n}},{key:"parseCode",value:function(e){return this.codeToInteger[e]}},{key:"toCode",value:function(e){return this.integerToCode[e]}},{key:"increment",value:function(e,t){for(var n=t;;){if(e.length<=n){e[n]=ut+1;break}var r=!0;switch(e[n]+=1,e[n]){case lt:e[n]=ht;break;case dt:e[n]=ut,n+=1,r=!1}if(r)break}}},{key:"parseString",value:function(e){for(var t=new String(e),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n}},{key:"stringify",value:function(e){return String.fromCharCode.apply(String,e)}}]),e}(),vt=new ft,mt="";function gt(e,t){var n=[];return vt.pushInt53(n,e),"number"==typeof t&&(vt.pushInt53(n,t),vt.cleanUnmeaningZero(n,16)),new yt(e,n)}var yt=function(){function e(t,n){C(this,e),this.scopeId=t,this.codes=n}return P(e,[{key:"generate",value:function(){var e=vt.stringify(this.codes);return vt.increment(this.codes,16),e}},{key:"createdCount",get:function(){for(var e=16,t=0,n=0,r=0;r<8;++r){var i=this.codes[e+r];t|=(i=void 0===i?0:vt.parseCode(i))<<4*r}e+=8;for(var a=0;a<8;++a){var o=this.codes[e+a];n|=(o=void 0===o?0:vt.parseCode(o))<<4*a}return n*nt+t}},{key:"clone",value:function(){return new e(this.scopeId,p(this.codes))}}]),e}(),bt=function(){function e(t,n){C(this,e),this.observerId=t,this.codes=n,this._createdCount=0}return P(e,[{key:"scopeId",get:function(){return 0}},{key:"createdCount",get:function(){return this._createdCount}},{key:"generate",value:function(){return this._createdCount+=1,vt.increment(this.codes,8),vt.stringify(this.codes)}},{key:"clone",value:function(){return new e(this.observerId,p(this.codes))}},{key:"makeSureNextGenerationIdAfter",value:function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);if(void 0===vt.parseCode(r))throw new Error("invalid generationId");t[n]=r}for(var i=0;i<t.length;++i)this.codes[i+8]=t[i]}}]),e}(),kt=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).name="SerializerError",r}return n}(v(Error)),wt=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).name="DeserializerError",r}return n}(v(Error)),St=Math.pow(2,31)-1,xt=-Math.pow(2,31),Ct=function(){function e(t,n,r,i){C(this,e),this.writer=t,this.objectFormats=n,this.objectAdapter=r,this.assertObjectFormat=i,this.anyObjectFormat=ct(),this.serializeTasksQueue=[],this.serializeBufferQueue=[],this.didObjectInQueueSet={},this.bufferIndexMap={}}return P(e,[{key:"serialize",value:function(e,t){var n=this.writer.putUint32Holder(),r=this.writer.didWriteBytes,i=1;1!==this.objectFormats.length&&(this.writer.writeUint32(e.length),i=e.length);for(var a=0;a<i;++a){var o=this.objectFormats[a]||this.anyObjectFormat,s=e[a];this.serializeValue(o,s)}for(;this.serializeTasksQueue.length>0;){var c=this.serializeTasksQueue.pop();this.handleSerializeTask(c)}this.writer.writeBigInt(mt),this.writer.writeUint32(this.serializeBufferQueue.length);var u,l=T(this.serializeBufferQueue);try{for(l.s();!(u=l.n()).done;){var h=u.value;this.writer.writeUint8(h.readonly?255:0),this.writer.writeBuffer(h)}}catch(e){l.e(e)}finally{l.f()}var d=this.writer.didWriteBytes-r,p=t?this.writer.generateHash(r,d):Qt;this.serializeHash(p),n(d+Xt)}},{key:"serializeValue",value:function(e,t){"object"!=M(t)?this.serializeNotObjectValue(t):null===t?this.writer.writeUint8($e.Null):ke(t)?this.serializeBufferValue(t):this.serializeObjectValue(e,t)}},{key:"handleSerializeTask",value:function(e){var t=e.identifier,n=e.object,r=e.objectEnum,i=e.deducedFormat;switch(this.writer.writeBigInt(t),r){case tt.Array:this.writer.writeUint8(et.Array),this.handleArraySerializeTask(n,i);break;case tt.Object:var a=this.assertObjectFormat(n),o=a?et.AssertedObject:et.DeducedObject,s=a||i,c=!a;this.writer.writeUint8(o),this.handleObjectSerializeTask(n,s,c);break;case tt.HangUpObject:var u=this.objectAdapter.findHangUpMetadata(n),l=We.parse(u.version),h=l.x,d=l.y,p=l.z;this.writer.writeUint8(et.HangUpObject),this.writer.writeUint32(u.objectFormatId),this.writer.writeUint16(h),this.writer.writeUint16(d),this.writer.writeUint16(p),this.writer.writeUint8($e.Never),this.handleHangUpObjectSerializeTask(n)}}},{key:"serializeNotObjectValue",value:function(e){switch(M(e)){case"undefined":this.writer.writeUint8($e.Undefined);break;case"string":this.writer.writeUint8($e.String),this.writer.writeString(e);break;case"number":Number.isSafeInteger(e)?xt<=e&&e<=St?(this.writer.writeUint8($e.Integer32),this.writer.writeInt32(e)):(this.writer.writeUint8($e.Integer53),this.writer.writeInt53(e)):(this.writer.writeUint8($e.Float),this.writer.writeFloat64(e));break;case"boolean":e?this.writer.writeUint8($e.True):this.writer.writeUint8($e.False);break;default:throw new kt("not support ".concat(M(e)," now"))}}},{key:"serializeBufferValue",value:function(e){var t=this.bufferIndexMap[e.id];void 0===t&&(t=this.serializeBufferQueue.length,this.bufferIndexMap[e.id]=t,this.serializeBufferQueue[t]=e),this.writer.writeUint8($e.Buffer),this.writer.writeUint32(t)}},{key:"serializeObjectValue",value:function(e,t){var n,r=this.objectAdapter.findIdentifier(t),i=this.objectAdapter.checkObjectEnum(t);switch(i){case tt.Array:n=$e.Array;break;case tt.Object:n=$e.Object;break;case tt.HangUpObject:n=$e.HangUpObject;break;default:throw new Error("unrecognized object enum ".concat(i))}this.writer.writeUint8(n),this.writer.writeUint8(0),this.writer.writeBigInt(r),this.pushToSerializeTaskQueueIfFirstCall({identifier:r,object:t,deducedFormat:e,objectEnum:i})}},{key:"pushToSerializeTaskQueueIfFirstCall",value:function(e){this.didObjectInQueueSet[e.identifier]||(this.didObjectInQueueSet[e.identifier]=!0,this.serializeTasksQueue.push(e))}},{key:"handleArraySerializeTask",value:function(e,t){var n=this.objectAdapter.length(e),r=t.index;this.writer.writeUint32(n);for(var i=0;i<n;++i)this.serializeValue(r,this.objectAdapter.getValue(e,i))}},{key:"handleObjectSerializeTask",value:function(e,t,n){for(var r in this.writer.writeUint32(t.id),t.properties){var i=t.properties[r];this.objectAdapter.hasKey(e,r)?this.serializeValue(i,this.objectAdapter.getValue(e,r)):this.writer.writeUint8($e.Never)}if(n){var a,o=this.writer.putUint32Holder(),s=0,c=T(this.objectAdapter.keys(e));try{for(c.s();!(a=c.n()).done;){var u=a.value;u in t.properties||(this.writer.writeString(u),this.serializeValue(t.key,this.objectAdapter.getValue(e,u)),s+=1)}}catch(e){c.e(e)}finally{c.f()}o(s)}else this.writer.writeUint32(0)}},{key:"handleHangUpObjectSerializeTask",value:function(e){var t,n=this.writer.putUint32Holder(),r=0,i=T(this.objectAdapter.keys(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;this.writer.writeString(a),this.serializeValue(this.anyObjectFormat,this.objectAdapter.getValue(e,a)),r+=1}}catch(e){i.e(e)}finally{i.f()}n(r)}},{key:"serializeHash",value:function(e){for(var t=0;t<Xt;++t)t<e.length?this.writer.writeUint8(e.charCodeAt(t)):this.writer.writeUint8(0)}}]),e}(),It=function(){function e(t,n,r,i){C(this,e),this.reader=t,this.format=n,this.objectAdapter=r,this.valuesLength=i,this.objectStateMap={},this.holdersMap={},this.deserializeBufferSetterQueue=[],this.cacheMap=Object.freeze([{},{},{}])}return P(e,[{key:"deserialize",value:function(t){for(var n=e.simpleObjectAdapter,r=this.reader.readUint32(),i=this.reader.didReadBytes,a=this.deserializeRootValuesLength(),o=[],s=0;s<a;++s)this.deserializeValue(n,o,s);for(;;){var c=this.reader.readBigInt();if(c===mt)break;this.deserializeArrayOrObjectBody(c)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var u=this.reader.didReadBytes-i;if(r!==u+Xt)throw new wt("expect bytes ".concat(r,", instead of ").concat(u));var l=this.deserializeHash();if(!t&&l!==Qt&&l!==this.reader.generateHash(i,u))throw new wt("hash isn't matched");return o}},{key:"deserializeRootValuesLength",value:function(){return 1!==this.valuesLength?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function(){var e,t=Object.freeze([]),n=T(this.objectAdapter.decorateObjectEnums);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.cacheMap[r];for(var a in i){var o=i[a],s=this.objectStateMap[a];if(s){var c=this.holdersMap[a]||t,u=s.type,l=s.objectFormat;this.objectAdapter.decorateObject(o,u,c,l)}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"deserializeValue",value:function(e,t,n){var r,i=this.reader.readUint8();switch(i){case $e.Undefined:e.setValue(t,n,void 0);break;case $e.Null:e.setValue(t,n,null);break;case $e.String:e.setValue(t,n,this.reader.readString());break;case $e.Integer32:e.setValue(t,n,this.reader.readInt32());break;case $e.Integer53:e.setValue(t,n,this.reader.readInt53());break;case $e.Float:e.setValue(t,n,this.reader.readFloat64());break;case $e.True:e.setValue(t,n,!0);break;case $e.False:e.setValue(t,n,!1);break;case $e.Array:this.reader.readUint8(),r=this.reader.readBigInt();var a=this.readAndPushToDeserializeTaskQueueIfNeed(r,tt.Array);e.setValue(t,n,a);break;case $e.Object:this.reader.readUint8(),r=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(r,tt.Object);e.setValue(t,n,o);break;case $e.HangUpObject:this.reader.readUint8(),r=this.reader.readBigInt();var s=this.readAndPushToDeserializeTaskQueueIfNeed(r,tt.HangUpObject);e.setValue(t,n,s);break;case $e.Buffer:var c=this.reader.readUint32(),u=this.deserializeBufferSetterQueue[c];u||(u=this.deserializeBufferSetterQueue[c]=[]),u.push((function(r){return e.setValue(t,n,r)}));break;case $e.Never:break;default:throw new kt("unrecognized primitiveType ".concat(JSON.stringify(i)))}return r}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function(e,t){var n=this.cacheMap[t],r=n[e];return r||(n[e]=r=this.objectAdapter.createObject(e,t)),r}},{key:"deserializeArrayOrObjectBody",value:function(e){var t=this.reader.readUint8();switch(t){case et.Array:this.objectStateMap[e]={type:t},this.handleArrayDeserializerTask(this.cacheMap[tt.Array][e]);break;case et.DeducedObject:case et.AssertedObject:var n=this.cacheMap[tt.Object][e],r=this.reader.readUint32(),i=this.format.findObjectFormat(r);this.objectStateMap[e]={type:t,objectFormat:i},this.handleObjectDeserializerTask(n,i);break;case et.HangUpObject:var a=this.cacheMap[tt.HangUpObject][e],o=this.reader.readUint32(),s=this.reader.readUint16(),c=this.reader.readUint16(),u=this.reader.readUint16();this.objectStateMap[e]={type:t},this.reader.readUint8(),this.handleHangUpObjectDeserializerTask(a,{objectFormatId:o,version:"".concat(s,".").concat(c,".").concat(u)})}}},{key:"handleAllDeserializeBuffers",value:function(){for(var e=this.reader.readUint32(),t=0;t<e;++t){var n=this.reader.readUint8(),r=this.reader.readBuffer();n&&r.freeze();var i,a=T(this.deserializeBufferSetterQueue[t]);try{for(a.s();!(i=a.n()).done;){(0,i.value)(r)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleArrayDeserializerTask",value:function(e){for(var t=this.reader.readUint32(),n=0;n<t;++n)this.deserializeValueAndRecordHolders(e,n)}},{key:"handleObjectDeserializerTask",value:function(e,t){for(var n in t.properties)this.deserializeValueAndRecordHolders(e,n);for(var r=this.reader.readUint32(),i=0;i<r;++i){var a=this.reader.readString();this.deserializeValueAndRecordHolders(e,a)}}},{key:"handleHangUpObjectDeserializerTask",value:function(e,t){for(var n=this.reader.readUint32(),r=0;r<n;++r){var i=this.reader.readString();this.deserializeValueAndRecordHolders(e,i)}this.objectAdapter.completeHangUpObject(e,t)}},{key:"deserializeValueAndRecordHolders",value:function(e,t){var n=this.deserializeValue(this.objectAdapter,e,t);if(void 0!==n){var r=this.holdersMap[n];r||(this.holdersMap[n]=r=[]),r.push({object:e,key:t})}}},{key:"deserializeHash",value:function(){for(var e=new Array(Xt),t=0;t<Xt;++t)e[t]=this.reader.readUint8();return String.fromCharCode.apply(String,e)}}]),e}(),Pt=It;Pt.simpleObjectAdapter=new st;var Mt,Tt=function(){function e(t,n,r,i){C(this,e),this.reader=t,this.format=n,this.objectFormats=r,this.objectAdapter=i,this.arrayCacheMap={},this.objectCacheMap={},this.objectStateMap={},this.holdersMap={},this.deserializeTasksQueue=[],this.deserializeBufferSetterQueue=[]}return P(e,[{key:"deserialize",value:function(t){for(var n=e.simpleObjectAdapter,r=this.reader.readUint32(),i=this.reader.didReadBytes,a=this.deserializeRootValuesLength(),o=[],s=0;s<a;++s){var c=this.objectFormats[s]||e.neverObjectFormat;this.deserializeValue(c,n,o,s)}for(;;){var u=this.reader.readBigInt();if(u===mt)break;var l=this.takeNextDeserializerTask(u);this.handleDeserializerTask(l)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var h=this.reader.didReadBytes-i;if(r!==h+Xt)throw new wt("expect bytes ".concat(r,", instead of ").concat(h));var d=this.deserializeHash();if(!t&&d!==Qt&&d!==this.reader.generateHash(i,h))throw new wt("hash isn't matched");return o}},{key:"deserializeRootValuesLength",value:function(){return 1!==this.objectFormats.length?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function(){var e=Object.freeze([]);for(var t in this.objectCacheMap){var n=this.objectCacheMap[t],r=this.holdersMap[t]||e,i=this.objectStateMap[t],a=i.objectFormat,o=i.type;this.objectAdapter.decorateObject(n,o,r,a)}}},{key:"deserializeValueAndRecordHolders",value:function(e,t,n){var r=this.deserializeValue(e,this.objectAdapter,t,n);if(void 0!==r){var i=this.holdersMap[r];i||(this.holdersMap[r]=i=[]),i.push({object:t,key:n})}}},{key:"deserializeValue",value:function(e,t,n,r){var i;switch(this.reader.readUint8()){case $e.Undefined:t.setValue(n,r,void 0);break;case $e.Null:t.setValue(n,r,null);break;case $e.String:t.setValue(n,r,this.reader.readString());break;case $e.Integer32:t.setValue(n,r,this.reader.readInt32());break;case $e.Integer53:t.setValue(n,r,this.reader.readInt53());break;case $e.Float:t.setValue(n,r,this.reader.readFloat64());break;case $e.True:t.setValue(n,r,!0);break;case $e.False:t.setValue(n,r,!1);break;case $e.Object:i=this.reader.readBigInt();var a=this.readAndPushToDeserializeTaskQueueIfNeed(i,e,!1);t.setValue(n,r,a);break;case $e.Array:i=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(i,e,!0);t.setValue(n,r,o);break;case $e.Buffer:var s=this.reader.readUint32(),c=this.deserializeBufferSetterQueue[s];c||(c=this.deserializeBufferSetterQueue[s]=[]),c.push((function(e){return t.setValue(n,r,e)}))}return i}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function(e,t,n){var r=n?this.arrayCacheMap:this.objectCacheMap,i=r[e];return i||(r[e]=i=this.objectAdapter.createObject(e,n?tt.Array:tt.Object),this.deserializeTasksQueue.push({isArray:n,identifier:e,deducedFormat:t,object:i})),i}},{key:"takeNextDeserializerTask",value:function(e){for(var t=0;t<this.deserializeTasksQueue.length;++t){var n=this.deserializeTasksQueue[t];if(e===n.identifier)return this.deserializeTasksQueue.splice(t,1),n}throw new wt("can't find identifier ".concat(e," in task queue"))}},{key:"handleDeserializerTask",value:function(e){var t=this.reader.readUint8(),n=e.identifier;switch(t){case et.Array:if(!e.isArray)throw new wt("expect array");this.objectStateMap[n]={type:t,objectFormat:e.deducedFormat},this.handleArrayDeserializerTask(e.object,e.deducedFormat);break;case et.DeducedObject:if(e.isArray)throw new wt("expect object");this.objectStateMap[n]={type:t,objectFormat:e.deducedFormat},this.handleObjectDeserializerTask(e.object,e.deducedFormat);break;case et.AssertedObject:if(e.isArray)throw new wt("expect object");var r=this.reader.readUint32(),i=this.format.findObjectFormat(r);this.objectStateMap[n]={type:t,objectFormat:i},this.handleObjectDeserializerTask(e.object,i)}}},{key:"handleAllDeserializeBuffers",value:function(){for(var e=this.reader.readUint32(),t=0;t<e;++t){var n=this.reader.readUint8(),r=this.reader.readBuffer();n&&r.freeze();var i,a=T(this.deserializeBufferSetterQueue[t]);try{for(a.s();!(i=a.n()).done;){(0,i.value)(r)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleArrayDeserializerTask",value:function(e,t){for(var n=t.index,r=this.reader.readUint32(),i=0;i<r;++i)this.deserializeValueAndRecordHolders(n,e,i)}},{key:"handleObjectDeserializerTask",value:function(e,t){for(var n in t.properties)this.deserializeValueAndRecordHolders(t.properties[n],e,n);for(var r=this.reader.readUint32(),i=0;i<r;++i){var a=this.reader.readString();this.deserializeValueAndRecordHolders(t.key,e,a)}}},{key:"deserializeHash",value:function(){for(var e=new Array(Xt),t=0;t<Xt;++t)e[t]=this.reader.readUint8();return String.fromCharCode.apply(String,e)}}]),e}(),At=Tt;At.neverObjectFormat=ct(),At.simpleObjectAdapter=new st,function(e){e[e.V0=0]="V0",e[e.V1=1]="V1"}(Mt||(Mt={}));var Et=We.parse("1.4.2");function Ot(e){var t=e;return"string"==typeof t&&(t=We.parse(t)),We.compare(t,Et)<0?0:1}var Rt=function(){function e(t){C(this,e),this.format=t.format,this.objectAdapter=t.objectAdapter,this.assertObjectFormat=t.assertObjectFormat||function(){}}return P(e,[{key:"serialize",value:function(e){var t=e.writer,n=e.values,r=e.objectFormats,i=e.includesHash;new Ct(t,r,this.objectAdapter,this.assertObjectFormat).serialize(n,i)}},{key:"deserialize",value:function(e){var t=e.reader,n=e.objectFormats,r=e.ignoreHashChecking;switch(e.version){case Mt.V0:return new At(t,this.format,n,this.objectAdapter).deserialize(r);case Mt.V1:return new Pt(t,this.format,this.objectAdapter,n.length).deserialize(r);default:return[]}}}]),e}(),Nt="0".charCodeAt(0),Lt=function(){function e(){C(this,e),this.buffer=new it}return P(e,[{key:"generateHash",value:function(e,t){return this.buffer.generateHash(e,t)}},{key:"didWriteBytes",get:function(){return this.buffer.length}},{key:"writeBuffer",value:function(e){this.buffer.pushUint32(e.byteLength),e.byteLength>0&&this.buffer.pushBuffer(e,0,e.byteLength)}},{key:"writeUint8",value:function(e){this.buffer.pushUint8(e)}},{key:"putUint8Holder",value:function(){return this.buffer.pushUint8Holder()}},{key:"writeUint16",value:function(e){this.buffer.pushUint16(e)}},{key:"writeInt32",value:function(e){this.buffer.pushInt32(e)}},{key:"writeUint32",value:function(e){this.buffer.pushUint32(e)}},{key:"putUint32Holder",value:function(){return this.buffer.pushUint32Holder()}},{key:"writeInt53",value:function(e){var t=0|e,n=(e-t)/nt;this.buffer.pushInt32(t),this.buffer.pushInt32(n)}},{key:"writeFloat64",value:function(e){this.buffer.pushFloat64(e)}},{key:"writeString",value:function(e){var t=function(e){for(var t=new String(e),n=0,r=0,i=0;i<t.length;++i)(r=t.charCodeAt(i))<128?n+=1:r<2048?n+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,n+=4):n+=3;return n}(e);this.writeInt32(t),function(e,t){for(var n,r,i=new String(e),a=0;a<i.length;++a)(n=i.charCodeAt(a))<128?t.pushUint8(n):n<2048?(t.pushUint8(n>>6|192),t.pushUint8(63&n|128)):55296==(64512&n)&&56320==(64512&(r=i.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&r),++a,t.pushUint8(n>>18|240),t.pushUint8(n>>12&63|128),t.pushUint8(n>>6&63|128),t.pushUint8(63&n|128)):(t.pushUint8(n>>12|224),t.pushUint8(n>>6&63|128),t.pushUint8(63&n|128))}(e,this.buffer)}},{key:"writeBigInt",value:function(e){var t=e;if(t.length>255)throw new kt("length of identifier ".concat(t.length," is greater than 255"));this.buffer.pushUint8(t.length);for(var n=Math.ceil(t.length/2),r=0;r<n;++r){var i=t.charCodeAt(2*r),a=t.charCodeAt(2*r+1);Number.isNaN(a)&&(a=Nt);var o=vt.parseCode(i),s=vt.parseCode(a);if(void 0===o||void 0===s)throw new kt("invalid big integer ".concat(JSON.stringify(e)));this.buffer.pushUint8(o|s<<4)}}},{key:"writeReadSlice",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.offset,a=r.byteLength,o=r.buffer;this.buffer.pushBuffer(o,i,a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"toBuffer",value:function(){return this.buffer.toBuffer()}}]),e}(),jt=[],Dt=[0],Ft=[0,0],zt=[0,0,0],Bt=[0,0,0,0],Ut=[0,0,0,0,0],Vt=[0,0,0,0,0,0],Wt=[0,0,0,0,0,0,0],Ht=[0,0,0,0,0,0,0,0];var _t,Gt,Yt=function(){function e(t){C(this,e),this._offset=0,this.buffer=t}return P(e,[{key:"offset",get:function(){return this._offset}},{key:"generateHash",value:function(e,t){for(var n=Math.min(e+t-1,this.buffer.byteLength-1),r=new _e.default,i=[0],a=e;a<=n;++a)i[0]=this.buffer.getUint8(a),r.appendBinary(String.fromCharCode.apply(String,i));return r.end(!0)}},{key:"didReadBytes",get:function(){return this._offset}},{key:"readBuffer",value:function(){var e=this.buffer.getUint32(this._offset);this._offset+=4;var t=this.buffer.slice(this._offset,e);return this._offset+=e,t}},{key:"readUint8",value:function(){var e=this.buffer.getUint8(this._offset);return this._offset+=1,e}},{key:"readUint16",value:function(){var e=this.buffer.getUint16(this._offset);return this._offset+=2,e}},{key:"readInt32",value:function(){var e=this.buffer.getInt32(this._offset);return this._offset+=4,e}},{key:"readUint32",value:function(){var e=this.buffer.getUint32(this._offset);return this._offset+=4,e}},{key:"readInt53",value:function(){var e=this.buffer.getInt32(this._offset);this._offset+=4;var t=this.buffer.getInt32(this._offset);return this._offset+=4,t*nt+e}},{key:"readFloat64",value:function(){var e=this.buffer.getFloat64(this._offset);return this._offset+=8,e}},{key:"readString",value:function(){var e=this.readInt32(),t=function(e,t,n){var r=t;if(n<1)return"";for(var i,a=r+n,o=[],s=null,c=0;r<a;)(i=e.getUint8(r++))<128?o[c++]=i:i>191&&i<224?o[c++]=(31&i)<<6|63&e.getUint8(r++):i>239&&i<365?(i=((7&i)<<18|(63&e.getUint8(r++))<<12|(63&e.getUint8(r++))<<6|63&e.getUint8(r++))-65536,o[c++]=55296+(i>>10),o[c++]=56320+(1023&i)):o[c++]=(15&i)<<12|(63&e.getUint8(r++))<<6|63&e.getUint8(r++),c>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),c=0);return s?(c&&s.push(String.fromCharCode.apply(String,o.slice(0,c))),s.join("")):String.fromCharCode.apply(String,o.slice(0,c))}(this.buffer,this._offset,e);return this._offset+=e,t}},{key:"readBigInt",value:function(){for(var e=this.readUint8(),t=Math.ceil(e/2),n=function(e){switch(e){case 0:return jt;case 1:return Dt;case 2:return Ft;case 3:return zt;case 4:return Bt;case 5:return Ut;case 6:return Vt;case 7:return Wt;case 8:return Ht;default:return[]}}(e),r=0;r<t;++r){var i=this.readUint8(),a=15&i,o=i>>4&15;n[2*r]=vt.toCode(a),2*r+1<e&&(n[2*r+1]=vt.toCode(o))}return String.fromCharCode.apply(String,n)}},{key:"skipBytes",value:function(e){return this._offset+=e,e}},{key:"sliceLatestBytes",value:function(e){return[{offset:this._offset-e,buffer:this.buffer,byteLength:e}]}}]),e}(),Xt=16,Qt=function(){for(var e=[],t=0;t<Xt;++t)e[t]=0;return String.fromCharCode.apply(String,e)}(),Kt=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).name="FormatError",r}return n}(v(Error));!function(e){e[e.Indeterminate=0]="Indeterminate",e[e.Circular=1]="Circular",e[e.Noncircular=2]="Noncircular"}(_t||(_t={})),function(e){e[e.Border=0]="Border",e[e.Compound=1]="Compound",e[e.Object=2]="Object",e[e.Handle=3]="Handle"}(Gt||(Gt={}));var qt=function(){function e(t,n,r){C(this,e),this.templateEnvironment=t,this.templateType=n,this.params=r,this.expandedParamNodes=[],this.convertTypeToGeneratorParam=this.convertTypeToGeneratorParam.bind(this);for(var i=0;i<r.length;++i)this.expandedParamNodes[i]=void 0}return P(e,[{key:"getExpandedExpression",value:function(){return this.expandNode(this.templateType)}},{key:"expandNode",value:function(e){switch(e.typeEnum){case he.Any:case he.Never:case he.Undefined:case he.Null:case he.String:case he.Number:case he.Boolean:case he.Function:return{type:e,clazz:0};case he.Object:var t=e,n={};for(var r in t.properties){var i=t.properties[r];n[r]=this.expandNode(i)}return{type:t,clazz:2,key:this.expandNode(t.key),index:this.expandNode(t.index),properties:n};case he.And:case he.Or:var a,o=e,s=[],c=T(o.children);try{for(c.s();!(a=c.n()).done;){var u=a.value;s.push(this.expandNode(u))}}catch(e){c.e(e)}finally{c.f()}return{type:o,clazz:1,children:s};case he.Generator:return this.expandGeneratorType(e);case he.Generic:return this.expandGenericType(e);case he.Reference:case he.GlobalReference:return this.expandReferenceType(e)}throw new Kt("unrecognized enum type "+e.typeEnum)}},{key:"expandGeneratorType",value:function(e){var t=e.params.map(this.convertTypeToGeneratorParam);return{clazz:3,handle:this.templateEnvironment.getTemplate(e.template).getHandle(t)}}},{key:"convertTypeToGeneratorParam",value:function(e){var t=this.expandNode(e);return 3===t.clazz?t.handle:t.type}},{key:"expandGenericType",value:function(e){var t=e.index,n=this.expandedParamNodes[t];if(!n){var r=this.params[t];if(!r)throw new Kt("generic index ".concat(t," is out of range: 0 ~ ").concat(this.params.length-1));n=this.covertParamTypeToExpandedNode(r),this.expandedParamNodes[t]=n}return n}},{key:"expandReferenceType",value:function(e){var t,n=this.templateEnvironment.replaceReferenceType(e);return t=n.typeEnum===he.Generator?n:{typeEnum:he.Generator,template:n,params:[]},this.expandGeneratorType(t)}},{key:"covertParamTypeToExpandedNode",value:function(e){return"id"in e?this.expandNode(e):{clazz:3,handle:e}}}]),e}(),Zt=function(){function e(t){C(this,e),this.rootExpandedNode=t}return P(e,[{key:"getCollapsedExpression",value:function(){return this.collapseNode(this.rootExpandedNode)}},{key:"collapseNode",value:function(t){switch(t.clazz){case Gt.Border:return{id:e.generateId(),hasCircular:!1,types:[t.type.typeEnum]};case Gt.Object:return this.collapseObjectExpandedNode(t);case Gt.Handle:return this.collapseHandleExpandedNode(t);case Gt.Compound:return this.collapseCompoundExpandedNode(t,t.type.typeEnum);default:throw new Error("invalid class ".concat(t.clazz))}}},{key:"collapseObjectExpandedNode",value:function(t){var n=t.key,r=t.index,i=t.properties,a=this.collapseNode(n),o=this.collapseNode(r),s=a.hasCircular||o.hasCircular,c={};for(var u in i){var l=i[u],h=this.collapseNode(l);c[u]=h,s=s||h.hasCircular}var d={key:a,index:o,properties:c};return this.isCollapsedObjectHasNeverPropertyTypes(d)?e.neverCollapsedNode:{id:e.generateId(),hasCircular:s,types:[he.Object],object:d}}},{key:"collapseHandleExpandedNode",value:function(t){var n=t.handle;switch(n.state){case _t.Noncircular:return n.collapsedNode;case _t.Indeterminate:case _t.Circular:return{id:e.generateId(),hasCircular:!0,types:[he.Object],handle:n};default:throw new Error("invalid state ".concat(n.state))}}},{key:"collapseCompoundExpandedNode",value:function(t,n){var r,i=[],a=T(t.children);try{for(a.s();!(r=a.n()).done;){var o=r.value;i.push(this.collapseNode(o))}}catch(e){a.e(e)}finally{a.f()}if(0===i.length)return e.neverCollapsedNode;if(1===i.length)return i[0];for(var s=0,c=i;s<c.length;s++){var u=c[s];if(u.handle&&u.handle.state===_t.Indeterminate){var l=n===he.And?"&":"|";throw new Kt('can not operate an indeterminate expression with "'.concat(l,'" sign'))}}return n===he.And?this.pruneAndMergeNodes(i):this.flattenNodes(i)}},{key:"pruneAndMergeNodes",value:function(t){var n=this.collectCrossTypeEnumsWith(t);if(0===n.length||n.find((function(e){return e===he.Never})))return e.neverCollapsedNode;var r=this.collectAllObjectCollapsedNodesIn(t);return this.handleObjectCollapsedNodesWithTypeEnums(r,n,he.And)}},{key:"flattenNodes",value:function(t){var n=this.collectUnionTypeEnumsWith(t);if(0===(n=n.filter((function(e){return e!==he.Never}))).length)return e.neverCollapsedNode;if(n.find((function(e){return e===he.Any})))return{id:e.generateId(),hasCircular:!1,types:[he.Any]};var r=this.collectAllObjectCollapsedNodesIn(t);return this.handleObjectCollapsedNodesWithTypeEnums(r,n,he.Or)}},{key:"collectCrossTypeEnumsWith",value:function(e){var t,n={},r=T(e);try{for(r.s();!(t=r.n()).done;){var i,a=T(t.value.types);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=n[o];void 0===s&&(s=0),n[o]=s+1}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}var c=[];for(var u in n)n[u]===e.length&&c.push(u);return c}},{key:"collectUnionTypeEnumsWith",value:function(e){var t,n={},r=T(e);try{for(r.s();!(t=r.n()).done;){var i,a=T(t.value.types);try{for(a.s();!(i=a.n()).done;){n[i.value]=!0}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}var o=[];for(var s in n)n[s]&&o.push(s);return o}},{key:"collectAllObjectCollapsedNodesIn",value:function(e){var t,n=[],r=T(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;(i.object||i.handle)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"handleObjectCollapsedNodesWithTypeEnums",value:function(t,n,r){var i,a=t;if(0===a.length)return{id:e.generateId(),hasCircular:!1,types:n};if(1===a.length)return function(e,t){return Ye(e,Xe(t))}(Je({},a[0]),{id:e.generateId(),types:n});var o=[];if(a=a.filter((function(e){return!e.handle||(o.push(e),!1)})),o.length>=2){var s=r===he.And?"&":"|";throw new Kt("can not ".concat(o.length,' circular expression with "').concat(s,'" sign'))}(i=a).push.apply(i,o);for(var c=a[0].object,u=1;u<a.length;++u){if(r===he.And&&this.isCollapsedObjectHasNeverPropertyTypes(c))return e.neverCollapsedNode;var l=a[u],h=this.getObjectFromObjectCollapsedNode(l);c=r===he.And?this.factorizeWithAndOperation(c,h):this.factorizeWithOrOperation(c,h)}return this.isCollapsedObjectHasNeverPropertyTypes(c)?e.neverCollapsedNode:{id:e.generateId(),types:n,hasCircular:this.hasCircularIn(a),object:c}}},{key:"getObjectFromObjectCollapsedNode",value:function(e){for(var t=e;;){if(t.object)return t.object;t=t.handle.collapsedNode}}},{key:"hasCircularIn",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){if(t.value.hasCircular)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"factorizeWithAndOperation",value:function(e,t){var n=[],r=[],i=[];for(var a in e.properties)a in t.properties?n.push(a):r.push(a);for(var o in t.properties)o in e.properties||i.push(o);for(var s={},c=0,u=n;c<u.length;c++){var l=u[c],h=e.properties[l],d=t.properties[l];s[l]=this.pruneAndMergeNodes([h,d])}for(var p=0,f=r;p<f.length;p++){var v=f[p];s[v]=e.properties[v]}for(var m=0,g=i;m<g.length;m++){var y=g[m];s[y]=t.properties[y]}return{key:this.pruneAndMergeKeyOrIndexNodes(e.key,t.key),index:this.pruneAndMergeKeyOrIndexNodes(e.index,t.index),properties:s}}},{key:"factorizeWithOrOperation",value:function(e,t){var n=[];for(var r in e.properties)r in t.properties&&n.push(r);for(var i={},a=0,o=n;a<o.length;a++){var s=o[a],c=e.properties[s],u=t.properties[s];i[s]=this.flattenNodes([c,u])}return{key:this.flattenNodesKeyOrIndexNodes(e.key,t.key),index:this.flattenNodesKeyOrIndexNodes(e.index,t.index),properties:i}}},{key:"pruneAndMergeKeyOrIndexNodes",value:function(e,t){return this.isCollapsedNodeTypeEqual(e,he.Undefined)?t:this.isCollapsedNodeTypeEqual(t,he.Undefined)?e:this.pruneAndMergeNodes([e,t])}},{key:"flattenNodesKeyOrIndexNodes",value:function(e,t){return this.isCollapsedNodeTypeEqual(e,he.Undefined)?t:this.isCollapsedNodeTypeEqual(t,he.Undefined)?e:this.flattenNodes([e,t])}},{key:"isCollapsedObjectHasNeverPropertyTypes",value:function(e){if(this.isCollapsedNodeTypeEqual(e.key,he.Never)||this.isCollapsedNodeTypeEqual(e.index,he.Never))return!0;for(var t in e.properties)if(this.isCollapsedNodeTypeEqual(e.properties[t],he.Never))return!0;return!1}},{key:"isCollapsedNodeTypeEqual",value:function(e,t){return 1===e.types.length&&e.types[0]===t}}],[{key:"generateId",value:function(){var e=this.nextId;return this.nextId+=1,"".concat(e)}}]),e}(),Jt=Zt;Jt.nextId=0,Jt.neverCollapsedNode={id:Zt.generateId(),hasCircular:!1,types:[he.Never]};var $t=function(){function e(t){C(this,e),this.replaceReferenceType=t,this.templatesTable={}}return P(e,[{key:"getTemplate",value:function(e){if(void 0===e.id)throw new Kt("templateType don't have id");var t=this.templatesTable[e.id];return t||(t=new en(this,e),this.templatesTable[e.id]=t),t}}]),e}(),en=function(){function e(t,n){C(this,e),this.templateEnvironment=t,this.templateType=n,this.handlesCache=[]}return P(e,[{key:"getHandle",value:function(e){var t=this.getHandleByParams(e);if(!t){t={state:_t.Indeterminate},this.setHandleWithParams(t,p(e));var n=this.createCollapsedNode(e);t.collapsedNode=n,t.state=n.hasCircular?_t.Circular:_t.Noncircular}return t}},{key:"createCollapsedNode",value:function(e){var t=new qt(this.templateEnvironment,this.templateType,e).getExpandedExpression();return new Jt(t).getCollapsedExpression()}},{key:"getHandleByParams",value:function(t){var n,r=T(this.handlesCache);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e.isParamsEquals(i.params,t))return i.handle}}catch(e){r.e(e)}finally{r.f()}}},{key:"setHandleWithParams",value:function(e,t){if(this.handlesCache.length>=2500)throw new Kt("the template's definition is divergence");this.handlesCache.push({handle:e,params:t})}}],[{key:"isParamsEquals",value:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n){var r=e[n],i=t[n];if(!(r===i||"id"in r&&"id"in i&&r.id===i.id))return!1}return!0}}]),e}(),tn=function(){function e(t){C(this,e),this.collapsedNodeToRecordMap={},this.recordMap={},this.nextRecordId=0,this.templateEnvironment=new $t(t);var n=this.nextRecordId;this.nextRecordId+=1,this.recordMap[n]=this.anyObjectFormatRecord={id:n,key:n,index:n,properties:{}}}return P(e,[{key:"covert",value:function(e){var t=this.templateEnvironment.getTemplate(e).getHandle([]).collapsedNode,n=this.findRecordId(t);return this.recordMap[n]}},{key:"getObjectFormatRecords",value:function(){var e=[];for(var t in this.recordMap)e.push(this.recordMap[t]);return e}},{key:"findRecordId",value:function(e){if(e.types.some((function(e){return e===he.Object}))){var t=this.collapsedNodeToRecordMap[e.id];if(!t){var n={id:this.nextRecordId};this.nextRecordId+=1,this.collapsedNodeToRecordMap[e.id]=n,this.recordMap[n.id]=n,this.convertCollapsedNodeAndFillObjectFormatRecord(e,n),t=n}return t.id}return this.anyObjectFormatRecord.id}},{key:"convertCollapsedNodeAndFillObjectFormatRecord",value:function(e,t){for(var n=e;n.handle;)n=n.handle.collapsedNode;var r=n.object,i={};for(var a in r.properties)i[a]=this.findRecordId(r.properties[a]);t.key=this.findRecordId(r.key),t.index=this.findRecordId(r.index),t.properties=i}}]),e}(),nn=function(){function e(){C(this,e),this.replaceReferenceType=function(){throw new Kt("not define referenceTypeReplacer")}}return P(e,[{key:"createWithRecords",value:function(e,t){var n,r=new tn(t||this.replaceReferenceType),i=[],a={},o=T(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.type,u=s.interrupter,l=r.covert(c);u&&(a[l.id]=u),i.push(l.id)}}catch(e){o.e(e)}finally{o.f()}for(var h=r.getObjectFormatRecords().map((function(e){var t=a[e.id];return t?t(e):e})),d=new rn(h),p=[],f=0,v=i;f<v.length;f++){var m=v[f];p.push(d.findObjectFormat(m))}return{format:d,objectFormats:p}}},{key:"createWithBuffer",value:function(e){return new rn(rn.deserialize(e))}}]),e}(),rn=function(){function e(t){C(this,e),this.records={},this.formats={};var n,r=null,i=T(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o={};this.records[a.id]=a,this.formats[a.id]=o,this.isAnyObjectFormatRecord(a)&&(r=o)}}catch(e){i.e(e)}finally{i.f()}var s,c=T(t);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.completeObjectFormat(this.formats[u.id],u)}}catch(e){c.e(e)}finally{c.f()}if(!r)throw new Error("can't find any object format");this.anyObjectFormat=r,this.objectFormatIds=Object.freeze(t.map((function(e){return e.id})).sort())}return P(e,[{key:"isAnyObjectFormatRecord",value:function(e){for(var t in e.properties)return!1;return e.index===e.id&&e.key===e.id}},{key:"completeObjectFormat",value:function(e,t){for(var n in e.id=t.id,e.key=this.formats[t.key],e.index=this.formats[t.index],e.properties={},t.properties)e.properties[n]=this.formats[t.properties[n]];Object.freeze(e.properties),Object.freeze(e)}},{key:"findObjectFormat",value:function(e){var t=this.formats[e];if(!t)throw new Error("can't find ObjectFormat with id ".concat(e));return t}},{key:"serialize",value:function(){var e=[],t=new Lt;for(var n in this.records)e.push(this.records[n]);e.sort((function(e,t){return e.id-t.id})),t.writeUint32(e.length);for(var r=0,i=e;r<i.length;r++){var a=i[r];this.serializeRecord(a,t)}return t.toBuffer()}},{key:"serializeRecord",value:function(e,t){if(e.id>rt)throw new Kt("ObjectFormat's number can't greater than ".concat(rt));var n=Object.keys(e.properties).sort();if(n.length>rt)throw new Kt("ObjectFormat's properties number can't greater than ".concat(rt));t.writeUint32(e.id),t.writeUint32(e.key),t.writeUint32(e.index),t.writeUint32(n.length);var r,i=T(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.writeString(a),t.writeUint32(e.properties[a])}}catch(e){i.e(e)}finally{i.f()}}}],[{key:"deserialize",value:function(e){for(var t=[],n=new Yt(e),r=n.readUint32(),i=0;i<r;++i){for(var a=n.readUint32(),o=n.readUint32(),s=n.readUint32(),c=n.readUint32(),u={},l=0;l<c;++l){var h=n.readString(),d=n.readUint32();u[h]=d}t.push({id:a,key:o,index:s,properties:u})}return t}}]),e}(),an=Math.pow(2,32)-1,on=Object.defineProperty,sn=Object.getOwnPropertySymbols,cn=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable,ln=function(e,t,n){return t in e?on(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};function hn(e,t){return void 0===e?t:e}var dn=function(){function e(t){C(this,e);var n={},r=[];for(var i in t){var a=t[i],o=hn(a.enablePing,!0),s=hn(a.useSSL,!0),c=[],u={};for(var l in a.hosts)"*"===l?c.push.apply(c,p(this.readStringArray(a.hosts[l]))):u[l]=this.readStringArray(a.hosts[l]);r.push(i),n[i]=Object.freeze({enablePing:o,useSSL:s,hosts:Object.freeze({default:Object.freeze(c),regions:Object.freeze(u)})})}this.keys=Object.freeze(r.sort()),this.hosts=Object.freeze(function(e,t){for(var n in t||(t={}))cn.call(t,n)&&ln(e,n,t[n]);if(sn){var r,i=T(sn(t));try{for(i.s();!(r=i.n()).done;)n=r.value,un.call(t,n)&&ln(e,n,t[n])}catch(e){i.e(e)}finally{i.f()}}return e}({},n))}return P(e,[{key:"readStringArray",value:function(e){return"string"==typeof e?Object.freeze([e]):Object.freeze(p(e))}},{key:"host",value:function(e){var t=this.hosts[e];if(!t)throw new Error("cannot find host ".concat(JSON.stringify(e)));return t}}]),e}(),pn=function(){function e(t,n){var r;if(C(this,e),this.nextIndex=0,this.enablePing=t.enablePing,this.useSSL=t.useSSL,0===(r=void 0===n?t.hosts.default:t.hosts.regions[n]||t.hosts.default).length)throw void 0===n?new Error("expect region: unexpect undefined"):new Error("invalid region ".concat(JSON.stringify(n),": cannot find any hosts of region"));this.hosts=r}return P(e,[{key:"hostsCount",get:function(){return this.hosts.length}},{key:"host",value:function(){return this.hosts[this.nextIndex]}},{key:"markSuccess",value:function(e){}},{key:"markFail",value:function(e){var t=this.nextIndex+1;t>=this.hosts.length&&(t=0),this.nextIndex=t}}]),e}(),fn=function(){function e(t){C(this,e),this.fetcher=t}return P(e,[{key:"fetch",value:function(e,t,n){var r=this;return new Promise((function(i,a){var o=setTimeout((function(){o=null,a(new Error("timeout"))}),n);r.fetcher(e,t).then((function(e){null!==o&&(clearTimeout(o),i(e))})).catch((function(e){null!==o&&(clearTimeout(o),a(e))}))}))}}]),e}(),vn=function(){function e(t){C(this,e);var n=new dn(t.configmap),r={};this.fetcher=new fn(t.fetcher),this.keys=n.keys,this.onIngoreFetchError=t.onIngoreFetchError,this.retryCount=t.retryCount,this.retryLoopsCount=t.retryLoopsCount,this.timeout=e.parseTimeoutFromParams(t.timeout),this.bussySleepDuration=hn(t.bussySleepDuration,3e3);var i,a=T(this.keys);try{for(a.s();!(i=a.n()).done;){var o=i.value;r[o]=new pn(n.host(o),t.region)}}catch(e){a.e(e)}finally{a.f()}this.loops=Object.freeze(r)}var t;return P(e,[{key:"fetch",value:function(e){var t=this,n=this.parseFetchingContext(e),r=n.key,i=this.loop(r);return function(e,r){return t.fetchWithKey(n,i,e,r)}}},{key:"origin",value:function(e,t){var n=this.loop(t),r=n.host(),i=e;return/:$/im.test(i)||(i+=":"),this.replaceProtocol(i,n.useSSL)+"//"+r}},{key:"reportSuccess",value:function(e,t){this.loop(e).markSuccess(t)}},{key:"reportFail",value:function(e,t){this.loop(e).markFail(t)}},{key:"fetchWithKey",value:(t=u(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c,u,l,h,d,p,f,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(i&&i.method||"get").toLowerCase(),void 0===(o=t.enableRetry)&&(o=this.checkIsIdempotent(a)),s=o?this.getFetchingCount(t,n):1,c=null,u=0;case 4:if(!(u<s)){e.next=28;break}return l=Date.now(),e.prev=6,h=n.host(),d=this.replaceURL(r,h,n.useSSL),p=t.timeout.length,f=u<p?t.timeout[u]:t.timeout[p-1],e.next=13,this.fetcher.fetch(d,i,f);case 13:if(v=e.sent,this.isServerBussyCode(v.status)){e.next=16;break}return e.abrupt("return",(n.markSuccess(Date.now()-l),v));case 16:if(e.t0=u<s-1,!e.t0){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,t.bussySleepDuration)}));case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(6),c=e.t1,n.markFail(Date.now()-l);case 25:++u,e.next=4;break;case 28:throw this.onIngoreFetchError&&c&&this.onIngoreFetchError(c),m="fail to ".concat(a," ").concat(this.replaceHost(r,n.useSSL)),s>1&&(m+=" after ".concat(s," times retries")),c=c?new Error("".concat(m," and the last Error is: ").concat(c.message)):new Error(m);case 31:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"getFetchingCount",value:function(e,t){var n,r;return"number"==typeof e.retryCount&&(n=e.retryCount+1),"number"==typeof e.retryLoopsCount&&(r=(e.retryLoopsCount+1)*t.hostsCount),void 0!==n&&void 0!==r?Math.max(n,r):void 0!==n?n:void 0!==r?r:t.hostsCount}},{key:"replaceURL",value:function(e,t,n){var r=new URL(e),i=r.protocol,a=r.port,o=r.pathname,s=r.search,c=this.replaceProtocol(i,n),u=t;return a&&(u+=":"+a),"".concat(c,"//").concat(u).concat(o).concat(s)}},{key:"replaceHost",value:function(e,t){var n=new URL(e),r=n.protocol,i=n.hostname,a=n.port,o=n.pathname,s=n.search,c=this.replaceProtocol(r,t),u="{{"+i+"}}";return a&&(u+=":"+a),"".concat(c,"//").concat(u).concat(o).concat(s)}},{key:"parseFetchingContext",value:function(t){var n=t;return"string"==typeof n&&(n={key:n}),Object.freeze({key:n.key,enableRetry:n.enableRetry,timeout:e.parseTimeoutFromParams(n.timeout,this.timeout),retryCount:hn(n.retryCount,this.retryCount),retryLoopsCount:hn(n.retryLoopsCount,this.retryLoopsCount),bussySleepDuration:hn(n.bussySleepDuration,this.bussySleepDuration)})}},{key:"checkIsIdempotent",value:function(e){switch(e){case"put":case"options":case"head":case"patch":case"delete":case"get":return!0;default:return!1}}},{key:"isServerBussyCode",value:function(e){switch(e){case 503:case 504:return!0;default:return!1}}},{key:"replaceProtocol",value:function(e,t){switch(e){case"http:":case"https:":return t?"https:":"http:";case"ws:":case"wss:":return t?"wss:":"ws:";default:return e}}},{key:"loop",value:function(e){var t=this.loops[e];if(!t)throw new Error("undefined key ".concat(JSON.stringify(e)));return t}}],[{key:"parseTimeoutFromParams",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.defaultTimeout;if("number"==typeof t)return Object.freeze([t]);if(Array.isArray(t)){if(0===t.length)throw new Error("timeout cannot be []");return Object.freeze(p(t))}return n}}]),e}(),mn=vn;mn.defaultTimeout=Object.freeze([5e3,1e4,25e3]);var gn,yn=Y(n(79892)),bn=Object.defineProperty,kn=Object.getOwnPropertySymbols,wn=Object.prototype.hasOwnProperty,Sn=Object.prototype.propertyIsEnumerable,xn=function(e,t,n){return t in e?bn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Cn=function(e,t){for(var n in t||(t={}))wn.call(t,n)&&xn(e,n,t[n]);if(kn){var r,i=T(kn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Sn.call(t,n)&&xn(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},In=function(){function e(t){C(this,e),this.sockets=[],this.logger=t}return P(e,[{key:"socketsCount",get:function(){return this.sockets.length}},{key:"addSocket",value:function(e){-1===this.sockets.indexOf(e)&&this.sockets.push(e)}},{key:"removeSocket",value:function(e){var t=this.sockets.indexOf(e);-1!==t&&this.sockets.splice(t,1)}},{key:"forEachSockets",value:function(e){this.sockets.forEach(e)}},{key:"emit",value:function(e,t){var n,r=T(this.sockets);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i.emit(e,t)}catch(e){this.logger.error(e)}}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),Pn=function(){function e(t){C(this,e),this.typesMap={},this.typeToIndexMap={},this.typesMap=Object.freeze(this.createTypesMap(t)),this.typeToIndexMap=Object.freeze(this.createTypeToIndexMap(this.typesMap))}return P(e,[{key:"createTypesMap",value:function(e){for(var t={},n=0;n<e.length;++n)t[n]=e[n];return t}},{key:"createTypeToIndexMap",value:function(e){var t={};for(var n in e){var r=parseInt(n,10),i=e[r];if(i in t)throw new Error('find duplicated type "'.concat(i,' in parameters of new TypesMap(...)"'));t[i]=r}return t}},{key:"hasType",value:function(e){return e in this.typeToIndexMap}},{key:"findTypeId",value:function(e){var t=this.typeToIndexMap[e];if(void 0===t)throw new Error("can't find id with type ".concat(e));return t}},{key:"findTypeById",value:function(e){var t=this.typesMap[e];if(!t)throw new Error("can't find type with id ".concat(e));return t}},{key:"extendsTypesMap",value:function(t){var n=[];for(var r in this.typesMap)n.push(this.typesMap[r]);for(var i in t.typesMap)n.push(t.typesMap[i]);return new e(n)}}],[{key:"create",value:function(t){return new e(t)}}]),e}();!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(gn||(gn={}));var Mn,Tn=function(){function e(){C(this,e),this.eventListeners={}}return P(e,[{key:"on",value:function(e,t){var n=this.eventListeners[e];n||(n=[],this.eventListeners[e]=n),-1===n.indexOf(t)&&n.push(t)}},{key:"off",value:function(e,t){var n=this.eventListeners[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.eventListeners[e])}}},{key:"once",value:function(e,t){var n=this;this.on(e,(function r(i){try{t(i)}finally{n.off(e,r)}}))}},{key:"dispatchToListeners",value:function(e,t){var n=this.eventListeners[e];if(n){var r,i=T(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(t)}catch(e){console.error(e)}}}catch(e){i.e(e)}finally{i.f()}}}}]),e}(),An=Math.pow(2,32);function En(e,t,n){var r=n%An,i=(n-r)/An;e.setInt32(t,r),e.setInt32(t+4,i)}function On(e,t){var n=e.getInt32(t);return e.getInt32(t+4)*An+n}!function(e){e[e.Buffer=0]="Buffer",e[e.String=1]="String",e[e.Integer=2]="Integer"}(Mn||(Mn={}));var Rn=function(){function e(t,n,r){var i=this;C(this,e),this.typesMap=t,this.socket=n,this.receiver=r,this.latestThreePackageBytes=[0,0,0],this.nextSelfPackageId=0,this._latestReceivedRemoteId=-1,this.onMessage=function(e){try{if(i.receivedPackageHeadBuffer){var t=i.receivedPackageHeadBuffer,n=be(e.data),r=i.parsePackage(t,n);i._latestReceivedRemoteId=Math.max(r.id,i._latestReceivedRemoteId),i.receivedPackageHeadBuffer=void 0,i.receiver(null,r)}else i.receivedPackageHeadBuffer=be(e.data)}catch(t){i.receiver(t,null)}},n.binaryType="arraybuffer",n.addEventListener("message",this.onMessage)}return P(e,[{key:"bufferedAmount",get:function(){return this.socket.bufferedAmount}},{key:"maxPackageBytesInLatestThree",get:function(){return Math.max.apply(Math,[0].concat(p(this.latestThreePackageBytes)))}},{key:"latestReceivedRemoteId",get:function(){return this._latestReceivedRemoteId}},{key:"sendPackage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object.freeze({id:this.nextSelfPackageId,receivedId:this._latestReceivedRemoteId,type:e,data:t});this.nextSelfPackageId+=1;var r=this.createPackageHead(n),i=this.wrapPackageData(n.data),a=r.byteLength+i.byteLength;return this.socket.send(r.primitiveBuffer),this.socket.send(i.primitiveBuffer),this.latestThreePackageBytes[0]=this.latestThreePackageBytes[1],this.latestThreePackageBytes[1]=this.latestThreePackageBytes[2],this.latestThreePackageBytes[2]=a,n.id}},{key:"createPackageHead",value:function(e){var t=ye(18);return En(t,0,e.id),En(t,8,e.receivedId),t.setUint8(16,this.typesMap.findTypeId(e.type)),t.setUint8(17,function(e){switch(M(e)){case"number":return 2;case"string":return 1;default:return 0}}(e.data)),t}},{key:"wrapPackageData",value:function(e){if("string"==typeof e){for(var t=new String(e),n=ye(2*t.length),r=0;r<t.length;++r)n.setUint16(2*r,65535&t.charCodeAt(r));return n}if("number"==typeof e){var i=ye(8);return En(i,0,e),i}return e}},{key:"parsePackage",value:function(e,t){var n,r=On(e,0),i=On(e,8),a=e.getUint8(16),o=e.getUint8(17);switch(o){case Mn.String:for(var s=t.byteLength/2,c=[],u=0;u<s;++u)c[u]=t.getUint16(2*u);n=String.fromCharCode.apply(String,c);break;case Mn.Integer:n=On(t,0);break;case Mn.Buffer:n=t;break;default:throw new Error("unrecognized data type ".concat(o))}return Object.freeze({id:r,receivedId:i,type:this.typesMap.findTypeById(a),data:n})}}]),e}(),Nn=function(){function e(t,n,r,i,a){var o=this;C(this,e),this.receivedWhenNotWorkingBuffer=[],this.remoteHeartbeatTimeout=void 0,this.crashByChannelError=!1,this.isWorking=!1,this.isLimit=!1,this.becameLimitTimestamp=0,this.sendHeartbeat=function(){o.isWorking&&(o.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(o.akkoSocket.params.heartbeatInterval),o.chanel.sendPackage("heartbeat"))},this.handleRemoteHeartbeatTimeout=function(){o.crashByChannelError||(o.crashByChannelError=!0,o.callbacks.onRemoteHeartbeatTimeout())},this.onReceivedPackage=function(e,t){if(!o.crashByChannelError)if(!e&&t)if(o.isWorking)try{o.handleReceivedPackage(t)}finally{o.delayRemoteHeartbeatTimeoutChecking()}else o.receivedWhenNotWorkingBuffer.push(t);else e&&!t&&o.callbacks.onParseMessageFailed(e)},this.akkoSocket=t,this.logger=r,this.chanel=new Rn(i,n,this.onReceivedPackage),this.callbacks=Object.freeze(Cn({},a)),this.sendHeartbeatDelayer=new De(this.sendHeartbeat),this.remoteHeartbeatTimeoutDelayer=new De(this.handleRemoteHeartbeatTimeout)}return P(e,[{key:"send",value:function(e,t){if(this.isWorking)if(t instanceof Array){var n,r=T(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.sendPackage(e,i)}}catch(e){r.e(e)}finally{r.f()}}else this.sendPackage(e,t)}},{key:"sendPackage",value:function(e,t){if(this.checkBufferedAmountOverflow())throw this.crashByChannelError||(this.crashByChannelError=!0,this.callbacks.onSendingBufferOverflow()),new Error("sending buffer overflow");this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage(e,t)}},{key:"checkBufferedAmountOverflow",value:function(){var e=!1,t=this.akkoSocket.params,n=t.sendingBufferCrash,r=t.sendingBufferLimit,i=t.sendingBufferLimitDuration,a=this.chanel,o=a.bufferedAmount,s=a.maxPackageBytesInLatestThree;if(o>n+s)e=!0;else if(o>r+s){var c=Date.now();this.isLimit?c-this.becameLimitTimestamp>i&&(this.isLimit=!1,e=!0):(this.isLimit=!0,this.becameLimitTimestamp=c)}else this.isLimit=!1;return e}},{key:"dispatchClose",value:function(e){var t=JSON.stringify(e);this.chanel.sendPackage("close",t)}},{key:"start",value:function(){this.isWorking||(this.isWorking=!0,this.delayRemoteHeartbeatTimeoutChecking(),this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage("setHeartbeatTimeout",this.akkoSocket.params.heartbeatTimeout),this.cleanReceivedWhenNotWorkingBuffer())}},{key:"cleanReceivedWhenNotWorkingBuffer",value:function(){var e=this.receivedWhenNotWorkingBuffer.splice(0,this.receivedWhenNotWorkingBuffer.length);if(e.length>0)try{var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.handleReceivedPackage(r)}}catch(e){n.e(e)}finally{n.f()}}finally{this.delayRemoteHeartbeatTimeoutChecking()}}},{key:"stop",value:function(){this.isWorking&&(this.isWorking=!1,this.sendHeartbeatDelayer.dispose(),this.remoteHeartbeatTimeoutDelayer.dispose(),this.remoteHeartbeatTimeout=void 0)}},{key:"handleReceivedPackage",value:function(t){if(e.sessionEventTypesMap.hasType(t.type)){if("setHeartbeatTimeout"===t.type)"number"==typeof t.data&&t.data>0?this.remoteHeartbeatTimeout=t.data:this.logger.warn("illegal remote heartbeat timeout: ".concat(t.data));else if("close"===t.type){var n;if("string"==typeof t.data)try{n=JSON.parse(t.data)}catch(e){this.logger.warn("parse close payload as JSON failed: ".concat(e.message))}this.callbacks.onCloseByRemote(n)}}else this.callbacks.onEvent(t.type,t.data)}},{key:"delayRemoteHeartbeatTimeoutChecking",value:function(){void 0===this.remoteHeartbeatTimeout?this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatTimeout):this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.remoteHeartbeatTimeout)}}]),e}(),Ln=Nn;Ln.sessionEventTypesMap=Pn.create(["heartbeat","setHeartbeatTimeout","close"]);var jn,Dn,Fn=function(){function e(t,n){var r=this;C(this,e),this.socket=t,this.logger=n,this.paddingExecutors=[],this.createdAt=Date.now(),this.isConnecting=!0,this.onOpen=function(){if(r.isConnecting){r.finishConnecting();var e,t=Date.now()-r.createdAt,n=T(r.paddingExecutors.splice(0));try{for(n.s();!(e=n.n()).done;){e.value.resolve({duration:t})}}catch(e){n.e(e)}finally{n.f()}}},this.onError=function(e){if(r.isConnecting){r.finishConnecting();var t,n=new Error(e.message||"connect failed"),i=T(r.paddingExecutors.splice(0));try{for(i.s();!(t=i.n()).done;){t.value.reject(n)}}catch(e){i.e(e)}finally{i.f()}}},this.onTimeout=function(){if(r.isConnecting){r.finishConnecting();var e,t=new Error("timeout"),n=T(r.paddingExecutors.splice(0));try{for(n.s();!(e=n.n()).done;){e.value.reject(t)}}catch(e){n.e(e)}finally{n.f()}try{var i=1e3;r.socket.close(1e3)}catch(i){r.logger.error(i)}}},t.addEventListener("open",this.onOpen),t.addEventListener("error",this.onError),this.timeoutTimer=setTimeout(this.onTimeout,25e3)}return P(e,[{key:"waitToConnected",value:function(){var e=this;return new Promise((function(t,n){e.paddingExecutors.push({resolve:t,reject:n})}))}},{key:"finishConnecting",value:function(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("error",this.onError),this.isConnecting=!1,this.timeoutTimer=null}}]),e}(),zn=function(e){g(i,e);var t,n,r=b(i);function i(e,t,n,a){var o;return C(this,i),(o=r.call(this)).didCallDisconnect=!1,o.connectingManager=null,o.connectFailError=void 0,o.onError=function(){o.logger.warn("websocket received error")},o.onCloseByRemote=function(e){if(o._phase===jn.Connected){o.sessionChannel.stop(),o.closeSocket(1e3),o.updatePhase(jn.Disconnected);var t=e&&e.error,n=e&&e.reason;t?o.callOnDisconnect({reason:Dn.RemoteError,message:t,remoteCode:e.errorCode}):o.callOnDisconnect({reason:Dn.Normal,message:n||"ok"})}},o.onClose=function(e){var t=e.code,n=void 0===t?1e3:t,r=e.reason;if(o._phase===jn.Connected){var i=o.errorMessageWithCode(n)||"disconnected with code ".concat(n,' "').concat(r,'"');o.sessionChannel.stop(),o.updatePhase(jn.Disconnected),o.callOnDisconnect({reason:Dn.WebSocketError,message:i,webSocketCode:n})}},o.socket=e,o.socket.binaryType="arraybuffer",o.logger=t,o.params=Object.freeze(Cn({},a)),o.sessionChannel=new Ln(w(o),e,t,n,{onCloseByRemote:o.onCloseByRemote,onEvent:function(e,t){return o.dispatchToListeners(e,t)},onRemoteHeartbeatTimeout:function(){return o.onCommunicationErrorMessage("remote heartbeat timeout")},onSendingBufferOverflow:function(){return o.onCommunicationErrorMessage("sending buffer overflow")},onParseMessageFailed:function(e){return o.onCommunicationErrorMessage("parse message failed: "+e.message)}}),o.initializePhaseWithSocketReadyState(),o}return P(i,[{key:"initializePhaseWithSocketReadyState",value:function(){switch(this.socket.readyState){case gn.CONNECTING:this._phase=jn.Connecting,this.connect();break;case gn.OPEN:this._phase=jn.Connected,this.addSessionListeners(),this.sessionChannel.start();break;default:var e=gn[this.socket.readyState];throw e||(e="".concat(this.socket.readyState)),new Error("invalid readyState of WebSocket: ".concat(e))}}},{key:"phase",get:function(){return this._phase}},{key:"updatePhase",value:function(e){if(this._phase!==e)try{this.params.onPhaseChanged(e)}finally{this._phase=e}}},{key:"emit",value:function(e,t){if(this._phase!==jn.Connected)throw new Error("AkkoSocket can't emit when phase is ".concat(this.phase));try{this.sessionChannel.send(e,t)}catch(e){throw this.disconnectForceWithCode(1e3),this.callOnDisconnect({reason:Dn.WebSocketError,message:e.message}),e}}},{key:"connect",value:(n=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.connectingManager=new Fn(this.socket,this.logger),e.next=4,this.connectingManager.waitToConnected();case 4:this.addSessionListeners(),this.sessionChannel.start(),this.updatePhase(jn.Connected),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.updatePhase(jn.Disconnected),this.connectFailError=e.t0;case 12:return e.prev=12,this.connectingManager=null,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])}))),function(){return n.apply(this,arguments)})},{key:"addSessionListeners",value:function(){this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("error",this.onError)}},{key:"waitToConnected",value:function(){if(this.connectFailError)throw this.connectFailError;if(this._phase===jn.Connected)return Promise.resolve({duration:0});if(this._phase===jn.Connecting)return this.connectingManager.waitToConnected();throw new Error("AkkoSocket's phase had became ".concat(this._phase))}},{key:"disconnect",value:function(e){return e?this.disconnectWithCodeAndReason({reason:e}):this.disconnectWithCodeAndReason()}},{key:"disconnectWithErrorDescription",value:function(e){var t=e.message,n=e.code;return this.disconnectWithCodeAndReason({error:t,errorCode:n})}},{key:"disconnectForce",value:function(){if(this._phase===jn.Connected){this.disconnectForceWithCode(1e3)}}},{key:"disconnectForceWithCode",value:function(e){this.sessionChannel.stop(),this.closeSocket(e),this.updatePhase(jn.Disconnected)}},{key:"disconnectWithCodeAndReason",value:(t=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.didCallDisconnect){e.next=2;break}throw new Error("AkkoSocket did call disconnect");case 2:this.didCallDisconnect=!0,n=!0,e.t0=this._phase,e.next=e.t0===jn.Disconnecting||e.t0===jn.Disconnected?7:e.t0===jn.Connecting?8:17;break;case 7:throw new Error("AkkoSocket can't disconnect when phase is ".concat(this.phase));case 8:return e.prev=8,e.next=11,this.waitToConnected();case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(8),n=!1;case 16:return e.abrupt("break",17);case 17:if(!n){e.next=26;break}return this.updatePhase(jn.Disconnecting),this.sessionChannel.dispatchClose(t),e.next=22,this.waitUtilCloseAndCheckTimeout();case 22:if(!e.sent){e.next=25;break}this.closeSocket(1e3);case 25:this.sessionChannel.stop(),this.updatePhase(jn.Disconnected);case 26:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(e){return t.apply(this,arguments)})},{key:"waitUtilCloseAndCheckTimeout",value:function(){var e=this,t=null,n=new Promise((function(e){t=setTimeout((function(){t=null,e(!0)}),3e3)})),r=new Promise((function(t){e.socket.readyState===gn.CLOSED?t(!1):e.socket.addEventListener("close",(function(){return t(!1)}))}));return Promise.race([n,r]).then((function(e){return null!==t&&clearTimeout(t),e}))}},{key:"onCommunicationErrorMessage",value:function(e){this._phase===jn.Connected&&(this.disconnectForce(),this.callOnDisconnect({reason:Dn.CommunicationError,message:e}))}},{key:"closeSocket",value:function(e){try{this.socket.close(e)}catch(e){this.logger.error(e)}}},{key:"callOnDisconnect",value:function(e){this.didCallDisconnect||this.params.onDisconnect(e)}},{key:"errorMessageWithCode",value:function(e){switch(e){case 1e3:return"CLOSE_NORMAL";case 1001:return"CLOSE_GOING_AWAY";case 1002:return"CLOSE_PROTOCOL_ERROR";case 1003:return"CLOSE_UNSUPPORTED";case 1005:return"CLOSE_NO_STATUS";case 1006:return"CLOSE_ABNORMAL";case 1007:return"Unsupported Data";case 1008:return"Policy Violation";case 1009:return"CLOSE_TOO_LARGE";case 1010:return"Missing Extension";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1015:return"TLS Handshake";default:return}}}]),i}(Tn),Bn=function(){function e(t){C(this,e),this.eventTypesMap=Ln.sessionEventTypesMap.extendsTypesMap(Pn.create(t))}return P(e,[{key:"createSocket",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new zn(t,n,this.eventTypesMap,Cn(Cn({},e.defaultSocketParams),r))}},{key:"createCombinedSockets",value:function(e){return new In(e)}}]),e}(),Un=Bn;Un.defaultSocketParams=Object.freeze({heartbeatInterval:4e4,heartbeatTimeout:5e4,sendingBufferLimit:5242880,sendingBufferLimitDuration:3e4,sendingBufferCrash:104857600,onDisconnect:function(){},onPhaseChanged:function(){}}),function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(jn||(jn={})),function(e){e.Normal="normal",e.WebSocketError="webSocketError",e.CommunicationError="communicationError",e.RemoteError="remoteError"}(Dn||(Dn={}));var Vn,Wn,Hn=Object.defineProperty,_n=Object.defineProperties,Gn=Object.getOwnPropertyDescriptors,Yn=Object.getOwnPropertySymbols,Xn=Object.prototype.hasOwnProperty,Qn=Object.prototype.propertyIsEnumerable,Kn=function(e,t,n){return t in e?Hn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},qn=function(e,t){for(var n in t||(t={}))Xn.call(t,n)&&Kn(e,n,t[n]);if(Yn){var r,i=T(Yn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Qn.call(t,n)&&Kn(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Zn=function(e,t){return _n(e,Gn(t))};function Jn(e){return 0===e.type}function $n(e){return 1===e.type}function er(e){return 3===e.type}function tr(e){return 4===e.type}!function(e){e[e.Invoker=0]="Invoker",e[e.Event=1]="Event",e[e.Ack=2]="Ack",e[e.Enter=3]="Enter",e[e.Leave=4]="Leave"}(Vn||(Vn={})),function(e){e[e.System=0]="System",e[e.App=1]="App",e[e.Custom=2]="Custom",e[e.Magix=3]="Magix"}(Wn||(Wn={}));var nr=function(){function e(t,n){C(this,e);var r=t.format.anyObjectFormat;this.serialization=t,this.rootClassReflection=n,this.rootObjectFormats=Object.freeze([this.rootClassReflection.objectFormat]),this.oneAnyObjectFormats=Object.freeze([r]),this.twoAnyObjectFormats=Object.freeze([r,r])}return P(e,[{key:"serializeSnapshotFrame",value:function(e){var t=new Lt;return this.serializeFrameHeader(t,e),this.serializeUsers(t,e.users),this.serialization.serialize({writer:t,values:[e.rootObject],objectFormats:this.rootObjectFormats,includesHash:!0}),t.toBuffer()}},{key:"serializeUsers",value:function(e,t){var n=[this.serialization.format.anyObjectFormat];e.writeUint32(t.length);var r,i=T(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.writeUint32(a.userId),e.writeUint32(a.nextFrameId),e.writeString(a.session),this.serialization.serialize({writer:e,values:[a.payload],objectFormats:n,includesHash:!0})}}catch(e){i.e(e)}finally{i.f()}}},{key:"deserializeSnapshotFrame",value:function(e,t,n){var r,i=new Yt(e),a=this.deserializeFrameHeader(i);r=t!==Mt.V0?this.deserializeUsers(i,t,n):function(e){var t=e.readInt32();e.readInt32();for(var n=[],r=0;r<t;++r){var i=e.readUint32();n.push({userId:i,nextFrameId:0,session:"",payload:void 0})}return n}(i);var o=l(this.serialization.deserialize({reader:i,objectFormats:this.rootObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return Zn(qn({},a),{users:r,rootObject:o})}},{key:"deserializeUsers",value:function(e,t,n){for(var r=e.readUint32(),i=[],a=[this.serialization.format.anyObjectFormat],o=0;o<r;++o){var s=e.readUint32(),c=e.readUint32(),u=e.readString(),h=l(this.serialization.deserialize({reader:e,objectFormats:a,ignoreHashChecking:n,version:t}),1)[0];i.push({userId:s,nextFrameId:c,session:u,payload:h})}return Object.freeze(i)}},{key:"serializeActionFrame",value:function(e,t){var n=new Lt;if(this.serializeFrameHeader(n,e),n.writeUint8(e.type),n.writeInt53(e.scopeId),n.writeInt53(e.beginObjectId),Jn(e)){n.writeUint32(e.methodId);var r=this.rootClassReflection.methodNames[e.methodId],i=this.rootClassReflection.methods[r].parameterFormatObjects;this.serialization.serialize({writer:n,values:e.parameters,objectFormats:i,includesHash:t})}else $n(e)?(n.writeUint8(e.scope),n.writeString(e.event),this.serialization.serialize({writer:n,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t})):er(e)?(n.writeString(e.session),this.serialization.serialize({writer:n,values:[e.userPayload,e.connectedPayload],objectFormats:this.twoAnyObjectFormats,includesHash:t})):tr(e)&&this.serialization.serialize({writer:n,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t});return n.toBuffer()}},{key:"deserializeActionFrame",value:function(e,t,n){var r,i=new Yt(e),a=this.deserializeFrameHeader(i),o=i.readUint8(),s=0,c=0;switch(t!==Mt.V0&&(s=i.readInt53(),c=i.readInt53()),o){case Vn.Invoker:var u=i.readUint32(),h=this.rootClassReflection.methodNames[u],d=this.rootClassReflection.methods[h].parameterFormatObjects,p=this.serialization.deserialize({reader:i,objectFormats:d,ignoreHashChecking:n,version:t});return t===Mt.V0&&(r=i.readBigInt()),Zn(qn({},a),{type:o,scopeId:s,beginObjectId:c,beginGenerationId:r,methodId:u,parameters:p});case Vn.Event:var f=i.readUint8(),v=i.readString(),m=l(this.serialization.deserialize({reader:i,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return t===Mt.V0&&(r=i.readBigInt()),Zn(qn({},a),{type:o,scopeId:s,beginObjectId:c,beginGenerationId:r,scope:f,event:v,payload:m});case Vn.Ack:return Zn(qn({},a),{type:o,scopeId:s,beginObjectId:c});case Vn.Enter:var g=i.readString(),y=l(this.serialization.deserialize({reader:i,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:n,version:t}),2),b=y[0],k=y[1];return Zn(qn({},a),{type:o,scopeId:s,beginObjectId:c,session:g,userPayload:b,connectedPayload:k});case Vn.Leave:var w=l(this.serialization.deserialize({reader:i,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return Zn(qn({},a),{type:o,scopeId:s,beginObjectId:c,payload:w});default:throw new Error("invalid type ".concat(o))}}},{key:"serializeFrameHeader",value:function(e,t){e.writeUint32(t.frameId),e.writeUint32(t.originalFrameId),e.writeInt53(t.timestamp),e.writeUint32(t.authorId)}},{key:"deserializeFrameHeader",value:function(e){return{frameId:e.readUint32(),originalFrameId:e.readUint32(),timestamp:e.readInt53(),authorId:e.readUint32()}}}]),e}(),rr=Math.pow(2,32),ir=(Math.pow(2,16),20);function ar(e,t){var n=e.getInt32(t);return e.getInt32(t+4)*rr+n}function or(e){for(var t=new Yt(e),n=new Lt,r=0;r<ir;++r)n.writeUint8(t.readUint8());return n.writeUint8(Vn.Ack),n.toBuffer()}var sr=function(){function e(t){if(C(this,e),t.byteLength<ir)throw new Error("Buffer is to short");this.frameBuffer=t}return P(e,[{key:"frameId",get:function(){return this.frameBuffer.getUint32(0)},set:function(e){this.frameBuffer.setUint32(0,e)}},{key:"originalFrameId",get:function(){return this.frameBuffer.getUint32(4)},set:function(e){this.frameBuffer.setUint32(4,e)}},{key:"timestamp",get:function(){return ar(this.frameBuffer,8)},set:function(e){var t=0|e,n=(e-t)/rr;this.frameBuffer.setInt32(8,t),this.frameBuffer.setInt32(12,n)}},{key:"authorId",get:function(){return this.frameBuffer.getUint32(16)},set:function(e){this.frameBuffer.setUint32(16,e)}},{key:"type",get:function(){return this.frameBuffer.getUint8(ir)}},{key:"scopeId",get:function(){return ar(this.frameBuffer,21)}},{key:"beginObjectId",get:function(){return ar(this.frameBuffer,29)}},{key:"scope",get:function(){return this.frameBuffer.getUint8(37)}},{key:"bodyBytes",get:function(){return this.frameBuffer.byteLength-ir}},{key:"fetchEventContent",value:function(){var e=new Yt(this.frameBuffer);if(e.skipBytes(37),this.type===Vn.Event){var t=e.readUint8();return{event:e.readString(),scope:t}}}}]),e}(),cr=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.call(this)}return P(n,[{key:"createObject",value:function(e,t){var r=s(x(n.prototype),"createObject",this).call(this,e,t);return n.objectsCollection&&n.objectsCollection.push(r),r}}],[{key:"startCollection",value:function(){this.objectsCollection=[]}},{key:"completeCollection",value:function(){try{if(!this.objectsCollection)return[];var e,t=T(this.objectsCollection);try{for(t.s();!(e=t.n()).done;){delete e.value.__identifier}}catch(e){t.e(e)}finally{t.f()}return this.objectsCollection}finally{this.objectsCollection=void 0}}}]),n}(st),ur=cr;function lr(e,t){return new nr(e,t)}ur.objectsCollection=void 0;var hr,dr=function(){function e(){C(this,e),this.listeners=[]}return P(e,[{key:"currentNode",get:function(){return this._currentNode}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"runWith",value:function(e,t){var n=this._currentNode;this._currentNode=e,this.dispatch(e,!0);try{return t()}finally{this._currentNode=n,this.dispatch(e,!1),n&&this.dispatch(n,!0)}}},{key:"dispatch",value:function(e,t){var n,r=T(this.listeners);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i(e,t)}catch(e){console.error(e)}}}catch(e){r.e(e)}finally{r.f()}}}]),e}();!function(e){e[e.SingleForward=0]="SingleForward",e[e.DoubleForward=1]="DoubleForward"}(hr||(hr={}));var pr,fr,vr,mr=new dr;!function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.Displayer=3]="Displayer"}(pr||(pr={})),function(e){e[e.Uncommitted=0]="Uncommitted",e[e.Committed=1]="Committed",e[e.Rejected=2]="Rejected"}(fr||(fr={})),function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"}(vr||(vr={}));var gr=function(){function e(t){C(this,e),this.operator=t,this.floatObjects={}}return P(e,[{key:"collectValue",value:function(e){var t=this;if("object"==M(e)&&null!==e){var n=this.operator.identifier(e);return n in this.floatObjects||(this.floatObjects[n]=e,this.operator.forEach(e,(function(e){t.collectValue(e)}))),n}}}]),e}(),yr=function e(){C(this,e)};function br(e){return e instanceof yr}function kr(e){var t=function(e,t,n){return n};return Object.setPrototypeOf(t,yr.prototype),Object.defineProperty(t,"payload",{enumerable:!0,configurable:!1,writable:!1,value:e}),t}var wr,Sr,xr=kr(null),Cr=kr(null),Ir=function e(t){var n=this;C(this,e),this.filters=[],this.filter=function(e,t,r){var i,a=T(n.filters);try{for(a.s();!(i=a.n()).done;){if((0,i.value)(e,t,r))return!0}}catch(e){a.e(e)}finally{a.f()}return!1};var r,i=[],a=T(t);try{var o=function(){var e=r.value,t=void 0;if("function"==typeof e)t=e;else if("string"==typeof e)t=function(t){return t===e};else{if(!(e instanceof RegExp))throw new Error("unrecognized condition "+e);t=function(t){return e.test(t)}}i.push(t)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.filters=Object.freeze(i)};function Pr(e,t){return{event:e.event,payload:e.payload,authorId:e.authorId,scope:Mr(e.scope),phase:t}}function Mr(e){switch(e){case Wn.System:return wr.System;case Wn.App:return wr.App;case Wn.Custom:return wr.Custom;default:return wr.Magix}}!function(e){e.System="system",e.App="app",e.Custom="custom",e.Magix="magix"}(wr||(wr={})),function(e){e.Dispatched="dispatched",e.Updated="updated",e.Canceled="canceled"}(Sr||(Sr={}));var Tr=function e(t){C(this,e),this.eventFilter=new Ir(t).filter};function Ar(e){return"object"==M(e)&&null!==e&&e instanceof Tr}function Er(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return kr(new Tr(t))}var Or="__reflection",Rr=function(){function e(t,n,r,i){C(this,e),this.isRootClass=n,this.id=r.classId,this.name=r.clazz.name,this.clazz=r.clazz,this.superClass=r.superClass,this.objectFormat=t.findObjectFormat(r.objectFormatId);for(var a={},o={},s=[r].concat(p(i)),c=s.length-1;c>=0;--c){var u,l=s[c],h=l.clazz,d=T(l.members);try{for(d.s();!(u=d.n()).done;){var f=u.value;Le(f)?a[f.name]=this.createProperty(f,h,this.objectFormat):je(f)&&(o[f.name]=this.createMethod(f,h,t))}}catch(e){d.e(e)}finally{d.f()}}this.properties=Object.freeze(a),this.methods=Object.freeze(o),this.methodNames=Object.freeze(Object.keys(this.methods))}return P(e,[{key:"createProperty",value:function(e,t,n){var r=e.decorators.some((function(e){return e===xr}));return Object.freeze({name:e.name,mode:e.mode,belongsClass:t,isTransient:r,isPublic:e.isPublic,objectFormat:n.properties[e.name],decorators:e.decorators})}},{key:"createMethod",value:function(e,t,n){var r,i=e.name,a=e.parameters,o=e.decorators,s=[],c=T(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;s.push(n.findObjectFormat(u))}}catch(e){c.e(e)}finally{c.f()}return Object.freeze({name:i,belongsClass:t,isPublic:e.isPublic,parameterFormatObjects:Object.freeze(s),decorators:Object.freeze(p(o))})}}]),e}(),Nr=function(e){g(n,e);var t=b(n);function n(e,r,i,a,o){var s;return C(this,n),(s=t.call(this,(function(e,t,n,r){return s.handleDecorateObject(e,t,n,r)}))).decorateObjectEnums=Object.freeze([tt.Object,tt.Array]),s.proxyRuntime=e,s.idGenerator=i,s.covertIdToClass=r,s.toOverrideObjects=a,s.overrideNodeCatcher=o,s}return P(n,[{key:"createObject",value:function(e,t){if(t===tt.HangUpObject)throw new wt("not support hang up object: ".concat(e));return s(x(n.prototype),"createObject",this).call(this,e,t)}},{key:"handleDecorateObject",value:function(e,t,n,r){var i=e.__identifier,a=this.proxyRuntime.objectOperator,o=this.getClassReflection(t,r),s=this.toOverrideObjects[i];if(!s||!this.isTypeMatch(s,t))switch(t){case et.Array:s=a.createObject(this.idGenerator.generate(),[]);break;case et.DeducedObject:s=a.createObject(this.idGenerator.generate(),{});break;case et.AssertedObject:Object.setPrototypeOf(e,o.clazz.prototype),s=a.createObject(this.idGenerator.generate(),e);break;default:throw new wt("invalid ObjectType ".concat(t))}var c,u=T(n);try{for(u.s();!(c=u.n()).done;){var l=c.value;l.object[l.key]=s}}catch(e){u.e(e)}finally{u.f()}this.overrideNodeCatcher(s,e,o)}},{key:"isTypeMatch",value:function(e,t){switch(this.proxyRuntime.objectOperator.kind(e)){case pr.Array:return t===et.Array;case pr.FlatObject:return t===et.DeducedObject;case pr.AkkoObject:return t===et.AssertedObject;default:return!1}}},{key:"getClassReflection",value:function(e,t){if(e===et.AssertedObject){if(!t)throw new wt("expect object format");var n=this.covertIdToClass(t.id);if(!n)throw new wt("can't find class by object format id ".concat(t.id));return n[Or]}return null}}]),n}(st),Lr=function(){function e(t){var n=this;C(this,e),this.assertObjectFormat=function(e){var t=n.proxyRuntime.objectOperator.getClassReflection(e);if(t)return t.objectFormat};var r=new gr(t.proxyRuntime.objectOperator);this.format=t.format,this.snapshotObjectFormats=t.snapshotObjectFormats,this.idGenerator=t.idGenerator,this.proxyRuntime=t.proxyRuntime,this.covertIdToClass=t.covertIdToClass,r.collectValue(t.rootObject),this.floatObjects=r.floatObjects}return P(e,[{key:"recoverFrom",value:function(t,n){for(var r,i=[],a=new Nr(this.proxyRuntime,this.covertIdToClass,this.idGenerator,this.floatObjects,(function(e,t,n){return i.push({object:e,tempObject:t,classReflection:n})})),o=!n,s=l(new Rt({format:this.format,objectAdapter:a,assertObjectFormat:this.assertObjectFormat}).deserialize({reader:t,objectFormats:this.snapshotObjectFormats,ignoreHashChecking:o,version:e.akkoSerVersion}),1)[0],c=0,u=i;c<u.length;c++){var h=u[c],d=h.object,p=h.tempObject,f=h.classReflection;this.proxyRuntime.objectOperator.override(d,p,f),p===s&&(r=d)}return r}}]),e}(),jr=Lr;jr.akkoSerVersion=Ot(He);var Dr,Fr=null,zr=null;mr.addListener((function(e,t){t&&e.tools?(Dr=e.coreFunctions,zr=e.tools.idGenerator,Fr=e.proxyRuntime):(Dr=null,zr=null,Fr=null)}));var Br,Ur,Vr=function(){function e(t,n){C(this,e),this.format=n.format,this.covertIdToClass=n.covertObjectFormatIdToClass,this.description=Object.freeze({roomUUID:t,appIdentifier:n.appIdentifier,appVersion:n.appVersion,appHash:n.appHash,akkoVersion:n.akkoVersion})}return P(e,[{key:"createSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!mr.currentNode)throw new Error("can't call createSnapshot out of Magix");var n=Dr.wrapper(e),r=new Lt,i=this.readObjectFormatWith(n),a=t;return r.writeUint8(t?255:0),t&&(r.writeString(this.description.roomUUID),r.writeString(this.description.appIdentifier),r.writeString(this.description.appVersion),r.writeString(this.description.appHash),r.writeString(this.description.akkoVersion)),r.writeUint32(i.id),Fr.frameHandler.createSerialization(this.format).serialize({writer:r,values:[n],objectFormats:[i],includesHash:a}),r.toBuffer().freeze()}},{key:"recoverWithSnapshot",value:function(e,t){if(!mr.currentNode)throw new Error("can't call recoverWithSnapshot out of Magix");var n=Dr.wrapper(t),r=new Yt(e),i=this.readDescription(r),a=r.readUint32();if(n&&this.readObjectFormatWith(n).id!==a)throw new Error("target's class isn't matching");var o=this.format.findObjectFormat(a),s=this.shouldOverrideTarget(i)?n:void 0;return new jr({rootObject:s,format:this.format,snapshotObjectFormats:[o],idGenerator:zr,proxyRuntime:Fr,covertIdToClass:this.covertIdToClass}).recoverFrom(r,void 0!==i)}},{key:"readObjectFormatWith",value:function(e){var t=Fr.objectOperator;if(t.kind(e)!==pr.AkkoObject)throw new Error("can't only create snapshot of AkkoObject");return t.getClassReflection(e).objectFormat}},{key:"readDescription",value:function(e){if(e.readUint8()){var t=e.readString(),n=e.readString(),r=e.readString(),i=e.readString(),a=e.readString();if(n!==this.description.appIdentifier)throw new Error("invalid snapshot: appIdentifier not matches");if(r!==this.description.appVersion)throw new Error("invalid snapshot: appVersion not matches");if(i!==this.description.appHash)throw new Error("invalid snapshot: appHash not matches");if(a!==this.description.akkoVersion)throw new Error("invalid snapshot: akkoVersion not matches");return{roomUUID:t,appIdentifier:n,appVersion:r,appHash:i,akkoVersion:a}}}},{key:"shouldOverrideTarget",value:function(e){return!e||e.roomUUID===this.description.roomUUID}}]),e}();function Wr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Vr(t,e)}function Hr(){if(!Br)throw new Error("you can not call this function out of Magix");return Br.resource}mr.addListener((function(e,t){Br=t&&e.tools?e.tools.extra:void 0})),function(e){e.Real="real",e.Illusion="illusion",e.NoEffects="noEffects"}(Ur||(Ur={}));var _r=function(){function e(t){C(this,e),this.atob=t}return P(e,[{key:"parse",value:function(e){for(var t=new String(this.atob(e)),n=ye(t.length),r=0;r<t.length;++r)n.setUint8(r,t.charCodeAt(r));return n}}]),e}();function Gr(e){var t={},n=function(n){var r=e[n];t[n]="function"==typeof r?function(){var e;try{for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];e=r.apply(t,i)}catch(e){console.error(e)}return e}:r};for(var r in e)n(r);return Object.freeze(t)}var Yr="__identifier";function Xr(e,t){Object.defineProperty(e,Yr,{enumerable:!1,configurable:!0,value:t})}var Qr,Kr,qr,Zr,Jr,$r,ei,ti,ni,ri,ii,ai=function(){function e(t,n){C(this,e),this.foundObjects=[],this.idGenerator=t,this.operator=n}return P(e,[{key:"complete",value:function(){var e,t=T(this.foundObjects);try{for(t.s();!(e=t.n()).done;){delete e.value[Yr]}}catch(e){t.e(e)}finally{t.f()}}},{key:"bind",value:function(e){if("object"!=M(e)||null===e||ke(e))return e;var t=e;if(this.operator.isDisplayerObject(t)&&(t=this.operator.copyDisplayer(t)),t.constructor===Array)return this.bindArray(t);if(t.constructor===Object)return this.bindObject(t);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function(e){var t=e[Yr];void 0===t&&(Xr(e,t=this.idGenerator.generate()),this.foundObjects.push(e));for(var n=0;n<e.length;++n)this.bind(e[n])}},{key:"bindObject",value:function(e){var t=e[Yr];for(var n in void 0===t&&(Xr(e,t=this.idGenerator.generate()),this.foundObjects.push(e)),e)this.bind(e[n])}}]),e}(),oi=function(){function e(t,n,r){C(this,e),this.nodes={},this.idGenerator=t,this.operator=n,this.adapter=r}return P(e,[{key:"bind",value:function(e,t){var n=null,r=this.bindValue(e,t),i=this.findIdentifier(r);if(void 0!==i){var a=this.nodes[i];n={wrapped:a.wrapped,copied:a.copied}}return{value:r,binder:n}}},{key:"completeBinding",value:function(){for(var e in this.nodes){delete this.nodes[e].binded[Yr]}}},{key:"bindValue",value:function(e,t){if("object"!=M(e)||null===e)return e;if(ke(e))return e.readonly?e:e.slice();var n=e;if(this.operator.isDisplayerObject(n)&&(n=this.operator.copyDisplayer(n)),n.constructor===Array)return this.bindArray(n,t);if(n.constructor===Object)return this.bindObject(n,t);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function(e,t){var n=e[Yr];if(void 0===n){n=this.idGenerator.generate();var r=this.adapter.createObject(n,tt.Array),i=[];Xr(e,n),Xr(i,n),this.nodes[n]={identifier:n,binded:e,copied:i,wrapped:r};for(var a=0;a<e.length;++a){var o=this.bindValue(e[a],t.index),s=this.findIdentifier(o);if(void 0===s)this.adapter.setValue(r,a,o),i[a]=o;else{var c=this.nodes[s],u=c.copied,l=c.wrapped;this.adapter.setValue(r,a,l),i[a]=u}}}return e}},{key:"bindObject",value:function(e,t){var n=e[Yr];if(void 0===n){n=this.idGenerator.generate();var r={},i=this.adapter.createObject(n,tt.Object),a=[],o=[];for(var s in Xr(e,n),Xr(r,n),this.nodes[n]={identifier:n,binded:e,copied:r,wrapped:i},t.properties)s in e&&(a.push(s),o.push(t.properties[s]));for(var c in e)c!==Yr&&!(c in t.properties)&&(a.push(c),o.push(t.key));for(var u=0;u<a.length;++u){var l=a[u],h=o[u],d=this.bindValue(e[l],h),p=this.findIdentifier(d);if(void 0===p)this.adapter.setValue(i,l,d),r[l]=d;else{var f=this.nodes[p],v=f.copied,m=f.wrapped;this.adapter.setValue(i,l,m),r[l]=v}}}return e}},{key:"findIdentifier",value:function(e){if("object"==M(e)&&null!==e)return e[Yr]}}]),e}(),si=function(){function e(t){C(this,e),this._phase=t.phase||t.getCurrentPhase(),this.getCurrentPhase=t.getCurrentPhase,this.onPhaseChanged=t.onPhaseChanged}return P(e,[{key:"phase",get:function(){return this._phase}},{key:"touch",value:function(){var e=this.getCurrentPhase(),t=this._phase;t!==e&&(this._phase=e,this.onPhaseChanged&&this.onPhaseChanged(e,t))}}]),e}(),ci=function(){function e(t,n){C(this,e),this.paddingInvokers=null,this.logger=t,this.callbacks=qn({},n)}return P(e,[{key:"hasKey",value:function(e){return e in this.callbacks}},{key:"callback",value:function(e,t){var n=this.callbacks[e];if(n)if(this.paddingInvokers)this.paddingInvokers.push({key:e,payload:t});else try{n(t)}catch(e){this.logger.error(e)}}},{key:"isPadding",get:function(){return!!this.paddingInvokers},set:function(e){if(this.isPadding!==e)if(e)this.paddingInvokers=[];else{var t,n=T(this.paddingInvokers);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.key,a=r.payload;try{this.callbacks[i](a)}catch(e){this.logger.error(e)}}}catch(e){n.e(e)}finally{n.f()}this.paddingInvokers=null}}}]),e}(),ui=function(){function e(t){C(this,e),this.base64Parser=new _r(t)}return P(e,[{key:"create",value:function(e){if(!this.isSupportedAkkoVersion(e.akkoVersion))throw new xe("can not support library (built by akko ".concat(e.akkoVersion,")"));var t=this.createFormat(e.formatBase64),n=this.createClassReflections(t,e.rootConstructor,e.classDeclarations),r=this.createObjectFormatToClassMap(n);return new li(e.appIdentifier,e.appVersion,e.formatHash,e.akkoVersion,e.rootConstructor,(function(e){return r[e]}),t,n)}},{key:"isSupportedAkkoVersion",value:function(e){var t=He.split("."),n=e.split(".");return!(n.length<2||t[0]!==n[0]||t[1]!==n[1])&&(!(t.length>=3)||t[2]>=n[2])}},{key:"createFormat",value:function(e){var t=new nn,n=this.base64Parser.parse(e);return t.createWithBuffer(n)}},{key:"createClassReflections",value:function(e,t,n){var r={};for(var i in n){var a=n[i],s=a.clazz,c=s===t,u=o(this.searchThisAndSuperClassDeclarations(a,n)),l=u[0],h=u.slice(1),d=new Rr(e,c,l,h);if(void 0!==Object.getOwnPropertyDescriptor(s,Or))throw new xe("class ".concat(s.name,' has defined  reserved word static property "').concat(Or));Object.defineProperty(s,Or,{value:d,writable:!1,configurable:!1}),r[i]=d}return Object.freeze(r)}},{key:"createObjectFormatToClassMap",value:function(e){var t={};for(var n in e){var r=e[n];t[r.objectFormat.id]=r.clazz}return Object.freeze(t)}},{key:"searchThisAndSuperClassDeclarations",value:function(e,t){for(var n=[],r=e;n.push(r),r.superClass&&r.superClass!==Object;)r=this.findClassDeclarationsWithConstructor(r.superClass,t);return n}},{key:"findClassDeclarationsWithConstructor",value:function(e,t){for(var n in t){var r=t[n];if(r.clazz===e)return r}throw new xe("can not find superClass")}}]),e}(),li=function(){function e(t,n,r,i,a,o,s,c){C(this,e),this.appIdentifier=t,this.appVersion=n,this.appHash=r,this.akkoVersion=i,this.rootClass=a,this.covertObjectFormatIdToClass=o,this.format=s,this.classReflections=c}return P(e,[{key:"classReflection",value:function(e){var t=this.classReflections[e];if(!t)throw new Error("can't find class with id ".concat(e));return t}}]),e}();function hi(e){Qr=e.creator,Kr=e.updater,qr=e.wrapper,Zr=e.unwrapper,Jr=e.jsxUnwrapper,$r=e.getter,ei=e.setter,ti=e.caller,ni=e.remover,ri=e.prefix,ii=e.postfix}var di,pi,fi=Object.freeze({creator:function(e){return e},updater:function(e){return e},wrapper:function(e){return e},unwrapper:function(e){return e},jsxUnwrapper:function(e){return e},getter:function(e,t){return e[t]},setter:function(e,t,n){return e[t]=n},caller:function(e,t,n,r){return(r||e)[t].apply(e,n)},remover:function(e,t){return delete e[t]},prefix:function(e,t,n){return e[t]+=n},postfix:function(e,t,n){var r=e[t];return e[t]+=n,r}});function vi(){if(!di){var e=this.constructor&&this.constructor.name;throw e?new Error("can't construct ".concat(e," out of Magix, it's an AkkoObject")):new Error("can't construct an AkkoObject out of Magix")}di(this)}hi(fi),mr.addListener((function(e,t){hi(t?e.coreFunctions:fi)})),mr.addListener((function(e,t){di=t?e.coreFunctions.creator:void 0})),Object.setPrototypeOf(vi.prototype,Object.prototype),mr.addListener((function(e,t){pi=t?e.proxyRuntime.objectOperator:void 0}));var mi=function(){var e=new ui(yn.default.bind(null));return new Ne({akkoVersion:He,akkoObjectBaseClass:vi,libraryFactory:e.create.bind(e),coreFunctions:{creator:function(e){return Qr(e)},updater:function(e){return Kr(e)},wrapper:function(e){return qr(e)},unwrapper:function(e){return Zr(e)},jsxUnwrapper:function(e){return Jr(e)},getter:function(e,t){return $r(e,t)},setter:function(e,t,n){return ei(e,t,n)},caller:function(e,t,n,r){return ti(e,t,n,r)},remover:function(e,t){return ni(e,t)},prefix:function(e,t,n){return ri(e,t,n)},postfix:function(e,t,n){return ii(e,t,n)}}})}();var gi,yi,bi,ki,wi=mi.context,Si=mi.getLibrary;function xi(e){if(!pi)throw new Error("can't call isAkkoObject out of Magix");return pi.isValidObject(e)||mi.isAkkoObject(e)}function Ci(e){if("function"==typeof e){var t=e[Or];if("object"==M(t)&&null!==t)return t}else if(mi.isAkkoObject(e))return Ci(e.constructor)}function Ii(){if(!gi)throw Ni();return gi.environment}function Pi(){if(!gi)throw Ni();return gi.timestamp}function Mi(){if(!gi)throw Ni();return gi.functions.getAuthorId()}function Ti(e){if(!gi)throw Ni();return gi.functions.hasUser(e)}function Ai(){if(!gi)throw Ni();return gi.functions.getUsersCount()}function Ei(e){if(!gi)throw Ni();return gi.functions.getUser(e)}function Oi(){if(!gi)throw Ni();return gi.functions.getUserIds()}function Ri(){if(!gi)throw Ni();return gi.snapshot}function Ni(){return new Error("you can not call this function out of Magix")}function Li(e){for(var t=new Yt(e),n=t.readUint32(),r=[],i=t.readUint32(),a=0;a<i;++a){var o=t.readInt53(),s=t.readUint32();r.push(Object.freeze({beginScopeId:o,count:s}))}return Object.freeze({userId:n,initializeSlices:Object.freeze(r)})}mr.addListener((function(e,t){gi=t&&e.tools?e.tools:void 0})),function(e){e.RoomDelete="roomDelete",e.RoomZombie="roomZombie",e.RoomBan="roomBan",e.GatewayAdjust="GatewayAdjust",e.KickByAdmin="kickByAdmin",e.ReplaceByOther="replaceByOther",e.Crash="crash",e.Isolate="isolate"}(yi||(yi={})),function(e){e[e.Inserted=0]="Inserted",e[e.Updated=1]="Updated",e[e.Removed=2]="Removed"}(bi||(bi={})),function(e){e[e.Readonly=0]="Readonly",e[e.Writable=1]="Writable"}(ki||(ki={}));var ji=function(){function e(t,n){C(this,e);var r=n.format.anyObjectFormat;this.serialization=new Rt({format:n.format,objectAdapter:new ur}),this.objectOperator=t,this.oneAnyObjectFormats=Object.freeze([r]),this.twoAnyObjectFormats=Object.freeze([r,r])}return P(e,[{key:"serialize",value:function(e){var t=new Lt,n=gt(-1),r=new ai(n,this.objectOperator);t.writeUint8(e.kind);try{switch(e.kind){case ki.Writable:var i=e.userPayload,a=e.connectedPayload;r.bind(i),r.bind(a),this.serialization.serialize({writer:t,values:[i,a],objectFormats:this.twoAnyObjectFormats,includesHash:!1});break;case ki.Readonly:var o=e.payload;r.bind(o),this.serialization.serialize({writer:t,values:[o],objectFormats:this.oneAnyObjectFormats,includesHash:!1})}return t.toBuffer()}finally{r.complete()}}},{key:"deserialize",value:function(t){try{ur.startCollection();var n=new Yt(t),r=n.readUint8();switch(r){case ki.Writable:var i=l(this.serialization.deserialize({reader:n,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:!0,version:e.akkoSerVersion}),2);return{kind:r,userPayload:i[0],connectedPayload:i[1]};case ki.Readonly:return{kind:r,payload:l(this.serialization.deserialize({reader:n,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:!0,version:e.akkoSerVersion}),1)[0]};default:throw new Error("invalid kind ".concat(r))}}finally{ur.completeCollection()}}}]),e}(),Di=ji;Di.akkoSerVersion=Ot(He);var Fi=function(){function e(){C(this,e)}return P(e,[{key:"serialize",value:function(e){var t=new Lt;return t.writeString(e.libIdentifier),t.writeString(e.appIdentifier),t.writeString(e.appVersion),t.writeString(e.appHash),t.toBuffer()}},{key:"deserialize",value:function(e){var t=new Yt(e);return{libIdentifier:t.readString(),appIdentifier:t.readString(),appVersion:t.readString(),appHash:t.readString()}}}]),e}();function zi(e){return function(e){var t=new Lt;return t.writeUint32(e.id),t.writeInt53(e.timestamp),t.toBuffer()}(e)}function Bi(e){return function(e){var t=new Yt(e),n=t.readUint32(),r=t.readInt53();return Object.freeze({id:n,timestamp:r})}(e)}var Ui=function(){function e(t){if(C(this,e),this.storageSlices=[],this.usingSlice=void 0,this.nextScopeId=0,t){var n,r=T(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.appendScopeSlice(i)}}catch(e){r.e(e)}finally{r.f()}}}return P(e,[{key:"allocScopeId",value:function(){if(this.usingSlice){var e=this.nextScopeId;return e===this.usingSlice.beginScopeId+this.usingSlice.count-1?(this.usingSlice=this.storageSlices.shift(),this.usingSlice&&(this.nextScopeId=this.usingSlice.beginScopeId)):this.nextScopeId+=1,e}}},{key:"appendScopeSlice",value:function(e){this.usingSlice?this.storageSlices.push(e):(this.usingSlice=e,this.nextScopeId=e.beginScopeId)}}]),e}();var Vi,Wi=new Un(["error","snapshot","action","chunk","session-build","update-online","allocate-user","release-user","allocate-scope","update-access","ban-access","hang-up","library-description","ping","pong","reset-frame-id","ack-reset-frame-id","action-newline","allocate-user-ids","user-ids","allocate-snapshot","watch-action","action-result","isolate-room"]);!function(e){e[e.Undefined=0]="Undefined",e[e.NoUserToRelease=1]="NoUserToRelease",e[e.WritableAccessForbidden=2]="WritableAccessForbidden",e[e.StuffedOfWritableUsers=3]="StuffedOfWritableUsers",e[e.WrongWritablePhase=4]="WrongWritablePhase"}(Vi||(Vi={}));var Hi=function(){function e(t,n,r){C(this,e),this.nextFrameId=0,this.userId=t,this.scopeStorage=n,this.nextFrameId=r}return P(e,[{key:"createFrameId",value:function(){var e=this.nextFrameId;return this.nextFrameId+=1,e}},{key:"appendScopeSlices",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.scopeStorage.appendScopeSlice(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"allocateIdentifierGenerator",value:function(){var e=this.scopeStorage.allocScopeId();if(void 0===e)throw new xe("run out of scope ID");return gt(e)}}]),e}(),_i=function(){function e(t,n){if(C(this,e),this.users={},this._usersCount=0,this.paddingImageCreatingTask=null,this.proxyRuntime=t,n){var r,i=T(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.users[a.userId]={userId:a.userId,nextFrameId:a.nextFrameId,session:a.session,payload:a.payload},this._usersCount+=1}}catch(e){i.e(e)}finally{i.f()}}else this.users[an]={userId:an,nextFrameId:0,session:"",payload:void 0},this._usersCount+=1}return P(e,[{key:"hasUser",value:function(e){return e in this.users}},{key:"userIds",get:function(){var e=[];for(var t in this.users)e.push(parseInt(t,10));return e.sort()}},{key:"usersCount",get:function(){return this._usersCount}},{key:"user",value:function(e,t){var n=this.users[e];if(n){var r=n.payload;return t||(r=this.proxyRuntime.objectOperator.wrapDisplayer(this.proxyRuntime,r)),{userId:e,session:n.session,payload:r}}}},{key:"snapshotUsers",value:function(){var e,t=[],n=T(this.userIds);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.users[r];t.push({userId:r,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"createImageAuthor",value:function(e,t){var n=this,r=e.userId,i=this.users[r];if(i){var a=new Ui(e.initializeSlices),o=new Hi(e.userId,a,i.nextFrameId);try{t(o)}catch(e){console.error(e)}return Promise.resolve()}return new Promise((function(r){n.paddingImageCreatingTask={allocatedUser:e,complete:function(e){r(),e&&t(e)}}}))}},{key:"cancelImageAuthorCreating",value:function(){this.paddingImageCreatingTask&&(this.paddingImageCreatingTask.complete(null),this.paddingImageCreatingTask=null)}},{key:"updateUserNextFrameId",value:function(e,t){var n=this.users[e];n&&(n.nextFrameId=t)}},{key:"userEnter",value:function(e,t,n,r){var i=this;e in this.users||(this._usersCount+=1),this.users[e]={userId:e,nextFrameId:t,session:n,payload:r},this.proxyRuntime.observeUpdate((function(){if(i.paddingImageCreatingTask){var n=i.paddingImageCreatingTask.allocatedUser,r=n.userId,a=n.initializeSlices;if(r===e){var o=new Ui(a),s=new Hi(e,o,t);i.paddingImageCreatingTask.complete(s),i.paddingImageCreatingTask=null}}i.proxyRuntime.reportUsersChanged(i._usersCount)}))}},{key:"userLeave",value:function(e){e in this.users&&(this._usersCount-=1,delete this.users[e]),this.proxyRuntime.reportUsersChanged(this._usersCount)}}]),e}(),Gi=function(){function e(t){C(this,e),this.didCompleteInit=!1,this.proxyRuntime=t.proxyRuntime,this.imageUsers=t.imageUsers,this.onEventFire=t.onEventFire,this.onEventFireACK=t.onEventFireACK,this.onCatchErrorWhenAppendFrame=t.onCatchErrorWhenAppendFrame;var n=Ci(t.library.rootClass),r=[],i={},a={};for(var o in n.methods){var s=n.methods[o],c=e.findEventPayloadWithDecorators(s.decorators);c&&r.push(Object.freeze({filter:c.eventFilter,method:o})),a[o]=e.findNoEffectsWithDecorators(s.decorators)}for(var u=0;u<n.methodNames.length;++u)i[n.methodNames[u]]=u;this.methodNames=n.methodNames,this.methodNameToIdMap=Object.freeze(i),this.eventHandlers=Object.freeze(r),this.noEffectsMethods=Object.freeze(a)}return P(e,[{key:"completeInit",value:function(){this.didCompleteInit=!0}},{key:"methodNameToId",value:function(e){return this.methodNameToIdMap[e]}},{key:"isNoEffectMethod",value:function(e){return this.noEffectsMethods[e]}},{key:"dispatch",value:function(e,t){var n,r=this.proxyRuntime.rootObject.target,i=Wn.Custom,a=T(this.eventHandlers);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.filter,c=o.method;s(e,t,i)&&this.proxyRuntime.rootObject.getRootMethod(c).apply(r,[e,t,i])}}catch(e){a.e(e)}finally{a.f()}}},{key:"invoke",value:function(e,t){var n=this.proxyRuntime.rootObject.target;return this.proxyRuntime.rootObject.getRootMethod(e).apply(n,t)}},{key:"appendAction",value:function(e,t,n){var r=this;(t.mode===vr.Real||t.mode===vr.RealAck)&&this.imageUsers.updateUserNextFrameId(e.authorId,e.originalFrameId+1);var i=!this.isForcesOnIllusionLine(t.mode);try{var a;return this.proxyRuntime.block.runWithMagix(t,(function(){Jn(e)?a=r.invokeActionFrame(e):$n(e)?r.handleEventActionFrame(e):er(e)?r.handleEnterActionFrame(e):tr(e)&&r.handleLeaveActionFrame(e)})),a}catch(a){try{this.onCatchErrorWhenAppendFrame&&this.onCatchErrorWhenAppendFrame(e.authorId,a),n&&n(a)}catch(e){console.error(e)}return}finally{i&&(this.frameId=e.frameId,this.timestamp=e.timestamp)}}},{key:"callbackEventIfNeed",value:function(e){if(this.didCompleteInit)if($n(e)){var t=this.proxyRuntime.rootObject.observerId;e.authorId===t?this.onEventFireACK({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId}):this.onEventFire({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId})}else er(e)?this.onEventFire({event:"Enter",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.connectedPayload),scope:Wn.System,authorId:e.authorId}):tr(e)&&this.onEventFire({event:"Leave",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:Wn.System,authorId:e.authorId})}},{key:"invokeActionFrame",value:function(e){var t=e.methodId,n=e.parameters,r=this.proxyRuntime.rootObject.target,i=this.methodNames[t];return this.proxyRuntime.rootObject.getRootMethod(i).apply(r,n)}},{key:"handleEventActionFrame",value:function(e){if(void 0!==e.beginGenerationId&&e.scope===Wn.System)switch(e.event){case"Enter":var t=e.authorId,n=e.originalFrameId+1;this.imageUsers.userEnter(t,n,"",undefined);break;case"Leave":this.imageUsers.userLeave(e.authorId)}this.invokeEventCallbacks(e.event,e.payload,e.scope)}},{key:"handleEnterActionFrame",value:function(e){var t=e.authorId,n=e.originalFrameId+1,r=e.session,i=e.userPayload;this.imageUsers.userEnter(t,n,r,i),this.invokeEventCallbacks("Enter",e.connectedPayload,Wn.System)}},{key:"handleLeaveActionFrame",value:function(e){var t=e.authorId,n=e.payload;this.imageUsers.userLeave(t),this.invokeEventCallbacks("Leave",n,Wn.System)}},{key:"invokeEventCallbacks",value:function(e,t,n){var r,i=this.proxyRuntime.rootObject.target,a=T(this.eventHandlers);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.filter,c=o.method;s(e,t,n)&&this.proxyRuntime.rootObject.getRootMethod(c).apply(i,[e,t,n])}}catch(e){a.e(e)}finally{a.f()}}},{key:"isForcesOnIllusionLine",value:function(e){switch(e){case vr.Real:case vr.RealAck:return!1;case vr.Illusion:case vr.IllusionRebuild:return!0;case vr.Outside:return this.proxyRuntime.hasDoubleLines&&this.proxyRuntime.hasBranch;default:throw new Error("invalid mode ".concat(e))}}}],[{key:"findEventPayloadWithDecorators",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(br(r)&&Ar(r.payload))return r.payload}}catch(e){n.e(e)}finally{n.f()}}},{key:"findNoEffectsWithDecorators",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){if(t.value===Cr)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}}]),e}(),Yi=function(){function e(t,n,r){C(this,e),this.observerId=t,this.logger=n,this.onLengthChanged=r,this.queue=[]}return P(e,[{key:"length",get:function(){return this.queue.length}},{key:"pushIllusionActionFrameGetter",value:function(e){this.queue.push(e),this.onLengthChanged(this.queue.length)}},{key:"forFrames",value:function(e){var t,n=T(this.queue);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"replaceActionFrame",value:function(e){var t,n,r,i=this.isAckFrame(e);if(i){var a=this.takeIllusionFrame(e.frameId,e.originalFrameId),o=new sr(a.get());t=Date.now()-a.timestamp,o.frameId=e.frameId,o.originalFrameId=e.originalFrameId,o.timestamp=e.timestamp,n=o.frameBuffer,r=a.section}else{if(e.type===Vn.Ack)throw new Error("received others' ACK frame");n=e.frameBuffer}return{replacedBuffer:n,isAck:i,rttTimeInterval:t,section:r}}},{key:"takeIllusionFrame",value:function(e,t){var n=this.queue.findIndex((function(e){return e.frameId===t}));if(n>0&&this.logger.warn("received frame can't touch first illusion frame"),-1===n)throw new Error("not found frameId ".concat(t," match to ACK frameId"));var r=this.queue.splice(n,1)[0];return this.onLengthChanged(this.queue.length),r}},{key:"isAckFrame",value:function(e){switch(e.type){case Vn.Ack:case Vn.Invoker:return e.authorId===this.observerId;case Vn.Event:if(e.scope===Wn.Custom)return e.authorId===this.observerId}return!1}}]),e}();function Xi(e){return void 0===e.beginGenerationId?gt(e.scopeId,e.beginObjectId):function(e,t){if(e>rt)throw new Error("observerId ".concat(e," is out of range 0 ~ ").concat(rt));var n=[],r=new bt(e,n);return vt.pushUint32(n,e),r.makeSureNextGenerationIdAfter(t),r}(e.authorId,e.beginGenerationId)}var Qi=function(){function e(t,n,r,i,a,o,s){C(this,e),this.logger=t,this.strategy=n,this.proxyRuntime=r,this.triggerInvoker=i,this.assertAppendFrameId=a,this.onReceivedRttReport=o,this.onIllusionQueueLengthChanged=s,this.observerId=null,this._illusionQueue=null}return P(e,[{key:"illusionQueue",get:function(){return this._illusionQueue}},{key:"waitUtilIllusionQueueEmpty",value:function(){var e=this;return 0===this._illusionQueue.length?Promise.resolve():new Promise((function(t){e.onIllusionQueueEmpty=t}))}},{key:"setObserverId",value:function(e){if(this._illusionQueue)throw new Error("did set observer ID");this.observerId=e,this._illusionQueue=new Yi(e,this.logger,this.onIllusionQueueLengthChanged)}},{key:"cleanObserverId",value:function(){var e=this._illusionQueue;this.observerId=null,this._illusionQueue=null,this.onIllusionQueueLengthChanged(e.length)}},{key:"appendActionFramesWithDoubleMode",value:function(e,t){for(var n,r=this,i=function(i){var a=e[i],o=r.proxyRuntime.frameHandler.deserializeActionFrame(a,r.strategy.deserializerVersion,r.strategy.ignoreHashChecking,{mode:vr.Real}),s=Xi(o);r.assertAppendFrameId(o);var c=t&&function(e){return t(e,i)},u={authorId:o.authorId,mode:vr.Real,timestamp:o.timestamp,identifierGenerator:s};n=r.triggerInvoker.appendAction(o,u,c),r.triggerInvoker.callbackEventIfNeed(o)},a=0;a<e.length;++a)i(a);return n}},{key:"appendActionFrames",value:function(e,t){for(var n,r=this,i=[],a=[],o=!1,s=!1,c=0;c<e.length;++c){var u=new sr(e[c]),l=this._illusionQueue.replaceActionFrame(u);l.isAck||(o=!0),!s&&u.type===Vn.Leave&&u.authorId===this.observerId&&(s=!0);var h={index:c,frameBuffer:l.replacedBuffer,frameSection:l.section};o?a.push(h):i.push(h),void 0!==l.rttTimeInterval&&this.onReceivedRttReport(l.rttTimeInterval)}if(this.proxyRuntime.block.runWithDisableObserve((function(){var e,n=T(i);try{var a=function(){var n=e.value,i=n.index,a=n.frameBuffer,o=n.frameSection,s=r.proxyRuntime.frameHandler.deserializeActionFrame(a,r.strategy.deserializerVersion,r.strategy.ignoreHashChecking,{mode:vr.RealAck,frameSection:o}),c=Xi(s);r.assertAppendFrameId(s);var u=t&&function(e){return t(e,i)},l={authorId:s.authorId,mode:vr.RealAck,timestamp:s.timestamp,frameSection:o,identifierGenerator:c};r.triggerInvoker.appendAction(s,l,u),r.triggerInvoker.callbackEventIfNeed(s),o.completeACK()};for(n.s();!(e=n.n()).done;)a()}catch(e){n.e(e)}finally{n.f()}})),a.length>0){this.proxyRuntime.mergeBranch();var d,p=T(a);try{var f=function(){var e=d.value,i=e.index,a=e.frameBuffer,o=e.frameSection,s=r.proxyRuntime.frameHandler.deserializeActionFrame(a,r.strategy.deserializerVersion,r.strategy.ignoreHashChecking,{mode:vr.Real,frameSection:o}),c=Xi(s);r.assertAppendFrameId(s);var u=t&&function(e){return t(e,i)},l={authorId:s.authorId,mode:vr.Real,timestamp:s.timestamp,frameSection:o,identifierGenerator:c};n=r.triggerInvoker.appendAction(s,l,u),r.triggerInvoker.callbackEventIfNeed(s)};for(p.s();!(d=p.n()).done;)f()}catch(e){p.e(e)}finally{p.f()}this._illusionQueue.length>0&&(s?this._illusionQueue=new Yi(this.observerId,this.logger,this.onIllusionQueueLengthChanged):this.rebuildIllusionBranch())}return this.proxyRuntime.hasBranch&&this.proxyRuntime.hasDoubleLines&&0===this._illusionQueue.length&&this.proxyRuntime.mergeBranch(),this.onIllusionQueueEmpty&&0===this._illusionQueue.length&&(this.onIllusionQueueEmpty(),this.onIllusionQueueEmpty=void 0),n}},{key:"rebuildIllusionBranch",value:function(){var e=this;this.proxyRuntime.forkBranchRuntime();var t=this._illusionQueue;this._illusionQueue=new Yi(this.observerId,this.logger,this.onIllusionQueueLengthChanged),t.forFrames((function(t){var n=new sr(t.get()),r=e.proxyRuntime.createFrameSection(t.section),i={frameId:t.frameId,timestamp:t.timestamp,section:r,get:function(){return n.frameBuffer}};e._illusionQueue.pushIllusionActionFrameGetter(i);var a=e.proxyRuntime.frameHandler.deserializeActionFrame(n.frameBuffer,e.strategy.deserializerVersion,e.strategy.ignoreHashChecking,{mode:vr.IllusionRebuild,frameSection:r}),o=Xi(a);e.triggerInvoker.appendAction(a,{authorId:a.authorId,mode:vr.IllusionRebuild,timestamp:a.timestamp,frameSection:r,identifierGenerator:o}),r.completeRebuild()})),t.length>0&&this.onIllusionQueueLengthChanged(this._illusionQueue.length)}}]),e}(),Ki=function(){function e(t,n){C(this,e),this.objectOperator=n,this.rootClassReflection=Ci(t.rootClass);var r=new Rt({format:t.format,objectAdapter:new ur});this.flatFrameSerialization=lr(r,this.rootClassReflection)}return P(e,[{key:"serialize",value:function(e,t,n){var r=new ai(e,this.objectOperator);try{this.replaceWithBindsActionFrame(r,t);var i=Zn(qn({},t),{beginObjectId:e.createdCount});return this.flatFrameSerialization.serializeActionFrame(i,n)}finally{r.complete()}}},{key:"replaceWithBindsActionFrame",value:function(e,t){if($n(t))e.bind(t.payload);else if(Jn(t)){var n,r=T(t.parameters);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.bind(i)}}catch(e){r.e(e)}finally{r.f()}}else er(t)?(e.bind(t.userPayload),e.bind(t.connectedPayload)):tr(t)&&e.bind(t.payload)}}]),e}(),qi=function(){function e(t){C(this,e),this.author=t.author,this.objectOperator=t.objectOperator,this.rootClassReflection=t.rootClassReflection,this.objectAdapter=t.objectAdapter,this.flatFrameSerialization=t.flatFrameSerialization,this.includesFrameHash=t.includesFrameHash}return P(e,[{key:"appendScopeSlices",value:function(e){this.author.appendScopeSlices(e)}},{key:"handleInvokerArgs",value:function(e,t,n){var r=this.objectOperator,i=this.objectAdapter,a=this.rootClassReflection,o=new oi(n,r,i);try{for(var s=a.methods[e].parameterFormatObjects,c=[],u=[],l=0;l<t.length;++l){var h=o.bind(t[l],s[l]),d=h.value,p=h.binder;p?(c[l]=p.copied,u[l]=p.wrapped):(c[l]=d,u[l]=d)}return{copied:c,wrapped:u}}finally{o.completeBinding()}}},{key:"handlePayload",value:function(e,t){var n=this.objectOperator,r=this.objectAdapter,i=this.flatFrameSerialization.serialization.format.anyObjectFormat,a=new oi(t,n,r);try{var o=a.bind(e,i),s=o.value,c=o.binder,u=s,l=s;return c&&(u=c.copied,l=c.wrapped),{copied:u,wrapped:l}}finally{a.completeBinding()}}},{key:"serializeEventFrameGetter",value:function(e,t,n,r){var i=this,a=this.author.createFrameId(),o={frameId:a,originalFrameId:a,timestamp:n,authorId:this.author.userId,type:Vn.Event,scopeId:r.scopeId,beginObjectId:r.createdCount,event:e,payload:t,scope:Wn.Custom};return{frameId:a,getter:function(){return i.flatFrameSerialization.serializeActionFrame(o,i.includesFrameHash)}}}},{key:"serializeInvokerFrameGetter",value:function(e,t,n,r){var i=this,a=this.author.createFrameId(),o={frameId:a,originalFrameId:a,timestamp:n,authorId:this.author.userId,type:Vn.Invoker,scopeId:r.scopeId,beginObjectId:r.createdCount,methodId:e,parameters:t};return{frameId:a,getter:function(){return i.flatFrameSerialization.serializeActionFrame(o,i.includesFrameHash)}}}}]),e}(),Zi=function(){function e(t,n){C(this,e),this.onGeneratedFrameBuffer=t,this.onGenreateFrameFailed=n,this.pendding={},this._count=0}return P(e,[{key:"count",get:function(){return this._count}},{key:"createEventFrameGetter",value:function(e,t,n,r,i,a){var o=this,s=r.serializeEventFrameGetter(e,t,n,a),c=s.frameId,u=s.getter,l=new $i(c,n,i,(function(){try{var e=new sr(u());return o.fireGenerate(l,e),e.frameBuffer}catch(e){throw o.onGenreateFrameFailed(e),e}}));return this.fireCreate(l),l}},{key:"createInvokerFrameGetter",value:function(e,t,n,r,i,a){var o=this,s=r.serializeInvokerFrameGetter(e,t,n,a),c=s.frameId,u=s.getter,l=new $i(c,n,i,(function(){try{var e=new sr(u());return o.fireGenerate(l,e),e.frameBuffer}catch(e){throw o.onGenreateFrameFailed(e),e}}));return this.fireCreate(l),l}},{key:"fireCreate",value:function(e){this.pendding[e.id]||(this.pendding[e.id]=e,this._count+=1)}},{key:"fireGenerate",value:function(e,t){e.id in this.pendding&&(delete this.pendding[e.id],this._count-=1),this.onGeneratedFrameBuffer(t.frameBuffer)}}]),e}();Zi.callGetMaxDuration=1200;var Ji=function(){function e(t,n,r,i){C(this,e),this.frameId=t,this.timestamp=n,this.section=r,this.getter=i,this.buffer=null,this.id="".concat(e.nextId),e.nextId+=1}return P(e,[{key:"get",value:function(){return this.buffer||(this.buffer=this.getter()),this.buffer}}]),e}(),$i=Ji;$i.nextId=0;var ea,ta=function(){function e(t){var n=this;if(C(this,e),this.modifiable=!0,this.generator=null,this.didDestroy=!1,this.assertAppendFrameId=function(e){var t=e.frameId,r=n.triggerInvoker.frameId+1;if(r!==t)throw new Error("find unexpected frame id ".concat(t,", wanna ").concat(r))},this.invokeMethod=function(e,t){n.assertEnableSendActionFrames();var r,i=Date.now(),a=n.generator;if(!a)throw new Error("cannot invoke ".concat(e,", frameGenerator is not prepare"));var o=a.author.allocateIdentifierGenerator(),s=n.proxyRuntime.block.runWithContinuousUpdated((function(){var s=n.proxyRuntime.createFrameSection(),c={authorId:a.author.userId,mode:vr.Illusion,frameSection:s,timestamp:i,identifierGenerator:o};r=n.proxyRuntime.block.runWithMagix(c,(function(){var r=n.triggerInvoker.methodNameToId(e),c=a.handleInvokerArgs(e,t,o),u=o.clone();try{return n.triggerInvoker.invoke(e,c.wrapped)}finally{var l=n.pending.createInvokerFrameGetter(r,c.copied,i,a,s,u);n.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(l),n.callbacks.onGeneratedActionFrame?(n.phaseNode.touch(),n.callbacks.onGeneratedActionFrame(l)):l.get()}}))}));return n.callbacks.onModified&&s.didUpdated&&n.callbacks.onModified(),r},this.currentPhase=function(){var e=n.branchImageHelper.illusionQueue;return e&&0===e.length&&0===n.pending.count?ea.Real:ea.Illusion},this.clientCrashWithError=function(e){n.callbacks.onClientCrashWithError&&Promise.resolve().then((function(){return n.callbacks.onClientCrashWithError(e)})).catch((function(e){return console.error(e)}))},this.library=t.library,this.logger=t.logger,this.proxyRuntime=t.proxyRuntime,this.serializer=new Ki(t.library,t.proxyRuntime.objectOperator),this.imageUsers=t.imageUsers,this.strategy=t.strategy,this.callbacks=Gr(t.callbacks||{}),this.eventFireNode=new ci(t.logger,{fire:this.callbacks.onEventFire,ack:this.callbacks.onEventFireACK}),this.eventFireNode.isPadding=!0,this.triggerInvoker=new Gi({library:this.library,imageUsers:this.imageUsers,proxyRuntime:t.proxyRuntime,onEventFire:function(e){return n.eventFireNode.callback("fire",e)},onEventFireACK:function(e){return n.eventFireNode.callback("ack",e)},onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}),this.triggerInvoker.frameId=t.frameId,this.triggerInvoker.timestamp=t.timestamp,this.proxyRuntime.rootObject.onInvokedTriggerMethod=this.invokeMethod,t.actionFrames){var r,i=T(t.actionFrames);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this.proxyRuntime.frameHandler.deserializeActionFrame(a,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),s=Xi(o);this.triggerInvoker.appendAction(o,{authorId:o.authorId,timestamp:o.timestamp,mode:vr.Real,identifierGenerator:s})}}catch(e){i.e(e)}finally{i.f()}}this.phaseNode=new si({phase:ea.Real,getCurrentPhase:this.currentPhase,onPhaseChanged:this.callbacks.onPhaseChanged}),this.branchImageHelper=new Qi(this.logger,this.strategy,this.proxyRuntime,this.triggerInvoker,this.assertAppendFrameId,this.callbacks.onReceivedRttReport||function(){},this.callbacks.onIllusionQueueLengthChanged||function(){}),this.pending=new Zi((function(){return n.phaseNode.touch()}),this.clientCrashWithError),this.triggerInvoker.completeInit(),this.eventFireNode.hasKey("fire")&&Promise.resolve().then((function(){return n.eventFireNode.isPadding=!1})).catch((function(e){return console.error(e)}))}var t;return P(e,[{key:"hasDoubleLines",get:function(){return this.proxyRuntime.hasDoubleLines}},{key:"trigger",get:function(){return this.proxyRuntime.rootObject.displayer}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"userIds",get:function(){return this.imageUsers.userIds}},{key:"usersCount",get:function(){return this.imageUsers.usersCount}},{key:"pendingReportChanged",get:function(){return this.proxyRuntime.pendingReportChanged},set:function(e){this.proxyRuntime.pendingReportChanged=e}},{key:"hasUser",value:function(e){return this.imageUsers.hasUser(e)}},{key:"user",value:function(e){return this.imageUsers.user(e,!1)}},{key:"verifiedFrameId",get:function(){return this.triggerInvoker.frameId}},{key:"frameId",get:function(){var e=this.triggerInvoker.frameId,t=this.branchImageHelper.illusionQueue;return t&&(e+=t.length),e},set:function(e){var t=this.branchImageHelper.illusionQueue,n=e;t&&(n-=t.length),this.triggerInvoker.frameId=n}},{key:"timestamp",get:function(){return this.triggerInvoker.timestamp}},{key:"appendActionFrames",value:function(e,t){this.appendActionFramesToRuntime(e,t)}},{key:"appendActionFramesToRuntime",value:function(e,t){var n,r,i=this;this.eventFireNode.isPadding=!0;try{n=this.proxyRuntime.block.runWithContinuousUpdated((function(){r=i.proxyRuntime.hasDoubleLines?i.proxyRuntime.hasBranch?i.branchImageHelper.appendActionFrames(e,t):i.branchImageHelper.appendActionFramesWithDoubleMode(e,t):i.appendActionFramesWithSingleMode(e,t)})),this.phaseNode.touch()}finally{this.eventFireNode.isPadding=!1}return this.callbacks.onModified&&n.didUpdated&&this.callbacks.onModified(),r}},{key:"appendScopeSlices",value:function(e){this.generator&&this.generator.appendScopeSlices(e)}},{key:"appendActionFramesWithSingleMode",value:function(e,t){for(var n,r=this,i=function(i){var a=e[i],o=r.proxyRuntime.frameHandler.deserializeActionFrame(a,r.strategy.deserializerVersion,r.strategy.ignoreHashChecking),s=Xi(o);r.assertAppendFrameId(o);var c=t&&function(e){return t(e,i)},u={authorId:o.authorId,mode:vr.Real,timestamp:o.timestamp,identifierGenerator:s};n=r.triggerInvoker.appendAction(o,u,c),r.triggerInvoker.callbackEventIfNeed(o)},a=0;a<e.length;++a)i(a);return n}},{key:"dispatch",value:function(e,t){var n=this;this.assertEnableSendActionFrames();var r=Date.now(),i=this.generator;if(!i)throw new Error("cannot dispatch event ".concat(e,", generator is not prepare"));var a=i.author.allocateIdentifierGenerator(),o=this.proxyRuntime.block.runWithContinuousUpdated((function(){var o=n.proxyRuntime.createFrameSection(),s={authorId:i.author.userId,mode:vr.Illusion,timestamp:r,frameSection:o,identifierGenerator:a};n.proxyRuntime.block.runWithMagix(s,(function(){var s=i.handlePayload(t,a),c=a.clone();try{return n.triggerInvoker.dispatch(e,s.wrapped)}finally{var u=n.pending.createEventFrameGetter(e,s.copied,r,i,o,c);n.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(u),n.callbacks.onGeneratedActionFrame?(n.phaseNode.touch(),n.callbacks.onGeneratedActionFrame(u)):u.get()}}))}));this.eventFireNode.callback("fire",{event:e,payload:t,scope:Wn.Custom,authorId:i.author.userId}),this.callbacks.onModified&&o.didUpdated&&this.callbacks.onModified()}},{key:"snapshot",value:function(){var e=this,t=this.generator?this.generator.author.userId:an,n={frameId:this.frameId,originalFrameId:this.frameId,timestamp:this.timestamp,authorId:t,rootObject:this.proxyRuntime.rootObject.snapshotRootObject(),users:this.imageUsers.snapshotUsers()},r={authorId:t,mode:vr.Outside,timestamp:n.timestamp,identifierGenerator:gt(-1)};return this.proxyRuntime.block.runWithMagix(r,(function(){return e.proxyRuntime.frameHandler.serializeSnapshotFrame(n)}))}},{key:"setAllocatedUser",value:function(e){var t=this;return this.imageUsers.createImageAuthor(e,(function(n){var r=t.serializer,i=r.objectOperator,a=r.rootClassReflection,o=r.flatFrameSerialization,s=t.proxyRuntime.frameHandler.objectAdapter,c=t.strategy.includesFrameHash;t.generator=new qi({author:n,objectOperator:i,rootClassReflection:a,flatFrameSerialization:o,objectAdapter:s,includesFrameHash:c}),t.proxyRuntime.reportObserverIdChanged(e.userId),t.branchImageHelper.setObserverId(n.userId)}))}},{key:"waitUtilIllusionQueueEmpty",value:function(){return this.branchImageHelper.waitUtilIllusionQueueEmpty()}},{key:"removeAllocatedUser",value:(t=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.imageUsers.cancelImageAuthorCreating(),this.generator=null,this.proxyRuntime.reportObserverIdChanged(an),e.next=5,this.branchImageHelper.waitUtilIllusionQueueEmpty();case 5:this.branchImageHelper.cleanObserverId();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.didDestroy||(this.imageUsers.cancelImageAuthorCreating(),this.generator=null,this.didDestroy=!0,this.proxyRuntime.dispose(),this.phaseNode.touch())}},{key:"createInvokerFrameBuffer",value:function(e){var t=this.triggerInvoker.methodNameToId(e.method);if(void 0===t)throw new Error("can't find method ".concat(JSON.stringify(e.method)));if(this.triggerInvoker.isNoEffectMethod(e.method))throw new Error("can't create frame for no effects method ".concat(JSON.stringify(e.method)));var n=Zn(qn({},this.createFrameHeader(e)),{type:Vn.Invoker,scopeId:e.identifierGenerator.scopeId,methodId:t,parameters:e.parameters});return this.serializeActionFrame(e.identifierGenerator,n)}},{key:"createEventFrameBuffer",value:function(e){var t=Zn(qn({},this.createFrameHeader(e)),{type:Vn.Event,scopeId:e.identifierGenerator.scopeId,scope:e.scope,event:e.event,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createEnterFrameBuffer",value:function(e){var t=Zn(qn({},this.createFrameHeader(e)),{type:Vn.Enter,scopeId:e.identifierGenerator.scopeId,session:e.session,userPayload:e.userPayload,connectedPayload:e.connectedPayload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createLeaveFrameBuffer",value:function(e){var t=Zn(qn({},this.createFrameHeader(e)),{type:Vn.Leave,scopeId:e.identifierGenerator.scopeId,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createFrameHeader",value:function(e){var t=e.frameId,n=e.originalFrameId,r=e.authorId;return{frameId:t,originalFrameId:void 0===n?t:n,timestamp:Date.now(),authorId:r,beginObjectId:0}}},{key:"serializeActionFrame",value:function(e,t){var n=this,r={authorId:this.generator?this.generator.author.userId:an,mode:vr.Outside,timestamp:t.timestamp,identifierGenerator:e};return this.proxyRuntime.block.runWithMagix(r,(function(){return n.serializer.serialize(e,t,n.strategy.includesFrameHash)}))}},{key:"assertEnableSendActionFrames",value:function(){if(this.didDestroy)throw new Error("image was desctroy");var e=this.branchImageHelper.illusionQueue;if((e?e.length:0)>=700)throw this.clientCrashWithError(new Error("illusion queue is overflow")),new Error("can't modify. illusion queue is overflow")}}]),e}();!function(e){e.Real="real",e.Illusion="illusion"}(ea||(ea={}));var na=function(){function e(t){C(this,e),this.proxyManager=t}return P(e,[{key:"createAccessUpdaterSerialization",value:function(e){return new Di(this.proxyManager.objectOperator,e)}},{key:"createWithParameters",value:function(t){var n=this.findOriginProxyRuntime(t),r=this.proxyManager.createProxyRuntime(t.library,n),i=new _i(r),a=Date.now();r.setupWithParameters(t.constructorScopeId,t.args,a,{logger:t.logger,observerId:t.observerId,imageUsers:i,pendingReportChanged:t.pendingReportChanged,snapshotManager:Wr(t.library,t.roomUUID),toolsExtra:t.toolsExtra});var o=new ta({frameId:0,timestamp:a,library:t.library,logger:t.logger,proxyRuntime:r,actionFrames:[],imageUsers:i,strategy:e.wrapStrategy(t),callbacks:t.callbacks});return n?r.rootObject.initializeWithOriginRootObject(n.rootObject):r.rootObject.initialize(),o}},{key:"parseSnapshotFrame",value:function(e,t){var n=this.proxyManager.createProxyRuntime(e),r=Mt.V1;return n.frameHandler.deserializeSnapshotFrame(t,r,!1)}},{key:"createWithSnapshot",value:function(t){var n=this.findOriginProxyRuntime(t),r=this.proxyManager.createProxyRuntime(t.library,n),i=t.snapshotDeserializerVersion;void 0===i&&(i=Ot(He));var a=r.frameHandler.deserializeSnapshotFrame(t.snapshotFrame,i,t.ignoreHashChecking),o=a.rootObject,s=new _i(r,a.users);r.setupWithRootObject(o,{logger:t.logger,observerId:t.observerId,imageUsers:s,pendingReportChanged:t.pendingReportChanged,snapshotManager:Wr(t.library,t.roomUUID),toolsExtra:t.toolsExtra});var c=new ta({frameId:a.frameId,timestamp:a.timestamp,library:t.library,logger:t.logger,actionFrames:t.actionFrames,proxyRuntime:r,imageUsers:s,strategy:e.wrapStrategy(t),callbacks:t.callbacks});return n?r.rootObject.initializeWithOriginRootObject(n.rootObject):r.rootObject.initialize(),c}},{key:"findOriginProxyRuntime",value:function(e){var t=e.originalImage;if(t)return t.proxyRuntime}}],[{key:"wrapStrategy",value:function(e){var t=e.actionDeserializerVersion;return void 0===t&&(t=Ot(He)),Object.freeze({roomUUID:e.roomUUID,ignoreHashChecking:e.ignoreHashChecking,includesFrameHash:e.includesFrameHash,deserializerVersion:t})}}]),e}(),ra=Object.freeze([{methodName:"toString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"toLocaleString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"join",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"indexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"lastIndexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"every",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"some",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"forEach",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reduce",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reduceRight",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"concat",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reverse",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"slice",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"splice",returnArray:!0,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e,t){var n,r=t[0];if(r>=0&&r<e.length)if(t.length>1){var i=t[1];void 0===i&&(i=0);var a=t.length-2;a<0&&(a=0),a===i?a>0&&(n={beginIndex:r,length:a}):n={beginIndex:r,length:e.length-r}}else n={beginIndex:r,length:e.length-r};return n}},{methodName:"map",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"filter",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"sort",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"push",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:e.length-1,length:1}}},{methodName:"pop",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:e.length,length:1}}},{methodName:"shift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length+1}}},{methodName:"unshift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}}]);var ia=function(){function e(t){C(this,e),this.nodes={};var n,r={},i=T(t);try{var a=function(){var e=n.value,t=e.clazz,i=e.banList,a=e.proxyList,o={},s=t.name;r[s]=Object.freeze({clazz:t,methods:o});var c,u=T(i);try{var l=function(){var e=c.value;o[e]=function(){throw new Error("".concat(s,".").concat(e," is ban in Magix"))}};for(u.s();!(c=u.n()).done;)l()}catch(e){u.e(e)}finally{u.f()}var h,d=T(a);try{var p=function(){var e=h.value;o[e]=function(){throw new Error("".concat(s,".").concat(e," is not defined"))}};for(d.s();!(h=d.n()).done;)p()}catch(e){d.e(e)}finally{d.f()}Object.seal(o)};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}this.nodes=r}return P(e,[{key:"findMethod",value:function(e,t){var n=this.findNode(e);if(n)return n.methods[t]}},{key:"proxyMethod",value:function(e,t,n){var r=this.findNode(e);if(!r)throw new Error("invalid class");if(!(t in r.methods))throw new Error("invalid method ".concat(JSON.stringify(t)));r.methods[t]=n}},{key:"findNode",value:function(e){var t=e.name,n=this.nodes[t];if(n&&n.clazz===e)return n}}]),e}();var aa=Object.defineProperty,oa=Object.getOwnPropertySymbols,sa=Object.prototype.hasOwnProperty,ca=Object.prototype.propertyIsEnumerable,ua=function(e,t,n){return t in e?aa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},la=function(e,t){for(var n in t||(t={}))sa.call(t,n)&&ua(e,n,t[n]);if(oa){var r,i=T(oa(t));try{for(i.s();!(r=i.n()).done;){n=r.value;ca.call(t,n)&&ua(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},ha=function(){function e(t){C(this,e),this.usersCache={},this.observerId=t.observerId,this.environment=t.environment,this.authorId=t.authorId,this.core=t.coreFunctions,this.roomObserver=t.roomObserver,this.imageUsers=t.imageUsers}return P(e,[{key:"getAuthorId",value:function(){var e;return this.environment===Ur.NoEffects&&this.observerId===this.authorId&&(null==(e=this.roomObserver)||e.reportObservedObserverId()),this.authorId}},{key:"hasUser",value:function(e){var t;return this.environment===Ur.NoEffects&&(null==(t=this.roomObserver)||t.reportObservedUsers()),this.imageUsers.hasUser(e)}},{key:"getUsersCount",value:function(){var e;return this.environment===Ur.NoEffects&&(null==(e=this.roomObserver)||e.reportObservedUsers()),this.imageUsers.usersCount}},{key:"getUser",value:function(e){var t,n;return this.imageUsers.hasUser(e)&&((n=this.usersCache[e])||(n=this.usersCache[e]=this.core.creator(this.imageUsers.user(e,!0)))),this.environment===Ur.NoEffects&&(null==(t=this.roomObserver)||t.reportObservedUsers()),n}},{key:"getUserIds",value:function(){var e;return this.userIdsCache||(this.userIdsCache=this.core.creator(this.imageUsers.userIds)),this.environment===Ur.NoEffects&&(null==(e=this.roomObserver)||e.reportObservedUsers()),this.userIdsCache}}]),e}(),da=function(){function e(t){C(this,e),this._hasDoubleLines=!1,this._branchRuntime=null,this.logger=t.logger,this.observerId=t.observerId,this.proxyRuntime=t.proxyRuntime,this.imageUsers=t.imageUsers,this.toolsExtra=t.toolsExtra,this.snapshotManager=t.snapshotManager}return P(e,[{key:"hasDoubleLines",get:function(){return this._hasDoubleLines}},{key:"branchRuntime",get:function(){return this._branchRuntime}},{key:"changeToDoubleLines",value:function(){this._hasDoubleLines=!0}},{key:"forkBranchRuntime",value:function(){return this._branchRuntime=function(e){return new fo(e)}(this.logger),this._branchRuntime}},{key:"releaseBranchRuntime",value:function(){this._branchRuntime&&(this._branchRuntime=null)}},{key:"getForwardMode",value:function(){return!this._hasDoubleLines||this._branchRuntime?hr.SingleForward:hr.DoubleForward}},{key:"runWithMagix",value:function(t,n){var r=t.authorId,i=this.getEnvironment(t.mode),a=this.getForwardMode(),o=e.coreFunctionsSwitcher.switchCoreFunctions(t.mode),s=Object.freeze({idGenerator:t.identifierGenerator,environment:i,timestamp:t.timestamp,snapshot:this.snapshotManager,extra:this.toolsExtra,functions:new ha({observerId:this.observerId,environment:i,authorId:r,coreFunctions:o,roomObserver:this.proxyRuntime.roomObserver,imageUsers:this.imageUsers})}),c={mode:t.mode,coreFunctions:o,frameSection:t.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:a,tools:s};return mr.runWith(c,n)}},{key:"runWithSerialization",value:function(t,n){var r=this.getForwardMode(),i=e.coreFunctionsSwitcher.switchCoreFunctions(t.mode),a={mode:t.mode,coreFunctions:i,frameSection:t.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:r};return mr.runWith(a,n)}},{key:"isForcesOnIllusionLine",value:function(e){switch(e){case oo.Real:case oo.RealAck:return!1;case oo.Illusion:case oo.IllusionRebuild:return!0;case oo.Outside:return this._hasDoubleLines&&!!this._branchRuntime;default:throw new Error("invalid mode ".concat(e))}}},{key:"getEnvironment",value:function(e){switch(e){case oo.Illusion:case oo.IllusionRebuild:return Ur.Illusion;case oo.Real:case oo.RealAck:return Ur.Real;case oo.Outside:return Ur.NoEffects;default:throw new Error("invalid mode ".concat(e))}}}],[{key:"coreFunctionsSwitcher",get:function(){return this._coreFunctionsSwitcher||(this._coreFunctionsSwitcher=new co),this._coreFunctionsSwitcher}}]),e}();function pa(e,t,n){return t.constructor===Object?cs(e,n,t):ls(e,n,t)}var fa,va="__identifier";function ma(e,t){Object.defineProperty(e,va,{enumerable:!1,configurable:!0,value:t})}mr.addListener((function(e,t){fa=t?e.coreFunctions.creator:void 0}));var ga=function(){function e(t,n,r){C(this,e),this.proxyRuntime=t,this.identifierGenerator=n,this.banFunction=r,this.proxyNodes={},this.modifyObjects=[]}return P(e,[{key:"complete",value:function(){var e,t=T(this.modifyObjects);try{for(t.s();!(e=t.n()).done;){delete e.value[va]}}catch(e){t.e(e)}finally{t.f()}}},{key:"wrap",value:function(e){if(this.banFunction&&"function"==typeof e)throw new Error("can't wrap function");if("object"!=M(e)||null===e||ke(e))return e;if(mo(e))throw new Error("can't let displayer node pass Magix border");if(e.constructor===Array)return this.wrapArray(e);if(e.constructor===Object)return this.wrapObject(e);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"wrapArray",value:function(e){var t,n=e[va];if(void 0===n){ma(e,n=this.identifierGenerator.generate());for(var r=(t=this.createProxyNode([],n)).target(),i=0;i<e.length;++i)r[i]=this.wrap(e[i]);this.proxyNodes[n]=t,this.modifyObjects.push(e)}else t=this.proxyNodes[n];return t}},{key:"wrapObject",value:function(e){var t,n=e[va];if(void 0===n){ma(e,n=this.identifierGenerator.generate());var r,i=(t=this.createProxyNode({},n)).target(),a=T(Object.keys(e).sort());try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]=this.wrap(e[o])}}catch(e){a.e(e)}finally{a.f()}this.proxyNodes[n]=t,this.modifyObjects.push(e)}else t=this.proxyNodes[n];return t}},{key:"createProxyNode",value:function(e,t){return fa?fa(e,t):pa(this.proxyRuntime,e,t)}}]),e}(),ya=function(){function e(t){C(this,e),this.pendingBuffer={},this.observer=t.create(mt,"room observer")}return P(e,[{key:"pendingReportChanged",get:function(){return!!this.pendingBuffer},set:function(e){!!this.pendingBuffer!==e&&(e?this.pendingBuffer={}:(this.firePendingReportChanges(this.pendingBuffer),this.pendingBuffer=null))}},{key:"reportObserverIdChanged",value:function(t){this.report(e.selfUserId,t,bi.Updated)}},{key:"reportUsersChanged",value:function(t){this.report(e.users,t,bi.Updated)}},{key:"reportObservedObserverId",value:function(){this.observer.reportObservedKey(e.selfUserId)}},{key:"reportObservedUsers",value:function(){this.observer.reportObservedKey(e.users)}},{key:"firePendingReportChanges",value:function(t){for(var n in t){var r=t[n],i=r.value,a=r.kind;this.observer.reportChanged(e.users,i,a)}}},{key:"report",value:function(e,t,n){if(this.pendingBuffer){var r=this.pendingBuffer[e];r?(r.value=t,r.kind=n):this.pendingBuffer[e]={value:t,kind:n}}else this.observer.reportChanged(e,t,n)}}]),e}(),ba=ya;function ka(e,t){Object.defineProperty(e,zo,{enumerable:!1,writable:!1,configurable:!0,value:t})}ba.selfUserId="userId",ba.users="users";var wa=function(){function e(){C(this,e),this.didTouchedSet={}}return P(e,[{key:"copyProxyNode",value:function(e){var t=e.identifier;this.didTouchedSet[t]||(this.didTouchedSet[t]=!0,Uo(e)?this.copyAkkoObjectProxyNode(e):Ho(e)?this.copyFlatObjectProxyNode(e):Xo(e)&&this.copyArrayProxyNode(e))}},{key:"copyAkkoObjectProxyNode",value:function(e){var t=e.realTarget;if(t){var n={};for(var r in t){var i=Object.getOwnPropertyDescriptor(t,r);if(i&&!i.get&&!i.set){var a=t[r];Lo(a)&&this.copyProxyNode(a),n[r]=a}}ka(n,e),Object.setPrototypeOf(n,e.struct.classReflection.clazz.prototype),e.illuTarget=n}}},{key:"copyFlatObjectProxyNode",value:function(e){var t=e.realTarget;if(t){var n={};for(var r in t){var i=t[r];Lo(i)&&this.copyProxyNode(i),n[r]=i}ka(n,e),e.illuTarget=n}}},{key:"copyArrayProxyNode",value:function(e){var t=e.realTarget;if(t){for(var n=[],r=0;r<t.length;++r)if(r in t){var i=t[r];Lo(i)&&this.copyProxyNode(i),n[r]=i}ka(n,e),e.illuTarget=n}}}]),e}(),Sa=new(function(){function e(){C(this,e)}return P(e,[{key:"addProperty",value:function(e,t,n){}},{key:"removeProperty",value:function(e,t){}},{key:"setProperty",value:function(e,t,n){}},{key:"unbindDelegate",value:function(e){}},{key:"callbackDelegates",value:function(){return{didUpdated:!1}}}]),e}());function xa(){return Sa}function Ca(e,t){var n=Sa;try{return Sa=e,t(),{didUpdated:e.didUpdated}}finally{Sa=n}}var Ia=function(){function e(){C(this,e),this.disable=!1,this.delegates={},this.unbindsDelegated={},this.updatedObjects={},this._didUpdated=!1}return P(e,[{key:"didUpdated",get:function(){return this._didUpdated}},{key:"callbackDelegates",value:function(){for(var e in this.delegates)if(e in this.unbindsDelegated)delete this.delegates[e];else{var t=this.delegates[e],n=this.updatedObjects[e];t.updateDisplayer(n)}for(var r in this.delegates){var i=this.delegates[r],a=this.updatedObjects[r];i.reportChanged(a)}}},{key:"unbindDelegate",value:function(e){this.disable||(this.unbindsDelegated[e.identifier]=!0)}},{key:"addProperty",value:function(e,t,n){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var r=this.getBufferObject(e),i=r[t];if(i)switch(i.value=n,i.kind){case bi.Removed:i.kind=bi.Updated;break;case bi.Inserted:i.kind=bi.Inserted;break;case bi.Updated:i.kind=bi.Updated}else r[t]={kind:bi.Inserted,value:n,isIndex:"number"==typeof t}}}},{key:"setProperty",value:function(e,t,n){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var r=this.getBufferObject(e),i=r[t];if(i)switch(i.value=n,i.kind){case bi.Removed:i.kind=bi.Updated;break;case bi.Inserted:i.kind=bi.Inserted;break;case bi.Updated:i.kind=bi.Updated}else r[t]={kind:bi.Updated,value:n,isIndex:"number"==typeof t}}}},{key:"removeProperty",value:function(e,t){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var n=this.getBufferObject(e),r=n[t];if(r)switch(r.kind){case bi.Removed:break;case bi.Inserted:delete n[t];break;case bi.Updated:r.kind=bi.Removed,r.value=void 0}else n[t]={kind:bi.Removed,value:void 0,isIndex:"number"==typeof t}}}},{key:"getBufferObject",value:function(e){var t=e.identifier,n=this.updatedObjects[t];return n||(this.delegates[t]=e,this.updatedObjects[t]=n={}),n}}]),e}(),Pa=function(){function e(t,n,r){C(this,e),this.runtime=t,this.observerAdapter=n,this.pendingUpdatedSection=r?new Ia:null}return P(e,[{key:"pendingReportChanged",get:function(){return!!this.pendingUpdatedSection},set:function(e){!!this.pendingUpdatedSection!==e&&(e?this.pendingUpdatedSection=new Ia:(this.pendingUpdatedSection.callbackDelegates(),this.pendingUpdatedSection=null))}},{key:"runWithMagix",value:function(e,t){return this.runtime.runWithMagix(e,t)}},{key:"runWithDisableObserve",value:function(e){var t=xa();try{return t.disable=!0,e()}finally{t.disable=!1}}},{key:"runWithContinuousUpdated",value:function(e){var t,n,r;return this.pendingUpdatedSection?(n=this.pendingUpdatedSection,r=!1):(n=new Ia,r=!0),this.observerAdapter?this.observerAdapter.observeUpdate((function(){t=Ca(n,e),r&&n.callbackDelegates()})):(t=Ca(n,e),r&&n.callbackDelegates()),t}}]),e}();var Ma=function(){function e(t){var n=this;C(this,e),this.cache={},this.clean=function(){var e=n.adapter.createObserverCollection();for(var t in n.cache){var r=n.cache[t];for(var i in r){var a=r[i].hub;a&&e.addObserverHub(a)}delete n.cache[t]}e.clean()},this.adapter=t,this.delayer=new De(this.clean)}return P(e,[{key:"dispose",value:function(){this.delayer.dispose()}},{key:"valueWithArgs",value:function(e,t,n,r,i){var a,o=this;if(this.isComplicate(r))return i.call(e,n,r);var s,c=n+JSON.stringify(r),u=this.cache[t];if(u||(u=this.cache[t]={}),c in u)null==(a=(s=u[c]).hub)||a.replay();else{var l,h;try{l=this.adapter.collectObservations((function(){return i.call(e,n,r)}),(function(e){return h=e})),s={hub:h,result:l}}catch(e){s={hub:h,error:e}}h&&(h.onChanged=function(){return o.onExpire(t,c)}),u[c]=s}return this.touchCache(),this.returnNode(s)}},{key:"isComplicate",value:function(e){if(e.length>=5)return!0;var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("string"!=typeof r&&"number"!=typeof r)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"valueWithKey",value:function(e,t,n,r){var i,a,o=this,s=this.cache[t];if(s||(s=this.cache[t]={}),n in s)null==(i=(a=s[n]).hub)||i.replay();else{var c,u;try{c=this.adapter.collectObservations((function(){return r.call(e,n)}),(function(e){return u=e})),a={hub:u,result:c}}catch(e){a={hub:u,error:e}}u&&(u.onChanged=function(){return o.onExpire(t,n)}),s[n]=a}return this.touchCache(),this.returnNode(a)}},{key:"onExpire",value:function(e,t){var n=this.cache[e];t in n&&(delete n[t],function(e){for(var t in e)return!0;return!1}(n)||delete this.cache[e])}},{key:"returnNode",value:function(e){if(e.error)throw e.error;return e.hub&&e.hub.replay(),e.result}},{key:"touchCache",value:function(){if(!this.delayer.isRunning){var t=e.cacheDuration,n=e.cacheRate,r=t+Math.random()*n;this.delayer.refreshAndInvokeAfterInterval(r)}}}]),e}(),Ta=Ma;Ta.cacheDuration=6e4,Ta.cacheRate=.3;var Aa,Ea=function(){function e(t,n,r,i){var a=i.observerAdapter,o=i.escapeObjectFilter,s=i.jsxFactory;C(this,e),this.objectOperator=t,this.library=n,this.disposedListeners=[],this.observerAdapter=a,this.escapeObjectFilter=o||function(){return!1},this.jsxFactory=s,this.roomObserver=a&&new ba(a),this.noEffectsIdGenerator=gt(-1),this.frameHandler=new ds(this,this.library),this.cache=this.observerAdapter&&new Ta(this.observerAdapter),r&&r.library===this.library?this.structMap=la({},r.structMap):this.structMap={}}return P(e,[{key:"runtime",get:function(){return this._runtime}},{key:"block",get:function(){return this.proxyBlock}},{key:"rootObject",get:function(){return this._rootObject}},{key:"hasDoubleLines",get:function(){return this._runtime.hasDoubleLines}},{key:"hasBranch",get:function(){return!!this._runtime.branchRuntime}},{key:"pendingReportChanged",get:function(){var e,t;return!(!(null==(e=this.roomObserver)?void 0:e.pendingReportChanged)&&!(null==(t=this.proxyBlock)?void 0:t.pendingReportChanged))},set:function(e){this.roomObserver&&(this.roomObserver.pendingReportChanged=e),this.proxyBlock&&(this.proxyBlock.pendingReportChanged=e),this._rootObject.pendingUpdatedRootObject=e}},{key:"forkBranchRuntime",value:function(){this._runtime.forkBranchRuntime()}},{key:"mergeBranch",value:function(){var e=this._runtime;e.branchRuntime.syncTwoBranches(),e.releaseBranchRuntime()}},{key:"observeUpdate",value:function(e){this.observerAdapter?this.observerAdapter.observeUpdate(e):e()}},{key:"reportUsersChanged",value:function(e){var t;null==(t=this.roomObserver)||t.reportUsersChanged(e)}},{key:"reportObserverIdChanged",value:function(e){var t;this._runtime.observerId=e,null==(t=this.roomObserver)||t.reportObserverIdChanged(e)}},{key:"createFrameSection",value:function(e){var t=this._runtime;t.hasDoubleLines||((new wa).copyProxyNode(this._rootObject.snapshotRootObject()),t.changeToDoubleLines());var n,r=t.branchRuntime;return r||(r=t.forkBranchRuntime()),e&&(n=e.takeCreatedProxyNodes()),r.createFrameSection(n)}},{key:"setupWithParameters",value:function(e,t,n,r){var i=this;this.setupRuntime(r);var a=an,o=gt(e),s=this.pushValues(o,t,!0),c={authorId:a,mode:vr.Real,timestamp:n,identifierGenerator:o},u=this.runtime.runWithMagix(c,(function(){return m(i.library.rootClass,p(s))})).__proxy;this._rootObject=new ps(this._runtime,u,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=r.pendingReportChanged}},{key:"setupWithRootObject",value:function(e,t){if(this.setupRuntime(t),!Uo(e))throw new Error("rootObject should be AkkoObjectProxyNode");this._rootObject=new ps(this._runtime,e,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=t.pendingReportChanged}},{key:"setupRuntime",value:function(e){if(this._runtime)throw new Error("did bind runtime params");this._runtime=new da({logger:e.logger,observerId:e.observerId,imageUsers:e.imageUsers,snapshotManager:e.snapshotManager,proxyRuntime:this,toolsExtra:e.toolsExtra}),this.roomObserver&&(this.roomObserver.pendingReportChanged=e.pendingReportChanged),this.proxyBlock=new Pa(this._runtime,this.observerAdapter,e.pendingReportChanged)}},{key:"pullValue",value:function(e){return"object"!=M(e)||null===e?e:Lo(e)?e.displayer:ke(e)?e.readonly?e:e.slice():this.escapeObjectFilter(e)?e:void 0}},{key:"pushValues",value:function(e,t,n){var r=[],i=new ga(this,e,n);try{for(var a=0;a<t.length;++a)r[a]=i.wrap(t[a]);return r}finally{i.complete()}}},{key:"getAkkoObjectStruct",value:function(e){var t=this.structMap[e.id];return t||(t=this.structMap[e.id]=new xo(e)),t}},{key:"listenDisposed",value:function(e){-1===this.disposedListeners.indexOf(e)&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function(e){var t=this.disposedListeners.indexOf(e);-1!==t&&this.disposedListeners.splice(t,1)}},{key:"dispose",value:function(){var e;null==(e=this.cache)||e.dispose();var t,n=T(this.disposedListeners.splice(0));try{for(n.s();!(t=n.n()).done;){var r=t.value;try{r()}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),Oa=new ia([{clazz:Object,proxyList:["assign"],banList:["getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","create","defineProperty","defineProperties"]},{clazz:Array,proxyList:[],banList:["from"]},{clazz:String,proxyList:["fromCodePoint","fromCharCode"],banList:[]},{clazz:Number,proxyList:["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"],banList:[]}]);function Ra(){if(!Aa)throw mr.currentNode?new Error("can't create JSX. you didn't set jsxFactory"):new Error("can't create JSX. maybe you called it out of Magix");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Aa.apply(void 0,t)}Oa.proxyMethod(Object,"assign",(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length>0){var i=n[0];i&&Lo(i)&&(e=i)}for(var a=0;a<n.length;++a)n[a]=jo(n[a]);var o=Object.assign.apply(this,n),s=o[zo];return e&&e!==s&&(s=e,Co(e,o)),s})),Oa.proxyMethod(String,"fromCodePoint",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)t[r]=jo(t[r]);return String.fromCodePoint.apply(this,t)})),Oa.proxyMethod(String,"fromCharCode",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)t[r]=jo(t[r]);return String.fromCharCode.apply(this,t)})),Oa.proxyMethod(Number,"isFinite",Number.isFinite),Oa.proxyMethod(Number,"isInteger",Number.isInteger),Oa.proxyMethod(Number,"isNaN",Number.isNaN),Oa.proxyMethod(Number,"isSafeInteger",Number.isSafeInteger),Oa.proxyMethod(Number,"parseFloat",Number.parseFloat),Oa.proxyMethod(Number,"parseInt",Number.parseInt),mr.addListener((function(e,t){Aa=t?e.proxyRuntime.jsxFactory:void 0}));var Na=function(){function e(){C(this,e),this.unwrappedMap={}}return P(e,[{key:"unwrap",value:function(e){return Lo(e)?this.unwrapProxyNode(e):ke(e)?e.readonly?e:e.slice():e}},{key:"unwrapProxyNode",value:function(e){if(Uo(e))return e.displayer;var t=e.identifier,n=this.unwrappedMap[t];if(!n){var r=e.target();if(Ho(e))for(var i in this.unwrappedMap[t]=n={},r)n[i]=this.unwrap(r[i]);else if(Xo(e)){this.unwrappedMap[t]=n=[];for(var a=0;a<r.length;++a)n[a]=this.unwrap(r[a])}}return n}}]),e}();function La(e){if("object"==M(e)&&null!==e){if(Lo(e))return e;var t=e[zo];return Lo(t)?t:void 0}}function ja(e){return e instanceof vi?e.__proxy:e}var Da,Fa,za,Ba,Ua,Va,Wa,Ha,_a,Ga,Ya,Xa,Qa,Ka,qa=function(){function e(){C(this,e)}return P(e,[{key:"updater",value:function(e){return e}},{key:"getter",value:function(e,t){var n=La(e);return n?n.getValue(t):e[t]}},{key:"caller",value:function(e,t,n,r){if("function"==typeof e){if(Or in e)return e[t].apply(e,n);var i=Oa.findMethod(e,t);if(i)return i.apply(e,n);if("function"==typeof Function.prototype[t])return e[t].apply(e,p(n));throw new Error("can't call ".concat(e.name,".").concat(t,", it's not supported"))}var a,o;return r&&(a=r[t]),Lo(e)?(o=e.target(),a||(a=e.getMethod(t))):(o=e,a||(a=e[t])),a.apply(o,n)}},{key:"setter",value:function(e,t,n){var r=La(e),i=n;return i=ja(i),r?r.setValue(t,i):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=La(e);return r?r.prefix(t,n):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=La(e);if(r)return r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=La(e);return n?n.removeKey(t):delete e[t]}},{key:"wrapper",value:function(e){return"object"!=M(e)||null===e?e:e[zo]||e}},{key:"unwrapper",value:function(e){return Lo(e)?e.target():e}},{key:"jsxUnwrapper",value:function(e){return(new Na).unwrap(e)}}]),e}(),Za=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"onContextUpdate",value:function(e,t){t?(Da=e.tools&&e.tools.idGenerator,Fa=e.frameSection,za=e.proxyRuntime):(Da=void 0,Fa=void 0,za=void 0)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Da.generate();if(e.constructor===Array)t=ls(za,n,e);else if(e.constructor===Object)t=cs(za,n,e);else{var r=e.constructor[Or];if("object"!=M(r)||null===r)throw new Error("can't find __reflection");var i=za.getAkkoObjectStruct(r);t=us(za,n,e,i)}return Fa.addCreatedObject(t),t}},{key:"updater",value:function(e){return Lo(e)&&Fa.illusionUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=La(e),i=n;return i=ja(i),r?(Fa.illusionUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=La(e);return r?(Fa.illusionUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=La(e);if(r)return Fa.illusionUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=La(e);return n?(Fa.illusionUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(qa),Ja=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"onContextUpdate",value:function(e,t){t?(Ba=e.tools&&e.tools.idGenerator,Ua=e.frameSection,Va=e.proxyRuntime):(Ba=void 0,Ua=void 0,Va=void 0)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ba.generate(),n=Ua.illusionTakeCreatedObject(t,e);if(n)n.replaceIlluTarget(e);else if(e.constructor===Array)n=ls(Va,t,e);else if(e.constructor===Object)n=cs(Va,t,e);else{var r=e.constructor[Or];if("object"!=M(r)||null===r)throw new Error("can't find __reflection");var i=Va.getAkkoObjectStruct(r);n=us(Va,t,e,i)}return Ua.addCreatedObject(n),n}},{key:"updater",value:function(e){return Lo(e)&&Ua.illusionUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=La(e),i=n;return i=ja(i),r?(Ua.illusionUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=La(e);return r?(Ua.illusionUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=La(e);if(r)return Ua.illusionUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=La(e);return n?(Ua.illusionUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(qa),$a=hr.SingleForward,eo=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"onContextUpdate",value:function(e,t){t?(Wa=e.tools&&e.tools.idGenerator,Ha=e.frameSection,_a=e.proxyRuntime,$a=e.forwardMode):(Wa=void 0,Ha=void 0,_a=void 0,$a=hr.SingleForward)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wa.generate(),n=null==Ha?void 0:Ha.realTakeCreatedObject(t,e);if(n)n.realTarget=Co(n,e);else if(e.constructor===Array)n=ls(_a,t,e);else if(e.constructor===Object)n=cs(_a,t,e);else{var r=e.constructor[Or];if("object"!=M(r)||null===r)throw new Error("can't find __reflection");var i=_a.getAkkoObjectStruct(r);n=us(_a,t,e,i)}return $a===hr.DoubleForward&&n.converge(),n}},{key:"wrapper",value:function(e){if("object"!=M(e)||null===e)return e;var t=e[zo];return t?($a===hr.DoubleForward&&t.converge(),t):e}}]),n}(qa),to=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"onContextUpdate",value:function(e,t){t?(Ga=e.tools&&e.tools.idGenerator,Ya=e.frameSection,Xa=e.proxyRuntime):(Ga=void 0,Ya=void 0,Xa=void 0)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ga.generate(),n=Ya.realTakeCreatedObject(t,e);if(n)n.realTarget=Co(n,e);else if(e.constructor===Array)(n=ls(Xa,t,e)).converge(),Ya.realUpdateProxyNode(n);else if(e.constructor===Object)(n=cs(Xa,t,e)).converge(),Ya.realUpdateProxyNode(n);else{var r=e.constructor[Or];if("object"!=M(r)||null===r)throw new Error("can't find __reflection");var i=Xa.getAkkoObjectStruct(r);(n=us(Xa,t,e,i)).converge(),Ya.realUpdateProxyNode(n)}return n}},{key:"wrapper",value:function(e){if("object"!=M(e)||null===e)return e;var t=e[zo];return t?(t.illuTarget||(t.converge(),Ya.realUpdateProxyNode(t)),t):e}},{key:"updater",value:function(e){return Lo(e)&&Ya.realUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=La(e),i=n;return i=ja(i),r?(Ya.realUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=La(e);return r?(Ya.realUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=La(e);if(r)return Ya.realUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=La(e);return n?(Ya.realUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(qa),no=io;function ro(e){return-1===function(e){return vt.readInt53(e,0)}(e.identifier)}function io(){return!0}function ao(e,t){if(no(e))return!0;var n=Ci(e.target());if(n){var r=n.properties[t];if(r&&r.isTransient)return!0}return!1}mr.addListener((function(e,t){no=t&&e.tools&&e.mode===oo.Outside?ro:io}));var oo,so=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"onContextUpdate",value:function(e,t){t?(Qa=e.tools&&e.tools.idGenerator,Ka=e.proxyRuntime):(Qa=void 0,Ka=void 0)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qa.generate();if(e.constructor===Array)t=ls(Ka,n,e);else if(e.constructor===Object)t=cs(Ka,n,e);else{var r=e.constructor[Or];if("object"!=M(r)||null===r)throw new Error("can't find __reflection");var i=Ka.getAkkoObjectStruct(r);t=us(Ka,n,e,i)}return t}},{key:"getter",value:function(e,t){var n=La(e);if(n){var r=n.getValue(t);return n.touchKey(t),r}return e[t]}},{key:"unwrapper",value:function(e){return Lo(e)?(e.touchKey(),e.target()):e}},{key:"setter",value:function(e,t,n){var r=La(e),i=n;if(r&&ao(r,t))return i=ja(i),r?r.setValue(t,i):e[t]=i;throw new Error("Magix is frozen, you can't modify anything")}},{key:"prefix",value:function(e,t,n){var r=La(e);if(r&&ao(r,t)){var i=r.prefix(t,n);return r.touchKey(t),i}throw new Error("Magix is frozen, you can't modify anything")}},{key:"postfix",value:function(e,t,n){var r=La(e);if(r&&ao(r,t)){var i=r.postfix(t,n);return r.touchKey(t),i}throw new Error("Magix is frozen, you can't modify anything")}},{key:"remover",value:function(e,t){var n=La(e);if(n&&ao(n,t))return n.removeKey(t);throw new Error("Magix is frozen, you can't modify anything")}}]),n}(qa);!function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"}(oo||(oo={}));var co=function(){function e(){var t=this;C(this,e),this.illusion=e.bind(new Za),this.illusionRebuild=e.bind(new Ja),this.real=e.bind(new eo),this.realAck=e.bind(new to),this.outside=e.bind(new so),this.currentCoreFunctions=this.illusion,mr.addListener((function(e,n){return t.currentCoreFunctions.onContextUpdate(e,n)}))}return P(e,[{key:"switchCoreFunctions",value:function(e){switch(e){case 0:this.currentCoreFunctions=this.illusion;break;case 1:this.currentCoreFunctions=this.illusionRebuild;break;case 2:this.currentCoreFunctions=this.real;break;case 3:this.currentCoreFunctions=this.realAck;break;case 4:this.currentCoreFunctions=this.outside}return this.currentCoreFunctions}}],[{key:"bind",value:function(e){return Object.freeze({creator:e.creator.bind(e),updater:e.updater.bind(e),wrapper:e.wrapper.bind(e),unwrapper:e.unwrapper.bind(e),jsxUnwrapper:e.jsxUnwrapper.bind(e),getter:e.getter.bind(e),setter:e.setter.bind(e),caller:e.caller.bind(e),remover:e.remover.bind(e),prefix:e.prefix.bind(e),postfix:e.postfix.bind(e),onContextUpdate:e.onContextUpdate.bind(e)})}}]),e}();var uo=function(){function e(){C(this,e),this.counterSet={},this.elementSet={}}return P(e,[{key:"hasElement",value:function(e){var t=this.elementSet[e.identifier];return!!t&&t===e}},{key:"createSubSet",value:function(){return new lo(this)}},{key:"release",value:function(e){for(var t in this.elementSet){var n=this.elementSet[t];e&&e(n),delete this.counterSet[t],delete this.elementSet[t]}}},{key:"add",value:function(e){var t=e.identifier;return t in this.counterSet?this.counterSet[t]+=1:(this.elementSet[t]=e,this.counterSet[t]=1)}},{key:"remove",value:function(e){var t=this.counterSet[e];return void 0===t?t=0:0===(t-=1)&&(delete this.counterSet[e],delete this.elementSet[e]),t}}]),e}(),lo=function(){function e(t){C(this,e),this.uniteSet=t,this.elementSet={}}return P(e,[{key:"add",value:function(e){var t=e.identifier;t in this.elementSet||(this.elementSet[t]=e,this.uniteSet.add(e))}},{key:"release",value:function(e){for(var t in this.elementSet){var n=this.elementSet[t],r=this.uniteSet.remove(t);e&&0===r&&e(n),delete this.elementSet[t]}}}]),e}();function ho(e){var t=e.realTarget,n=e.illuTarget;if(!t||!n)return!1;switch(e.kind){case Do.Array:var r=e,i=t,a=n;if(i.length!==a.length)return!1;for(var o=r.equalsCount;o<i.length;++o)if(po(i[o],a[o]))return r.equalsCount=o,!1;return r.equalsCount=i.length,!0;case Do.FlatObject:case Do.HangUpObject:for(var s in t)if(!(s in n)||po(n[s],t[s]))return!1;for(var c in n)if(!(c in t))return!1;return!0;case Do.AkkoObject:var u,l=T(e.struct.serializableValueProperties);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(h in t!=h in n||po(t[h],n[h]))return!1}}catch(e){l.e(e)}finally{l.f()}return!0;default:return!1}}function po(e,t){return e!==t&&(Number.isNaN(e)?!Number.isNaN(t):!ke(e)||!ke(t)||!e.isEqualsTo(t))}var fo=function(){function e(t){C(this,e),this.logger=t,this.updatedProxyNodes=new uo,this.noConvergentRealNodes={},this.noConvergentIllusionNodes={}}return P(e,[{key:"createFrameSection",value:function(e){return new vo(this,this.updatedProxyNodes.createSubSet(),e)}},{key:"syncTwoBranches",value:function(){for(var e in this.updatedProxyNodes.release((function(e){ho(e)||e.converge()})),this.noConvergentIllusionNodes){var t=this.noConvergentIllusionNodes[e];t!==this.noConvergentRealNodes[e]&&t.converge(),delete this.noConvergentIllusionNodes[e]}for(var n in this.noConvergentRealNodes)this.noConvergentRealNodes[n].converge(),delete this.noConvergentRealNodes[n]}},{key:"isUpdatedProxyNode",value:function(e){return this.updatedProxyNodes.hasElement(e)}},{key:"isNoConvergentIllusionProxyNode",value:function(e){return e in this.noConvergentIllusionNodes}},{key:"isNoConvergentRealProxyNode",value:function(e){return e in this.noConvergentRealNodes}},{key:"addNoConvergentIllusionProxyNode",value:function(e){this.logger.warn("found no convergent illusion object: ".concat(e.identifier)),this.noConvergentIllusionNodes[e.identifier]=e}},{key:"addNoConvergentRealProxyNode",value:function(e){this.logger.warn("found no convergent real object: ".concat(e.identifier)),this.noConvergentRealNodes[e.identifier]=e}}]),e}(),vo=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};C(this,e),this.createdProxyNodes={},this.branch=t,this.illuUpdatedProxyNodes=n,this.realUpdatedProxyNodes={},this.legacyCreatedProxyNodes=r}return P(e,[{key:"takeCreatedProxyNodes",value:function(){try{return this.createdProxyNodes}finally{this.createdProxyNodes={}}}},{key:"illusionUpdateProxyNode",value:function(e){this.branch.isNoConvergentIllusionProxyNode(e.identifier)||this.illuUpdatedProxyNodes.add(e)}},{key:"realUpdateProxyNode",value:function(e){!this.branch.isNoConvergentRealProxyNode(e.identifier)&&!this.branch.isUpdatedProxyNode(e)&&(this.realUpdatedProxyNodes[e.identifier]=e)}},{key:"addCreatedObject",value:function(e){e.identifier in this.createdProxyNodes||(this.createdProxyNodes[e.identifier]=e),this.illuUpdatedProxyNodes.add(e)}},{key:"illusionTakeCreatedObject",value:function(e,t){return this.takeCreatedObject(e,t,this.legacyCreatedProxyNodes)}},{key:"realTakeCreatedObject",value:function(e,t){var n=this.takeCreatedObject(e,t,this.createdProxyNodes);return n&&!this.branch.isUpdatedProxyNode(n)&&(this.realUpdatedProxyNodes[e]=n),n}},{key:"takeCreatedObject",value:function(e,t,n){var r=n[e];return r&&(delete n[e],(Xo(r)&&t.constructor!==Array||Ho(r)&&t.constructor!==Object||Uo(r)&&t.constructor!==r.struct.classReflection.clazz)&&(r.dispose(),r=void 0)),r}},{key:"completeRebuild",value:function(){for(var e in this.legacyCreatedProxyNodes)this.legacyCreatedProxyNodes[e].dispose(),delete this.legacyCreatedProxyNodes[e]}},{key:"completeACK",value:function(){var e=this;for(var t in this.realUpdatedProxyNodes){var n=this.realUpdatedProxyNodes[t];ho(n)||this.branch.addNoConvergentRealProxyNode(n),delete this.realUpdatedProxyNodes[t]}for(var r in this.illuUpdatedProxyNodes.release((function(t){t.realTarget&&!ho(t)&&e.branch.addNoConvergentIllusionProxyNode(t)})),this.createdProxyNodes)this.createdProxyNodes[r].dispose(),delete this.createdProxyNodes[r]}}]),e}();function mo(e){return e instanceof ko}function go(e){var t=e.__proxy;return t.didDispose?fr.Rejected:t.realTarget?fr.Committed:fr.Uncommitted}var yo,bo,ko=function(){function e(t){C(this,e),Object.defineProperty(this,"__proxy",{value:t,writable:!1,enumerable:!1,configurable:!0})}return P(e,[{key:"toJSON",value:function(){return this.__proxy.toJSON()}}]),e}();function wo(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object.defineProperty(e,t,{enumerable:n,configurable:!0,get:function(){var e=this.__proxy,n=e.proxyRuntime.pullValue(e.displayerTarget()[t]);return e.assertAccessible(),e.touchKey(t),n}})}function So(e,t){delete e[t]}!function(e){e[e.ReadValue=0]="ReadValue",e[e.ReadByGetter=1]="ReadByGetter",e[e.CanNotReadGetter=2]="CanNotReadGetter",e[e.CanNotReadPrivateValue=3]="CanNotReadPrivateValue",e[e.CanNotReadPrivateGetter=4]="CanNotReadPrivateGetter"}(yo||(yo={})),function(e){e[e.NoEffects=0]="NoEffects",e[e.Modifiable=1]="Modifiable",e[e.Private=2]="Private",e[e.EventReceiver=3]="EventReceiver"}(bo||(bo={}));var xo=function(){function e(t){C(this,e),this.valuePropertiesSet={},this.classReflection=t;var n=[],r=[],i=[],a={};for(var o in t.properties){var s=t.properties[o],c=s.mode===Re.Value,u=s.decorators.some((function(e){return e===Cr})),l=s.decorators.some((function(e){return e===xr}));c&&(a[o]=!0,l?n.push(o):r.push(o)),s.isPublic&&(c||u)&&i.push(o)}this.transientValueProperties=Object.freeze(n),this.serializableValueProperties=Object.freeze(r),this.copyableProperties=Object.freeze(i),this.displayerNodeClass=this.createAkkoDisplayerNodeClass(t),this.valuePropertiesSet=Object.freeze(a),this.propertyKinds=this.createPropertyReadableKinds(t),this.methodKinds=this.createMethodCallableKinds(t)}return P(e,[{key:"isValueProperty",value:function(e){return e in this.valuePropertiesSet}},{key:"getPropertyReadableKind",value:function(e){return this.propertyKinds[e]}},{key:"getMethodCallableKind",value:function(e){return this.methodKinds[e]}},{key:"getValueOutsideFromProxyNode",value:function(e,t){switch(this.propertyKinds[t]){case 0:case 1:return e.proxyRuntime.pullValue(this.getValueFromProxyNode(e,t));case 2:throw new Error("can't read property ".concat(JSON.stringify(t)," unless it has @noEffects"));case 3:case 4:throw new Error("can't read private property ".concat(JSON.stringify(t)));default:return}}},{key:"getValueFromProxyNode",value:function(e,t){switch(e.assertAccessible(),this.propertyKinds[t]){case 0:case 3:var n=e.displayerTarget()[t];return e.touchKey(t),n;case 1:var r=e.proxyRuntime.runtime,i=r.observerId,a=e.proxyRuntime.noEffectsIdGenerator,o={authorId:i,mode:oo.Outside,timestamp:Date.now(),identifierGenerator:a};return r.runWithMagix(o,(function(){return e.target()[t]}));default:return}}},{key:"createAkkoDisplayerNodeClass",value:function(e){var t=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return n}(ko),n=function(e){Object.defineProperty(t.prototype,e,{enumerable:!1,configurable:!1,get:function(){var t=this.__proxy,n=t.struct;return t.assertAccessible(),n.getValueOutsideFromProxyNode(t,e)}})};for(var r in e.properties)n(r);var i=function(e){t.prototype[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.__proxy.callOutside(e,n)}};for(var a in e.methods)i(a);return t}},{key:"createPropertyReadableKinds",value:function(e){var t={};for(var n in e.properties){var r=e.properties[n];r.isPublic?r.mode===Re.Value?t[n]=0:r.decorators.some((function(e){return e===Cr}))?t[n]=1:t[n]=2:r.mode===Re.Value?t[n]=3:t[n]=4}return Object.freeze(t)}},{key:"createMethodCallableKinds",value:function(e){var t={};for(var n in e.methods){var r=e.methods[n];r.isPublic?r.decorators.some((function(e){return br(e)&&Ar(e.payload)}))?t[n]=3:r.decorators.some((function(e){return e===Cr}))?t[n]=0:t[n]=1:t[n]=2}return Object.freeze(t)}}]),e}();function Co(e,t){return Object.defineProperty(t,zo,{enumerable:!1,writable:!1,configurable:!0,value:e}),t}var Io=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,null,[{key:"createClass",value:function(e){var t=e.classReflection,r=e.getter,i=e.invoker,a=function(e){g(n,e);var t=b(n);function n(e,r){var i;return C(this,n),i=t.call(this,r),Object.defineProperty(w(i),"__Holder",{value:e,writable:!1,enumerable:!1,configurable:!0}),i}return n}(n),o=function(e){Object.defineProperty(a.prototype,e,{enumerable:!1,configurable:!1,get:function(){return r(e)},set:function(){throw new Error("cannot set property ".concat(e," which has only a getter"))}})};for(var s in t.properties)o(s);var c=function(e){a.prototype[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i(e,n)}};for(var u in t.methods)c(u);return a}},{key:"updateProxy",value:function(e,t){Object.defineProperty(e,zo,{value:t,writable:!1,enumerable:!1,configurable:!0})}},{key:"getHolder",value:function(e){return e.__Holder}}]),n}(ko),Po=function(){function e(t,n){var r=this;C(this,e),this.updatedListeners=[],this.disposedListeners=[],this.dispatchDisposed=function(){var e,t=T(r.disposedListeners);try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n()}catch(e){console.error(e)}}}catch(e){t.e(e)}finally{t.f()}},this.runtime=t,this.onClean=n}return P(e,[{key:"listenUpdated",value:function(e){this.updatedListeners.some((function(t){return t.id===e.id}))||this.updatedListeners.push(Object.freeze(la({},e)))}},{key:"unlistenUpdated",value:function(e){var t=this.updatedListeners.findIndex((function(t){return t.id===e}));-1!==t&&(this.updatedListeners.splice(t,1),this.fireRemoveListener())}},{key:"listenDisposed",value:function(e){-1===this.disposedListeners.indexOf(e)&&(this.disposedListeners.push(e),1===this.disposedListeners.length&&this.runtime.listenDisposed(this.dispatchDisposed))}},{key:"unlistenDisposed",value:function(e){var t=this.disposedListeners.indexOf(e);-1!==t&&(this.disposedListeners.splice(t,1),this.fireRemoveListener(),0===this.disposedListeners.length&&this.runtime.unlistenDisposed(this.dispatchDisposed))}},{key:"dispatchUpdated",value:function(e){var t,n=T(this.updatedListeners);try{for(n.s();!(t=n.n()).done;){var r=t.value.listener;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"fireRemoveListener",value:function(){0===this.updatedListeners.length&&0===this.disposedListeners.length&&(this.runtime.unlistenDisposed(this.dispatchDisposed),this.onClean())}}]),e}();function Mo(e,t){var n=Oo(e),r=e.__proxy;null==n||n.listenUpdated({id:t,listener:function(e){return function(e,t,n){var r=[];for(var i in t){var a=t[i],o=a.isIndex?parseInt(i,10):i,s=a.kind,c=void 0;switch(s){case bi.Inserted:case bi.Updated:c=e.proxyRuntime.pullValue(a.value);case bi.Removed:}r.push({key:o,value:c,kind:s})}n(r)}(r,e,t)}})}function To(e,t){var n;null==(n=Oo(e))||n.unlistenUpdated(t)}function Ao(e,t){var n;null==(n=Oo(e))||n.listenDisposed(t)}function Eo(e,t){var n;null==(n=Oo(e))||n.unlistenDisposed(t)}function Oo(e){if(!mo(e))throw new Error("it isn't akko wrapped object");return e instanceof Io?Io.getHolder(e).getListeners():e.__proxy.getListeners()}var Ro=!1,No=hr.SingleForward;function Lo(e){return e instanceof Fo}function jo(e){return"object"!=M(e)||null===e?e:e instanceof Fo?e.target():e}mr.addListener((function(e,t){if(t){var n=e.proxyRuntime.runtime;Ro=n.isForcesOnIllusionLine(e.mode),No=e.forwardMode}else Ro=!1,No=hr.SingleForward}));var Do,Fo=function(){function e(t,n,r){C(this,e),this._didDispose=!1,this.listeners=null,this.proxyRuntime=t,this.identifier=n,Ro?this.illuTarget=Co(this,r):this.realTarget=Co(this,r)}return P(e,[{key:"didDispose",get:function(){return this._didDispose}},{key:"assertAccessible",value:function(){if(this._didDispose)throw new Error("akko wrapped object isn't accessible")}},{key:"reportChanged",value:function(e){var t;null==(t=this.listeners)||t.dispatchUpdated(e)}},{key:"getValue",value:function(e){return this.target()[e]}},{key:"touchKey",value:function(e){var t=this.proxyRuntime.observerAdapter;t&&(this.observer||(this.observer=t.create(this.identifier,this.getDebugName())),void 0===e?this.observer.reportObservedIteration():this.observer.reportObservedKey(e))}},{key:"getListeners",value:function(){var e=this;return!this.listeners&&!this._didDispose&&(this.listeners=new Po(this.proxyRuntime,(function(){e.listeners=null}))),this.listeners}},{key:"cleanListeners",value:function(){this.listeners=null}},{key:"dispose",value:function(){this._didDispose=!0,xa().unbindDelegate(this),this._displayer&&(this.releaseDisplayer(this._displayer),delete this._displayer,delete this.observer),this.listeners&&(this.listeners=null)}},{key:"target",value:function(){return Ro?this.illuTarget:this.realTarget}},{key:"displayerTarget",value:function(){return this.illuTarget||this.realTarget}},{key:"displayer",get:function(){return this._displayer||(this._displayer=this.createDisplayer()),this._displayer}},{key:"toString",value:function(){return this.target().toString()}},{key:"toLocaleString",value:function(){return this.target().toLocaleString()}},{key:"sideTarget",value:function(){if(No===hr.DoubleForward&&!Ro)return this.illuTarget}}]),e}(),zo="__proxy";function Bo(e){if(mr.currentNode){if(Lo(e))return e.identifier;var t=e[zo];if(!Lo(t))throw new Error("identifier not found");return t.identifier}if(mo(e))return e.__proxy.identifier;throw"object"!=M(e)?new Error("can not find identifier of ".concat(M(e))):null===e?new Error("can not find identifier of null"):new Error("identifier not found")}function Uo(e){return e instanceof Vo}!function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.HangUpObject=3]="HangUpObject"}(Do||(Do={}));var Vo=function(e){g(n,e);var t=b(n);function n(e,r,i,a){var o;return C(this,n),(o=t.call(this,e,r,i)).struct=a,o}return P(n,[{key:"getDebugName",value:function(){return this.struct.classReflection.name}},{key:"createDisplayer",value:function(){return new(0,this.struct.displayerNodeClass)(this)}},{key:"kind",get:function(){return Do.AkkoObject}},{key:"clazz",get:function(){return this.struct.classReflection.clazz}},{key:"updateDisplayer",value:function(e){}},{key:"reportChanged",value:function(e){s(x(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var r in e){var i=e[r],a=i.kind,o=i.value;t.reportChanged(r,o,a)}}},{key:"converge",value:function(){var e=this.realTarget;if(e){var t,n={},r=T(this.struct.serializableValueProperties);try{for(r.s();!(t=r.n()).done;){var i=t.value;i in e&&(n[i]=e[i])}}catch(e){r.e(e)}finally{r.f()}Object.setPrototypeOf(n,this.struct.classReflection.clazz.prototype),this.replaceIlluTarget(n)}}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=Co(this,e);this.illuTarget=n;var r,i=xa(),a=T(this.struct.serializableValueProperties);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o in t,c=o in n;c&&!s?i.addProperty(this,o,n[o]):!c&&s?i.removeProperty(this,o):c&&s&&n[o]!==t[o]&&i.setProperty(this,o,n[o])}}catch(e){a.e(e)}finally{a.f()}}},{key:"getMethod",value:function(e){return this.target()[e]}},{key:"touchKey",value:function(e){switch(this.struct.getPropertyReadableKind(e)){case yo.ReadValue:case yo.CanNotReadPrivateValue:s(x(n.prototype),"touchKey",this).call(this,e)}}},{key:"callOutside",value:function(e,t){var n;switch(this.assertAccessible(),this.struct.getMethodCallableKind(e)){case bo.NoEffects:var r=this.proxyRuntime.cache;n=r?r.valueWithArgs(this,this.identifier,e,t,this.callNoEffectsMethod):this.callNoEffectsMethod(e,t);break;case bo.Modifiable:if(!this.struct.classReflection.isRootClass)throw new Error("can only call modifiable methods of trigger object");n=this.proxyRuntime.rootObject.onInvokedTriggerMethod(e,t);break;case bo.EventReceiver:throw new Error("can't invoke event receiver. you should call dispatch()");case bo.Private:throw new Error("can't invoke private method");default:var i;(i=void 0)[e].apply(i,p(t))}return this.proxyRuntime.pullValue(n)}},{key:"callNoEffectsMethod",value:function(e,t){var n=this,r=this.proxyRuntime.runtime,i=r.observerId,a=this.proxyRuntime.noEffectsIdGenerator,o={authorId:i,mode:oo.Outside,timestamp:Date.now(),identifierGenerator:a};return r.runWithMagix(o,(function(){var r=n.target(),i=r[e],o=n.proxyRuntime.pushValues(a,t,!1);return i.apply(r,o)}))}},{key:"setValue",value:function(e,t){var n=this.target();if(this.struct.isValueProperty(e)){var r=n[e],i=e in n;n[e]=t,i?r!==t&&xa().setProperty(this,e,t):xa().addProperty(this,e,t);var a=this.sideTarget();return a&&(a[e]=t),t}return n[e]=t}},{key:"postfix",value:function(e,t){var n=this.target();if(this.struct.isValueProperty(e)){var r=n[e],i=e in n,a=n[e]+=t;i?r!==a&&xa().setProperty(this,e,a):xa().addProperty(this,e,a);var o=this.sideTarget();return o&&(o[e]=a),a}return n[e]+=t}},{key:"prefix",value:function(e,t){var n=this.target(),r=n[e];if(this.struct.isValueProperty(e)){var i=e in n,a=n[e]+=t;i?r!==a&&xa().setProperty(this,e,a):xa().addProperty(this,e,a);var o=this.sideTarget();o&&(o[e]=a)}else n[e]+=t;return r}},{key:"removeKey",value:function(e){if(this.struct.isValueProperty(e)){var t=this.target(),n=e in t;if(n){delete t[e],xa().removeProperty(this,e);var r=this.sideTarget();r&&delete r[e]}return n}return!1}},{key:"toJSON",value:function(){var e,t={},n=T(this.struct.copyableProperties);try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r]=this[r]}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"releaseDisplayer",value:function(e){}}]),n}(Fo),Wo=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"getDebugName",value:function(){return"Object"}},{key:"createDisplayer",value:function(){var e=new ko(this);for(var t in this.displayerTarget())wo(e,t);return e}},{key:"updateDisplayer",value:function(e){var t=this._displayer;if(t)for(var n in e)switch(e[n].kind){case bi.Inserted:wo(t,n);break;case bi.Removed:So(t,n)}}},{key:"reportChanged",value:function(e){s(x(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var r in e){var i=e[r],a=i.kind,o=i.value;t.reportChanged(r,o,a)}}},{key:"clazz",get:function(){return Object}},{key:"converge",value:function(){this.realTarget&&this.replaceIlluTarget(la({},this.realTarget))}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=Co(this,e);this.illuTarget=n;var r=xa();for(var i in n){var a=n[i];i in t?t[i]!==a&&r.setProperty(this,i,a):r.addProperty(this,i,a)}for(var o in t)o in n||r.removeProperty(this,o)}},{key:"getMethod",value:function(e){return this.target()[e]}},{key:"setValue",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n;return n[e]=t,a?i!==t&&xa().setProperty(this,e,t):xa().addProperty(this,e,t),r&&(r[e]=t),t}},{key:"prefix",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n,o=n[e]+=t;return a?i!==o&&xa().setProperty(this,e,o):xa().addProperty(this,e,o),r&&(r[e]=o),o}},{key:"postfix",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n,o=n[e]+=t;return a?i!==o&&xa().setProperty(this,e,o):xa().addProperty(this,e,o),r&&(r[e]=o),i}},{key:"removeKey",value:function(e){var t=this.target(),n=e in t;if(n){delete t[e];var r=this.sideTarget();xa().removeProperty(this,e),r&&delete r[e]}return n}},{key:"toJSON",value:function(){var e=this.displayerTarget(),t={};for(var n in e)t[n]=e[n];return t}},{key:"releaseDisplayer",value:function(e){}}]),n}(Fo);function Ho(e){return e instanceof _o}var _o=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"kind",get:function(){return Do.FlatObject}},{key:"covertToAkkoObjectProxyNode",value:function(e){var t=this,n=this.realTarget,r=this.illuTarget;return t.struct=this.proxyRuntime.getAkkoObjectStruct(e),t._displayer=void 0,Object.setPrototypeOf(t,Vo.prototype),Object.setPrototypeOf(n,e.clazz.prototype),r&&Object.setPrototypeOf(r,e.clazz.prototype),t}}]),n}(Wo),Go=function(){function e(t){C(this,e),this.index=0,this.proxy=t,this.length=t.proxyRuntime.pullValue(t.displayerTarget().length),t.assertAccessible(),t.touchKey("length")}return P(e,[{key:Symbol.iterator,value:function(){return new e(this.proxy)}},{key:"next",value:function(){if(this.index>=this.length)return{value:void 0,done:!0};var e=this.proxy.displayerTarget()[this.index],t=this.proxy.proxyRuntime.pullValue(e);return this.proxy.assertAccessible(),this.proxy.touchKey(this.index),this.index+=1,{value:t,done:!1}}}]),e}(),Yo=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),r=t.call(this,e);for(var i=e.displayerTarget(),a=0;a<i.length;++a)wo(w(r),a);return r}return P(n,[{key:"concat",value:function(){for(var e=n.unwrapToPureArray(this),t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0;a<r.length;++a)r[a]=n.unwrapToPureArray(r[a]);return Array.prototype.concat(e,r)}},{key:"every",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.every.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"filter",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.filter.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"find",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=Array.prototype.find.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}));return r.pullValue(i)}},{key:"findIndex",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.findIndex.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"forEach",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;Array.prototype.forEach.call(this.__proxy.displayerTarget(),(function(i,a){e.call(t,r.pullValue(i),a,n)}))}},{key:"indexOf",value:function(e,t){var n=e;return mo(n)&&(n=n.__proxy),Array.prototype.indexOf.call(this.__proxy.displayerTarget(),n,t)}},{key:"lastIndexOf",value:function(e,t){var n=e;return mo(n)&&(n=n.__proxy),Array.prototype.lastIndexOf.call(this.__proxy.displayerTarget(),n,t)}},{key:"join",value:function(e){return Array.prototype.join.call(this.__proxy.displayerTarget(),e)}},{key:"map",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.map.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"reduce",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=t;return Array.prototype.reduce.call(this.__proxy.displayerTarget(),(function(t,a,o){var s=t;return i!==s&&(s=r.pullValue(s)),i=e(s,r.pullValue(a),o,n)}),t)}},{key:"reduceRight",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=t;return Array.prototype.reduceRight.call(this.__proxy.displayerTarget(),(function(t,a,o){var s=t;return i!==s&&(s=r.pullValue(s)),i=e(s,r.pullValue(a),o,n)}),t)}},{key:"slice",value:function(e,t){for(var n=this.__proxy.proxyRuntime,r=Array.prototype.slice.call(this.__proxy.displayerTarget(),e,t),i=0;i<r.length;++i)r[i]=n.pullValue(r[i]);return r}},{key:"some",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.some.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"toString",value:function(){return Array.prototype.toString.apply(this.__proxy.displayerTarget())}},{key:"copyWithin",value:function(){n.throwImmutableError()}},{key:"fill",value:function(){n.throwImmutableError()}},{key:"pop",value:function(){n.throwImmutableError()}},{key:"push",value:function(){n.throwImmutableError()}},{key:"reverse",value:function(){n.throwImmutableError()}},{key:"shift",value:function(){n.throwImmutableError()}},{key:"splice",value:function(){n.throwImmutableError()}},{key:"unshift",value:function(){n.throwImmutableError()}},{key:"sort",value:function(){n.throwImmutableError()}},{key:"entries",value:function(){n.throwBanMethodError()}},{key:"keys",value:function(){n.throwBanMethodError()}},{key:"values",value:function(){n.throwBanMethodError()}}],[{key:"refreshLength",value:function(e,t){for(var n=t;n in e;)So(e,n),n+=1;if(n===t)for(n=t-1;n>=0&&!(n in e);)wo(e,n),n-=1}},{key:"unwrapToPureArray",value:function(e){if(e instanceof n){for(var t=e.__proxy.displayerTarget().length,r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}return e}},{key:"throwImmutableError",value:function(){throw new Error("it is immutable")}},{key:"throwBanMethodError",value:function(){throw new Error("ban method")}}]),n}(ko);function Xo(e){return e instanceof Ko}Object.defineProperty(Yo.prototype,"length",{enumerable:!1,configurable:!0,get:function(){var e=this.__proxy,t=e.proxyRuntime.pullValue(e.displayerTarget().length);return e.touchKey("length"),t}}),"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&Object.defineProperty(Yo.prototype,Symbol.iterator,{enumerable:!1,configurable:!0,writable:!1,value:function(){return new Go(this.__proxy)}});var Qo=function(e){g(n,e);var t=b(n);function n(){var e;return C(this,n),(e=t.apply(this,arguments)).equalsCount=0,e}return P(n,[{key:"getDebugName",value:function(){return"Array"}},{key:"createDisplayer",value:function(){return new Yo(this)}},{key:"kind",get:function(){return Do.Array}},{key:"clazz",get:function(){return Array}},{key:"updateDisplayer",value:function(e){var t=this._displayer,n=e.length;t&&n&&Yo.refreshLength(t,n.value)}},{key:"reportChanged",value:function(e){s(x(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t){var r=e.length;for(var i in r&&t.reportChanged("length",r.value,r.kind),e){var a=e[i],o=a.kind,c=a.value;a.isIndex&&t.reportChanged(parseInt(i,10),c,o)}}}},{key:"converge",value:function(){this.realTarget&&(this.replaceIlluTarget(p(this.realTarget)),this.equalsCount=this.realTarget.length)}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=Co(this,e);this.illuTarget=n;for(var r=Math.min(t.length,n.length),i=xa(),a=0;a<r;++a)t[a]!==n[a]&&i.setProperty(this,a,n[a]);this.refreshLength(t.length,n),this.equalsCount=0}},{key:"getMethod",value:function(e){return n.arrayValidMethods[e]}},{key:"getValue",value:function(e){return"number"==typeof e?this.target()[e]:"length"===e?this.target().length:void 0}},{key:"setValue",value:function(e,t){var n=this.target(),r=n.length;if("number"==typeof e){if(e>=0){var i=e in n&&n[e]!==t,a=n[e]=t;i&&xa().setProperty(this,e,t);var o=this.sideTarget();return this.refreshLength(r,n),o&&(o[e]=t),e<this.equalsCount&&(this.equalsCount=e),a}return t}return n[e]}},{key:"removeKey",value:function(e){return!1}},{key:"prefix",value:function(e,t){if("number"==typeof e){var n=this.target(),r=this.sideTarget(),i=e in n,a=n.length,o=n[e],s=n[e]+=t;return i&&s!==o&&xa().setProperty(this,e,s),this.refreshLength(a,n),r&&(r[e]=s),e<this.equalsCount&&(this.equalsCount=e),s}}},{key:"postfix",value:function(e,t){if("number"==typeof e){var n=this.target(),r=this.sideTarget(),i=e in n,a=n.length,o=n[e],s=n[e]+=t;return i&&s!==o&&xa().setProperty(this,e,s),this.refreshLength(a,n),r&&(r[e]=s),e<this.equalsCount&&(this.equalsCount=e),o}}},{key:"toJSON",value:function(){for(var e=this.displayerTarget(),t=[],n=0;n<e.length;++n)t[n]=e[n];return t}},{key:"releaseDisplayer",value:function(e){}},{key:"refreshLength",value:function(e,t){if(e!==t.length){var n=this.sideTarget(),r=xa();if(e>t.length){n&&n.splice(t.length);for(var i=t.length;i<e;++i)r.removeProperty(this,i)}else for(var a=e;a<t.length;++a)n&&(n[a]=t[a]),r.addProperty(this,a,t[a]);r.setProperty(this,"length",t.length)}}}],[{key:"createArrayValidMethods",value:function(){var e,t,n;mr.addListener((function(r,i){i&&r.tools?(e=r.tools.idGenerator,t=r.coreFunctions.updater,n=r.coreFunctions.creator):(e=void 0,t=void 0,n=void 0)}));var r,i=function(t,r){return t===r?t[zo]:n(r,e.generate())},a={},o=T(ra);try{var s=function(){var e=r.value,n=e.methodName,o=e.returnArray,s=e.lengthChanged,c=e.elementChanged,u=e.touchLength,l=e.cleanEqualsCount,h=e.pickTouchedSegment,d=Array.prototype[n],p=s||c;a[n]=function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var f=this,v=f.length,m=f[zo],g=d.apply(f,r);if(p&&!no(m))throw new Error("Magix is frozen, you can't call Array.".concat(n,"()"));var y=h&&h(f,r);if(s&&m.refreshLength(v,f),y)for(var b=Math.min(f.length,y.beginIndex+y.length),k=m.sideTarget(),w=xa(),S=y.beginIndex;S<b;++S){if(c){var x=f[S];k&&(k[S]=x),w.setProperty(m,S,x)}m.touchKey(S)}return u&&m.touchKey(),l&&(m.equalsCount=0),p&&t(m),o?i(f,g):g}};for(o.s();!(r=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return Object.freeze(a)}}]),n}(Fo),Ko=Qo;function qo(e){return e instanceof Jo}Ko.arrayValidMethods=Qo.createArrayValidMethods();var Zo,Jo=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"version",get:function(){return this._version}},{key:"objectFormatId",get:function(){return this._objectFormatId}},{key:"setHangMetadata",value:function(e){if(this._version||this._objectFormatId)throw new Error("did set version");this._version=e.version,this._objectFormatId=e.objectFormatId}},{key:"kind",get:function(){return Do.HangUpObject}}]),n}(Wo);function $o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new ts(t,n).copyValue(e)}!function(e){e[e.ExportsPropertyMode=0]="ExportsPropertyMode",e[e.SerializablePropertyMode=1]="SerializablePropertyMode"}(Zo||(Zo={}));var es,ts=function(){function e(t,n){C(this,e),this.mode=t,this.creator=n,this.copedObjectMap={}}return P(e,[{key:"copyValue",value:function(e){return mo(e)?this.copyProxyNode(e.__proxy):Lo(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function(e){var t=e.identifier,n=this.copedObjectMap[t];if(!n){var r=e.displayerTarget();if(Ho(e)){var i={};for(var a in this.copedObjectMap[t]=n=i,r)i[a]=this.copyInsideValue(e.proxyRuntime,r[a])}else if(Uo(e)){var o=e.struct,s=this.createAkkoObject(o.classReflection.clazz);this.copedObjectMap[t]=n=s;var c,u=T(this.getPropertiesToCopy(e));try{for(u.s();!(c=u.n()).done;){var l=c.value;s[l]=this.copyInsideValue(e.proxyRuntime,o.getValueFromProxyNode(e,l))}}catch(e){u.e(e)}finally{u.f()}}else if(Xo(e)){var h=r.length,d=[];this.copedObjectMap[t]=n=d;for(var p=0;p<h;++p)d[p]=this.copyInsideValue(e.proxyRuntime,r[p])}}return n}},{key:"getPropertiesToCopy",value:function(e){switch(this.mode){case 0:return e.struct.copyableProperties;case 1:return e.struct.serializableValueProperties;default:throw new Error("invalid mode ".concat(this.mode))}}},{key:"createAkkoObject",value:function(e){return this.creator?this.creator(e):{}}},{key:"copyInsideValue",value:function(e,t){return"object"!=M(t)||null===t?t:Lo(t)?this.copyProxyNode(t):ke(t)?t.readonly?t:t.slice():e.escapeObjectFilter(t)?t:void 0}}]),e}();mr.addListener((function(e,t){es=t&&e.tools?e.coreFunctions:null}));var ns=function(){function e(){C(this,e),this.copedObjectMap={}}return P(e,[{key:"copyValue",value:function(e){return Lo(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function(e){var t=e.identifier,n=this.copedObjectMap[t];if(!n)if(Ho(e)||qo(e)){var r=es.creator({});for(var i in this.copedObjectMap[t]=n=r,es.unwrapper(e)){var a=this.copyValue(es.getter(e,i));es.setter(n,i,a)}}else if(Uo(e)){var o=e.struct,s={};Object.setPrototypeOf(s,o.classReflection.clazz.prototype);var c=es.creator(s);this.copedObjectMap[t]=n=c;var u,l=T(o.serializableValueProperties);try{for(l.s();!(u=l.n()).done;){var h=u.value,d=this.copyValue(es.getter(e,h));es.setter(c,h,d)}}catch(e){l.e(e)}finally{l.f()}}else{if(!Xo(e))throw new Error("invalid proxy node");var p=es.getter(e,"length"),f=es.creator([]);this.copedObjectMap[t]=n=f;for(var v=0;v<p;++v){var m=this.copyValue(es.getter(e,v));es.setter(f,v,m)}}return n}}]),e}(),rs=function(){function e(t,n){var r=this;C(this,e),this.listeners=new is,this.didDispose=!1,this.getProperty=function(e){var t,n=r._akkoProxyNode.proxyRuntime;switch(r.struct.getPropertyReadableKind(e)){case yo.ReadValue:t=n.pullValue(r._akkoProxyNode.displayerTarget()[e]),r.touchKey(e);break;case yo.ReadByGetter:var i=n.cache;t=i?i.valueWithKey(r,r._akkoProxyNode.identifier,e,r.readByGetter):r.readByGetter(e),r.touchKey(zo);break;case yo.CanNotReadGetter:throw new Error("can't read property ".concat(JSON.stringify(e)," unless it has @noEffects"));case yo.CanNotReadPrivateValue:case yo.CanNotReadPrivateGetter:throw new Error("can't read private property ".concat(JSON.stringify(e)))}return t},this.readByGetter=function(e){var t=r._akkoProxyNode.proxyRuntime,n=t.runtime,i=n.observerId,a=t.noEffectsIdGenerator,o={authorId:i,mode:oo.Outside,timestamp:Date.now(),identifierGenerator:a},s=n.runWithMagix(o,(function(){return r._akkoProxyNode.target()[e]}));return t.pullValue(s)},this.invokeMethod=function(e,t){var n=r._akkoProxyNode.callOutside(e,t);return r.touchKey(zo),n},this.onAkkoProxyNodeUpdated=function(e){if(r.observer){for(var t in e){var n=e[t],i=n.kind,a=n.value;r.observer.reportChanged(t,a,i)}r.listeners.dispatchUpdated(e)}},this.struct=t.struct,this.observerAdapter=n,this._akkoProxyNode=t,this.displayer=this.createDisplayer(t),this.valueProperties=Object.freeze([].concat(p(this.struct.transientValueProperties),p(this.struct.serializableValueProperties))),this.listenUpdated(t)}return P(e,[{key:"dispose",value:function(){this.didDispose||(this.unlistenUpdate(this._akkoProxyNode),this.listeners.dispatchDisposed(),this.didDispose=!0)}},{key:"getListeners",value:function(){return this.listeners}},{key:"akkoProxyNode",get:function(){return this._akkoProxyNode},set:function(e){var t=this;this._akkoProxyNode!==e&&(this.unlistenUpdate(this._akkoProxyNode),this.observerAdapter?this.observerAdapter.observeUpdate((function(){t.compareAndReportUpdated(t._akkoProxyNode,e),t._akkoProxyNode=e,Io.updateProxy(t.displayer,e)})):(this.compareAndReportUpdated(this._akkoProxyNode,e),this._akkoProxyNode=e,Io.updateProxy(this.displayer,e)),this.listenUpdated(this.akkoProxyNode))}},{key:"compareAndReportUpdated",value:function(e,t){var n=this.compareAndGetUpdatedObject(e,t);if(this.observer){for(var r in n){var i=n[r],a=i.value,o=i.kind;this.observer.reportChanged(r,a,o)}this.observer.reportChanged(zo,t,bi.Updated)}this.listeners.dispatchUpdated(n)}},{key:"compareAndGetUpdatedObject",value:function(e,t){var n,r=e.displayerTarget(),i=t.displayerTarget(),a={},o=T(this.valueProperties);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s in r,u=s in i,l="number"==typeof s,h=null;c&&!u?h={isIndex:l,kind:bi.Removed,value:void 0}:!c&&u?h={isIndex:l,kind:bi.Inserted,value:i[s]}:r[s]!==i[s]&&(h={isIndex:l,kind:bi.Updated,value:i[s]}),h&&(a[s]=h)}}catch(e){o.e(e)}finally{o.f()}return a}},{key:"createDisplayer",value:function(e){return new(Io.createClass({classReflection:e.struct.classReflection,getter:this.getProperty,invoker:this.invokeMethod}))(this,e)}},{key:"listenUpdated",value:function(e){var t;null==(t=e.getListeners())||t.listenUpdated({id:this.onAkkoProxyNodeUpdated,listener:this.onAkkoProxyNodeUpdated})}},{key:"unlistenUpdate",value:function(e){var t;null==(t=e.getListeners())||t.unlistenUpdated(this.onAkkoProxyNodeUpdated)}},{key:"touchKey",value:function(e){var t=this.observerAdapter;if(t){if(!this.observer){var n=this._akkoProxyNode.identifier;this.observer=t.create(n,"AkkoDisplayerHolder")}this.observer.reportObservedKey(e)}}}]),e}(),is=function(){function e(){C(this,e),this.updatedListeners=[],this.disposedListeners=[]}return P(e,[{key:"listenUpdated",value:function(e){this.updatedListeners.some((function(t){return t.id===e.id}))||this.updatedListeners.push(Object.freeze(la({},e)))}},{key:"unlistenUpdated",value:function(e){var t=this.updatedListeners.findIndex((function(t){return t.id===e}));-1!==t&&this.updatedListeners.splice(t,1)}},{key:"listenDisposed",value:function(e){-1===this.disposedListeners.indexOf(e)&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function(e){var t=this.disposedListeners.indexOf(e);-1!==t&&this.disposedListeners.splice(t,1)}},{key:"dispatchUpdated",value:function(e){var t,n=T(this.updatedListeners);try{for(n.s();!(t=n.n()).done;){var r=t.value.listener;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"dispatchDisposed",value:function(){var e,t=T(this.disposedListeners);try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n()}catch(e){console.error(e)}}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),as=null;mr.addListener((function(e,t){as=t?e.coreFunctions:null}));var os,ss=function(){function e(){C(this,e)}return P(e,[{key:"isValidObject",value:function(e){return Uo(e)}},{key:"isDisplayerObject",value:function(e){return mo(e)}},{key:"identifier",value:function(e){return e.identifier}},{key:"kind",value:function(e){if(Uo(e))return pr.AkkoObject;if(Ho(e))return pr.FlatObject;if(Xo(e))return pr.Array;if(mo(e))return pr.Displayer;throw new Error("unrecognized proxy node")}},{key:"forEach",value:function(e,t){if(Ho(e)){var n=e.target();for(var r in n)t(n[r],r)}else if(Xo(e))for(var i=e.target(),a=0;a<i.length;++a)t(i[a],a);else if(Uo(e)){var o,s=e.target(),c=T(e.struct.serializableValueProperties);try{for(c.s();!(o=c.n()).done;){var u=o.value;t(s[u],u)}}catch(e){c.e(e)}finally{c.f()}}}},{key:"createObject",value:function(e,t){return as.creator(t,e)}},{key:"wrapDisplayer",value:function(e,t){return t.displayer}},{key:"unwrapDisplayer",value:function(e,t){return t.__proxy}},{key:"getClassReflection",value:function(e){var t=e;if(mo(t)&&(t=t.__proxy),Uo(t))return t.struct.classReflection}},{key:"override",value:function(e,t,n){if(Ho(e)){for(var r in as.unwrapper(e))r in t||as.remover(e,r);for(var i in t)as.setter(e,i,t[i])}else if(Xo(e)){var a=t,o=as.getter(e,"length");a.length>o&&as.caller(e,"splice",[o]);for(var s=0;s<a.length;++s)as.setter(e,s,a[s])}else if(Uo(e)){var c,u=e.proxyRuntime.getAkkoObjectStruct(n),l=T(u.transientValueProperties);try{for(l.s();!(c=l.n()).done;){var h=c.value;as.remover(e,h)}}catch(e){l.e(e)}finally{l.f()}var d,p=T(u.serializableValueProperties);try{for(p.s();!(d=p.n()).done;){var f=d.value;as.setter(e,f,t[f])}}catch(e){p.e(e)}finally{p.f()}}}},{key:"displayerPhase",value:function(e){if(mo(e))return go(e);throw new Error("it isn't akko wrapped object")}},{key:"copyDisplayer",value:function(e){return $o(e)}}]),e}();function cs(e,t,n){return new _o(e,t,n)}function us(e,t,n,r){return new Vo(e,t,n,r)}function ls(e,t,n){return new Ko(e,t,n)}mr.addListener((function(e,t){os=t?e.coreFunctions.creator:void 0}));var hs=function(){function e(t,n){C(this,e),this.decorateObjectEnums=Object.freeze([tt.Object]),this.proxyRuntime=t,this.covertIdToClass=n}return P(e,[{key:"createObject",value:function(e,t){if(t===tt.HangUpObject)return function(e,t,n){return new Jo(e,t,n)}(this.proxyRuntime,e,{});var n=t===tt.Array?[]:{};return os?os(n,e):pa(this.proxyRuntime,n,e)}},{key:"findIdentifier",value:function(e){var t=e.identifier;if(void 0===t)throw Lo(e)?new Error("can't find identifier of proxy node"):new Error("object should be proxy node");return t}},{key:"findHangUpMetadata",value:function(e){if(!qo(e))throw new Error("it's not hang up object");return e}},{key:"checkObjectEnum",value:function(e){switch(e.kind){case Do.Array:return tt.Array;case Do.AkkoObject:case Do.FlatObject:return tt.Object;case Do.HangUpObject:return tt.HangUpObject;default:throw new Error("unrecognized object")}}},{key:"keys",value:function(e){return Object.keys(e.target())}},{key:"length",value:function(e){if(Xo(e))return e.target().length}},{key:"hasKey",value:function(e,t){return t in e.target()}},{key:"getValue",value:function(e,t){return e.target()[t]}},{key:"setValue",value:function(e,t,n){e.setValue(t,n)}},{key:"completeHangUpObject",value:function(e,t){qo(e)&&e.setHangMetadata(t)}},{key:"decorateObject",value:function(e,t,n,r,i){if(r&&t===et.AssertedObject){var a=this.covertIdToClass(r.id);if(!a)throw new wt("can't find class by object format id ".concat(r.id));var o=a[Or];Ho(e)&&e.covertToAkkoObjectProxyNode(o)}}}]),e}();var ds=function(){function e(t,n){C(this,e),this.assertObjectFormat=function(e){if(Uo(e))return e.struct.classReflection.objectFormat},this.proxyRuntime=t,this.objectAdapter=function(e,t){return new hs(t,e.covertObjectFormatIdToClass)}(n,t),this.frameSerialization=function(e,t){var n=Ci(e.rootClass);return lr(new Rt({format:e.format,objectAdapter:t,assertObjectFormat:function(e){if(Uo(e))return e.struct.classReflection.objectFormat}}),n)}(n,this.objectAdapter)}return P(e,[{key:"serializeSnapshotFrame",value:function(e){return this.frameSerialization.serializeSnapshotFrame(e)}},{key:"serializeActionFrame",value:function(e,t){return this.frameSerialization.serializeActionFrame(e,t)}},{key:"deserializeSnapshotFrame",value:function(e,t,n){return this.frameSerialization.deserializeSnapshotFrame(e,t,n)}},{key:"deserializeActionFrame",value:function(e,t,n,r){var i=this;return r?this.proxyRuntime.runtime.runWithSerialization(r,(function(){return i.frameSerialization.deserializeActionFrame(e,t,n)})):this.frameSerialization.deserializeActionFrame(e,t,n)}},{key:"createSerialization",value:function(e){return new Rt({format:e,objectAdapter:this.objectAdapter,assertObjectFormat:this.assertObjectFormat})}}]),e}(),ps=function(){function e(t,n,r){C(this,e),this.runtime=t,this.rootObject=n,this.observerAdapter=r,this._pendingUpdatedRootObject=!1,this.didPenddingRootObject=!1}return P(e,[{key:"initialize",value:function(){this.holder=new rs(this.rootObject,this.observerAdapter)}},{key:"initializeWithOriginRootObject",value:function(e){this.holder=e.holder,this._pendingUpdatedRootObject?this.didPenddingRootObject=!0:this.holder.akkoProxyNode=this.rootObject}},{key:"pendingUpdatedRootObject",get:function(){return this._pendingUpdatedRootObject},set:function(e){this._pendingUpdatedRootObject!==e&&(this._pendingUpdatedRootObject=e,!e&&this.didPenddingRootObject&&(this.didPenddingRootObject=!1,this.holder.akkoProxyNode=this.rootObject))}},{key:"observerId",get:function(){return this.runtime.observerId}},{key:"displayer",get:function(){return this.holder.displayer}},{key:"target",get:function(){return this.rootObject.target()}},{key:"getRootMethod",value:function(e){return this.rootObject.getMethod(e)}},{key:"snapshotRootObject",value:function(){return this.rootObject}}]),e}(),fs=function(){function e(t){C(this,e),this.params=Object.freeze(la({},t)),this.objectOperator=new ss}return P(e,[{key:"createProxyRuntime",value:function(e,t){return new Ea(this.objectOperator,e,t,{escapeObjectFilter:this.params.escapeObjectFilter,jsxFactory:this.params.jsxFactory,observerAdapter:this.params.observerAdapter})}}]),e}();function vs(e){if(!mo(e))throw new Error("it isn't akko wrapped object");return fr.Rejected!==go(e)}function ms(e,t){return mo(e)?e.__proxy.displayerTarget()instanceof t:Lo(e)?e.displayerTarget()instanceof t:e instanceof t}function gs(e){var t=ys(e);if(t===Object)return-1;if(t===Array)return-2;if(void 0===t)return-3;var n=t[Or];return n?n.id:-3}function ys(e){switch(M(e)){case"function":return e;case"object":if(null!==e)return function(e){var t=e.__proxy;switch(function(e){if(Uo(e))return pr.AkkoObject;if(Ho(e))return pr.FlatObject;if(Xo(e))return pr.AkkoObject;if(mo(e))return pr.Displayer;throw new Error("unrecognized proxy node")}(t)){case pr.FlatObject:return Object;case pr.Array:return Array;case pr.AkkoObject:return function(e){var t=e;if(mo(t)&&(t=t.__proxy),Uo(t))return t.struct.classReflection}(t).clazz}return e.constructor}(e)}}function bs(e){return mr.currentNode?function(e){return(new ns).copyValue(e)}(e):$o(e)}var ks=Y(n(17563)),ws=Y(n(17563)),Ss=Y(n(17563)),xs=Y(n(17563)),Cs=Y(n(17563)),Is=Object.defineProperty,Ps=Object.defineProperties,Ms=Object.getOwnPropertyDescriptors,Ts=Object.getOwnPropertySymbols,As=Object.prototype.hasOwnProperty,Es=Object.prototype.propertyIsEnumerable,Os=function(e,t,n){return t in e?Is(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Rs=function(e,t){for(var n in t||(t={}))As.call(t,n)&&Os(e,n,t[n]);if(Ts){var r,i=T(Ts(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Es.call(t,n)&&Os(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Ns=function(e,t){return Ps(e,Ms(t))},Ls=function(){function e(){C(this,e)}return P(e,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Ds(e)}}]),e}(),js=function(){function e(t){C(this,e),this.callbacks=Object.freeze(this.wrapCallbacks(t))}return P(e,[{key:"wrapCallbacks",value:function(t){var n,r={},i=T(e.callbackKeys);try{var a=function(){var e=n.value,i=t[e];r[e]=i||function(){throw new Error("can't call. ".concat(e," not register"))}};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return Object.freeze(r)}},{key:"convertIdToUrl",value:function(e){return this.callbacks.convertIdToUrl(e)}}]),e}(),Ds=js;Ds.callbackKeys=Object.freeze(["convertIdToUrl"]);var Fs=function(){function e(){C(this,e),this.paddingResolves=[]}return P(e,[{key:"hasValue",get:function(){return!this.paddingResolves}},{key:"getValueRightNow",value:function(){return this.value}},{key:"getValue",value:function(){var e=this;return this.hasValue?this.error?Promise.reject(this.error):Promise.resolve(this.value):new Promise((function(t,n){return e.paddingResolves.push({resolve:t,reject:n})}))}},{key:"catchError",value:function(e){if(!this.hasValue){var t,n=T(this.paddingResolves);try{for(n.s();!(t=n.n()).done;){(0,t.value.reject)(e)}}catch(e){n.e(e)}finally{n.f()}this.value=void 0,this.error=e,this.paddingResolves=null}return this}},{key:"setValue",value:function(e){if(this.hasValue)throw new Error("did set value");this.value=e,this.error=void 0;var t,n=T(this.paddingResolves);try{for(n.s();!(t=n.n()).done;){(0,t.value.resolve)(e)}}catch(e){n.e(e)}finally{n.f()}return this.paddingResolves=null,this}}]),e}(),zs=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,n.createMessage(e))).name=e.title,r.title=e.title,r.messages=e.messages?Object.freeze(p(e.messages)):n.emptyArray,r.statusCode=e.statusCode,r.errorCode=e.errorCode,r}return P(n,null,[{key:"createMessage",value:function(e){var t=e.title;return e.messages&&e.messages.length>0&&(t+=": "+e.messages.join("; ")),t}}]),n}(v(Error)),Bs=zs;Bs.emptyArray=Object.freeze([]);var Us=function(){function e(t,n,r,i){var a=this;C(this,e),this.keyFetcherValue=new Fs,this.akkoVersionValue=n,t.getValue().then((function(e){return a.keyFetcherValue.setValue(e.getFetcher(r).fetch(i))})).catch((function(e){return a.keyFetcherValue.catchError(e)}))}var t,n,r;return P(e,[{key:"akkoVersion",get:function(){return this.akkoVersionValue.getValue()}},{key:"fetchJSON",value:(r=u(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyFetcherValue.getValue();case 2:return e.t0=e.sent,e.next=5,(0,e.t0)(t,n);case 5:if(r=e.sent,!this.isSuccessStatus(r,n)){e.next=13;break}return e.next=9,r.text();case 9:return i=e.sent,e.abrupt("return",""===i?void 0:JSON.parse(i));case 13:return e.next=15,this.createError(r);case 15:throw e.sent;case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"fetchBuffer",value:(n=u(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyFetcherValue.getValue();case 2:return e.t0=e.sent,e.next=5,(0,e.t0)(t,n);case 5:if(404!==(r=e.sent).status){e.next=8;break}return e.abrupt("return",null);case 8:if(!this.isSuccessStatus(r,n)){e.next=23;break}if(!r.arrayBuffer){e.next=17;break}return e.t2=be,e.next=13,r.arrayBuffer();case 13:e.t3=e.sent,e.t1=(0,e.t2)(e.t3),e.next=22;break;case 17:return e.t4=be,e.next=20,r.buffer();case 20:e.t5=e.sent,e.t1=(0,e.t4)(e.t5);case 22:return e.abrupt("return",e.t1);case 23:return e.next=25,this.createError(r);case 25:throw e.sent;case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"createError",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.headers.get("content-type"))&&!/application\/json/i.test(n)){e.next=17;break}return e.prev=2,e.next=5,t.json();case 5:r=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",new Error("response with status "+t.status+" and parse error JSON failed: "+e.t0.message));case 11:if("object"==M(r.error)&&null!==r.error){e.next=13;break}return e.abrupt("return",new Error("response with status "+t.status+" without error object"));case 13:return i=r.error,a=i.code,o=i.title,s=i.messages,e.abrupt("return",new Bs({statusCode:t.status,errorCode:a,title:o,messages:s}));case 17:return e.t1=Error,e.t2="response with status "+t.status+" with text ",e.next=21,t.text();case 21:return e.t3=e.sent,e.t4=e.t2+e.t3,e.abrupt("return",new e.t1(e.t4));case 24:case"end":return e.stop()}}),e,null,[[2,8]])}))),function(e){return t.apply(this,arguments)})},{key:"isSuccessStatus",value:function(e,t){var n=e.status;switch(t&&t.method||"get"){case"get":return 200===n||206===n;case"delete":return 204===n;default:return 201===n}}}]),e}(),Vs=function(){function e(t,n){C(this,e),this.configmap=t,this.onIngoreFetchError=n,this.fetchers={},this.supportRegions=this.collectRegions(t)}return P(e,[{key:"collectRegions",value:function(e){var t={};for(var n in e)for(var r in e[n].hosts)t[r]=!0;return t}},{key:"getFetcher",value:function(e){var t=this.fetchers[e];if(!t){if(!this.supportRegions[e])throw new Error("invalid region ".concat(JSON.stringify(e)));t=this.fetchers[e]=new mn({fetcher:fetch.bind(window),region:e,configmap:this.configmap,onIngoreFetchError:this.onIngoreFetchError,retryCount:2,retryLoopsCount:0})}return t}}]),e}();function Ws(e){if("object"==M(e)&&null!==e){for(var t in e)Ws(e[t]);Object.freeze(e)}return e}function Hs(e){if("object"!=M(e)||null===e)return e;if(e instanceof Array){for(var t=[],n=0;n<e.length;++n)t[n]=Hs(e[n]);return t}var r={};for(var i in e)r[i]=Hs(e[i]);return r}var _s,Gs=function(){function e(){C(this,e),this.node=null}var t,n;return P(e,[{key:"getAkkoAppConfigs",value:(n=u(regeneratorRuntime.mark((function e(t,n,r){var i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node&&this.node.appIdentifier===t||(i=new Fs,this.node=Object.freeze({appIdentifier:t,configsValue:i}),this.fetchAkkoAppConfigs(t,n,r).then((function(e){return i.setValue(Ws(e))})).catch((function(e){i.catchError(e),setTimeout((function(){return a.node=null}),0)}))),e.t0=Hs,e.next=4,this.node.configsValue.getValue();case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchAkkoAppConfigs",value:(t=u(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Vs({api:{hosts:{"*":n}}},r),a=(new Fs).setValue(i),o=new Fs,s=new Us(a,o,"*","api"),c=(0,ks.stringify)({app:t}),e.next=3,s.fetchJSON("https://shunt-api/v5/configs/regions?".concat(c));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),Ys=new Gs;function Xs(e,t,n){return Ys.getAkkoAppConfigs(e,t,n)}!function(e){e[e.Ready=0]="Ready",e[e.Setuping=1]="Setuping",e[e.Fail=2]="Fail"}(_s||(_s={}));var Qs=function(){function e(t){var n=this;C(this,e),this.fetcherPhase=1,this.getAkkoFetcher=function(){var e=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 2===n.fetcherPhase&&n.setupFetcher(),e.next=3,n.fetchersHubValue.getValue();case 3:return e.abrupt("return",e.sent.getFetcher(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onIngoreFetchError=function(e){console.warn("fetch failed but ignore: ".concat(e.message))},this.params=Object.freeze(Ns(Rs({},t),{shuntApiHosts:Object.freeze(p(t.shuntApiHosts))})),this.akkoVersionValue=new Fs,this.setupFetcher()}var t;return P(e,[{key:"create",value:function(e){return new Ks(this.fetchersHubValue,this.akkoVersionValue,this.getAkkoFetcher,e)}},{key:"setupFetcher",value:(t=u(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.params,n=t.appIdentifier,r=t.shuntApiHosts,i=t.onInterruptConfigs,a=t.onAkkoSetupFailed,e.prev=1,this.fetchersHubValue=new Fs,this.fetcherPhase=1,e.next=5,Xs(n,r,this.onIngoreFetchError);case 5:o=e.sent,i&&(o=i(o)),this.akkoVersionValue.setValue(o.akkoVersion),this.fetchersHubValue.setValue(new Vs(o.configmap,this.onIngoreFetchError)),this.fetcherPhase=0,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.fetchersHubValue.catchError(new Error("akko setup failed: ".concat(e.t0.message))),this.fetcherPhase=2,a&&a(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return t.apply(this,arguments)})}]),e}(),Ks=function(){function e(t,n,r,i){C(this,e),this.fetchersHubValue=t,this.akkoVersionValue=n,this.getAkkoFetcher=r,this.region=i}var t,n;return P(e,[{key:"fetch",value:(n=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Us(this.fetchersHubValue,this.akkoVersionValue,this.region,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"origin",value:(t=u(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAkkoFetcher(this.region);case 2:return e.abrupt("return",e.sent.origin(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"reportSuccess",value:function(e,t){this.getAkkoFetcher(this.region).then((function(n){n.reportSuccess(e,t)}))}},{key:"reportFail",value:function(e,t){this.getAkkoFetcher(this.region).then((function(n){n.reportFail(e,t)}))}},{key:"akkoVersion",get:function(){return this.akkoVersionValue.getValue()}}]),e}(),qs=function(){function e(t,n){var r=this;C(this,e),this.netState=t,this.onNetStateUpdate=n,this.paddingResolver=[],this._didDispose=!1,this.onOnline=function(){r._isOnline=!0,r.onNetStateUpdate&&r.onNetStateUpdate(!0),r.handleAllPaddingResolver(!0)},this.onOffline=function(){r._isOnline=!1,r.onNetStateUpdate&&r.onNetStateUpdate(!1)},t.addListener(this.listener={onOnline:this.onOnline,onOffline:this.onOffline}),this._isOnline=t.isOnline}return P(e,[{key:"isOnline",get:function(){return this._isOnline}},{key:"didDispose",get:function(){return this._didDispose}},{key:"dispose",value:function(){try{this.handleAllPaddingResolver(!1),this.netState.removeListener(this.listener)}finally{this._didDispose=!0}}},{key:"makeSureOnline",value:function(){var e=this;return this._didDispose?Promise.resolve(!1):this._isOnline?Promise.resolve(!0):new Promise((function(t){e.paddingResolver.push(t)}))}},{key:"handleAllPaddingResolver",value:function(e){var t,n=T(this.paddingResolver.splice(0,this.paddingResolver.length));try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(e){n.e(e)}finally{n.f()}}}]),e}();var Zs="undefined"!=typeof WebSocket?WebSocket:n.g.WebSocket;var Js=function(){function e(t,n){var r=this,i=n.logger,a=n.timeout,o=n.roomToken,s=n.webSocketQuery,c=n.callbacks;C(this,e),this.disconnectedCallbacks=[],this.actionFramesInterrupter=[],this.snapshotFrameInterrupter=null,this._connectingDuration=-1,this.onReceiveSnapshotFrame=function(e){r.snapshotFrameInterrupter=e},this.onReceiveActionFrame=function(e){r.actionFramesInterrupter?r.actionFramesInterrupter.push(e):r.callbacks.onReceivedActionFrame(e)},this.onReceiveScopeSlices=function(e){r.callbacks.onReceivedScopeSlices(function(e){for(var t=new Yt(e),n=[],r=t.readUint32(),i=0;i<r;++i){var a=t.readInt53(),o=t.readUint32();n.push(Object.freeze({beginScopeId:a,count:o}))}return Object.freeze(n)}(e))},this.onHangUp=function(){r.socket.disconnect(),r.callbacks.onKickWithReason(yi.GatewayAdjust)},this.onDisconnect=function(e){var t=e.reason,n=e.message,i=r.isConnected();r._sessionBuild=void 0;var a=t===Dn.WebSocketError||t===Dn.CommunicationError;if(r.disconnectedCallback(n,a),i)switch(t){case Dn.WebSocketError:case Dn.CommunicationError:r.callbacks.onDisconnectedWithSocketError(new Error(n));break;case Dn.Normal:r.callbacks.onKickWithReason(n);break;case Dn.RemoteError:r.callbacks.onDisconnectedByServer(new Error(n))}};var u="".concat(t,"?").concat(function(e,t){var n={room:t.uuid,token:e,combinable:!0,sessionToken:t.sessionToken,akkoVersion:t.akkoVersion,clientVersion:t.clientVersion,markWritable:t.markWritable,access:t.access};for(var r in n)void 0===n[r]&&delete n[r];return(0,ws.stringify)(n)}(o,s)),l=new Zs(u);this.logger=i,this.timeout=a,this.uuid=s.uuid,this.libraryDescriptionSerialization=new Fi,this.socket=Wi.createSocket(l,i,{onDisconnect:this.onDisconnect}),this.socket.on("snapshot",this.onReceiveSnapshotFrame),this.socket.on("action",this.onReceiveActionFrame),this.socket.on("allocate-scope",this.onReceiveScopeSlices),this.socket.on("hang-up",this.onHangUp),this.callbacks=Object.freeze(Rs({},c))}var t,n;return P(e,[{key:"connectingDuration",get:function(){return this._connectingDuration}},{key:"setAccessUpdaterSerialization",value:function(e){this.accessUpdaterSerialization=e}},{key:"bindPingPongNode",value:function(e){e.bindSocket(this.socket)}},{key:"sessionBuild",get:function(){if(!this._sessionBuild)throw new Error("not connected");return this._sessionBuild}},{key:"sendActionFrame",value:function(e){this.socket.emit("action",e)}},{key:"isConnected",value:function(){return!!this._sessionBuild}},{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var r=function(){var t=e.disconnectedCallbacks.indexOf(a);-1!==t&&e.disconnectedCallbacks.splice(t,1),null!==i&&(clearTimeout(i),i=null),e.socket.off("session-build",o)},i=setTimeout((function(){r(),n(new Error("receive session-build event timeout"))}),e.timeout),a=function(e,i){r(),i?t(e):n(new Error("connect failed: ".concat(e)))};e.disconnectedCallbacks.push(a);var o=function(n){r();var i=e.snapshotFrameInterrupter,a=e.actionFramesInterrupter;e._sessionBuild=function(e){var t=new Yt(e),n=t.readString(),r=t.readString(),i=t.readString();return Object.freeze({session:n,sessionToken:r,slice:i})}(n),e.snapshotFrameInterrupter=null,e.actionFramesInterrupter=null,t({snapshot:i,actionFrames:a})};e.socket.on("session-build",o),e.socket.on("library-description",(function t(n){var r=e.libraryDescriptionSerialization.deserialize(n);e.callbacks.onReceivedLibraryDescription(r),e.socket.off("library-description",t)})),e.socket.waitToConnected().then((function(t){var n=t.duration;return e._connectingDuration=n})).catch((function(t){e.logger.warn(t.message),a(t.message,!0)}))}))}},{key:"disconnect",value:function(){return this.disconnectedCallback("disconnect",!1),this.socket.disconnect()}},{key:"disconnectWithError",value:function(e){return this.disconnectedCallback(e.message,!1),this.socket.disconnectWithErrorDescription({message:e.message})}},{key:"updateToWritable",value:(n=u(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={kind:ki.Writable,userPayload:t,connectedPayload:n},this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(r)),e.next=4,this.interruptEvent("allocate-user",[Vi.WritableAccessForbidden,Vi.StuffedOfWritableUsers,Vi.WrongWritablePhase]);case 4:if(void 0===(i=e.sent).errorCode){e.next=12;break}e.t0=i.errorCode,e.next=e.t0===Vi.WritableAccessForbidden?9:e.t0===Vi.StuffedOfWritableUsers?10:e.t0===Vi.WrongWritablePhase?11:12;break;case 9:throw new Error("can't update to writable. you don't have permission");case 10:throw new Error("room is stuffed of writable users");case 11:throw new Error("it's wrong writable phase");case 12:return e.abrupt("return",void 0!==i.target?Li(i.target):null);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"updateToReadonly",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={kind:ki.Readonly,payload:t},this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(n)),e.next=4,this.interruptEvent("release-user",[Vi.NoUserToRelease,Vi.WrongWritablePhase]);case 4:if(void 0===(r=e.sent).errorCode){e.next=11;break}e.t0=r.errorCode,e.next=e.t0===Vi.NoUserToRelease?9:e.t0===Vi.WrongWritablePhase?10:11;break;case 9:throw new Error("room don't have user to release");case 10:throw new Error("it's wrong writable phase");case 11:return e.abrupt("return",void 0!==r.target);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disconnectedCallback",value:function(e,t){var n,r=T(this.disconnectedCallbacks.splice(0));try{for(r.s();!(n=r.n()).done;){(0,n.value)(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"interruptEvent",value:function(e,t){var n=this;return new Promise((function(r){var i=function(){var t=n.disconnectedCallbacks.indexOf(a);-1!==t&&n.disconnectedCallbacks.splice(t,1),n.socket.off(e,o),n.socket.off("error",s)},a=function(){i(),r({})};n.disconnectedCallbacks.push(a);var o=function(e){i(),r({target:e})},s=function(e){-1!==t.indexOf(e)&&(i(),r({errorCode:e}))};n.socket.on(e,o),n.socket.on("error",s)}))}}]),e}(),$s=function(){function e(){C(this,e),this.switchOn=!0}return P(e,[{key:"wrapCallbacks",value:function(e){var t=this,n={},r=function(r){var i=e[r];n[r]="function"==typeof i?function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.switchOn)return i.apply(n,r)}:i};for(var i in e)r(i);return Object.freeze(n)}}]),e}(),ec=Object.freeze([1e3,1e3,1e3,3e3,3e3,5e3,5e3]);function tc(e){return new Promise((function(t){return setTimeout(t,e)}))}var nc=function(){function e(t,n,r){var i=this;C(this,e),this._didDispose=!1,this.connectionTask=null,this.operator=null,this.connectionNode=null,this.onNetStateUpdate=function(e){i._didDispose||(e?i.connectionTask&&i.startConnectionTask():i.operator&&(i.operator.cancel(),i.operator=null))},this.logger=t,this.fetcher=n,this.netStatePaddingNode=r&&new qs(r,this.onNetStateUpdate)}var t;return P(e,[{key:"dispose",value:function(){this._didDispose||(this._didDispose=!0,this.operator&&this.operator.cancel(),this.connectionTask=null,this.operator=null,this.netStatePaddingNode&&this.netStatePaddingNode.dispose())}},{key:"connect",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._didDispose){e.next=2;break}throw new Error("did dispose");case 2:if(!this.connectionTask){e.next=4;break}throw new Error("is connecting");case 4:if(this.connectionNode&&(this.connectionNode.filter.switchOn=!1,this.connectionNode=null),e.t0=this.netStatePaddingNode,!e.t0){e.next=10;break}return e.next=9,this.netStatePaddingNode.makeSureOnline();case 9:e.t0=!e.sent;case 10:if(!e.t0){e.next=12;break}throw new Error("offline");case 12:return n=new Promise((function(e,n){var i=new $s;r.connectionTask={resolve:e,reject:n,filter:i,params:Ns(Rs({},t),{callbacks:i.wrapCallbacks(t.callbacks)})}})),this.startConnectionTask(),e.prev=14,e.next=17,n;case 17:return e.abrupt("return",e.sent);case 18:return e.prev=18,this.connectionTask=null,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[14,,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"startConnectionTask",value:function(){var e=this,t=new rc(this.logger,this.fetcher),n=this.connectionTask,r=n.params,i=n.filter,a=n.resolve,o=n.reject;this.operator=t,this.operator.connect(r).then((function(n){n&&t===e.operator&&(a(n),e.operator=null,e.connectionNode={filter:i,connection:n.connection})})).catch((function(n){t===e.operator&&(o(n),e.operator=null)}))}}]),e}(),rc=function(){function e(t,n){C(this,e),this.logger=t,this.fetcher=n,this.connection=null,this.isCancel=!1}var t;return P(e,[{key:"connect",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",r=0;case 2:if(!(r<ec.length+1)){e.next=33;break}return e.next=5,this.fetcher.origin("wss","realtime");case 5:return i=e.sent,a=Date.now(),this.connection=new Js(i,t),o=Date.now(),e.next=11,this.connection.connect();case 11:if(s=e.sent,!this.isCancel){e.next=19;break}if(this.fetcher.reportSuccess("realtime",Date.now()-a),e.t0=s&&this.connection,!e.t0){e.next=18;break}return e.next=18,this.connection.disconnectWithError(new Error("cancel connect"));case 18:return e.abrupt("return",null);case 19:if("object"!=M(s)){e.next=21;break}return e.abrupt("return",(this.fetcher.reportSuccess("realtime",Date.now()-a),{connection:this.connection,snapshot:s.snapshot,actionFrames:s.actionFrames,retryCount:r}));case 21:if(this.fetcher.reportFail("realtime",Date.now()-a),n=s,this.connection=null,c=ec[r],e.t1=void 0!==c&&o+c-Date.now()>0,!e.t1){e.next=28;break}return e.next=27,tc(c);case 27:e.t1=this.isCancel;case 28:if(!e.t1){e.next=30;break}return e.abrupt("return",null);case 30:++r,e.next=2;break;case 33:throw new Error("connect fail after multiple retries: "+n);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"cancel",value:function(){var e=this;this.connection&&(this.connection.disconnectWithError(new Error("cancel connect")).catch((function(t){return e.logger.error(t)})),this.connection=null),this.isCancel=!0}}]),e}();function ic(e){var t=Si(e);if(!t)throw new Error("can't find library from ".concat(e.name,". it's not root class"));return t}var ac=function(){};function oc(e){return sc.apply(this,arguments)}function sc(){return sc=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new uc(t),e.next=3,n.connect();case 3:return r=e.sent,e.abrupt("return",{session:n,snapshot:r.snapshot,actionFrames:r.actionFrames,connection:r.connection,retryCount:r.retryCount});case 5:case"end":return e.stop()}}),e)}))),sc.apply(this,arguments)}var cc,uc=function(){function e(t){var n=this;C(this,e),this.connectingResult=null,this._connection=null,this._libraryNode=null,this.onDisconnectedByServer=function(e){n._connection=null,n._libraryNode=null,n.callbacks.onDisconnectedByServer&&n.callbacks.onDisconnectedByServer(e)},this.onKickWithReason=function(e){n._connection=null,n._libraryNode=null,n.reconnectionOptions.disableReconnect||e!==yi.GatewayAdjust&&e!==yi.RoomZombie?n.callbacks.onKickWithReason&&n.callbacks.onKickWithReason(e):n.startReconnect(new Error("room became zombie"))},this.onDisconnectedWithSocketError=function(){var e=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._connection=null,n._libraryNode=null,!n.reconnectionOptions.disableReconnect){e.next=6;break}n.callbacks.onDisconnectedWithSocketError&&n.callbacks.onDisconnectedWithSocketError(t),e.next=8;break;case 6:return e.next=8,n.startReconnect(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.logger=t.logger,this.uuid=t.uuid,this.roomToken=t.roomToken,this.timeout=t.timeout,this.markWritable=t.markWritable,this.clientVersion=t.clientVersion,this.reconnectionOptions=t.reconnectionOptions,this.access=t.access,this.objectOperator=t.objectOperator,this.libraryNodeFetcher=t.libraryNodeFetcher,this.connectionBuilder=new nc(t.logger,t.fetcher,t.netState),this.callbacks=Object.freeze(Rs({},t.callbacks))}var t,n;return P(e,[{key:"session",get:function(){return this.sessionBuild.session}},{key:"slice",get:function(){return this.sessionBuild.slice}},{key:"connection",get:function(){return this._connection}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"dispose",value:function(){this.connectionBuilder.dispose()}},{key:"connect",value:(n=u(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connectingResult){e.next=2;break}throw new Error("WebSocketSession is connecting");case 2:return t=new Fs,n=this.connectingResult=new Fs,e.prev=3,e.next=6,this.connectionBuilder.connect({logger:this.logger,roomToken:this.roomToken,timeout:this.timeout,webSocketQuery:{uuid:this.uuid,akkoVersion:He,clientVersion:this.clientVersion,markWritable:this.markWritable,access:this.access,sessionToken:this.sessionBuild&&this.sessionBuild.sessionToken},callbacks:{onReceivedLibraryDescription:this.createLibraryDescriptionReceiver(t),onReceivedActionFrame:this.callbacks.onReceivedActionFrame||ac,onReceivedScopeSlices:this.callbacks.onReceivedScopeSlices||ac,onDisconnectedByServer:this.onDisconnectedByServer,onKickWithReason:this.onKickWithReason,onDisconnectedWithSocketError:this.onDisconnectedWithSocketError}});case 6:return r=e.sent,this.sessionBuild&&(i=r.connection.sessionBuild,a=i.session,o=i.slice,this.callbacks.onSessionUpdate&&this.sessionBuild.session!==a&&this.callbacks.onSessionUpdate(a),this.callbacks.onSliceUpdate&&this.sessionBuild.slice!==o&&this.callbacks.onSliceUpdate(o)),this._connection=r.connection,e.next=11,t.getValue();case 11:return this._libraryNode=e.sent,this.sessionBuild=r.connection.sessionBuild,this._connection.setAccessUpdaterSerialization(new Di(this.objectOperator,ic(this._libraryNode.libraryClass))),this.connectingResult=null,n.setValue(r),e.abrupt("return",r);case 19:throw e.prev=19,e.t0=e.catch(3),t.catchError(e.t0),n.catchError(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[3,19]])}))),function(){return n.apply(this,arguments)})},{key:"reconnectWithError",value:function(e){this._connection&&(this._connection.disconnect(),this._connection=null,this._libraryNode=null),this.startReconnect(e)}},{key:"createLibraryDescriptionReceiver",value:function(e){var t=this;return function(){var n=u(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=e,n.next=4,t.libraryNodeFetcher(r);case 4:n.t1=n.sent,n.t0.setValue.call(n.t0,n.t1),n.next=11;break;case 8:n.prev=8,n.t2=n.catch(0),e.catchError(n.t2);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()}},{key:"startReconnect",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connectingResult){e.next=5;break}return e.next=3,this.connectingResult.getValue();case 3:e.next=0;break;case 5:return e.prev=5,n=this.callbacks,r=n.onBeginReconnect,i=n.onReconnected,r&&Promise.resolve().then((function(){return r(t)})),e.next=10,this.connect();case 10:a=e.sent,i&&Promise.resolve().then((function(){return i(a)})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),this.callbacks.onDisconnectedWithSocketError&&this.callbacks.onDisconnectedWithSocketError(e.t0);case 17:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e){return t.apply(this,arguments)})}]),e}(),lc=Object.freeze({disableReconnect:!1});!function(e){e[e.Success=0]="Success",e[e.Break=1]="Break"}(cc||(cc={}));var hc=function(){function e(t){var n=this;C(this,e),this.idle=Fe({timeout:800,checkingTimeMod:2,maxPaddingDuration:1600,maxInvokingDuration:100}),this.nextId=0,this.socket=null,this.pingProgress=null,this.promiseSleep=null,this.deltaTime=void 0,this.latestAdjustedTimestamp=0,this.isFirstAdjustedTime=!0,this.onPong=function(e){var t=Bi(e),r=t.id,i=t.timestamp;if(n.pingProgress){var a=n.pingProgress,o=a.id,s=a.timestamp,c=a.handlers;if(o===r){var u,l={remoteTimestamp:i,shouldBreak:!1,sendAt:s,receivedAt:Date.now()},h=T(c);try{for(h.s();!(u=h.n()).done;){var d=u.value,p=d.resolve,f=d.timer;clearTimeout(f),p(l)}}catch(e){h.e(e)}finally{h.f()}n.pingProgress=null}}},this.onPingFailed=t}var t,n;return P(e,[{key:"calibrationTimestamp",get:function(){if(void 0===this.deltaTime)return Date.now();var e=Math.max(this.latestAdjustedTimestamp,Date.now()+this.deltaTime);return this.latestAdjustedTimestamp=e,e}},{key:"bindSocket",value:function(e){this.socket&&this.unbindSocket(),this.socket=e,this.socket.on("pong",this.onPong),this.handleStartPingLoop().catch(this.onPingFailed)}},{key:"unbindSocket",value:function(){if(this.socket&&(this.socket.off("pong",this.onPong),this.socket=null),this.promiseSleep&&(clearTimeout(this.promiseSleep.sleepTimer),this.promiseSleep.resolve(1),this.promiseSleep=null),this.pingProgress){var e,t={shouldBreak:!0,remoteTimestamp:0,sendAt:0,receivedAt:0},n=T(this.pingProgress.handlers);try{for(n.s();!(e=n.n()).done;){(0,e.value.resolve)(t)}}catch(e){n.e(e)}finally{n.f()}this.pingProgress=null}}},{key:"handleStartPingLoop",value:(n=u(regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=regeneratorRuntime.mark((function t(){var n,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=0,i=0,t.next=4,r.doProgress(r.onPingFailed,u(regeneratorRuntime.mark((function t(){var a,o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.ping(e.pongTimeout);case 2:if(a=t.sent,o=a.shouldBreak,s=a.remoteTimestamp,c=a.sendAt,u=a.receivedAt,!o){t.next=9;break}return t.abrupt("return",1);case 9:return l=u-c,t.abrupt("return",(n+=s+l/2-u,i+=1,r.isFirstAdjustedTime&&r.updateDeltaTime(Math.floor(n/i)),0));case 11:case"end":return t.stop()}}),t)}))));case 4:if(a=t.sent,t.t0=1===a,t.t0){t.next=12;break}return r.isFirstAdjustedTime?r.isFirstAdjustedTime=!1:i>=(e.processTimeIntervalList.length+1)/2&&r.updateDeltaTime(Math.floor(n/i)),t.next=10,r.sleep(r.withFloatRate(e.processInterval));case 10:a=t.sent,t.t0=1===a;case 12:if(!t.t0){t.next=14;break}return t.abrupt("return","break");case 14:case"end":return t.stop()}}),t)}));case 1:if(!this.socket){t.next=8;break}return t.delegateYield(n(),"t0",3);case 3:if("break"!==t.t0){t.next=6;break}return t.abrupt("break",8);case 6:t.next=1;break;case 8:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"updateDeltaTime",value:function(e){this.deltaTime=e}},{key:"doProgress",value:(t=u(regeneratorRuntime.mark((function t(n,r){var i,a,o,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,t.prev=1,t.next=4,r();case 4:i=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),n(t.t0);case 10:if(0!==i){t.next=43;break}a=T(e.processTimeIntervalList),t.prev=12,a.s();case 14:if((o=a.n()).done){t.next=35;break}return s=o.value,t.prev=16,t.next=19,this.sleep(this.withFloatRate(s));case 19:if(i=t.sent,t.t1=1===i,t.t1){t.next=26;break}return t.next=24,r();case 24:i=t.sent,t.t1=1===i;case 26:if(!t.t1){t.next=28;break}return t.abrupt("break",35);case 28:t.next=33;break;case 30:t.prev=30,t.t2=t.catch(16),n(t.t2);case 33:t.next=14;break;case 35:t.next=40;break;case 37:t.prev=37,t.t3=t.catch(12),a.e(t.t3);case 40:return t.prev=40,a.f(),t.finish(40);case 43:return t.abrupt("return",i);case 44:case"end":return t.stop()}}),t,this,[[1,7],[12,37,40,43],[16,30]])}))),function(e,n){return t.apply(this,arguments)})},{key:"ping",value:function(e){var t=this;return new Promise((function(n,r){var i,a,o=Date.now();t.pingProgress?(i=t.pingProgress.id,a=t.pingProgress.handlers):(i=t.getNextId(),a=[],t.pingProgress={id:i,timestamp:o,handlers:a},t.idle.invokeOnIdle((function(){var e;null==(e=t.socket)||e.emit("ping",zi({id:i,timestamp:o}))})).catch((function(e){if(t.pingProgress){var n,r=T(t.pingProgress.handlers);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.reject(e),clearTimeout(i.timer)}}catch(e){r.e(e)}finally{r.f()}t.pingProgress=null}})));var s={resolve:n,reject:r,timer:setTimeout((function(){t.pingProgress&&t.pingProgress.id===i&&t.removeHandler(s)&&s.reject(new Error("pong timeout"))}),e)};a.push(s)}))}},{key:"removeHandler",value:function(e){var t=!1;if(this.pingProgress){var n=this.pingProgress.handlers,r=n.indexOf(e);r>=0&&(n.splice(r,1),0===n.length&&(this.pingProgress=null),t=!0)}return t}},{key:"getNextId",value:function(){this.nextId>e.maxId&&(this.nextId=0);var t=this.nextId;return this.nextId+=1,t}},{key:"withFloatRate",value:function(t){var n=1-e.timeFloatRate+2*e.timeFloatRate*Math.random();return Math.floor(n*t)}},{key:"sleep",value:function(e){var t=this;if(this.promiseSleep)throw new Error("did call sleep");return new Promise((function(n){var r=setTimeout((function(){t.promiseSleep=null,n(0)}),e);t.promiseSleep={resolve:n,sleepTimer:r}}))}}]),e}(),dc=hc;dc.maxId=Math.pow(2,32)-1,dc.pongTimeout=6e3,dc.timeFloatRate=.35,dc.processInterval=3e5,dc.processTimeIntervalList=Object.freeze([5e3,7e3,12e3,15e3]);var pc,fc,vc=function(){function e(t){var n=this;C(this,e),this.invoker=t,this.animationFrameId=null,this.shouldInvokeNextFrame=!1,this.blockInvoke=!1,this.fireTick=function(){if(n.shouldInvokeNextFrame)try{n.invoker()}catch(e){console.error(e)}n.shouldInvokeNextFrame=!1,n.blockInvoke=!1,n.animationFrameId=null}}return P(e,[{key:"invoke",value:function(){if(this.blockInvoke)this.shouldInvokeNextFrame=!0;else{try{this.invoker()}catch(e){console.error(e)}null===this.animationFrameId&&(this.animationFrameId=window.requestAnimationFrame(this.fireTick)),this.blockInvoke=!0}}}]),e}();!function(e){e.Playing="playing",e.Pausing="pausing",e.PausingAndWaiting="pausingAndWaiting",e.Waiting="waiting",e.Ended="ended"}(pc||(pc={})),function(e){e[e.AutoBlockNewFrames=0]="AutoBlockNewFrames",e[e.DoNotBlockNewFrames=1]="DoNotBlockNewFrames"}(fc||(fc={}));var mc,gc=function(){function e(){C(this,e),this.blockMode=1,this.queue=[],this.blockIndex=this.queue.length}return P(e,[{key:"hasFrames",get:function(){return this.queue.length>0}},{key:"hasAccessibleFrames",get:function(){return this.blockIndex>0}},{key:"hasBlockedFrames",get:function(){return this.queue.length>this.blockIndex}},{key:"accessibleLength",get:function(){return this.blockIndex}},{key:"rearFrame",get:function(){return this.frameAt(0)}},{key:"latestFrameIncludesBlocked",get:function(){var e;return null==(e=this.queue[this.queue.length-1])?void 0:e.proto}},{key:"blockedFrame",get:function(){var e;return null==(e=this.queue[this.blockIndex])?void 0:e.proto}},{key:"blockedReceivedAt",get:function(){var e=this.queue[this.blockIndex];return e?e.receivedAt:-1}},{key:"timeInterval",get:function(){if(this.blockIndex>0){var e=this.queue[this.blockIndex-1],t=this.queue[0];return e.proto.timestamp-t.proto.timestamp}return 0}},{key:"timeIntervalBefore",value:function(e){var t,n=0,r=null==(t=this.queue[0])?void 0:t.proto.timestamp;if(void 0!==r){for(var i=-1,a=this.blockIndex-1;a>=0;--a){var o=this.queue[a];if(o.proto.timestamp<=e){i=o.proto.timestamp;break}}-1!==i&&(n=i-r)}return n}},{key:"frameAt",value:function(e){if(e<this.blockIndex)return this.queue[e].proto}},{key:"push",value:function(e){var t=Date.now();1===this.blockMode&&(this.blockIndex+=e.length);var n,r=T(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.queue.push({proto:i,receivedAt:t})}}catch(e){r.e(e)}finally{r.f()}}},{key:"shift",value:function(){var e;if(this.frameAt(0))return this.blockIndex-=1,null==(e=this.queue.shift())?void 0:e.proto}},{key:"unblockOneFrame",value:function(){this.blockIndex<this.queue.length&&(this.blockIndex+=1)}}]),e}();!function(e){e.Realtime="realtime",e.Reconstruction="reconstruction"}(mc||(mc={}));var yc=function(){function e(t){var n=this;C(this,e),this.framesQueue=new gc,this.isPlaying=!1,this._didCompletePushFrames=!1,this.didCompletePlaying=!1,this.handleTickEvent=function(){try{n.onTick()}finally{n.shouldTickNextFrame()&&n.tickLimiter.invoke(),n.phaseNode.touch()}},this.currentPhase=function(){return n.didCompletePlaying?pc.Ended:n._didCompletePushFrames||n.framesQueue.hasAccessibleFrames?n.isPlaying?pc.Playing:pc.Pausing:n.isPlaying?pc.Waiting:pc.PausingAndWaiting},this.onPhaseChanged=function(e,t){t===pc.Playing&&e!==pc.Playing?n.onPlayingStop():t!==pc.Playing&&e===pc.Playing&&n.onPlayingContinue(),n.callbacks.onPhaseChanged&&n.callbacks.onPhaseChanged(e)},this.logger=t.logger,this.mode=t.mode,this.callbacks=Object.freeze(Rs({},t.callbacks));var r=t.enableAnimationFrame,i=t.frameInterval,a=void 0===i?17:i,o=t.remainLowTimeInterval,s=void 0===o?12e3:o;if(r){var c=new vc(this.handleTickEvent);this.tickLimiter=new Ue(a,(function(){return c.invoke()}))}else this.tickLimiter=new Ue(a,this.handleTickEvent);this.remainLowTimeInterval=s,this.phaseNode=new si({getCurrentPhase:this.currentPhase,onPhaseChanged:this.onPhaseChanged})}return P(e,[{key:"didCompletePushFrames",get:function(){return this._didCompletePushFrames}},{key:"completePlaying",value:function(){this.didCompletePlaying=!0,this.phaseNode.touch(),this.tickLimiter.cancel()}},{key:"frameInterval",get:function(){return this.tickLimiter.limitDuration},set:function(e){this.tickLimiter.limitDuration=e}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"shouldTickNextFrame",value:function(){return!this.didCompletePlaying&&(!!this.willTickEveryFrames||!(!this.isPlaying||!this.framesQueue.hasFrames))}},{key:"pushFrames",value:function(e){this.framesQueue.push(e),e.length>0&&this.isPlaying&&this.tickLimiter.invoke(),this.phaseNode.touch()}},{key:"play",value:function(){!this.isPlaying&&this.phaseNode.phase!==pc.Ended&&(this.isPlaying=!0,this.framesQueue.hasAccessibleFrames&&this.tickLimiter.invoke(),this.phaseNode.touch())}},{key:"pause",value:function(){this.isPlaying&&(this.isPlaying=!1,this.tickLimiter.cancel(),this.phaseNode.touch())}},{key:"completePushFrames",value:function(){this._didCompletePushFrames=!0,this.framesQueue.hasAccessibleFrames||(this.didCompletePlaying=!0,this.tickLimiter.cancel()),this.phaseNode.touch()}}]),e}(),bc=function(){function e(t,n){C(this,e),this.lastTimestamp=0,this.targetValue=t,this._momentValue=t,this.halfLifeInterval=n}return P(e,[{key:"value",get:function(){return this.targetValue},set:function(e){this.targetValue!==e&&(this.targetValue!==this._momentValue&&this.refreshMomentValue(),this.targetValue=e)}},{key:"momentValue",get:function(){return this.targetValue!==this._momentValue&&this.refreshMomentValue(),this._momentValue}},{key:"refreshMomentValue",value:function(){var t,n=Date.now(),r=n-this.lastTimestamp;if(r>this.halfLifeInterval*e.convergenceTimes)t=this.targetValue;else{var i=Math.pow(.5,r/this.halfLifeInterval);t=this._momentValue*i+this.targetValue*(1-i),Math.abs(t-this.targetValue)<e.minNumber&&(t=this.targetValue)}this._momentValue=t,this.lastTimestamp=n}}]),e}(),kc=bc;kc.convergenceTimes=6,kc.minNumber=.01;var wc=Object.freeze([Object.freeze({duration:1200,rate:1}),Object.freeze({duration:1e3,rate:.75}),Object.freeze({duration:3e3,rate:.5}),Object.freeze({duration:5e3,rate:.25})]);var Sc,xc=function(){var e,t=0,n=T(wc);try{for(n.s();!(e=n.n()).done;){t+=e.value.duration}}catch(e){n.e(e)}finally{n.f()}return t}(),Cc=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).latestTimestamp=null,r.syncDelta=null,r.framesQueue.blockMode=fc.AutoBlockNewFrames,r.frameDelayGradient=new kc(e.frameDelay||0,1200),r}return P(n,[{key:"frameDelay",get:function(){return this.frameDelayGradient.value},set:function(e){this.frameDelayGradient.value=e}},{key:"isPlaybackSpeedModifiable",get:function(){return!1}},{key:"playbackSpeed",get:function(){return 1},set:function(e){}},{key:"willTickEveryFrames",get:function(){return!1}},{key:"syncBlockTimestamp",value:function(e){var t=e-Date.now();this.syncDelta?this.syncDelta.value=t:this.syncDelta=new kc(t,1200)}},{key:"stopBlockTimestamp",value:function(){this.syncDelta=null}},{key:"onPlayingContinue",value:function(){}},{key:"onPlayingStop",value:function(){}},{key:"onTick",value:function(){var e=Date.now(),t=[];if(this.unblockFramesIfNeed(e),this.fillOverIntervalFrames(e,t),this.fillShouldPlayFrames(e,t),this.playFrames(t),this.callbacks.onBufferRemainLow&&this.latestTimestamp&&!this.didCompletePushFrames){var n=0;if(this.framesQueue.hasAccessibleFrames)n=this.framesQueue.latestFrameIncludesBlocked.timestamp-this.latestTimestamp.ack;n<this.remainLowTimeInterval&&this.callbacks.onBufferRemainLow()}}},{key:"unblockFramesIfNeed",value:function(e){if(this.syncDelta)for(var t=e+this.syncDelta.momentValue;this.framesQueue.hasBlockedFrames&&this.framesQueue.blockedFrame.timestamp<=t;)this.framesQueue.unblockOneFrame();else for(;this.framesQueue.hasBlockedFrames;){if(!(e>=this.framesQueue.blockedReceivedAt+this.frameDelayGradient.momentValue))break;this.framesQueue.unblockOneFrame()}}},{key:"fillOverIntervalFrames",value:function(e,t){for(;this.framesQueue.timeInterval>xc;)t.push(this.framesQueue.shift());t.length>0&&this.updateLatestTimestamp(e,t[t.length-1])}},{key:"fillShouldPlayFrames",value:function(e,t){for(var n=function(e){var t,n=e,r=T(wc);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(n<=i.duration)return i.rate;n-=i.duration}}catch(e){r.e(e)}finally{r.f()}throw new Error("durationTime is too large:"+n)}(this.framesQueue.timeIntervalBefore(e));this.framesQueue.hasAccessibleFrames;){var r=this.framesQueue.rearFrame,i=!1;if(this.latestTimestamp){var a=r.timestamp-this.latestTimestamp.ack,o=this.latestTimestamp.device+a*n;i=e+this.frameInterval>=o}else i=!0;if(!i)break;t.push(this.framesQueue.shift()),this.updateLatestTimestamp(e,r)}}},{key:"playFrames",value:function(e){if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(e){this.logger.error(e)}}},{key:"updateLatestTimestamp",value:function(e,t){var n=t.timestamp;this.latestTimestamp?(this.latestTimestamp.ack=n,this.latestTimestamp.device=e):this.latestTimestamp={ack:n,device:e}}}]),n}(yc),Ic=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).frameDelay=0,r._playbackSpeed=1,r.endFrameTimestamp=e.endFrameTimestamp,r.anchor={deviceTimestamp:Date.now(),playerTimestamp:e.initFrameTimestamp},r}return P(n,[{key:"syncBlockTimestamp",value:function(e){}},{key:"stopBlockTimestamp",value:function(){}},{key:"play",value:function(){s(x(n.prototype),"play",this).call(this);var e=this.callbacks.onBufferRemainLow;e&&this.isBufferRemainLow&&Promise.resolve().then(e).catch((function(e){return console.error(e)}))}},{key:"isPlaybackSpeedModifiable",get:function(){return!0}},{key:"playbackSpeed",get:function(){return this._playbackSpeed},set:function(e){if(e<0)throw new Error("invalid playback speed ".concat(e,". it shouldn't be nagative number"));if(Number.isNaN(e)||e===1/0)throw new Error("invalid playback speed. it can not be ".concat(e));this._playbackSpeed!==e&&(this.phase===pc.Playing&&this.refreshAnchor(this._playbackSpeed),this._playbackSpeed=e)}},{key:"willTickEveryFrames",get:function(){return!0}},{key:"onPlayingContinue",value:function(){this.refreshAnchor(0)}},{key:"onPlayingStop",value:function(){this.refreshAnchor(this._playbackSpeed)}},{key:"onTick",value:function(){for(var e=[],t=this.playbackSpeed*(Date.now()-this.anchor.deviceTimestamp+this.frameInterval),n=this.anchor.playerTimestamp+t;this.framesQueue.hasAccessibleFrames&&this.framesQueue.rearFrame.timestamp<=n;)e.push(this.framesQueue.shift());if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(r){this.logger.error(r)}if(this.callbacks.onTick)if(e.length>0){var r=e[e.length-1],i=Math.max(this.anchor.playerTimestamp,r.timestamp);this.callbacks.onTick(i,!1)}else this.callbacks.onTick(n,!0);this.callbacks.onBufferRemainLow&&!this.didCompletePushFrames&&this.isBufferRemainLow&&this.callbacks.onBufferRemainLow(),this.didCompletePushFrames&&0===e.length&&void 0!==this.endFrameTimestamp&&n>=this.endFrameTimestamp&&this.completePlaying()}},{key:"refreshAnchor",value:function(e){var t=Date.now(),n=e*(t-this.anchor.deviceTimestamp);this.anchor={deviceTimestamp:t,playerTimestamp:this.anchor.playerTimestamp+n}}},{key:"isBufferRemainLow",get:function(){return this.framesQueue.timeInterval<this.remainLowTimeInterval}}]),n}(yc),Pc=function(){function e(){C(this,e)}return P(e,[{key:"create",value:function(e){switch(e.mode){case mc.Realtime:return new Cc(e);case mc.Reconstruction:return new Ic(e);default:throw new Error("invalid mode ".concat(e.mode))}}}]),e}(),Mc=new Pc,Tc=function(){function e(t){C(this,e),this.latestReceivedFrameId=-1,this.didAssertedCount=0,this.latestReceivedFrameId=t}return P(e,[{key:"assertReceivedFrameId",value:function(e){var t=this.latestReceivedFrameId+1;if(e!==t)throw new Error("Magix want frameId ".concat(t,", instead of ").concat(e," (did asserted ").concat(this.didAssertedCount," frames)"));this.latestReceivedFrameId=e,this.didAssertedCount+=1}}]),e}(),Ac=function(){function e(t){var n,r=this;C(this,e),this.latestTimestamp=null,this.receivedActionFramePicker=function(e){r.frameIdAsserter.assertReceivedFrameId(e.frameId),r.playerBuffer.pushFrames([e])},this.onPlayActionFrames=function(e){r.onFrameReceivedInterval&&e.length>0&&r.onFrameReceivedInterval(r.getFrameReceivedInterval(e));var t,n=[],i=T(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.push(a.frameBuffer)}}catch(e){i.e(e)}finally{i.f()}try{r.image.appendActionFrames(n)}catch(a){if(!r.onClientCrashWithError)throw a;r.onClientCrashWithError(a)}},this.connection=t.connection,this.image=t.imageFactory.createWithSnapshot({logger:t.logger,observerId:an,library:t.library,snapshotFrame:t.snapshot,pendingReportChanged:t.pendingReportChanged,actionFrames:p(t.initializeActionFrames),originalImage:null==(n=t.originalMagixSession)?void 0:n.image,includesFrameHash:!1,ignoreHashChecking:!0,roomUUID:t.connection.uuid,toolsExtra:t.toolsExtra,callbacks:{onModified:t.callbacks.onModified,onPhaseChanged:t.callbacks.onImagePhaseChanged,onGeneratedActionFrame:t.callbacks.onGeneratedActionFrame,onCatchErrorWhenAppendFrame:t.callbacks.onCatchErrorWhenAppendFrame,onReceivedRttReport:t.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:t.callbacks.onIllusionQueueLengthChanged,onEventFire:t.callbacks.onEventFire,onEventFireACK:t.callbacks.onEventFireACK,onClientCrashWithError:t.callbacks.onClientCrashWithError}}),this.frameIdAsserter=new Tc(this.image.frameId),this.playerBuffer=Mc.create({logger:t.logger,mode:mc.Realtime,frameDelay:t.timeDelay,enableAnimationFrame:t.enableAnimationFrame,initFrameTimestamp:this.image.timestamp,callbacks:{onPlayActionFrames:this.onPlayActionFrames}}),this.onFrameReceivedInterval=t.callbacks.onFrameReceivedInterval,this.onClientCrashWithError=t.callbacks.onClientCrashWithError,this.playerBuffer.play()}return P(e,[{key:"imagePhase",get:function(){return this.image.phase}},{key:"timestamp",get:function(){return this.image.timestamp}},{key:"trigger",get:function(){return this.image.trigger}},{key:"pendingReportChanged",get:function(){return this.image.pendingReportChanged},set:function(e){this.image.pendingReportChanged=e}},{key:"receivedScopeSlices",value:function(e){this.image.appendScopeSlices(e)}},{key:"dispatch",value:function(e,t){this.image.dispatch(e,t)}},{key:"updateTimeDelay",value:function(e){this.playerBuffer.frameDelay=e}},{key:"syncBlockTimestamp",value:function(e){this.playerBuffer.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){this.playerBuffer.stopBlockTimestamp()}},{key:"setModifiable",value:function(e){this.image.modifiable=e}},{key:"setAllocatedUser",value:function(e){return this.image.setAllocatedUser(e)}},{key:"removeAllocatedUser",value:function(){return this.image.removeAllocatedUser()}},{key:"destroy",value:function(){this.image.destroy()}},{key:"cleanSendingQueue",value:function(){return this.image.waitUtilIllusionQueueEmpty()}},{key:"getFrameReceivedInterval",value:function(e){var t,n=Date.now(),r=0,i=0,a=T(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(this.latestTimestamp){var s=n-this.latestTimestamp.recevied,c=o.timestamp-this.latestTimestamp.arbitrated;this.latestTimestamp.recevied=n,this.latestTimestamp.arbitrated=o.timestamp,r+=Math.abs(s-c),i+=1}else this.latestTimestamp={recevied:n,arbitrated:o.timestamp}}}catch(e){a.e(e)}finally{a.f()}var u=0;return i>0&&(u=r/i),u}}]),e}(),Ec=function(){function e(t,n,r,i){C(this,e),this.userPayload=t,this.onCleanSendingQueue=n,this.onSelfUserIdUpdate=r,this.onConvertToWritable=i,this._selfUserId=void 0,this.invokerBlock=Promise.resolve(),this.isConnectedSessionWritable=!1,this.connectedSession=null}var t;return P(e,[{key:"selfUserId",get:function(){return this._selfUserId}},{key:"finalUserId",get:function(){var e=this;return this.invokerBlock.then((function(){return e._selfUserId}))}},{key:"setConnectedMagixSession",value:function(e){this.connectedSession!==e&&(!this.connectedSession&&e&&this.paddingAndWaitSession&&(this.paddingAndWaitSession(e),this.paddingAndWaitSession=void 0),this.connectedSession=e,this.isConnectedSessionWritable=!1)}},{key:"setWritable",value:function(e,t){return this.invokerBlock=this.convertTo(this.invokerBlock,e,t)}},{key:"convertTo",value:(t=u(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(this.isConnectedSessionWritable!==n){e.next=4;break}return e.abrupt("return");case 4:this.updateObserverId(void 0),i=null;case 6:return e.next=8,this.waitAndGetConnectedSession();case 8:if(a=e.sent,this.isConnectedSessionWritable!==n){e.next=11;break}return e.abrupt("break",33);case 11:if(!n){e.next=21;break}return e.next=14,a.connection.updateToWritable(this.userPayload,r);case 14:if(i=e.sent){e.next=17;break}return e.abrupt("continue",31);case 17:return e.next=19,a.setAllocatedUser(i);case 19:e.next=29;break;case 21:return e.next=23,this.onCleanSendingQueue();case 23:return e.next=25,a.connection.updateToReadonly(r);case 25:if(e.sent){e.next=27;break}return e.abrupt("continue",31);case 27:return e.next=29,a.removeAllocatedUser();case 29:return this.isConnectedSessionWritable=n,e.abrupt("break",33);case 31:e.next=6;break;case 33:i&&this.updateObserverId(i.userId),this.onConvertToWritable&&this.onConvertToWritable(!!i);case 34:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"waitAndGetConnectedSession",value:function(){var e=this;return this.connectedSession?Promise.resolve(this.connectedSession):new Promise((function(t){return e.paddingAndWaitSession=t}))}},{key:"updateObserverId",value:function(e){this._selfUserId!==e&&(this._selfUserId=e,this.onSelfUserIdUpdate&&this.onSelfUserIdUpdate(e))}}]),e}(),Oc="NETLESSROOM_".length;function Rc(e){if(!/^NETLESSROOM_.+/.test(e)){if(/^WHITE.+/.test(e))return"writable";throw new Error("invalid room token: ".concat(JSON.stringify(e)))}var t=e.substring(Oc),n=(0,Ss.parse)(function(e){return atob(e.replace(/_/g,"/").replace(/-/g,"+"))}(t)),r=parseFloat("".concat(n.role));if(Number.isNaN(r)||!Number.isSafeInteger(r))throw new Error("invalid room token with wrong role: ".concat(JSON.stringify(e)));switch(r){case 0:case 1:return"writable";case 2:return"readonly";default:throw new Error("find unrecognized role from roomToken: ".concat(r))}}!function(e){e[e.Admin=0]="Admin",e[e.Writer=1]="Writer",e[e.Reader=2]="Reader"}(Sc||(Sc={}));var Nc=function(){function e(t,n){var r=this;C(this,e),this.queue=[],this._isWorking=!0,this.onDelayFire=function(){r.queue.splice(0),r.onTimeout()},this.timeout=t,this.delayer=new De(this.onDelayFire),this.onTimeout=n}return P(e,[{key:"isWorking",get:function(){return this._isWorking},set:function(e){this._isWorking!==e&&(this._isWorking=e,e?this.activeFirstNode():this.delayer.cancel())}},{key:"fireSend",value:function(e){var t=e.frameId,n=Date.now();this.queue.push({frameId:t,sendAt:n}),this._isWorking&&1===this.queue.length&&this.delayer.refreshAndInvokeAfterInterval(this.timeout)}},{key:"fireACK",value:function(e){var t=e.originalFrameId,n=this.queue.findIndex((function(e){return e.frameId===t}));-1!==n&&(this.queue.splice(n,1),this._isWorking&&this.activeFirstNode())}},{key:"activeFirstNode",value:function(){if(0===this.queue.length)this.delayer.cancel();else{var e=this.queue[0].sendAt+this.timeout-Date.now();e>0?this.delayer.refreshAndInvokeAfterInterval(e):(this.delayer.cancel(),this.onDelayFire())}}}]),e}(),Lc=function(){function e(t){var n=this;C(this,e),this.idle=Fe({timeout:250,checkingTimeMod:7,maxPaddingDuration:800,maxInvokingDuration:5}),this.actionFramePickersList=[],this._phase=Dc.Ready,this._modifiable=!0,this._timeDelay=0,this.switchWritable=!1,this.switchWritableTaskId=0,this.isReconnecting=!1,this.beginReconnectAt=0,this.onReceivedActionFrame=function(e){var t=new sr(e);try{if(n.magixSession){if(n.actionFramePickersList.length>0){var r,i=T(n.cleanActionFramesBufferList());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.magixSession.receivedActionFramePicker(a)}}catch(e){i.e(e)}finally{i.f()}}n.magixSession.receivedActionFramePicker(t)}else n.actionFramePickersList.push(t)}catch(a){n.logger.error("found error when receive action frame: "+a.message),n.socketSession.reconnectWithError(a)}finally{n.ackTimeout.fireACK(t)}},this.onReceivedScopeSlices=function(e){try{n.magixSession&&n.magixSession.receivedScopeSlices(e)}catch(e){n.logger.error("found error when receive scope slices: "+e.message),n.socketSession.reconnectWithError(e)}},this.onBeginReconnect=function(e){var t=n._phase===Dc.Connecting;n.beginReconnectAt=Date.now(),n.refreshACKTimeoutIsWorking(),t||(n.callbacks.onReconnectWithError?n.callbacks.onReconnectWithError(e):n.logger.error(e)),n.switchWritableTaskId+=1,n.magixSession.destroy(),n.pingPongNode.unbindSocket(),t||n.changePhase(Dc.Reconnecting),n.isReconnecting=!0,n.authorState.setConnectedMagixSession(null)},this.onReconnected=function(){var e=u(regeneratorRuntime.mark((function e(t){var r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.connection,i=t.snapshot,a=t.actionFrames,o=t.retryCount,n.buildMagixSession({connection:r,snapshot:i,actionFrames:a,pendingReportChanged:!0}),s=n._phase===Dc.Connecting,c=n.switchWritableTaskId,e.t0=n.switchWritable,!e.t0){e.next=7;break}return e.next=7,n.authorState.setWritable(!0,n.settingWritablePayload);case 7:c===n.switchWritableTaskId&&(n.magixSession.pendingReportChanged=!1,s||(n.changePhase(Dc.Connected),n.onModified()),n.isReconnecting=!1,n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(null),n.reconnectionResultReceiver=null),n.callbacks.onReconnected&&!s&&n.callbacks.onReconnected({retryCount:o,buildWebSocketDuration:r.connectingDuration,buildMagixDuration:Date.now()-n.beginReconnectAt})),n.beginReconnectAt=0,n.refreshACKTimeoutIsWorking();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onGeneratedActionFrame=function(e){var t;n.idle.invokeOnIdle(u(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.get();case 1:case"end":return n.stop()}}),n)})))).catch((function(e){var t,r;return null==(r=(t=n.callbacks).onReceivedWarning)?void 0:r.call(t,e.message)})),n.idle.invokeOnIdle(u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(n.socketSession.connection.sendActionFrame(t),n.ackTimeout.fireSend(new sr(t)));case 1:case"end":return e.stop()}}),e)})))).catch((function(e){var t,r;return null==(r=(t=n.callbacks).onReceivedWarning)?void 0:r.call(t,e.message)}))},this.onCleanSendingQueue=u(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=n.magixSession)?void 0:t.cleanSendingQueue();case 2:case"end":return e.stop()}}),e)}))),this.onSelfUserIdUpdate=function(e){n.callbacks.onSelfUserIdUpdate&&n._phase!==Dc.Ready&&n._phase!==Dc.Connecting&&n.callbacks.onSelfUserIdUpdate(e)},this.onModified=function(){n.callbacks.onModified&&n._phase!==Dc.Ready&&n._phase!==Dc.Connecting&&(n.animationFrameTicker?n.animationFrameTicker.invoke():n.callbacks.onModified())},this.onACKTimeout=function(){console.warn("receive ACK frame timeout. it will send a ping"),n.pingPongNode.ping(e.pingAfterAckTimeout).catch((function(){n.onClientCrashWithError(new Error("connection failed because pong timeout after receive ACK frame timeout"))}))},this.onClientCrashWithError=function(e){n._phase===Dc.Connected&&n.socketSession.reconnectWithError(e)},this.onFrameReceivedInterval=function(t){n.callbacks.onFrameReceivedInterval&&(n.callbacks.onFrameReceivedInterval(t),n.receivedIntervalResetter.refreshAndInvokeAfterInterval(e.receivedIntervalResetterCleanInterval))},this.onDisconnectWithError=function(e){if(n.magixSession.destroy(),n.pingPongNode.unbindSocket(),n.phase!==Dc.Disconnected){var t=n._phase;n.socketSession.dispose(),n.isReconnecting=!1,n.changePhase(Dc.Disconnected),n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(e),n.reconnectionResultReceiver=null),t===Dc.Connecting?n.errorWhenConnecting=e:n.callbacks.onDisconnectWithError&&n.callbacks.onDisconnectWithError(e)}},this.onKickedWithReason=function(e){if(n.magixSession.destroy(),n.pingPongNode.unbindSocket(),n.phase!==Dc.Disconnected){var t=n._phase,r=new Error("kicked by server when connecting: ".concat(e));n.socketSession.dispose(),n.isReconnecting=!1,n.changePhase(Dc.Disconnected),n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(r),n.reconnectionResultReceiver=null),t===Dc.Connecting&&(n.errorWhenConnecting=r),n.callbacks.onKickedWithReason&&n.callbacks.onKickedWithReason(e)}},this.logger=t.logger,this.imageFactory=t.imageFactory,this.libraryNodeFetcher=t.libraryNodeFetcher,this.fetcherFactory=t.fetcherFactory,this.enableAnimationFrame=t.enableAnimationFrame,this.reconnectionOptions=t.reconnectionOptions,this.toolsExtra=t.toolsExtra,this.netState=t.netState,this.clientVersion=t.clientVersion,this.callbacks=Gr(t.callbacks),this.callbacks.onModified&&t.enableAnimationFrame&&(this.animationFrameTicker=new vc(this.callbacks.onModified)),this.pingPongNode=new dc(this.logger.warn),this.authorState=new Ec(t.userPayload,this.onCleanSendingQueue,this.onSelfUserIdUpdate,this.onModified),this.ackTimeout=new Nc(e.ackTimeout,this.onACKTimeout),this.receivedIntervalResetter=new De((function(){n.callbacks.onFrameReceivedInterval&&n.callbacks.onFrameReceivedInterval(0)}))}var t,n,r;return P(e,[{key:"modifiable",get:function(){return this._modifiable}},{key:"phase",get:function(){return this._phase}},{key:"calibrationTimestamp",get:function(){return this.pingPongNode.calibrationTimestamp}},{key:"timeDelay",get:function(){return this._timeDelay},set:function(e){this._timeDelay=e,this.magixSession&&this.magixSession.updateTimeDelay(e)}},{key:"session",get:function(){return this.socketSession&&this.socketSession.session}},{key:"slice",get:function(){return this.socketSession&&this.socketSession.slice}},{key:"changePhase",value:function(e){if(this._phase!==e){switch(this._phase=e,e){case Dc.Disconnecting:case Dc.Disconnected:this.refreshACKTimeoutIsWorking(),this.receivedIntervalResetter.cancel()}this.callbacks.onPhaseChanged&&this.callbacks.onPhaseChanged(e)}}},{key:"selfUserId",get:function(){return this.authorState.selfUserId}},{key:"isWritable",get:function(){return void 0!==this.authorState.selfUserId}},{key:"imagePhase",get:function(){if(!this.magixSession)throw new Error("image phase not exist when Magix's phase is ".concat(this.phase));return this.magixSession.imagePhase}},{key:"trigger",get:function(){if(!this.magixSession)throw new Error("trigger object not exist when Magix's phase is ".concat(this.phase));return this.magixSession.trigger}},{key:"syncBlockTimestamp",value:function(e){var t;null==(t=this.magixSession)||t.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){var e;null==(e=this.magixSession)||e.stopBlockTimestamp()}},{key:"setWritable",value:(r=u(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._phase!==Dc.Connected&&this._phase!==Dc.Reconnecting){e.next=10;break}return this.switchWritable=t,this.settingWritablePayload=t?n:void 0,this.refreshACKTimeoutIsWorking(),e.prev=2,e.next=5,this.authorState.setWritable(t,n);case 5:return e.prev=5,this.refreshACKTimeoutIsWorking(),e.finish(5);case 8:e.next=11;break;case 10:throw new Error("can't only set writable when connected or reconnecting");case 11:case"end":return e.stop()}}),e,this,[[2,,5,8]])}))),function(e,t){return r.apply(this,arguments)})},{key:"connect",value:(n=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Date.now(),this.phase===Dc.Ready){e.next=3;break}throw new Error("can't connect when Magix's phase is ".concat(this.phase));case 3:return this.changePhase(Dc.Connecting),e.prev=4,e.next=7,oc({logger:this.logger,fetcher:this.fetcherFactory.create(t.region),uuid:t.uuid,roomToken:t.roomToken,timeout:45e3,markWritable:t.isWritable,clientVersion:this.clientVersion,access:Rc(t.roomToken),netState:this.netState,reconnectionOptions:this.reconnectionOptions,objectOperator:this.imageFactory.proxyManager.objectOperator,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:{onReceivedActionFrame:this.onReceivedActionFrame,onReceivedScopeSlices:this.onReceivedScopeSlices,onBeginReconnect:this.onBeginReconnect,onReconnected:this.onReconnected,onSliceUpdate:this.callbacks.onSliceChanged,onSessionUpdate:this.callbacks.onSessionChanged,onDisconnectedByServer:this.onDisconnectWithError,onDisconnectedWithSocketError:this.onDisconnectWithError,onKickWithReason:this.onKickedWithReason}});case 7:if(r=e.sent,i=r.session,a=r.connection,o=r.snapshot,s=r.actionFrames,c=r.retryCount,this.socketSession=i,this.settingWritablePayload=t.connectedPayload,this.buildMagixSession({connection:a,snapshot:o,actionFrames:s,pendingReportChanged:!1}),e.t0=t.isWritable,!e.t0){e.next=21;break}return e.next=20,this.authorState.setWritable(!0,t.connectedPayload);case 20:this.switchWritable=!0;case 21:if(!this.isReconnecting){e.next=29;break}return e.next=24,new Promise((function(e){l.reconnectionResultReceiver=e}));case 24:if(!(u=e.sent)){e.next=27;break}throw u;case 27:e.next=31;break;case 29:if(this._phase===Dc.Connecting){e.next=31;break}throw this.errorWhenConnecting?this.errorWhenConnecting:new Error("magix connect fail with invalid phase ".concat(this._phase));case 31:return e.abrupt("return",(this.changePhase(Dc.Connected),{libraryNode:i.libraryNode,statistics:{retryCount:c,buildWebSocketDuration:i.connection.connectingDuration,buildMagixDuration:Date.now()-n}}));case 34:throw e.prev=34,e.t1=e.catch(4),this.cleanActionFramesBufferList(),this.changePhase(Dc.Disconnected),this.pingPongNode.unbindSocket(),e.t1;case 37:case"end":return e.stop()}}),e,this,[[4,34]])}))),function(e){return n.apply(this,arguments)})},{key:"reconnectWithError",value:function(e){if(this._phase!==Dc.Reconnecting){if(this._phase!==Dc.Connected)throw new Error("can't reconnect when magix's phase is ".concat(this._phase));this.socketSession.reconnectWithError(e)}}},{key:"buildMagixSession",value:function(t){var n=this,r=t.connection,i=t.snapshot,a=t.actionFrames,o=t.pendingReportChanged;this.magixSession&&this.magixSession.destroy(),i.byteLength>=e.hugeSnapshotBytes&&(this.ackTimeout.timeout=e.hugeSnapshotAckTimeout);var s=this.magixSession=new Ac({logger:this.logger,library:ic(this.socketSession.libraryNode.libraryClass),connection:r,pendingReportChanged:o,snapshot:i,initializeActionFrames:a,imageFactory:this.imageFactory,enableAnimationFrame:this.enableAnimationFrame,originalMagixSession:this.magixSession,timeDelay:this._timeDelay,toolsExtra:this.toolsExtra,callbacks:{onImagePhaseChanged:function(e){return n.onImagePhaseChanged(s,e)},onGeneratedActionFrame:this.onGeneratedActionFrame,onModified:this.onModified,onEventFire:this.wrapeEventFireCallback(this.callbacks.onEventFire),onEventFireACK:this.wrapeEventFireCallback(this.callbacks.onEventFireACK),onClientCrashWithError:this.onClientCrashWithError,onFrameReceivedInterval:this.onFrameReceivedInterval,onReceivedRttReport:this.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:this.callbacks.onIllusionQueueLengthChanged,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame||function(e,t){return n.logger.error(t)}}});r.bindPingPongNode(this.pingPongNode),this.magixSession.setModifiable(this._modifiable),this.authorState.setConnectedMagixSession(this.magixSession)}},{key:"disconnect",value:(t=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReconnecting=!1,this.phase!==Dc.Reconnecting){e.next=4;break}this.socketSession.dispose(),this.pingPongNode.unbindSocket(),this.changePhase(Dc.Disconnected),e.next=27;break;case 4:if(this.phase!==Dc.Connected){e.next=26;break}if(this.pingPongNode.unbindSocket(),this.changePhase(Dc.Disconnecting),e.prev=6,e.t0=this.magixSession,!e.t0){e.next=18;break}return e.next=11,this.authorState.finalUserId;case 11:if(e.t1=e.sent,e.t2=void 0,e.t3=e.t1!==e.t2,!e.t3){e.next=17;break}return e.next=17,this.magixSession.removeAllocatedUser();case 17:this.magixSession.destroy();case 18:return e.next=20,this.socketSession.connection.disconnect();case 20:this.socketSession.dispose();case 21:return e.prev=21,this.changePhase(Dc.Disconnected),e.finish(21);case 24:e.next=27;break;case 26:throw new Error("can't disconnect when Magix's phase is ".concat(this.phase));case 27:case"end":return e.stop()}}),e,this,[[6,,21,24]])}))),function(){return t.apply(this,arguments)})},{key:"dispatch",value:function(e,t){if(this.phase!==Dc.Connected)throw new Error("can't dispatch event when Magix's phase is ".concat(this.phase));this.magixSession.dispatch(e,t)}},{key:"refreshACKTimeoutIsWorking",value:function(){0===this.beginReconnectAt&&this.switchWritable&&this.isWritable&&this._phase===Dc.Connected?this.ackTimeout.isWorking=!0:this.ackTimeout.isWorking=!1}},{key:"onImagePhaseChanged",value:function(e,t){this.callbacks.onImagePhaseChanged&&this.magixSession===e&&this.callbacks.onImagePhaseChanged(t)}},{key:"wrapeEventFireCallback",value:function(e){if(e)return function(t){return e(Pr(t,Sr.Dispatched))}}},{key:"cleanActionFramesBufferList",value:function(){return this.actionFramePickersList.splice(0,this.actionFramePickersList.length)}}]),e}(),jc=Lc;jc.receivedIntervalResetterCleanInterval=700,jc.ackTimeout=7e3,jc.pingAfterAckTimeout=7e3,jc.hugeSnapshotAckTimeout=26e3,jc.hugeSnapshotBytes=1048576;var Dc,Fc=function(){function e(t,n,r,i,a,o){C(this,e),this.fetcherFactory=t,this.imageFactory=n,this.reconnectionOptions=r,this.netState=i,this.clientVersion=a,this.magixConfiguration=Object.freeze(Rs({},o))}return P(e,[{key:"createMagix",value:function(e,t){return new jc({logger:t.logger,fetcherFactory:this.fetcherFactory,libraryNodeFetcher:t.libraryNodeFetcher,imageFactory:this.imageFactory,toolsExtra:e,enableAnimationFrame:this.magixConfiguration.enableAnimationFrame,reconnectionOptions:this.reconnectionOptions,netState:this.netState,userPayload:t.userPayload,clientVersion:this.clientVersion,callbacks:t.callbacks||{}})}}]),e}();function zc(e){return Bc.apply(this,arguments)}function Bc(){return Bc=u(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,i=0;case 2:if(!(i<n)){e.next=15;break}return e.prev=3,e.next=6,t();case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),r=e.t0;case 12:++i,e.next=2;break;case 15:throw r;case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),Bc.apply(this,arguments)}!function(e){e.Ready="ready",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(Dc||(Dc={}));var Uc=function(){function e(t){var n=this;C(this,e),this.isDownloading=!1,this.didDestroy=!1,this.onPlayActionFrames=function(e){var t,r=[],i=T(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.sequenceInitializer,s=a.framePicker;o&&(r.length>0&&(n.image.appendActionFrames(r),r=[]),n.image=n.createImage(o,n.image),n._libIdentifier=o.libIdentifier,n._libraryNode=o.libraryNode,n.playingSliceIndex+=1,n.callbacks.onSliceChanged&&n.callbacks.onSliceChanged()),s&&r.push(s.frameBuffer)}}catch(e){i.e(e)}finally{i.f()}r.length>0&&n.image.appendActionFrames(r)},this.onBufferRemainLow=function(){n.isDownloading||n.loadActionFrames()},this.onPlayerBufferPhaseChanged=function(e){n.callbacks.onPhaseChanged&&n.callbacks.onPhaseChanged(e)},this.logger=t.logger,this.imageFactory=t.imageFactory,this.sliceChunk=t.sliceChunk,this.sequenceFetcher=t.sequenceFetcher,this.toolsExtra=t.toolsExtra,this.fetchingSliceIndex=t.beginSliceIndex,this.playingSliceIndex=t.beginSliceIndex,this.callbacks=t.callbacks,this.isFirstSlice=!0,this.image=this.createImage(t.sequenceInitializer,t.originalReconstructorLine&&t.originalReconstructorLine.image),this.latestFetchingFrameId=this.image.frameId,this.latestPlayingFrameId=this.image.frameId,this.beginTimestamp=void 0===t.initFrameTimestamp?this.image.timestamp:t.initFrameTimestamp,this._libIdentifier=t.sequenceInitializer.libIdentifier,this._libraryNode=t.sequenceInitializer.libraryNode,this.playerBuffer=Mc.create({logger:t.logger,mode:mc.Reconstruction,enableAnimationFrame:t.enableAnimationFrame,initFrameTimestamp:this.beginTimestamp,endFrameTimestamp:this.sliceChunk.beginTimestamp+this.sliceChunk.duration,callbacks:{onBufferRemainLow:this.onBufferRemainLow,onPlayActionFrames:this.onPlayActionFrames,onPhaseChanged:this.onPlayerBufferPhaseChanged,onTick:t.callbacks.onTick}}),this.playerBuffer.playbackSpeed=t.playbackSpeed}var t,n;return P(e,[{key:"trigger",get:function(){return this.image.trigger}},{key:"libIdentifier",get:function(){return this._libIdentifier}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"playbackSpeed",get:function(){return this.playerBuffer.playbackSpeed},set:function(e){this.playerBuffer.playbackSpeed=e}},{key:"createImage",value:function(e,t){var n=e.snapshot,r=e.actionFrames,i=e.akkoSerVersion,a=e.libraryNode,o=this.imageFactory.createWithSnapshot({logger:this.logger,observerId:an,library:ic(a.libraryClass),snapshotFrame:n,actionFrames:r,originalImage:t,toolsExtra:this.toolsExtra,roomUUID:this.sliceChunk.roomUUID,includesFrameHash:!1,ignoreHashChecking:!0,pendingReportChanged:!1,snapshotDeserializerVersion:i,actionDeserializerVersion:i,callbacks:{onModified:this.callbacks.onModified,onEventFire:this.callbacks.onEventFire,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}});return o.modifiable=!1,o}},{key:"slice",get:function(){return this.sliceChunk.sliceAt(this.playingSliceIndex)}},{key:"sliceIndex",get:function(){return this.playingSliceIndex}},{key:"play",value:function(){this.playerBuffer.play()}},{key:"pause",value:function(){this.playerBuffer.pause()}},{key:"setup",value:function(){var e=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;this.beginTimestamp<e?this.loadActionFrames():this.playerBuffer.completePushFrames()}},{key:"destroy",value:function(){this.didDestroy||(this.playerBuffer.pause(),this.image.destroy(),this.didDestroy=!0)}},{key:"phase",get:function(){return this.playerBuffer.phase}},{key:"isRemainFramesToFetch",value:function(){return this.fetchingSliceIndex<this.sliceChunk.slicesCount}},{key:"loadActionFrames",value:function(){var e=this;this.fillActionFramesIntoBuffer().catch((function(t){return e.logger.error(t)}))}},{key:"fillActionFramesIntoBuffer",value:(n=u(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRemainFramesToFetch()){e.next=18;break}return e.prev=1,this.isDownloading=!0,e.next=5,this.fetchFrames();case 5:t=e.sent,n=this.sliceChunk.beginTimestamp+this.sliceChunk.duration,r=this.removeTimestampOverFrames(t,n),(i=t[t.length-1])&&(this.latestPlayingFrameId=i.frameId),this.shouldPushEndSpaceHolderFrame(t,r,n)&&t.push({frameId:this.latestPlayingFrameId+1,timestamp:n}),t.length>0&&this.playerBuffer.pushFrames(t),this.isRemainFramesToFetch()||this.playerBuffer.completePushFrames(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.callbacks.onCatchErrorWhenFetchBuffer&&this.callbacks.onCatchErrorWhenFetchBuffer(e.t0);case 15:return e.prev=15,this.isDownloading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))),function(){return n.apply(this,arguments)})},{key:"shouldPushEndSpaceHolderFrame",value:function(e,t,n){var r=e[e.length-1];return(t||!this.isRemainFramesToFetch())&&(!r||r.timestamp<n)}},{key:"fetchFrames",value:(t=u(regeneratorRuntime.mark((function t(){var n,r,i,a,o,s,c,u,h,d,p,f,v=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.sliceChunk.sliceAt(this.fetchingSliceIndex)){t.next=2;break}return t.abrupt("return",[]);case 2:if(!((r=n.framesCount-this.latestFetchingFrameId)>0)){t.next=4;break}return t.abrupt("break",7);case 4:this.latestFetchingFrameId=0,this.latestPlayingFrameId=0,this.fetchingSliceIndex+=1,this.isFirstSlice=!1;case 5:t.next=0;break;case 7:return i=Math.min(r,e.fetchFramesCountOnce),a=0===this.latestFetchingFrameId&&!this.isFirstSlice,t.next=11,Promise.all([zc((function(){return v.sequenceFetcher.fetchFramePickers(n,v.latestFetchingFrameId,i)})),a?zc((function(){return v.sequenceFetcher.initializeWithFrameId(n,v.latestFetchingFrameId)})):Promise.resolve(void 0)]);case 11:o=t.sent,s=l(o,2),c=s[0],u=s[1],h=[],d=T(c);try{for(d.s();!(p=d.n()).done;)f=p.value,this.latestFetchingFrameId=f.frameId,h.push({frameId:f.frameId,timestamp:f.timestamp,framePicker:f})}catch(e){d.e(e)}finally{d.f()}return t.abrupt("return",(u&&(h[0].sequenceInitializer=u),h));case 19:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"removeTimestampOverFrames",value:function(e,t){var n=e.findIndex((function(e){return e.timestamp>t}));return-1!==n&&(e.splice(n,e.length-n),!0)}}]),e}(),Vc=Uc;Vc.fetchFramesCountOnce=600;var Wc,Hc=function(){function e(t){C(this,e),this.sliceChunk=t.sliceChunk,this.imageFactory=t.imageFactory,this.sequenceFetcher=t.sequenceFetcher,this.toolsExtra=t.toolsExtra,this.enableAnimationFrame=t.enableAnimationFrame}var t,n;return P(e,[{key:"createWithFrameId",value:(n=u(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.sliceChunk.getFrameDescriptionWithFrameId(n),s=o.sliceIndex,c=o.frameId,u=this.sliceChunk.sliceAt(s),e.next=6,this.sequenceFetcher.initializeWithFrameId(u,c);case 6:return l=e.sent,e.abrupt("return",new Vc({logger:t,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:a,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp,sequenceInitializer:l,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:r,callbacks:i}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"createWithProgressTime",value:(t=u(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,c,u,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.sliceChunk.getFrameDescriptionWithTimestamp(n),s=o.sliceIndex,c=o.timestamp,u=this.sliceChunk.sliceAt(s),l=c+u.beginTimestamp,e.next=7,this.sequenceFetcher.initializeWithTimestamp(u,l);case 7:return h=e.sent,e.abrupt("return",new Vc({logger:t,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:a,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp+n,sequenceInitializer:h,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:r,callbacks:i}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i,a){return t.apply(this,arguments)})}]),e}();!function(e){e[e.FrameId=0]="FrameId",e[e.ProgressTime=1]="ProgressTime"}(Wc||(Wc={}));var _c=function(){function e(t){C(this,e),this.isRunningLoop=!1,this.task=null,this.id=0,this.callbacks=Object.freeze(Rs({},t))}var t;return P(e,[{key:"currentTaskId",get:function(){return this.id}},{key:"isSeeking",get:function(){return this.isRunningLoop}},{key:"stopSeeking",value:function(){this.task&&(this.task.complete(Qc.Stopped),this.task=null),this.id+=1}},{key:"seekToFrameId",value:function(e){var t=this;return new Promise((function(n){t.task&&0===t.task.mode&&t.task.value===e?n(Qc.SuccessButUnnecessary):(t.setNewTask(0,e,n),t.startTaskLoop().catch((function(e){return console.error(e)})))}))}},{key:"seekToProgressTime",value:function(e){var t=this;return new Promise((function(n){t.task&&1===t.task.mode&&t.task.value===e?n(Qc.SuccessButUnnecessary):(t.setNewTask(1,e,n),t.startTaskLoop().catch((function(e){return console.error(e)})))}))}},{key:"setNewTask",value:function(e,t,n){var r=this.id+=1;this.task&&this.task.complete(Qc.Override),this.task={id:r,mode:e,value:t,complete:n}}},{key:"startTaskLoop",value:(t=u(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRunningLoop){e.next=23;break}e.prev=1,this.isRunningLoop=!0,this.callbacks.updateIsSeeking();case 3:if(!this.task){e.next=20;break}n=this.task,r=n.id,i=n.mode,a=n.value,o=void 0,e.t0=i,e.next=0===e.t0?8:1===e.t0?12:16;break;case 8:return e.next=10,this.callbacks.startSeekingToFrameId(r,a);case 10:return o=e.sent,e.abrupt("break",17);case 12:return e.next=14,this.callbacks.startSeekingToProgressTime(r,a);case 14:return o=e.sent,e.abrupt("break",17);case 16:throw new Error("invalid mode ".concat(i));case 17:this.id===r?(null==(t=this.task)||t.complete(Qc.Success),this.task=null,this.callbacks.afterSeeking(o)):this.callbacks.cancelSeeking(o);case 18:e.next=3;break;case 20:return e.prev=20,this.isRunningLoop=!1,this.callbacks.updateIsSeeking(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[1,,20,23]])}))),function(){return t.apply(this,arguments)})}]),e}(),Gc=function(){function e(t){var n=this;C(this,e),this._progressTime=0,this._playbackSpeed=1,this.isPlaying=!1,this.isMaskPhaseUpdating=!1,this.didStop=!1,this.currentLine=void 0,this.startSeekingToFrameId=function(){var e=u(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,i=Math.max(i,0),i=Math.min(i,n.framesCount),a=function(e){return n.lineFactory.createWithFrameId(n.logger,i,n.playbackSpeed,e,n.currentLine)},e.next=5,n.startSeekingTask(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.startSeekingToProgressTime=function(){var e=u(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,i=Math.max(i,0),i=Math.min(i,n.duration),Number.isSafeInteger(i)||(i=Math.floor(i)),a=function(e){return n.lineFactory.createWithProgressTime(n.logger,i,n.playbackSpeed,e,n.currentLine)},e.next=5,n.startSeekingTask(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.afterSeeking=function(e){try{n.isMaskPhaseUpdating=!0,e.setup()}finally{n.isMaskPhaseUpdating=!1}n.changeCurrentLine(e)},this.cancelSeeking=function(e){e.destroy()},this.onLineSliceChanged=function(){var e,t;n.currentLine&&(n.sliceStateUpdater.refreshReconstructorLine(n.currentLine),n.callbacks.onModified&&n.callbacks.onModified(),n.onTick(n.currentLine.beginTimestamp),null==(t=(e=n.callbacks).onTriggerBuilt)||t.call(e))},this.currentIsPlayable=function(){if(n.didStop||!n.currentLine||n.seekingNode.isSeeking)return!1;switch(n.currentLine.phase){case pc.Playing:case pc.Pausing:return!0;case pc.PausingAndWaiting:case pc.Waiting:case pc.Ended:default:return!1}},this.currentPhase=function(){if(n.didStop)return Xc.Stopped;if(!n.currentLine)return Xc.WaitingFirstFrame;if(n.seekingNode.isSeeking)return Xc.Seeking;switch(n.currentLine.phase){case pc.Playing:return Xc.Playing;case pc.Pausing:case pc.PausingAndWaiting:return Xc.Pause;case pc.Waiting:return Xc.Buffering;case pc.Ended:return Xc.Ended;default:throw new Error("invalid phase ".concat(n.currentLine.phase))}},this.touchPhaseChanged=function(){n.isMaskPhaseUpdating||(n.phaseNode.touch(),n.isPlayableNode.touch())},this.onTick=function(e){var t=Math.min(e-n.beginTimestamp,n.sliceChunk.duration);n._progressTime=t,n.callbacks.onProgressTimeChanged&&n.callbacks.onProgressTimeChanged(t)},this.onCatchError=function(e){n.didStop||(n.stop(),n.callbacks.onStoppedWithError&&n.callbacks.onStoppedWithError(e))},this.onEventFire=function(e){n.callbacks.onEventFire&&n.callbacks.onEventFire(Pr(e,Sr.Dispatched))},this.logger=t.logger,this.sliceChunk=t.sliceChunk,this.sequenceFetcher=t.sequenceFetcher,this.callbacks=Gr(t.callbacks),this.sliceStateUpdater=t.sliceStateUpdater,this.sliceStateUpdater.onSliceChanged=this.callbacks.onSliceChanged,this.sliceStateUpdater.onLibraryNodeChanged=this.callbacks.onLibraryNodeChanged,this.seekingNode=new _c({startSeekingToFrameId:this.startSeekingToFrameId,startSeekingToProgressTime:this.startSeekingToProgressTime,afterSeeking:this.afterSeeking,cancelSeeking:this.cancelSeeking,updateIsSeeking:this.touchPhaseChanged}),this.isPlayableNode=new si({phase:!1,onPhaseChanged:t.callbacks.onIsPlayableChanged,getCurrentPhase:this.currentIsPlayable}),this.phaseNode=new si({phase:Xc.WaitingFirstFrame,onPhaseChanged:t.callbacks.onPhaseChanged,getCurrentPhase:this.currentPhase}),this.lineFactory=new Hc({sliceChunk:t.sliceChunk,imageFactory:t.imageFactory,sequenceFetcher:t.sequenceFetcher,toolsExtra:t.toolsExtra,enableAnimationFrame:t.enableAnimationFrame})}var t;return P(e,[{key:"trigger",get:function(){if(!this.currentLine)throw new Error("trigger object not exist when Reconstructor's phase is ".concat(this.phase));return this.currentLine.trigger}},{key:"isPlayable",get:function(){return this.isPlayableNode.phase}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"progressTime",get:function(){return this._progressTime}},{key:"slice",get:function(){return this.sliceStateUpdater.slice}},{key:"sliceIndex",get:function(){return this.sliceStateUpdater.sliceIndex}},{key:"libIdentifier",get:function(){return this.sliceStateUpdater.libIdentifier}},{key:"libraryNode",get:function(){return this.sliceStateUpdater.libraryNode}},{key:"roomUUID",get:function(){return this.sliceChunk.roomUUID}},{key:"duration",get:function(){return this.sliceChunk.duration}},{key:"framesCount",get:function(){return this.sliceChunk.framesCount}},{key:"beginTimestamp",get:function(){return this.sliceChunk.beginTimestamp}},{key:"playbackSpeed",get:function(){return this.currentLine?this.currentLine.playbackSpeed:this._playbackSpeed},set:function(e){this._playbackSpeed=e,this.currentLine&&(this.currentLine.playbackSpeed=e)}},{key:"play",value:function(){var e=this;if(this.assertNotStop(),this.phaseNode.phase!==Xc.Ended){var t=this.isPlaying;this.isPlaying=!0,!t&&!this.seekingNode.isSeeking&&(this.currentLine?this.currentLine.play():this.seekToProgressTime(0).catch((function(t){return e.logger.error(t)}))),this.touchPhaseChanged()}}},{key:"pause",value:function(){this.assertNotStop(),this.isPlaying&&!this.seekingNode.isSeeking&&this.currentLine&&this.currentLine.pause(),this.isPlaying=!1,this.touchPhaseChanged()}},{key:"stop",value:function(){this.assertNotStop(),this.seekingNode.stopSeeking(),this.currentLine&&(this.currentLine.destroy(),this.currentLine=void 0),this.didStop=!0,this.touchPhaseChanged()}},{key:"seekToFrameId",value:function(e){return this.assertNotStop(),this.seekingNode.seekToFrameId(e)}},{key:"seekToProgressTime",value:function(e){return this.assertNotStop(),this.seekingNode.seekToProgressTime(e)}},{key:"startSeekingTask",value:(t=u(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=Rs({},this.wrapCallbacksWithTaskChecking(t,{onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame,onCatchErrorWhenFetchBuffer:this.onCatchError,onModified:this.callbacks.onModified,onSliceChanged:this.onLineSliceChanged,onEventFire:this.onEventFire,onTick:this.onTick,onPhaseChanged:this.touchPhaseChanged})),e.next=4,n(r);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),this.onCatchError(e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,n){return t.apply(this,arguments)})},{key:"changeCurrentLine",value:function(e){var t,n;this.currentLine&&this.currentLine.destroy(),this.currentLine=e,this.sliceStateUpdater.refreshReconstructorLine(e),this.isPlaying&&e.play(),this.callbacks.onModified&&this.callbacks.onModified(),this.onTick(e.beginTimestamp),null==(n=(t=this.callbacks).onTriggerBuilt)||n.call(t)}},{key:"wrapCallbacksWithTaskChecking",value:function(e,t){var n=this,r={},i=function(i){var a=t[i];a&&(r[i]=function(){if(e===n.seekingNode.currentTaskId)return a.apply(void 0,arguments)})};for(var a in t)i(a);return r}},{key:"assertNotStop",value:function(){if(this.didStop)throw new Error("Reconstructor did stop")}}]),e}();function Yc(e,t,n){var r=Math.min(e,n),i=Math.max(e,n),a=t;return t<r?a=r:t>i&&(a=i),a}var Xc,Qc,Kc=function(){function e(t){var n=this;C(this,e),this.fetchLibraryNode=function(){var e=u(regeneratorRuntime.mark((function e(t,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.previousLibraryNode||n.previousLibraryNode.libIdentifier!==r){e.next=2;break}return e.abrupt("return",n.previousLibraryNode.libraryNode);case 2:return e.next=4,n.libraryNodeFetcher({appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,libIdentifier:r});case 4:return i=e.sent,e.abrupt("return",(n.previousLibraryNode=Object.freeze({libIdentifier:r,libraryNode:i}),i));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.logger=t.logger,this.fetcher=t.fetcher,this.roomToken=t.roomToken,this.libraryNodeFetcher=t.libraryNodeFetcher}var t,n,r,i,a,o,s,c,h;return P(e,[{key:"initializeWithTimestamp",value:(h=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.libIdentifier,e.next=3,Promise.all([this.sequenceImageInitializerWithTimestamp(t,n),this.fetchLibraryNode(t,r)]);case 3:return i=e.sent,a=l(i,2),o=a[0],s=a[1],e.abrupt("return",Ns(Rs({},o),{libraryNode:s,libIdentifier:r}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"initializeWithFrameId",value:(c=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.libIdentifier,e.next=3,Promise.all([this.sequenceImageInitializerWithFrameId(t,n),this.fetchLibraryNode(t,r)]);case 3:return i=e.sent,a=l(i,2),o=a[0],s=a[1],e.abrupt("return",Ns(Rs({},o),{libraryNode:s,libIdentifier:r}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"sequenceImageInitializerWithTimestamp",value:(s=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Yc(t.beginTimestamp,n,t.beginTimestamp+t.duration),e.next=3,this.fetcher.fetch("persistence");case 3:return i=e.sent,a=(0,Cs.stringify)({timestamp:r}),o="https://persistence/pv/rooms/".concat(t.roomUUID,"/slices/").concat(t.uuid,"/snapshots?").concat(a),e.next=8,i.fetchJSON(o,{method:"get",headers:{"content-type":"application/json",token:this.roomToken}});case 8:return(s=e.sent)||(this.logger.warn("cannot find snapshot that timestamp=".concat(r," and slice=").concat(t.uuid)),s={frameId:0,timestamp:t.beginTimestamp}),e.next=12,this.fetchFrameRouterPicker(t,s.frameId);case 12:for(c=e.sent,u=0,l=0;l<c.framesCount&&c.timestampAt(l)<=n;l++)u+=1;return e.next=17,this.fetchSnapshot(t,s.frameId);case 17:if(h=e.sent,0!==u){e.next=22;break}e.t0=[],e.next=25;break;case 22:return e.next=24,this.fetchFramePickers(t,s.frameId,u);case 24:e.t0=e.sent;case 25:return d=e.t0,e.abrupt("return",{snapshot:h.frameBuffer,actionFrames:d.map((function(e){return e.frameBuffer})),akkoSerVersion:Ot(t.akkoVersion)});case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"sequenceImageInitializerWithFrameId",value:(o=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Yc(0,n,t.framesCount-1),e.next=3,this.fetchSnapshot(t,r);case 3:if(i=e.sent,0!=(a=r-i.frameId)){e.next=7;break}return e.abrupt("return",{snapshot:i.frameBuffer,actionFrames:[],akkoSerVersion:Ot(t.akkoVersion)});case 7:return e.next=9,this.fetchFramePickers(t,i.frameId,a);case 9:return o=e.sent,e.abrupt("return",{snapshot:i.frameBuffer,actionFrames:o.map((function(e){return e.frameBuffer})),akkoSerVersion:Ot(t.akkoVersion)});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"fetchFramePickers",value:(a=u(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,h,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"framesRouter");case 2:return i=e.sent,a=i.fetcher,o=i.url,e.next=7,qc.pick(a,o,n,r);case 7:return s=e.sent,e.next=10,this.fetchBody(t,"framesBody",s.offset,s.length);case 10:c=e.sent,u=[],l=0;case 13:if(!(l<s.framesCount)){e.next=22;break}if(h=s.offsetAt(l)-s.offset,d=s.lengthAt(l),!(c.byteLength<h+d)){e.next=17;break}return e.abrupt("break",22);case 17:p=c.slice(h,d),f=new sr(p),u.push(f);case 19:++l,e.next=13;break;case 22:return e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"fetchSnapshot",value:(i=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"snapshotsRouter");case 2:return r=e.sent,i=r.fetcher,a=r.url,o=Math.floor(n/t.snapshotIdInterval),e.next=8,qc.pick(i,a,o,1);case 8:if(0!==(s=e.sent).framesCount){e.next=11;break}throw new Error("can't find snapshot with frameId ".concat(n));case 11:return c=s.offsetAt(0),u=s.lengthAt(0),e.next=15,this.fetchBody(t,"snapshotsBody",c,u);case 15:return l=e.sent,e.abrupt("return",new sr(l));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetchFrameRouterPicker",value:(r=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"framesRouter");case 2:return r=e.sent,i=r.fetcher,a=r.url,o=Math.min(t.framesCount-n,t.snapshotIdInterval-1),e.abrupt("return",qc.pick(i,a,n,o));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"fetchBody",value:(n=u(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,n);case 2:return a=e.sent,o=a.fetcher,s=a.url,e.next=7,o.fetchBuffer(s,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(r,"-").concat(r+i)}});case 7:if(c=e.sent){e.next=10;break}throw new Error("can't find \"".concat(s,'"'));case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getAssetsFetcherAndURL",value:(t=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.uuid,i=t.roomUUID,a=t.token,e.t0=n,e.next="framesBody"===e.t0?4:"framesRouter"===e.t0?6:"snapshotsBody"===e.t0?8:"snapshotsRouter"===e.t0?10:12;break;case 4:return o="frames.body",e.abrupt("break",12);case 6:return o="frames.router",e.abrupt("break",12);case 8:return o="snapshots.body",e.abrupt("break",12);case 10:return o="snapshots.router",e.abrupt("break",12);case 12:return a?(s="assets-auth",c=a[n]):s="assets",u="https://".concat(s,"/").concat(i,"/").concat(r,"/").concat(o),c&&(u+="?auth_key="+c),e.next=17,this.fetcher.fetch(s);case 17:return e.t1=e.sent,e.t2=u,e.abrupt("return",{fetcher:e.t1,url:e.t2});case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),qc=function(){function e(t,n){C(this,e),this.buffer=t,this.framesCount=n,this.framesCount>0?this.offset=this.offsetAt(0):this.offset=Number.NaN}var t;return P(e,[{key:"length",get:function(){if(void 0===this._length){this._length=0;for(var e=0;e<this.framesCount;++e)this._length+=this.lengthAt(e)}return this._length}},{key:"timestampAt",value:function(e){var t=24*e+0;return this.buffer.getUint64(t)}},{key:"offsetAt",value:function(e){var t=24*e+8;return this.buffer.getUint64(t)}},{key:"lengthAt",value:function(e){var t=24*e+16;return this.buffer.getUint64(t)}}],[{key:"pick",value:(t=u(regeneratorRuntime.mark((function t(n,r,i,a){var o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i*(o=24),c=(i+a)*o-1,t.next=5,n.fetchBuffer(r,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(s,"-").concat(c)}});case 5:return(u=t.sent)||(u=ye(0)),l=Math.floor(u.byteLength/o),t.abrupt("return",new e(u,l));case 9:case"end":return t.stop()}}),t)}))),function(e,n,r,i){return t.apply(this,arguments)})}]),e}(),Zc=function(){function e(t){C(this,e),this.slices=Object.freeze(p(t.slices).sort((function(e,t){return e.beginTimestamp-t.beginTimestamp}))),this.beginAt=t.beginAt,this.endAt=t.endAt,this.roomUUID=this.getRoomUUID(),this.framesCount=this.getFramesCount()}return P(e,[{key:"getRoomUUID",value:function(){for(var e=this.slices[0].roomUUID,t=1;t<this.slices.length;++t)if(e!==this.slices[t].roomUUID)throw new Error("all slices should have the same roomUUID");return e}},{key:"getFramesCount",value:function(){var e,t=0,n=T(this.slices);try{for(n.s();!(e=n.n()).done;){t+=e.value.framesCount}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"beginTimestamp",get:function(){return this.beginAt}},{key:"duration",get:function(){return this.endAt-this.beginAt}},{key:"slicesCount",get:function(){return this.slices.length}},{key:"sliceAt",value:function(e){return this.slices[e]}},{key:"getFrameDescriptionWithFrameId",value:function(e){for(var t=e,n=0,r=0;r<this.slices.length;++r){var i=this.slices[r];if(n=r,t<i.framesCount)break;t-=i.framesCount}return{frameId:t,sliceIndex:n}}},{key:"getFrameDescriptionWithTimestamp",value:function(e){for(var t=e+this.beginAt,n=0,r=0;r<this.slices.length;++r){var i=this.slices[r];if(n=r,t<i.beginTimestamp+i.duration)break}return{sliceIndex:n,timestamp:Math.max(0,t-this.slices[n].beginTimestamp)}}}]),e}(),Jc=function(){function e(t){var n=this;C(this,e),this._libraryNodeFetcher=t,this.libraryNodeFetcher=function(e){return n._libraryNode&&n._libIdentifier===e.libIdentifier?Promise.resolve(n._libraryNode):n._libraryNodeFetcher(e)}}return P(e,[{key:"sliceIndex",get:function(){return this._sliceIndex}},{key:"slice",get:function(){return this._slice}},{key:"libIdentifier",get:function(){return this._libIdentifier}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"refreshReconstructorLine",value:function(e){(e.libIdentifier!==this._libIdentifier||e.libraryNode!==this._libraryNode)&&(this._libIdentifier=e.libIdentifier,this._libraryNode=e.libraryNode,this.onLibraryNodeChanged&&this.onLibraryNodeChanged(this._libIdentifier,this._libraryNode)),e.sliceIndex!==this._sliceIndex&&(this._sliceIndex=e.sliceIndex,this._slice=e.slice,this.onSliceChanged&&this.onSliceChanged(this._slice,this._sliceIndex))}}]),e}(),$c=function(){function e(t,n,r,i){C(this,e),this.fetcherFactory=t,this.imageFactory=n,this.clientVersion=r,this.enableAnimationFrame=i}var t,n,r;return P(e,[{key:"createReconstructor",value:(r=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rangeQuery,i=new Jc(n.libraryNodeFetcher),a=new Kc({logger:n.logger,roomToken:n.roomToken,fetcher:this.fetcherFactory.create(r.region),libraryNodeFetcher:i.libraryNodeFetcher}),e.next=5,this.fetchSliceChunk(r);case 5:if(o=e.sent){e.next=8;break}throw new Error("couldn't find any matching slices");case 8:return e.abrupt("return",new Gc({logger:n.logger,sliceChunk:o,imageFactory:this.imageFactory,sequenceFetcher:a,sliceStateUpdater:i,toolsExtra:t,enableAnimationFrame:this.enableAnimationFrame,callbacks:n.callbacks||{}}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"searchSlices",value:(n=u(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSliceChunk(t);case 2:if(n=e.sent,r=[],n)for(i=0;i<n.slicesCount;++i)r.push(n.sliceAt(i));return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchSliceChunk",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,h,d,f,v,m,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcherFactory.create(t.region).fetch("persistence");case 2:if(n=e.sent,void 0===t.slice){e.next=14;break}return i={clientVersion:this.clientVersion},a="https://persistence/pv/rooms/".concat(t.room,"/slices/").concat(t.slice,"?").concat((0,xs.stringify)(i)),e.next=8,n.fetchJSON(a,{headers:{"content-type":"application/json",token:t.roomToken}});case 8:if(o=e.sent,void 0===t.room||t.room===o.roomUUID){e.next=11;break}throw new Error("slice ".concat(o.uuid," is not belongs to room ").concat(t.room));case 11:r=[o],e.next=22;break;case 14:if(void 0===t.room){e.next=21;break}return s=t.beginTimestamp,c=void 0!==t.beginTimestamp&&void 0!==t.duration?t.beginTimestamp+t.duration:void 0,u={beginAt:s,endAt:c,clientVersion:this.clientVersion},l="https://persistence/pv/rooms/".concat(t.room,"/slices?").concat((0,xs.stringify)(u)),e.next=18,n.fetchJSON(l,{headers:{"content-type":"application/json",token:t.roomToken}});case 18:r=e.sent,e.next=22;break;case 21:throw new Error("expect either room or slice");case 22:if(!((r=r.map((function(e){return g.fillSliceLibIdentifier(e)}))).length>0)){e.next=31;break}void 0===(h=t.beginTimestamp)&&(h=Math.min.apply(Math,p(r.map((function(e){return e.beginTimestamp}))))),d=t.duration?h+t.duration:Math.max.apply(Math,p(r.map((function(e){return e.beginTimestamp+e.duration})))),f=T(r);try{for(f.s();!(v=f.n()).done;)m=v.value,Object.freeze(m)}catch(e){f.e(e)}finally{f.f()}return e.abrupt("return",(r=r.filter((function(e){var t=e.beginTimestamp;return e.beginTimestamp+e.duration>=h&&t<=d})),new Zc({beginAt:h,endAt:d,slices:r})));case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"fillSliceLibIdentifier",value:function(e){var t,n=l(e.libIdentifier.replace(/\.\w+$/im,"").split("-"),2),r=n[0],i=n[1];if(r&&i)try{if(We.compare(We.parse(i),We.parse("2.7.0"))<0)switch(r){case"2.0.0":t="2.0.0-2.7.9.0f385eb562396be49fb451e80c1d85fa";break;case"2.1.0":t="2.1.0-2.8.0.fb7b9e324522d815ee4e40990d061a0b"}}catch(e){console.warn(e)}return t?Ns(Rs({},e),{libIdentifier:t}):e}}]),e}();!function(e){e.WaitingFirstFrame="waitingFirstFrame",e.Playing="playing",e.Pause="pause",e.Stopped="stopped",e.Ended="ended",e.Buffering="buffering",e.Seeking="seeking"}(Xc||(Xc={})),function(e){e[e.Success=0]="Success",e[e.SuccessButUnnecessary=1]="SuccessButUnnecessary",e[e.Override=2]="Override",e[e.Stopped=3]="Stopped"}(Qc||(Qc={}));var eu=function(){function e(t){C(this,e);var n=t.onAkkoSetupFailed,r=function(){return new fs(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}({escapeObjectFilter:t.escapeObjectFilter,jsxFactory:t.jsxFactory,observerAdapter:t.observerAdapter});if(this.imageFactory=new na(r),this.convertIdToUrl=t.convertIdToUrl,t.shuntApiHosts){var i=new Qs({appIdentifier:t.appIdentifier,shuntApiHosts:t.shuntApiHosts,onInterruptConfigs:t.configsInterrupter,onAkkoSetupFailed:function(e){console.error("akko setup failed: ".concat(e.stack||e.message)),n&&n(e)}}),a=!!t.enableAnimationFrame,o={enableAnimationFrame:a},s=function(e){return!1===e?{disableReconnect:!0}:Rs(Rs({},lc),e)}(t.reconnectionOptions);this.magixFactory=new Fc(i,this.imageFactory,s,t.netStateAdapter,t.clientVersion,o),this.playerFactory=new $c(i,this.imageFactory,t.clientVersion,a)}}var t;return P(e,[{key:"createMagix",value:function(e){if(!this.magixFactory)throw new Error("expect shuntApiHosts");var t=(new Ls).create({convertIdToUrl:this.convertIdToUrl}),n=Object.freeze({resource:t});return this.magixFactory.createMagix(n,e)}},{key:"createReconstructor",value:function(e){if(!this.playerFactory)throw new Error("expect shuntApiHosts");var t=(new Ls).create({convertIdToUrl:this.convertIdToUrl}),n=Object.freeze({resource:t});return this.playerFactory.createReconstructor(n,e)}},{key:"searchSlices",value:(t=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerFactory){e.next=2;break}throw new Error("expect shuntApiHosts");case 2:return e.next=4,this.playerFactory.searchSlices(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),tu={};G(tu,{AnimationMode:function(){return yp},Boundless:function(){return wp},BoundlessEventKind:function(){return wu},CNode:function(){return Sh},CameraTransformation:function(){return gp},CanvasPaitingMode:function(){return mp},CanvasRenderMode:function(){return ph},CanvasRenderState:function(){return vp},ComponentKind:function(){return fp},DeviceType:function(){return up},LayoutKind:function(){return bp},LayoutRenderMode:function(){return kp},RectangleAdapterMode:function(){return pp},RectangleTesting:function(){return Ed},RenderLayoutMode:function(){return Su},creatHTMLRenderEngine:function(){return Mh},createCanvasRenderEngine:function(){return yh},createComponentDefinition:function(){return Sp},distance:function(){return Ip},isCanvasRenderEngine:function(){return bh},isHTMLRenderEngine:function(){return Th},midpoint:function(){return xp},unitVector:function(){return Cp}});var nu=Y(n(8322)),ru=Object.defineProperty,iu=Object.defineProperties,au=Object.getOwnPropertyDescriptors,ou=Object.getOwnPropertySymbols,su=Object.prototype.hasOwnProperty,cu=Object.prototype.propertyIsEnumerable,uu=function(e,t,n){return t in e?ru(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},lu=function(e,t){for(var n in t||(t={}))su.call(t,n)&&uu(e,n,t[n]);if(ou){var r,i=T(ou(t));try{for(i.s();!(r=i.n()).done;){n=r.value;cu.call(t,n)&&uu(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},hu=Object.freeze({debug:0,info:1,warn:2,error:3}),du=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.prefix,r=t.levelMask;C(this,e),this.prefix=n,this.levelMaskIndex=hu[r||"info"]}return P(e,[{key:"log",value:function(e,t,n){hu[t]>=this.levelMaskIndex&&(this.prefix?console[t](this.prefix,n):console[t](n))}},{key:"commit",value:function(){}},{key:"isSupportedEvents",value:function(e){return!0}}]),e}();function pu(e){var t={};for(var n in e){var r=e[n];void 0!==r&&(t[n]=r)}return t}function fu(e){if("object"!=M(e)||null===e)return e;if(e instanceof Array){var t,n=[],r=T(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push(fu(i))}}catch(e){r.e(e)}finally{r.f()}return Object.freeze(n)}var a={};for(var o in e)a[o]=fu(e[o]);return Object.freeze(a)}function vu(e,t,n){if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));return mu(e,t,n?{context:pu(n)}:{})}function mu(e,t,n){var r={debug:gu(e,"debug",t,n),info:gu(e,"info",t,n),warn:gu(e,"warn",t,n),error:gu(e,"error",t,n),withContext:function(r){return mu(e,t,{context:lu(lu({},n.context),r)})}};return Object.defineProperty(r,"context",{enumerable:!1,set:function(e){return n.context=e},get:function(){return n.context}}),Object.freeze(r)}function gu(e,t,n,r){return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0;s<a.length;++s)a[s]=bu(a[s]);var c=yu(r),u=a.join(" ");e.log(n,t,u,c)}}function yu(e){var t;if(e.context)for(var n in t||(t={}),e.context)t[n]=e.context[n];return Object.freeze(t)}function bu(e){if(e instanceof Error){var t="Error: "+e.message+"\n";return"string"==typeof e.stack?t+e.stack.replace(t,""):t}try{return"".concat(e)}catch(t){return"[".concat(M(e)," ").concat(JSON.stringify(t.message),"]")}}function ku(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=Object.freeze(pu(n));return Object.freeze({commit:function(n){e.commit(t,lu(lu({},r),n))}})}var wu,Su,xu=function(){function e(t,n){C(this,e),this.argusEvents=fu(t),this.vid=n}return P(e,[{key:"encode",value:function(e,t){var n=function(e,t){return iu(e,au(t))}(lu({},t),{vid:this.vid,lts:Date.now(),clientIP:"__#CLIENT_IP#__"}),r=this.argusEvents[e],a=r.eventID,o=r.proto,s=o.verify(n);if(s)throw new Error(s);var c=o.create(n),u=function(e){if("object"==("undefined"==typeof process?"undefined":M(process))&&process+""=="[object process]")return i.from(e).toString("base64");for(var t,n="",r=0,a=e.length;r<a;)t=e.subarray(r,Math.min(r+32768,a)),n+=String.fromCharCode.apply(null,t),r+=32768;return btoa(n)}(o.encode(c).finish()),l="whiteBoard",h=Math.floor(Date.now()/1e3),d=nu.default.hash("payload=".concat(u,"&src=").concat(l,"&ts=").concat(h));return{id:a,src:l,payload:u,qos:1===this.vid?101:1,ts:h,sign:d}}}]),e}(),Cu=function(){function e(){C(this,e),this.queue=[]}return P(e,[{key:"append",value:function(e){this.queue.push(e)}},{key:"next",get:function(){return this.queue[0]}},{key:"done",value:function(){this.queue.shift()}},{key:"length",get:function(){return this.queue.length}}]),e}(),Iu=function(){var e=u(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(n);case 3:return e.abrupt("return","break");case 6:if(e.prev=6,e.t0=e.catch(0),3!==r){e.next=10;break}throw new Error("report log failed (with ".concat(3," times failed), error: ").concat(e.t0));case 10:return e.next=12,new Promise((function(e){setTimeout(e,1e3*r)}));case 12:case"end":return e.stop()}}),e,null,[[0,6]])})),i=1;case 2:if(!(i<=3)){e.next=10;break}return e.delegateYield(r(i),"t0",4);case 4:if("break"!==e.t0){e.next=7;break}return e.abrupt("break",10);case 7:i++,e.next=2;break;case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Pu=function(){function e(t,n,r,i){C(this,e),this.logQueue=t,this.resourceURL=n,this.request=r,this.warnLog=i}var t;return P(e,[{key:"report",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logQueue.append(t),1!==this.logQueue.length){e.next=19;break}case 1:if(!(n=this.logQueue.next)){e.next=16;break}return e.prev=3,e.next=6,Iu((function(e){return r.request(e,r.resourceURL)}),n);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.warnLog(e.t0);case 11:return e.prev=11,this.logQueue.done(),e.finish(11);case 14:e.next=17;break;case 16:return e.abrupt("break",19);case 17:e.next=1;break;case 19:case"end":return e.stop()}}),e,this,[[3,8,11,14]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Mu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};C(this,e),this.events={},this.initListeners("debug",t.debug),this.initListeners("info",t.info),this.initListeners("warn",t.warn),this.initListeners("error",t.error)}return P(e,[{key:"on",value:function(e,t){var n;(n=this.events[e]).push.apply(n,p(Array.isArray(t)?t:[t]))}},{key:"initListeners",value:function(e,t){return this.events[e]=[],t&&this.on(e,t)}},{key:"emit",value:function(e,t){this.events[e].forEach((function(e){try{var n=e(t);n instanceof Promise&&n.catch(console.error)}catch(e){console.error(e)}}))}}]),e}(),Tu=Y(n(67294)),Au=Y(n(67294)),Eu=Y(n(67294)),Ou=Y(n(51206)),Ru=Y(n(67294)),Nu=Y(n(67294)),Lu=Y(n(67294)),ju=Y(n(67294)),Du=Y(n(86254)),Fu=Y(n(67294)),zu=Y(n(67294)),Bu=Y(n(67294)),Uu=Y(n(73935)),Vu=Y(n(67294)),Wu=Y(n(67294)),Hu=Y(n(90646)),_u=Object.defineProperty,Gu=Object.defineProperties,Yu=Object.getOwnPropertyDescriptors,Xu=Object.getOwnPropertySymbols,Qu=Object.prototype.hasOwnProperty,Ku=Object.prototype.propertyIsEnumerable,qu=function(e,t,n){return t in e?_u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Zu=function(e,t){for(var n in t||(t={}))Qu.call(t,n)&&qu(e,n,t[n]);if(Xu){var r,i=T(Xu(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Ku.call(t,n)&&qu(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Ju=function(e,t){return Gu(e,Yu(t))};!function(e){e.MouseDown="MouseDown",e.MouseMove="MouseMove",e.MouseUp="MouseUp",e.MouseLeave="MouseLeave",e.MouseWheel="MouseWheel",e.TouchStart="TouchStart",e.TouchMove="TouchMove",e.TouchEnd="TouchEnd",e.TouchCancel="TouchCancel",e.SortedTouchStart="SortedTouchStart",e.SortedTouchMove="SortedTouchMove",e.SortedTouchEnd="SortedTouchEnd",e.SortedTouchCancel="SortedTouchCancel",e.KeyDown="KeyDown",e.KeyUp="KeyUp",e.MetaKeyUp="MetaKeyUp"}(wu||(wu={})),function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"}(Su||(Su={}));var $u=function(){function e(t){C(this,e),this.definitions={},this.id="".concat(e.nextId),this.orderIndex=t,e.nextId+=1}return P(e,[{key:"addDefinition",value:function(e){this.definitions[e.id]=e}}]),e}(),el=$u;el.nextId=0;var tl,nl=function(){function e(t,n,r){C(this,e),this._ratio=1,this._visibility=!0,this._size=Object.freeze(Zu({},t)),this.dirtyNotify=n,this.onSetupCanvas=r}return P(e,[{key:"size",get:function(){return this._size},set:function(e){(this._size.width!==e.width||this._size.height!==e.height)&&(this._size=Object.freeze(Zu({},e)),this.hasNextCanvasNode&&this._visibility&&this.refreshSize())}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility!==e&&(this._visibility=e,this.hasNextCanvasNode&&this._visibility&&this.refreshSize(),this.refreshVisibility())}},{key:"ratio",get:function(){return this._ratio}},{key:"setRatio",value:function(e){this._ratio=e}},{key:"getRatioWithContext",value:function(e){var t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(1,(window.devicePixelRatio||1)/t)}}],[{key:"setCanvasSize",value:function(e,t,n){(e.width!==t||e.height!==n)&&(e.width=t,e.height=n)}}]),e}();!function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.Safari=2]="Safari",e[e.IE=3]="IE",e[e.Other=4]="Other",e[e.Unkown=5]="Unkown"}(tl||(tl={}));var rl=function(){function e(){C(this,e),this.kind=5}return P(e,[{key:"getContext",value:function(e){var t=e.getContext("2d");switch(t.imageSmoothingEnabled=!1,this.kind){case 0:t.mozImageSmoothingEnabled=!1;break;case 1:t.oImageSmoothingEnabled=!1;break;case 2:t.webkitImageSmoothingEnabled=!1;break;case 3:t.msImageSmoothingEnabled=!1;break;case 5:void 0!==t.mozImageSmoothingEnabled?(t.mozImageSmoothingEnabled=!1,this.kind=0):void 0!==t.oImageSmoothingEnabled?(t.oImageSmoothingEnabled=!1,this.kind=1):void 0!==t.webkitImageSmoothingEnabled?(t.webkitImageSmoothingEnabled=!1,this.kind=2):void 0!==t.msImageSmoothingEnabled&&(t.msImageSmoothingEnabled=!1,this.kind=3)}return t}}]),e}(),il=new rl;function al(e){return il.getContext(e)}var ol=function(e){g(n,e);var t=b(n);function n(){var e;return C(this,n),(e=t.apply(this,arguments)).canvas=null,e.canvasIndex=1,e.canvasSizeSetter=null,e}return P(n,[{key:"hasNextCanvasNode",get:function(){return!!this.canvas}},{key:"nextCanvasNode",value:function(){var e=null;if(this.canvas){var t=this.canvas;e=[t.node1,t.node2][this.canvasIndex-1]}return e}},{key:"updateToNextBuffering",value:function(){if(this.canvas)switch(this.refreshVisibility(),this.canvasIndex){case 1:this.canvasIndex=2;break;case 2:this.canvasIndex=1}}},{key:"get2DContext",value:function(e){return al(e.canvas)}},{key:"refreshSize",value:function(){var e;if(this.canvas){var t=this.canvas.node1.canvas,r=this.canvas.node2.canvas;if(!t.getContext("2d")||!r.getContext("2d"))throw new Error("cannot find 2d context from canvas");var i=Math.ceil(this.ratio*this.size.width),a=Math.ceil(this.ratio*this.size.height);n.setCanvasSize(t,i,a),n.setCanvasSize(r,i,a),null==(e=this.canvasSizeSetter)||e.call(this,{width:i/this.ratio,height:a/this.ratio})}}},{key:"refreshVisibility",value:function(){if(this.canvas){var e=this.canvas.node1.canvas,t=this.canvas.node2.canvas;if(this.visibility)switch(this.canvasIndex){case 1:e.style.visibility="visible",t.style.visibility="hidden";break;case 2:e.style.visibility="hidden",t.style.visibility="visible"}else e.style.visibility="hidden",t.style.visibility="hidden"}}},{key:"setCanvas",value:function(e){var t,n,r,i,a,o,s,c=!1;if(e){var u=l(e,2),h=u[0],d=u[1];if(this.canvas){var p=this.canvas,f=p.node1,v=p.node2;(f.canvas!==h||v.canvas!==d)&&(null==(t=f.dirty)||t.release(),null==(n=v.dirty)||n.release(),this.canvas=null)}this.canvas||(c=!0,this.canvas=Object.freeze({node1:Object.freeze({canvas:h,dirty:null==(r=this.dirtyNotify)?void 0:r.createDirty()}),node2:Object.freeze({canvas:d,dirty:null==(i=this.dirtyNotify)?void 0:i.createDirty()})}))}else this.canvas&&(null==(a=this.canvas.node1.dirty)||a.release(),null==(o=this.canvas.node2.dirty)||o.release(),this.canvas=null);c&&(this.setRatio(this.getRatioWithCanvasPair(this.canvas)),this.refreshSize(),this.refreshVisibility(),null==(s=this.onSetupCanvas)||s.call(this))}},{key:"getRatioWithCanvasPair",value:function(e){var t=e.node1.canvas,n=e.node2.canvas;return Math.max(this.getRatioWithContext(al(t)),this.getRatioWithContext(al(n)))}},{key:"getRender",value:function(){var e=this;return function(t){g(r,t);var n=b(r);function r(t){var i;return C(this,r),(i=n.call(this,t)).canvas1=null,i.canvas2=null,i.onSetCanvas1Ref=function(e){i.canvas1=e,i.refreshCanvas()},i.onSetCanvas2Ref=function(e){i.canvas2=e,i.refreshCanvas()},i.state=Zu({},e.size),e.canvasSizeSetter=function(e){return i.setState(e)},i}return P(r,[{key:"componentWillUnmount",value:function(){e.canvasSizeSetter=null}},{key:"refreshCanvas",value:function(){this.canvas1&&this.canvas2?e.setCanvas([this.canvas1,this.canvas2]):e.setCanvas(null)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.style,r=this.state,i=r.width,a=r.height,o=Ju(Zu({},n),{width:i,height:a});return[(0,Au.createElement)("canvas",{key:"canvas1",className:t,ref:this.onSetCanvas1Ref,style:o}),(0,Au.createElement)("canvas",{key:"canvas2",className:t,ref:this.onSetCanvas2Ref,style:o})]}}]),r}(Au.Component)}}]),n}(nl),sl=function(e){g(n,e);var t=b(n);function n(){var e;return C(this,n),(e=t.apply(this,arguments)).shouldWrapContext=!1,e.isCanvasReadyOnSarari=!1,e.canvasNode=null,e.canvasSizeSetter=null,e.setCanvas=function(t){var n,r,i,a,o=!1;t?(e.canvasNode&&e.canvasNode.canvas!==t&&(null==(n=e.canvasNode.dirty)||n.release(),e.canvasNode=null),e.canvasNode||(o=!0,e.canvasNode={canvas:t,dirty:null==(r=e.dirtyNotify)?void 0:r.createDirty()})):e.canvasNode&&(null==(i=e.canvasNode.dirty)||i.release(),e.canvasNode=null),o&&(e.setRatio(e.getRatioWithContext(al(e.canvasNode.canvas))),e.refreshSize(),e.refreshVisibility(),null==(a=e.onSetupCanvas)||a.call(w(e)))},e}return P(n,[{key:"hasNextCanvasNode",get:function(){return!!this.canvasNode}},{key:"nextCanvasNode",value:function(){return this.canvasNode}},{key:"updateToNextBuffering",value:function(){}},{key:"get2DContext",value:function(e){return al(e.canvas)}},{key:"refreshSize",value:function(){var e;if(this.canvasNode){var t=this.canvasNode.canvas;if(!t.getContext("2d"))throw new Error("cannot find 2d context from canvas");var r=Math.ceil(this.ratio*this.size.width),i=Math.ceil(this.ratio*this.size.height);n.setCanvasSize(t,r,i),null==(e=this.canvasSizeSetter)||e.call(this,{width:r/this.ratio,height:i/this.ratio})}this.refreshIsCanvasReadyOnSarari()}},{key:"refreshVisibility",value:function(){if(this.canvasNode){var e=this.canvasNode.canvas;this.visibility?e.style.visibility="visible":e.style.visibility="hidden"}this.refreshIsCanvasReadyOnSarari()}},{key:"refreshIsCanvasReadyOnSarari",value:function(){var e=this.size,t=this.visibility,n=this.hasNextCanvasNode&&t&&e.width>0&&e.height>0;this.isCanvasReadyOnSarari!==n&&(this.isCanvasReadyOnSarari=n,n&&(this.shouldWrapContext=!0))}},{key:"getRender",value:function(){var e=this;return function(t){g(r,t);var n=b(r);function r(t){var i;return C(this,r),(i=n.call(this,t)).state=Zu({},e.size),e.canvasSizeSetter=function(e){return i.setState(e)},i}return P(r,[{key:"componentWillUnmount",value:function(){e.canvasSizeSetter=null}},{key:"render",value:function(){var t=this.props,n=t.className,r=t.style,i=this.state,a=i.width,o=i.height,s=Ju(Zu({},r),{width:a,height:o});return(0,Eu.createElement)("canvas",{key:"canvas1",className:n,ref:e.setCanvas,style:s})}}]),r}(Eu.Component)}}]),n}(nl);function cl(e,t,n){return new ol(e,t,n)}function ul(e,t,n){return new sl(e,t,n)}var ll,hl=function(){function e(){C(this,e),this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}return P(e,[{key:"recordPaintFloat",value:function(){this.paintFloatCount+=1}},{key:"recordGenerateCache",value:function(){this.generateCacheCount+=1}},{key:"recordPaintCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.paintCacheCount+=e}},{key:"recordFuseCache",value:function(){this.fuseCacheCount+=1}},{key:"recordFuse",value:function(e){this.fuseCount+=e}},{key:"recordSplit",value:function(){this.splitCount+=1}},{key:"clear",value:function(){this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}},{key:"print",value:function(){console.log("\n========="),console.log("paintFloatCount",this.paintFloatCount),console.log("generateCacheCount",this.generateCacheCount),console.log("paintCacheCount",this.paintCacheCount),console.log("fuseCacheCount",this.fuseCacheCount),console.log("fuseCount",this.fuseCount),console.log("splitCount",this.splitCount),this.clear()}}]),e}(),dl=Object.freeze({forEach:function(){return!1}});!function(e){e[e.Fusion=0]="Fusion",e[e.Rejection=1]="Rejection"}(ll||(ll={}));var pl=function(){function e(t,n,r){var i=this;C(this,e),this.cells={},this.forEach=function(t){if(0===i.mode)for(var n in i.cells){var r=i.cells[n],a=r.row,o=r.column;if(t(a,o))return!0}return i.range.forEach((function(n,r){var a=e.key(n,r);return!(i.cells[a]||!t(n,r))}))},this.mode=t,this.range=n;var a,o=T(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=e.key(s.row,s.column);this.cells[c]=s}}catch(e){o.e(e)}finally{o.f()}}return P(e,null,[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}(),fl=function(){function e(t,n,r,i){var a=this;C(this,e),this.row0=t,this.row1=n,this.column0=r,this.column1=i,this.forEach=function(e){for(var t=a.row0,n=a.row1,r=a.column0,i=a.column1,o=t;o<n;++o)for(var s=r;s<i;++s)if(e(o,s))return!0;return!1}}return P(e,[{key:"toString",value:function(){return"[row0=".concat(this.row0," row1=").concat(this.row1," column0=").concat(this.column0," column1=").concat(this.column1,"]")}},{key:"excludeForEach",value:function(e){var t=this.row0,n=this.row1,r=this.column0,i=this.column1,a=t,o=this.clamp(t,e.row0,n),s=this.clamp(t,e.row1,n),c=n,u=r,l=this.clamp(r,e.column0,i),h=this.clamp(r,e.column1,i),d=i;return{forEach:function(e){for(var t=a;t<o;++t)for(var n=r;n<i;++n)if(e(t,n))return!0;for(var p=s;p<c;++p)for(var f=r;f<i;++f)if(e(p,f))return!0;for(var v=o;v<s;++v)for(var m=u;m<l;++m)if(e(v,m))return!0;for(var g=o;g<s;++g)for(var y=h;y<d;++y)if(e(g,y))return!0;return!1}}}},{key:"clamp",value:function(e,t,n){var r=t;return r<e?r=e:r>n&&(r=n),r}},{key:"rowsCount",get:function(){return this.row1-this.row0}},{key:"columnsCount",get:function(){return this.column1-this.column0}},{key:"includes",value:function(e,t){return this.row0<=e&&e<this.row1&&this.column0<=t&&t<this.column1}},{key:"includesRange",value:function(e){var t=e.row0,n=e.row1,r=e.column0,i=e.column1;return this.row0<=t&&n<=this.row1&&this.column0<=r&&i<=this.column1}},{key:"merge",value:function(t,n,r){for(var i=new e(Math.floor(this.row0/t),Math.ceil(this.row1/t),Math.floor(this.column0/n),Math.ceil(this.column1/n)),a=i.row0,o=i.row1,s=i.column0,c=i.column1,u=a;u<o;++u)for(var l=s;l<c;++l){var h=!1,d=u*t,p=(u+1)*t,f=l*n,v=(l+1)*n;d<this.row0&&(d=this.row0,h=!0),p>this.row1&&(p=this.row1,h=!0),f<this.column0&&(f=this.column0,h=!0),v>this.column1&&(v=this.column1,h=!0);var m=new e(d,p,f,v);m.rowsCount>0&&m.columnsCount>0&&r(u,l,m,h)}return i}},{key:"fork",value:function(t,n,r){for(var i=this.row0,a=this.row1,o=this.column0,s=this.column1,c=i;c<a;++c)for(var u=o;u<s;++u)r(c,u,new e(c*t,(c+1)*t,u*n,(u+1)*n));return new e(this.row0*t,this.row1*t,this.column0*n,this.column1*n)}}],[{key:"rectToRange",value:function(t,n){var r=t.originX,i=t.originY,a=t.width,o=t.height,s=n.width,c=n.height,u=Math.floor(i/c),l=Math.floor(r/s);return new e(u,Math.floor((i+o)/c)+1,l,Math.floor((r+a)/s)+1)}},{key:"cellToRect",value:function(e,t,n){var r=n.width,i=n.height;return{originX:t*r,originY:e*i,width:r,height:i}}},{key:"calcIntersection",value:function(t,n){var r=Math.max(t.row0,n.row0),i=Math.min(t.row1,n.row1),a=Math.max(t.column0,n.column0),o=Math.min(t.column1,n.column1);return r<i&&a<o?new e(r,i,a,o):null}},{key:"calcDiff",value:function(e,t){var n=this.calcIntersection(e,t);return{addedRange:e.excludeForEach(t),removedRange:t.excludeForEach(e),keepRange:n?{forEach:n.forEach}:dl}}},{key:"isEquals",value:function(e,t){return e.row0===t.row0&&e.row1===t.row1&&e.column0===t.column0&&e.column1===t.column1}}]),e}(),vl=function(){function e(){C(this,e),this.nodes={}}return P(e,[{key:"get",value:function(t,n){var r,i=e.key(t,n);return null==(r=this.nodes[i])?void 0:r.element}},{key:"set",value:function(t,n,r){var i=e.key(t,n);return this.nodes[i]=Object.freeze({element:r,row:t,column:n,key:i}),r}},{key:"delete",value:function(t,n){var r=e.key(t,n),i=this.nodes[r];if(i)return delete this.nodes[r],i.element}},{key:"fill",value:function(e){var t=e.nodes;for(var n in t)this.nodes[n]=t[n]}},{key:"clear",value:function(e){if(e)for(var t in this.nodes)e(this.nodes[t].element);this.nodes={}}},{key:"forEach",value:function(e){for(var t in this.nodes){var n=this.nodes[t];e(n.element,n.row,n.column)}}}],[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}();function ml(e,t){if(M(e)!=M(t))return!1;if("object"!=M(e)||null===e)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){for(var n in e){if(!(n in t))return!1;if(!ml(e[n],t[n]))return!1}for(var r in t)if(!(r in e))return!1;return!0}if(e.constructor===Array){var i=e,a=t;if(i.length!==a.length)return!1;for(var o=0;o<i.length;++o)if(!ml(e[o],t[o]))return!1;return!0}return!0}function gl(e){for(var t in e)return!0;return!1}var yl=function(){function e(t){C(this,e),this.rate=t.rate,this.bucketUnitSize=Object.freeze(Zu({},t.bucketUnitSize)),this.favorBucketsCount=t.favorBucketsCount,this.tree=t.tree,this.visions=t.visions,this.bucketFactory=t.bucketFactory,this.visibleNodes=this.initVisibleNodes(this.visions),this.toScreenPoint=t.toScreenPoint,this.onLeafNodeVisible=t.onLeafNodeVisible,this.onLeafNodeInvisible=t.onLeafNodeInvisible,this.visionCover=this.calcVisionCover(t.visionRectangle),this._projectiveSize=this.calcProjectiveSize(this.visionCover,t.scale),this.buckets=new vl,this.searchAndFillVisibleNodes(this.visionCover.range,this._projectiveSize,this.visionCover.unitSize,t.ratio)}return P(e,[{key:"projectiveSize",get:function(){return this._projectiveSize}},{key:"unitSize",get:function(){return this.visionCover.unitSize}},{key:"range",get:function(){return this.visionCover.range}},{key:"forEachBuckets",value:function(e){this.buckets.forEach(e)}},{key:"bucket",value:function(e,t){return this.buckets.get(e,t)}},{key:"update",value:function(e){var t=this;this.refreshVisibleNodes(e.diff);var n=this.updateVision(e),r=n.addedRange,i=n.keepRange,a=n.projectiveSize,o=Zu({},e.updateSet),s=!!e.dirtyCells,c=[];return i.forEach((function(n,r){var i=t.buckets.get(n,r),a=t.appendDiff(n,r,i,e,s),u=a.movedLeaves,l=a.touchedLeaves;l&&c.push({row:n,column:r,touchedLeaves:l}),Object.assign(o,u)})),r.forEach((function(n,r){var i,s=t.buckets.get(n,r),c=s.collectLeaves(),u=t.createProjectiveRect(n,r,t.visionCover.unitSize,a);null==(i=e.dirtyCells)||i.collect(n,r),Object.assign(o,c),s.updateProjectiveRect(u,e.ratio,e.refresh)})),i.forEach((function(n,r){var i=t.buckets.get(n,r),s=t.createProjectiveRect(n,r,t.visionCover.unitSize,a);i.updateProjectiveRect(s,e.ratio,e.refresh),i.handleUpdatedLeaves(o),i.fuseChunksWithNeighbours(),i.increaseChunksLife()})),e.shouldUpdateAll&&this.forEachBuckets((function(e){return e.notifyGlobalUpdate()})),this.callbackLeavesVisible(e),c}},{key:"initVisibleNodes",value:function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t}},{key:"refreshVisibleNodes",value:function(e){var t=e.addedSet,n=e.removedSet;for(var r in t)this.visibleNodes[r]=t[r];for(var i in n)delete this.visibleNodes[i]}},{key:"updateVision",value:function(t){var n=dl,r=this.visionCover.range,i=null;if(t.visionRectangle){var a=this.calcVisionCover(t.visionRectangle,this.visionCover.exponent),o=this.calcProjectiveSize(a,t.scale);if(!e.isVisionCoversEquals(a,this.visionCover)){var s=this.forkOrMegeAndGetRangeDiff(a,o);this.searchAndFillVisibleNodes(s.addedRange,o,a.unitSize,t.scale),this.visionCover=a,n=s.addedRange,r=s.keepRange}ml(o,this._projectiveSize)||(this._projectiveSize=o,i=o)}return i||(i=this._projectiveSize),{addedRange:n,keepRange:r,projectiveSize:i}}},{key:"forkOrMegeAndGetRangeDiff",value:function(e,t){var n,r=this,i=e.exponent-this.visionCover.exponent;if(i>0){var a=Math.pow(this.rate,i),o=new vl,s=[],c=this.visionCover.range.merge(a,a,(function(n,i,a,c){if(e.range.includes(n,i))if(c)s.push({row:n,column:i});else{var u=r.bucketFactory.merge(r.buckets,{range:a,unitSize:e.unitSize,projectiveRect:r.createProjectiveRect(n,i,e.unitSize,t)});o.set(n,i,u)}}));if(n=fl.calcDiff(e.range,c),s.length>0){var u=function(e,t){return new pl(ll.Fusion,e,t)}(n.addedRange,s),l=function(e,t){return new pl(ll.Rejection,e,t)}(n.keepRange,s);n=Ju(Zu({},n),{addedRange:u,keepRange:l})}this.buckets.forEach((function(e){return e.dispose()})),this.buckets=o}else if(i<0){var h=Math.pow(this.rate,Math.abs(i)),d=new vl,p=this.visionCover.range.fork(h,h,(function(n,i,a){var o=fl.calcIntersection(a,e.range),s=r.buckets.get(n,i);if(o&&s){var c=r.bucketFactory.fork(s,{range:o,unitSize:e.unitSize,projectiveRect:r.createProjectiveRect(n,i,e.unitSize,t)});d.fill(c)}}));n=fl.calcDiff(e.range,p),this.buckets.forEach((function(e){return e.dispose()})),this.buckets=d}else(n=fl.calcDiff(e.range,this.visionCover.range)).removedRange.forEach((function(e,t){var n;null==(n=r.buckets.delete(e,t))||n.dispose()}));return n}},{key:"searchAndFillVisibleNodes",value:function(e,t,n,r){var i=this,a=null;e.forEach((function(e,o){if(!a)for(var s in a={},i.visibleNodes){var c=i.rangeOfLeafNode(i.visibleNodes[s],n);c&&(a[s]=c)}var u=fl.cellToRect(e,o,n),l=i.createProjectiveRect(e,o,n,t),h=i.bucketFactory.build(i.tree,r,u,l,(function(t){var n=a[t.id];return!(!n||!n.includes(e,o))}));i.buckets.set(e,o,h)}))}},{key:"createProjectiveRect",value:function(e,t,n,r){var i=this.toScreenPoint(e,t,n);return{originX:i.x,originY:i.y,width:r.width,height:r.height}}},{key:"appendDiff",value:function(e,t,n,r,i){var a=r.diff,o=r.moveSet,s=a.addedSet,c=this.visionCover.unitSize,u=[],l=[],h=[];for(var d in s){var p=this.rangeOfLeafNode(s[d],c);p&&!p.includes(e,t)&&u.push(d)}var f={};for(var v in o){var m=o[v],g=this.rangeOfLeafNode(m,c);if(g){var y=n.has(v),b=g.includes(e,t);y&&b?f[v]=m:y&&!b?h.push(m):!y&&b&&l.push(m)}}var k=i?{}:null;if(u.length>0||l.length>0||h.length>0){if(k){var w,S=T(u);try{for(S.s();!(w=S.n()).done;){k[w.value]=!0}}catch(e){S.e(e)}finally{S.f()}var x,C=T(l);try{for(C.s();!(x=C.n()).done;){k[x.value.id]=!0}}catch(e){C.e(e)}finally{C.f()}var I,P=T(h);try{for(P.s();!(I=P.n()).done;){k[I.value.id]=!0}}catch(e){P.e(e)}finally{P.f()}}a=a.decorate({maskAdded:u,insertToAdded:l,insertToRemoved:h})}if(k){for(var M in f)k[M]=!0;for(var A in r.updateSet)k[A]=!0;for(var E in r.diff.sortedSet)k[E]=!0;for(var O in r.diff.removedSet)k[O]=!0;gl(k)||(k=null)}return n.appendDiff(a),{movedLeaves:f,touchedLeaves:k}}},{key:"isLeavesTouchBucket",value:function(e,t){var n=!1;for(var r in t)if(e.has(r)){n=!0;break}return n}},{key:"callbackLeavesVisible",value:function(e){var t=e.diff,n=t.addedSet,r=t.removedSet;for(var i in n)this.onLeafNodeVisible(n[i]);for(var a in r)this.onLeafNodeInvisible(r[a])}},{key:"calcVisionCover",value:function(t,n){var r=t.width*t.height;0===r&&(r=1);var i=this.rate,a=this.favorBucketsCount,o=this.bucketUnitSize,s=o.width*o.height,c=Math.log(r/(a*s))/(2*Math.log(i));if(void 0===n)c=Math.ceil(c);else{var u=n+e.ExponentBuffer,l=n-1-e.ExponentBuffer;c=c>u||c<l?Math.ceil(c):n}var h=Math.pow(i,c),d=Object.freeze({width:o.width*h,height:o.height*h}),p=fl.rectToRange(t,d);return Object.freeze({exponent:c,range:p,unitSize:d})}},{key:"calcProjectiveSize",value:function(e,t){var n=e.unitSize,r=n.width,i=n.height;return Object.freeze({width:Math.ceil(r*t),height:Math.ceil(i*t)})}},{key:"rangeOfLeafNode",value:function(e,t){var n=this.visions.vision(e.id);return n?fl.rectToRange(n.sceneRect,t):null}}],[{key:"isVisionCoversEquals",value:function(e,t){return e.exponent===t.exponent&&e.unitSize.width===t.unitSize.width&&e.unitSize.height===t.unitSize.height&&fl.isEquals(e.range,t.range)}}]),e}(),bl=yl;bl.ExponentBuffer=.25;var kl=function(){function e(t,n,r,i,a,o){var s=this;C(this,e),this.touch=function(){s.onRepaint(s.leaf.value)},this.screen=t,this.visions=n,this.id=r.id,this.leaf=r,this.fixedSize=i,this.render=a,this.onRepaint=o}return P(e,[{key:"refreshPayload",value:function(){this.render.updatePayload(this.leaf.value.payload)}},{key:"updateContext",value:function(e){this.render.updateContext(e)}},{key:"paint",value:function(e,t,n){var r=this.leaf.value,i=this.visions.vision(this.leaf.id),a=this.createPaintParams(e,i,r,t,n),o=i.screenRect.originX,s=i.screenRect.originY;if(n&&(o-=n.originX,s-=n.originY),e.translate(o,s),this.fixedSize){var c=i.scale;if(1!==c&&e.scale(c,c),void 0!==i.rotation){var u=i.sceneRect,l=u.width/2,h=u.height/2;e.translate(l,h),e.rotate(i.rotation),e.translate(-l,-h)}}this.render.paint(a)}},{key:"remove",value:function(){this.render.remove()}},{key:"createPaintParams",value:function(e,t,n,r,i){var a,o,s,c=t.screenRect,u=this.touch,l=this.createTailor(t,i);if(this.fixedSize){s=t.scale,o={width:n.width,height:n.height};var h=t.scale,d=t.margin,p=c.width/h-o.width,f=c.height/h-o.height,v=p/(d.left+d.right),m=f/(d.top+d.bottom);a={left:d.left*v,right:d.right*v,top:d.top*m,bottom:d.bottom*m}}else s=t.scale,a=t.margin,o={width:c.width-a.left-a.right,height:c.height-a.top-a.bottom};var g={context:e,margin:a,scale:s,size:o,tailor:l,paintingMode:r,touch:u,screen:this.screen},y=this.createFakeScreenRect(o,l);return g.screenSize=y,g.screenRect=y,g}},{key:"createTailor",value:function(e,t){var n=e.tailor,r=n.left,i=n.top,a=n.right,o=n.bottom;if(t){var s=e.screenRect,c=s.originX,u=s.originY,l=c+s.width,h=u+s.height,d=c+r,p=u+i,f=l-a,v=h-o;r=(d=Math.max(d,t.originX))-c,i=(p=Math.max(p,t.originY))-u,a=l-(f=Math.min(f,t.originX+t.width)),o=h-(v=Math.min(v,t.originY+t.width))}if(this.fixedSize){var m=e.scale;r/=m,i/=m,a/=m,o/=m}return{left:r,top:i,right:a,bottom:o}}},{key:"createFakeScreenRect",value:function(e,t){var n=t.left,r=t.top;return{originX:n,originY:r,width:e.width-t.right-n,height:e.height-t.bottom-r}}}]),e}(),wl=function(){function e(t){C(this,e),this.nodes=null,this.id="".concat(e.nextId+=1),this.life=0,this.context=t}return P(e,[{key:"isFuseable",get:function(){return this.life>=e.fuseThreshold}},{key:"isFloat",get:function(){var t;return this.life<e.floatThreshold&&1===(null==(t=this.nodes)?void 0:t.length)}},{key:"onBeforeFuse",value:function(e,t){}},{key:"onSplit",value:function(){}},{key:"onRemoved",value:function(){}},{key:Symbol.iterator,value:function(){return new xl(this.getNodes())}},{key:"previousChunk",get:function(){var e,t;return(null==(t=null==(e=this.getNodes()[0])?void 0:e.previousNode)?void 0:t.value)||null}},{key:"nextChunk",get:function(){var e,t,n=this.getNodes();return(null==(t=null==(e=n[n.length-1])?void 0:e.nextNode)?void 0:t.value)||null}},{key:"getSampleNode",value:function(){return this.nodes&&this.nodes.length>0?this.nodes[0]:null}},{key:"initWithNode",value:function(e){if(this.nodes)throw new Error("it is not init chunk");return this.nodes=[e],e.value=this,this}},{key:"initWithShadowList",value:function(e){if(this.nodes)throw new Error("it is not init chunk");this.nodes=[];var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.nodes.push(r),r.value=this}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"increaseLife",value:function(){var t=this;this.life<e.floatThreshold&&this.watchIsFloatUpdate((function(){t.life+=1}))}},{key:"cutOff",value:function(e,t){var n=this;return this.watchIsFloatUpdate((function(){var r=n.getNodes(),i=r.indexOf(e),a=r.indexOf(t);if(-1===i)throw new Error("cannot find begin node id=".concat(e.id," to cut off"));if(-1===a)throw new Error("cannot find end node id=".concat(e.id," to cut off"));var o=r.splice(a),s=n.createChunkWithNodes(o),c=r.splice(0,i+1);return{left:n.createChunkWithNodes(c),right:s,becomeBlank:0===r.length}}))}},{key:"split",value:function(e){var t=this;return this.watchIsFloatUpdate((function(){var n=t.getNodes(),r=n.indexOf(e),i=null,a=null;if(-1===r)throw new Error("cannot find node id=".concat(e.id," to split"));if(r<n.length-1){var o=n.splice(r+1);i=t.createChunkWithNodes(o)}if(r>0){var s=n.splice(0,r);a=t.createChunkWithNodes(s)}return t.onSplit(),{left:a,right:i}}))}},{key:"createChunkWithNodes",value:function(e){var t=this.context.create();t.nodes=e;var n,r=T(e);try{for(r.s();!(n=r.n()).done;){n.value.value=t}}catch(e){r.e(e)}finally{r.f()}return t.isFloat&&t.context.bind(t,e[0].related),t}},{key:"findFuseNeighboursBeforeMe",value:function(){for(var e=this,t=[];e&&(null==(e=e.previousChunk)?void 0:e.isFuseable);)t.unshift(e);return t}},{key:"findFuseNeighboursAfterMe",value:function(){for(var e=this,t=[];e&&(null==(e=e.nextChunk)?void 0:e.isFuseable);)t.push(e);return t}},{key:"unshift",value:function(e){var t=e.nodes;if(t){var n;(n=this.getNodes()).unshift.apply(n,p(t));var r,i=T(t);try{for(i.s();!(r=i.n()).done;){r.value.value=this}}catch(e){i.e(e)}finally{i.f()}}}},{key:"push",value:function(e){var t=e.nodes;if(t){var n;(n=this.getNodes()).push.apply(n,p(t));var r,i=T(t);try{for(i.s();!(r=i.n()).done;){r.value.value=this}}catch(e){i.e(e)}finally{i.f()}}}},{key:"resetLife",value:function(){this.life=0}},{key:"dispose",value:function(){this.isFloat&&this.context.unbind(this,this.nodes[0].related),this.nodes=null,this.life=0,this.onRemoved()}},{key:"getNodes",value:function(){return this.nodes||(this.nodes=[]),this.nodes}},{key:"watchIsFloatUpdate",value:function(e){var t=this.isFloat,n=this.nodes&&this.nodes[0].related,r=e(),i=this.isFloat;return!t&&i?this.context.bind(this,this.nodes[0].related):t&&!i&&this.context.unbind(this,n),r}}],[{key:"fuseEachNeighbours",value:function(e){var t=[],n={};for(var r in e)n[r]||function(){n[r]=!0;var i=e[r];i.isFuseable&&i.watchIsFloatUpdate((function(){var e=i.findFuseNeighboursBeforeMe(),r=i.findFuseNeighboursAfterMe();(e.length>0||r.length>0)&&(i.life=0,i.onBeforeFuse(e,r));for(var a=e.length-1;a>=0;a--)i.unshift(e[a]);var o,s=T(e);try{for(s.s();!(o=s.n()).done;){var c=o.value;n[c.id]=!0,t.push(c)}}catch(e){s.e(e)}finally{s.f()}var u,l=T(r);try{for(l.s();!(u=l.n()).done;){var h=u.value;i.push(h),n[h.id]=!0,t.push(h)}}catch(e){l.e(e)}finally{l.f()}}))}();return t}}]),e}(),Sl=wl;Sl.fuseThreshold=4,Sl.floatThreshold=5,Sl.nextId=0;var xl=function(){function e(t){C(this,e),this.nodes=t,this.index=0}return P(e,[{key:"next",value:function(){var e;return this.index<this.nodes.length?(e={value:this.nodes[this.index],done:!1},this.index+=1):e={value:void 0,done:!0},e}}]),e}();var Cl=function(){function e(t){C(this,e),this.addedSet={},this.sortedSet={},this.removedSet={},this.id="".concat(e.nextId),this.releaser=t,e.nextId+=1}return P(e,[{key:"fetchDiff",value:function(){var e=new Pl(this.addedSet,this.sortedSet,this.removedSet);return this.addedSet={},this.sortedSet={},this.removedSet={},e}},{key:"release",value:function(){this.releaser(this.id)}},{key:"markAdded",value:function(e){this.addedSet[e.id]=e,delete this.sortedSet[e.id],delete this.removedSet[e.id]}},{key:"markSorted",value:function(e){this.addedSet[e.id]||(this.sortedSet[e.id]=e)}},{key:"markRemoved",value:function(e){this.removedSet[e.id]=e,delete this.addedSet[e.id],delete this.sortedSet[e.id]}}]),e}(),Il=Cl;Il.nextId=0;var Pl=function(){function e(t,n,r){C(this,e),this.addedSet=t,this.sortedSet=n,this.removedSet=r}return P(e,[{key:"isBlank",get:function(){return!gl(this.addedSet)&&!gl(this.sortedSet)&&!gl(this.removedSet)}},{key:"decorate",value:function(t){var n=t.insertToAdded,r=t.insertToRemoved,i=t.maskAdded,a=null,o=null;if(n&&n.length>0){a=Zu({},this.addedSet);var s,c=T(n);try{for(c.s();!(s=c.n()).done;){var u=s.value;a[u.id]=u}}catch(e){c.e(e)}finally{c.f()}}if(i&&i.length>0){a=a||Zu({},this.addedSet);var l,h=T(i);try{for(h.s();!(l=h.n()).done;){delete a[l.value]}}catch(e){h.e(e)}finally{h.f()}}if(r&&r.length>0){o=Zu({},this.removedSet);var d,p=T(r);try{for(p.s();!(d=p.n()).done;){var f=d.value;o[f.id]=f}}catch(e){p.e(e)}finally{p.f()}}return a=a||this.addedSet,o=o||this.removedSet,new e(a,this.sortedSet,o)}}],[{key:"createInsertDiff",value:function(t){var n,r={},i=T(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]=a}}catch(e){i.e(e)}finally{i.f()}return new e(r,{},{})}}]),e}(),Ml=function(){function e(t){C(this,e);var n,r={},i=T(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]={leaf:a,nex:null}}}catch(e){i.e(e)}finally{i.f()}this.nodes=r,this.leaves=t}return P(e,[{key:"sort",value:function(){for(var e in this.leaves.splice(0),this.nodes){var t=this.nodes[e],n=this.findNextNode(t);n&&(t.nex=n,delete this.nodes[n.leaf.id])}for(var r in this.nodes)for(var i=this.nodes[r];i;)this.leaves.push(i.leaf),i=i.nex;return this.leaves}},{key:"findNextNode",value:function(e){for(var t=e.leaf.nexLeaf();t;){var n=this.nodes[t.id];if(n)return n;t=t.nexLeaf()}return null}}]),e}(),Tl=function(){function e(t,n){C(this,e),this.par=null,this.pre=null,this.nex=null,this.tree=t,this.value=n,this.id=String(e.nextId),e.nextId+=1}return P(e,[{key:"parent",get:function(){return this.par}},{key:"assertBlank",value:function(e){if(this.assertBelongsTo(e),this.par||this.pre||this.nex)throw new Error("node is not empty")}},{key:"assertAddedTo",value:function(e){if(this.assertBelongsTo(e),this.isFreeNode())throw new Error("this node did not add to any tree")}},{key:"assertBelongsTo",value:function(e){if(this.tree!==e)throw new Error("this node is belongs to another tree")}},{key:"isFreeNode",value:function(){return null===this.par}},{key:"preLeaf",value:function(){return this.pre?this.pre.lastLeaf():this.par?this.par.preLeaf():null}},{key:"nexLeaf",value:function(){return this.nex?this.nex.firstLeaf():this.par?this.par.nexLeaf():null}}]),e}(),Al=Tl;Al.nextId=0;var El=function(e){g(n,e);var t=b(n);function n(e,r){return C(this,n),t.call(this,e,r)}return P(n,[{key:"firstLeaf",value:function(){return this}},{key:"lastLeaf",value:function(){return this}}]),n}(Al),Ol=function(e){g(n,e);var t=b(n);function n(e,r){var i,o;C(this,n),(o=t.call(this,e,r)).fir=null,o.las=null,o.forEachLeaves=function(e){for(var t=o.fir;t;)t instanceof El?e(t):t.forEachLeaves(e),t=t.nex};var s=(a(i={},Symbol.iterator,(function(){return new Nl(w(o))})),a(i,"forEach",o.forEachLeaves),i);return o.leaves=Object.freeze(s),o}return P(n,[{key:Symbol.iterator,value:function(){return new Rl(this.fir)}},{key:"nodes",get:function(){for(var e=[],t=this.fir;t;)e.push(t),t=t.nex;return e}},{key:"assertBlank",value:function(e){if(s(x(n.prototype),"assertBlank",this).call(this,e),this.fir||this.las)throw new Error("node is not empty")}},{key:"firstLeaf",value:function(){for(var e=this.fir;e;){var t=e.firstLeaf();if(t)return t;e=e.nex}return null}},{key:"lastLeaf",value:function(){for(var e=this.las;e;){var t=e.lastLeaf();if(t)return t;e=e.pre}return null}},{key:"forEach",value:function(e){for(var t=this.fir;t;)e(t),t=t.nex}},{key:"isFreeNode",value:function(){return s(x(n.prototype),"isFreeNode",this).call(this)&&this!==this.tree.root}}]),n}(Al),Rl=function(){function e(t){C(this,e),this.node=t}return P(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]),e}(),Nl=function(){function e(t){C(this,e),this.node=t.firstLeaf(),this.lastLeaf=t.lastLeaf()}return P(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node===this.lastLeaf?this.node=null:this.node=this.node.nexLeaf()):e={value:void 0,done:!0},e}}]),e}(),Ll=function(){function e(t){C(this,e),this.bufferMap={},this._root=new Ol(this),t&&t(this)}return P(e,[{key:"root",get:function(){return this._root}},{key:"createDiffBuffer",value:function(){var e=this,t=new Il((function(t){return delete e.bufferMap[t]}));return this.bufferMap[t.id]=t,t}},{key:"wrapLeaf",value:function(e){return new El(this,e)}},{key:"wrapGroup",value:function(e){return new Ol(this,e)}},{key:Symbol.iterator,value:function(){return this._root.leaves[Symbol.iterator]()}},{key:"forEach",value:function(e){return this._root.leaves.forEach(e)}},{key:"append",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._root,n=e,r=t;n.assertBlank(this),r.assertAddedTo(this),this.appendTo(n,r),this.markAdded(n)}},{key:"addAfter",value:function(e,t){var n=e,r=t;if(n.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add after root");this.addAfterTo(n,r),this.markAdded(n)}},{key:"addBefore",value:function(e,t){var n=e,r=t;if(n.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add before root");this.addBeforeTo(n,r),this.markAdded(n)}},{key:"remove",value:function(e){var t=e;t.assertAddedTo(this),this.removeFrom(t),this.markRemoved(t)}},{key:"moveAppend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._root,n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.appendTo(n,r),this.markSorted(n)}},{key:"moveAfter",value:function(e,t){var n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.addAfterTo(n,r),this.markSorted(n)}},{key:"moveBefore",value:function(e,t){var n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.addBeforeTo(n,r),this.markSorted(n)}},{key:"appendTo",value:function(e,t){e.par=t,t.las?(e.pre=t.las,t.las.nex=e,t.las=e):(t.fir=e,t.las=e)}},{key:"addAfterTo",value:function(e,t){var n=t.nex,r=t.par;if(!r)throw new Error("cannot add after root");e.pre=t,e.nex=n,e.par=r,t.nex=e,n&&(n.pre=e),r.las===t&&(r.las=e)}},{key:"addBeforeTo",value:function(e,t){var n=t.pre,r=t.par;if(!r)throw new Error("cannot add before root");e.nex=t,e.pre=n,e.par=r,t.pre=e,n&&(n.nex=e),r.fir===t&&(r.fir=e)}},{key:"removeFrom",value:function(e){var t=e.pre,n=e.nex,r=e.par;if(!r)throw new Error("cannot remove root");t&&(t.nex=n),n&&(n.pre=t),r.fir===e&&(r.fir=n),r.las===e&&(r.las=t),e.par=null,e.pre=null,e.nex=null}},{key:"sortLeaves",value:function(e){return e.length<=1?e:new Ml(e).sort()}},{key:"sort",value:function(e,t){var n=e;n.assertAddedTo(this);var r=n.nodes,i=p(r).sort(t);this.rebuildList(n,i),this.checkAndMarkSorted(r,i)}},{key:"rebuildList",value:function(e,t){t.length>0&&(e.fir=t[0],e.las=t[t.length-1]);for(var n=null,r=0;r<t.length;++r){var i=t[r];n&&(n.nex=i),i.pre=n,n=i}n&&(n.nex=null)}},{key:"checkAndMarkSorted",value:function(e,t){for(var n={},r={},i=0;i<e.length;++i){n[e[i].id]=i}var a,o=[],s=!1,c=null,u=0,l=-1,h=T(t);try{for(h.s();!(a=h.n()).done;){var d=n[a.value.id];if(c){var p=!1,f=c[c.length-1];if(d<=f)p=!0;else switch(c.length){case 0:break;case 1:s=d===f+1;break;default:d===f+1!==s&&(p=!0)}p?(o.push(c),c.length>u&&(u=c.length,l=o.length-1),c=[d]):c.push(d)}else c=[d]}}catch(e){h.e(e)}finally{h.f()}if(c&&(o.push(c),c.length>u&&(u=c.length,l=o.length-1)),-1!==l){for(var v=o[l],m=v[0],g=v[v.length-1],y=l-1;y>=0;y--){var b=o[y];if(b[b.length-1]<m)m=b[0];else{var k,w=T(b);try{for(w.s();!(k=w.n()).done;){var S=e[k.value];r[S.id]=S}}catch(e){w.e(e)}finally{w.f()}}}for(var x=l+1;x<o.length;x++){var C=o[x];if(C[0]>g)g=C[C.length-1];else{var I,P=T(C);try{for(P.s();!(I=P.n()).done;){var M=e[I.value];r[M.id]=M}}catch(e){P.e(e)}finally{P.f()}}}}for(var A in r)this.markSorted(r[A])}},{key:"markAdded",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof El)n.markAdded(e);else{var r,i=T(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markAdded(a)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"markSorted",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof El)n.markSorted(e);else{var r,i=T(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markSorted(a)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"markRemoved",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof El)n.markRemoved(e);else{var r,i=T(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markRemoved(a)}}catch(e){i.e(e)}finally{i.f()}}}}}]),e}(),jl=function(){function e(t){C(this,e),this.pre=null,this.nex=null,this.id=t.id,this.related=t}return P(e,[{key:"previousNode",get:function(){return this.pre}},{key:"nextNode",get:function(){return this.nex}}]),e}(),Dl=function(){function e(t){C(this,e),this.nodesSet={},this._length=0,this.fir=null,this.las=null,this.valueInitializer=t}return P(e,[{key:"length",get:function(){return this._length}},{key:"firstNode",get:function(){return this.fir}},{key:"node",value:function(e){return this.nodesSet[e]||null}},{key:"findNode",value:function(e){for(var t=this.fir;t&&!e(t);)t=t.nex;return t}},{key:Symbol.iterator,value:function(){return new Fl(this.fir)}},{key:"forEach",value:function(e){for(var t=this.fir;t;)e(t),t=t.nex}},{key:"appendDiff",value:function(e){var t=[],n=[],r=[];for(var i in e.removedSet){var a=this.nodesSet[i];a&&(this.removeNode(a),delete this.nodesSet[i],t.push(a),this._length-=1)}for(var o in e.sortedSet){var s=this.nodesSet[o];s&&!e.addedSet[o]&&(this.removeNode(s),r.push(s))}for(var c in e.addedSet)if(!this.nodesSet[c]){var u=e.addedSet[c],l=new jl(u);l.value=this.valueInitializer(l),this.nodesSet[c]=l,n.push(l),this._length+=1}for(var h=0,d=n;h<d.length;h++){var p=d[h];this.addNode(p)}for(var f=0,v=r;f<v.length;f++){var m=v[f];this.addNode(m)}return{removedNodes:t,addedNodes:n,sortedNodes:r}}},{key:"filter",value:function(t){var n,r=new e(this.valueInitializer),i=T(this);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t(a)){var o=a.related,s=a.value,c=new jl(o);c.value=s,r.appendNode(c)}}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"removeNode",value:function(e){var t=e.pre,n=e.nex;t&&(t.nex=n),n&&(n.pre=t),this.fir===e&&(this.fir=n),this.las===e&&(this.las=t),e.pre=null,e.nex=null}},{key:"appendNode",value:function(e){this.las?(e.pre=this.las,this.las.nex=e,this.las=e):(this.fir=e,this.las=e),this.nodesSet[e.id]=e,this._length+=1}},{key:"addNode",value:function(e){var t=this.findPreNode(e),n=this.findNexNode(e);t?(t.nex=e,e.pre=t):this.fir=e,n?(n.pre=e,e.nex=n):this.las=e}},{key:"findPreNode",value:function(e){for(var t=e.related.preLeaf();t;){var n=this.nodesSet[t.id];if(n)return n;t=t.preLeaf()}return null}},{key:"findNexNode",value:function(e){for(var t=e.related.nexLeaf();t;){var n=this.nodesSet[t.id];if(n)return n;t=t.nexLeaf()}return null}}],[{key:"create",value:function(t){var n,r=new e(t.valueInitializer),i=t.initLeafFilter||e.alwaysTrue,a=T(t.tree);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(i(o)){var s=new jl(o);s.value=r.valueInitializer(s),r.appendNode(s)}}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"alwaysTrue",value:function(){return!0}},{key:"merge",value:function(t){if(t.length>0){var n,r=new e(t[0].valueInitializer),i=r.nodesSet,a=T(t);try{for(a.s();!(n=a.n()).done;){var o,s=T(n.value);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=c.id,l=c.related,h=c.value;if(!i[u]){var d=new jl(l);d.value=h,i[u]=d,r._length+=1,r.addNode(d)}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}return r}return null}}]),e}(),Fl=function(){function e(t){C(this,e),this.node=t}return P(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]),e}(),zl=function(){function e(t){C(this,e),this.visions=t}return P(e,[{key:"build",value:function(e,t,n,r,i){var o,s=this.canvasPool,c=this.chunkContext,u=Dl.create({tree:e,initLeafFilter:null!=i?i:function(){return!1},valueInitializer:function(){return null}});if(i&&u.length>0){var l=c.create().initWithShadowList(u);o=a({},l.id,l),l.isFloat&&c.bind(l,l.getSampleNode().related)}return this.create({ratio:t,canvasPool:s,rectangle:n,chunks:o,projectiveRect:r,shadowList:u,chunkContext:c})}},{key:"merge",value:function(e,t){var n=t.range,r=t.unitSize,i=t.projectiveRect,a=[],o=1;n.forEach((function(t,n){var r=e.get(t,n);a.push(r.shadowList),o=r.ratio}));var s=this.canvasPool,c=this.chunkContext,u=Dl.merge(a),l={};if(u.length>0){var h=c.create().initWithShadowList(u);l[h.id]=h,h.isFloat&&c.bind(h,h.getSampleNode().related)}var d=n.row0*n.rowsCount,p=n.column0*n.columnsCount,f=fl.cellToRect(d,p,r);return this.create({ratio:o,canvasPool:s,rectangle:f,shadowList:u,chunks:l,projectiveRect:i,chunkContext:c})}},{key:"fork",value:function(e,t){var n=this,r=t.range,i=t.unitSize,a=t.projectiveRect,o=this.canvasPool,s=this.chunkContext,c={},u=new vl;return e.shadowList.forEach((function(e){var t=n.visions.vision(e.related.id);if(t){var r=fl.rectToRange(t.sceneRect,i);c[e.id]=r}})),r.forEach((function(t,r){var l=e.shadowList.filter((function(e){var n;return!!(null==(n=c[e.id])?void 0:n.includes(t,r))})),h={};if(l.length>0){var d=s.create().initWithShadowList(l);h[d.id]=d,s.bind(d,d.getSampleNode().related)}u.set(t,r,n.create({canvasPool:o,shadowList:l,chunks:h,projectiveRect:a,chunkContext:s,ratio:e.ratio,rectangle:fl.cellToRect(t,r,i)}))})),u}}]),e}(),Bl=function(){function e(t){C(this,e),this.id="".concat(e.nextId+=1),this.chunkContext=t.chunkContext,this.rectangle=t.rectangle,this._ratio=t.ratio,this._projectiveRect=t.projectiveRect,this.shadowList=t.shadowList,this.chunks=t.chunks||{}}return P(e,[{key:"ratio",get:function(){return this._ratio}},{key:"projectiveRect",get:function(){return this._projectiveRect}},{key:"firstChunk",get:function(){var e=this.shadowList.firstNode;return e?e.value:null}},{key:Symbol.iterator,value:function(){return new Vl(this.firstChunk)}},{key:"has",value:function(e){return null!==this.shadowList.node(e)}},{key:"findChunk",value:function(e){var t=null,n=this.shadowList.node(e.id);return n&&(t=this.findChunkByNode(n)),t}},{key:"collectLeaves",value:function(){var e={};for(var t in this.chunks){var n,r=T(this.chunks[t]);try{for(r.s();!(n=r.n()).done;){var i=n.value;e[i.id]=i.related}}catch(e){r.e(e)}finally{r.f()}}return e}},{key:"appendDiff",value:function(e){var t,n=this.shadowList.appendDiff(e),r=n.removedNodes,i=n.addedNodes,a=n.sortedNodes,o=T(a);try{for(o.s();!(t=o.n()).done;){var s=t.value;this.removeNode(s)}}catch(e){o.e(e)}finally{o.f()}var c,u=T(r);try{for(u.s();!(c=u.n()).done;){var l=c.value;this.removeNode(l)}}catch(e){u.e(e)}finally{u.f()}var h,d=T(i);try{for(d.s();!(h=d.n()).done;){var p=h.value;this.addNode(p)}}catch(e){d.e(e)}finally{d.f()}var f,v=T(a);try{for(v.s();!(f=v.n()).done;){var m=f.value;this.addNode(m)}}catch(e){v.e(e)}finally{v.f()}}},{key:"removeNode",value:function(e){var t=this.findChunkByNode(e);if(t){var n=this.chunkContext,r=t.split(e),i=r.left,a=r.right;i&&(this.chunks[i.id]=i,i.isFloat&&n.bind(i,i.getSampleNode().related)),a&&(this.chunks[a.id]=a,a.isFloat&&n.bind(a,a.getSampleNode().related)),delete this.chunks[t.id],t.dispose()}}},{key:"addNode",value:function(e){var t=this.chunkContext,n=this.previousNode(e),r=null==n?void 0:n.value,i=this.nextNode(e),a=null==i?void 0:i.value;if(r&&r===a){var o=r,s=o.cutOff(n,i),c=s.left,u=s.right,l=s.becomeBlank;this.chunks[c.id]=c,this.chunks[u.id]=u,c.isFloat&&t.bind(c,c.getSampleNode().related),u.isFloat&&t.bind(u,u.getSampleNode().related),l?(delete this.chunks[o.id],o.dispose()):o.resetLife()}var h=this.chunkContext.create().initWithNode(e);this.chunks[h.id]=h,t.bind(h,h.getSampleNode().related)}},{key:"previousNode",value:function(e){for(var t=e.previousNode;t&&!t.value;)t=t.previousNode;return t}},{key:"nextNode",value:function(e){for(var t=e.nextNode;t&&!t.value;)t=t.nextNode;return t}},{key:"findChunkByNode",value:function(e){var t=e.value,n=null;if(t&&(n=this.chunks[t.id])!==t)throw new Error("invalid node");return n}},{key:"handleUpdatedLeaves",value:function(e){for(var t in e){var n=this.shadowList.node(t);if(null==n?void 0:n.value){var r=n.value,i=r.split(n),a=i.left,o=i.right,s=this.chunkContext;a&&(this.chunks[a.id]=a,a.isFloat&&s.bind(a,a.getSampleNode().related)),o&&(this.chunks[o.id]=o,o.isFloat&&s.bind(o,o.getSampleNode().related)),r.resetLife()}}}},{key:"fuseChunksWithNeighbours",value:function(){var e,t=this.chunks,n=T(Sl.fuseEachNeighbours(t));try{for(n.s();!(e=n.n()).done;){var r=e.value;delete t[r.id],r.dispose()}}catch(e){n.e(e)}finally{n.f()}}},{key:"increaseChunksLife",value:function(){var e=this.chunks;for(var t in e)e[t].increaseLife()}},{key:"updateProjectiveRect",value:function(e,t,n){this._ratio=t,this._projectiveRect=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height})}},{key:"dispose",value:function(){var e,t={},n=T(this.shadowList);try{for(n.s();!(e=n.n()).done;){var r=e.value.value;r&&(t[r.id]=r)}}catch(e){n.e(e)}finally{n.f()}for(var i in t)t[i].dispose()}},{key:"notifyGlobalUpdate",value:function(){}}]),e}(),Ul=Bl;Ul.nextId=0;var Vl=function(){function e(t){C(this,e),this.chunk=t,this.didTouchChunk={}}return P(e,[{key:"next",value:function(){var e,t;if(this.chunk){if(this.didTouchChunk[this.chunk.id])throw new Error("find duplicated chunk "+this.chunk.id);this.didTouchChunk[this.chunk.id]=this.chunk,t={value:this.chunk,done:!1},this.chunk=null!=(e=this.chunk.nextChunk)?e:null}else t={value:void 0,done:!0};return t}}]),e}(),Wl=function(){function e(t){C(this,e),this.nodes={},this.factory=t}return P(e,[{key:"create",value:function(){return this.factory(this)}},{key:"forEachCandidateFloatNodes",value:function(e){for(var t in this.nodes)e(this.nodes[t].leaf)}},{key:"bind",value:function(e,t){var n=this.nodes[t.id];n||(n=this.nodes[t.id]={leaf:t,chunks:{}}),n.chunks[e.id]=e}},{key:"unbind",value:function(e,t){var n=this.nodes[t.id];if(n){var r=n.chunks;delete r[e.id],gl(r)||delete this.nodes[t.id]}}}]),e}(),Hl=function(){function e(){C(this,e),this.refManager=new _l,this.pool=[]}return P(e,[{key:"pull",value:function(){var e;if(0===this.pool.length){var t=document.createElement("canvas");e={canvas:t,context:al(t),size:{width:0,height:0}}}else e=this.pool.pop();return e}},{key:"push",value:function(e){this.pool.push(e)}},{key:"clear",value:function(){this.pool=[]}}]),e}(),_l=function(){function e(){C(this,e),this.refs={},this._length=0}return P(e,[{key:"has",value:function(e){return e in this.refs}},{key:"set",value:function(e,t){if(!this.has(e)){var n={id:e,value:t,prev:this.tail};this.tail?(this.tail.next=n,this.tail=n):this.head=this.tail=n,this.refs[e]=n,this._length+=1}}},{key:"delete",value:function(e){if(this.has(e)){var t=this.refs[e],n=t.prev,r=t.next;n?n.next=r:this.head=r,r?r.prev=n:this.tail=n,delete this.refs[e],this._length-=1}}},{key:"shift",value:function(){var e=this.head;if(e)return this.delete(e.id),e.value}},{key:"length",get:function(){return this._length}}]),e}(),Gl=function(){function e(t){C(this,e),this.canvasPool=t,this.id="".concat(e.id+=1),this.value=null}return P(e,[{key:"get",value:function(){return this.value}},{key:"transformTo",value:function(){var t=new e(this.canvasPool);return t.value=this.value,this.value=null,t}},{key:"allocate",value:function(t){if(this.value)throw new Error("can not call allocate on non empty canvasRef!");var n;if(this.canvasPool.refManager.length<e.MaxRefsSize)n=this.canvasPool.pull();else{var r=this.canvasPool.refManager.shift();n=r.value,r.value=null}this.value=n,this.canvasPool.refManager.set(this.id,this);var i=n,a=i.canvas,o=i.context,s=n.size=t,c=s.width,u=s.height;return a.width=c,a.height=u,o.resetTransform(),n}},{key:"clear",value:function(){this.canvasPool.refManager.delete(this.id),this.value&&(this.canvasPool.push(this.value),this.value=null)}},{key:"isEmpty",value:function(){return null==this.value}},{key:"isSizeEquals",value:function(e){return!!this.value&&ml(this.value.size,e)}}]),e}(),Yl=Gl;Yl.MaxRefsSize=64,Yl.id=0;var Xl=function(e){g(n,e);var t=b(n);function n(e,r,i,a){var o;return C(this,n),(o=t.call(this,i)).ratio=1,o.cacheSize=n.initCacheSize,o.didCacheSizeUpdated=!1,o.projectiveRect=n.initProjectiveReact,o.painter=e,o.statistical=a,o.canvasPool=r,o.canvasRef=new Yl(r),o}return P(n,[{key:"onSplit",value:function(){var e;this.canvasRef.clear(),null==(e=this.statistical)||e.recordSplit()}},{key:"onRemoved",value:function(){this.canvasRef.clear()}},{key:"updatePaintingInfo",value:function(e,t,n,r){this.projectiveRect=n,this.ratio=e,ml(this.cacheSize,t)||(this.cacheSize=t,this.didCacheSizeUpdated=!0),r&&this.didCacheSizeUpdated&&(this.canvasRef.clear(),this.didCacheSizeUpdated=!1)}},{key:"onGlobalUpdate",value:function(){this.canvasRef.clear()}},{key:"paint",value:function(e){var t,n,r,i=this.canvasRef.get();if(i)r=i.canvas;else{var a=this.canvasRef.allocate(this.cacheSize),o=a.context,s=a.canvas;this.paintNodes(o,this,mp.GenerateCache),null==(t=this.statistical)||t.recordGenerateCache(),r=s}if(this.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(r,0,0);else{var c=this.cacheSize,u=c.width,l=c.height;e.drawImage(r,0,0,u,l)}null==(n=this.statistical)||n.recordPaintCache()}},{key:"onBeforeFuse",value:function(e,t){var n;if(!this.canvasRef.isEmpty()||this.hasAnyCache(e)||this.hasAnyCache(t)){var r,i=[].concat(p(e),[this],p(t)),a=i[0],o=i.slice(1),s=null;a.canvasRef.isSizeEquals(this.cacheSize)?r=a.canvasRef.transformTo():(r=new Yl(this.canvasPool),s=a);var c=this.getCanvasRefContext(r);s&&this.mergeChunk(c,s);var u,l=T(o);try{for(l.s();!(u=l.n()).done;){var h=u.value;this.mergeChunk(c,h)}}catch(e){l.e(e)}finally{l.f()}this.canvasRef.clear(),this.canvasRef=r}null==(n=this.statistical)||n.recordFuse(e.length+1+t.length)}},{key:"getCanvasRefContext",value:function(e){var t;return e.isEmpty()?t=e.allocate(this.cacheSize).context:t=e.get().context,t}},{key:"hasAnyCache",value:function(e){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){if(!t.value.canvasRef.isEmpty())return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"mergeChunk",value:function(e,t){var n,r;if(e.resetTransform(),t.canvasRef.isEmpty()){var i=this.paintNodes(e,t,mp.GenerateCache);null==(n=this.statistical)||n.recordPaintCache(i)}else{var a=t.canvasRef.get().canvas;if(t.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(a,0,0);else{var o=this.cacheSize,s=o.width,c=o.height;e.drawImage(a,0,0,s,c)}null==(r=this.statistical)||r.recordFuseCache()}}},{key:"paintNodes",value:function(e,t,n){var r,i,a=0,o=T(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;e.resetTransform(),e.scale(this.ratio,this.ratio),null==(r=this.painter(s.id))||r.paint(e,n,this.projectiveRect),a+=1}}catch(e){o.e(e)}finally{o.f()}return a}}]),n}(Sl),Ql=Xl;Ql.initCacheSize=Object.freeze({width:1,height:1}),Ql.initProjectiveReact=Object.freeze({originX:0,originY:0,width:1,height:1});var Kl,ql,Zl=function(e){g(n,e);var t=b(n);function n(e,r,i,a){var o;return C(this,n),(o=t.call(this,r)).canvasPool=i,o.chunkContext=new Wl((function(t){return new Ql(e,i,t,a)})),o}return P(n,[{key:"create",value:function(e){return new Jl(e)}}]),n}(zl),Jl=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e))._protoProjectiveRect=r.projectiveRect,r.cacheSize=Object.freeze({width:e.projectiveRect.width,height:e.projectiveRect.height}),r}return P(n,[{key:"protoProjectiveRect",get:function(){return this._protoProjectiveRect}},{key:"updateProjectiveRect",value:function(e,t,r){var i=Math.ceil(e.originX*t),a=Math.ceil(e.originY*t),o=Math.ceil((e.originX+e.width)*t)-i,c=Math.ceil((e.originY+e.height)*t)-a,u={originX:i/t,originY:a/t,width:o/t,height:c/t};s(x(n.prototype),"updateProjectiveRect",this).call(this,u,t,r),this._protoProjectiveRect=Object.freeze(Zu({},e)),this.cacheSize=Object.freeze({width:o,height:c}),this.updatePaintingInfo(this.ratio,this.cacheSize,this.projectiveRect,r)}},{key:"updateRatioAndRefresh",value:function(e,t){s(x(n.prototype),"updateProjectiveRect",this).call(this,this.projectiveRect,e,t),this.updatePaintingInfo(this.ratio,this.cacheSize,this.projectiveRect,t)}},{key:"updatePaintingInfo",value:function(e,t,n,r){var i,a=T(this);try{for(a.s();!(i=a.n()).done;){i.value.updatePaintingInfo(e,t,n,r)}}catch(e){a.e(e)}finally{a.f()}}},{key:"notifyGlobalUpdate",value:function(){var e,t=T(this);try{for(t.s();!(e=t.n()).done;){e.value.onGlobalUpdate()}}catch(e){t.e(e)}finally{t.f()}}},{key:"paint",value:function(e,t,n){for(var r,i=n||this[Symbol.iterator](),a=null;!(r=i.next()).done;){var o=r.value;if(t(o)){a=o;break}o.paint(e)}return{iterator:i,floatChunk:a}}}]),n}(Ul);!function(e){e[e.None=0]="None",e[e.CoverByTop=1]="CoverByTop",e[e.Repaint=2]="Repaint"}(Kl||(Kl={})),function(e){e[e.None=0]="None",e[e.All=1]="All",e[e.Part=2]="Part"}(ql||(ql={}));var $l=function(){function e(){C(this,e),this.dirties=[]}return P(e,[{key:"createDirty",value:function(){var e=this,t=new th((function(){var n=e.dirties.indexOf(t);-1!==n&&e.dirties.splice(n,1)}));return this.dirties.push(t),t}},{key:"canBeMoreDirty",get:function(){var e,t=!1,n=T(this.dirties);try{for(n.s();!(e=n.n()).done;){if(e.value.canBeMoreDirty){t=!0;break}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"dirtyAll",value:function(){var e,t=T(this.dirties);try{for(t.s();!(e=t.n()).done;){e.value.dirtyAll()}}catch(e){t.e(e)}finally{t.f()}}},{key:"createDirtyCellsCollection",value:function(){var e=this;return new eh(null,(function(t,n){var r,i=T(e.dirties);try{for(i.s();!(r=i.n()).done;){r.value.dirtyCells(t,n)}}catch(e){i.e(e)}finally{i.f()}}))}}]),e}(),eh=function(){function e(t,n){C(this,e),this.cells={},this.subCells={},this.parent=t,this.onCollectedCells=n}return P(e,[{key:"createSub",value:function(){return new e(this,null)}},{key:"collect",value:function(e,t){var n=th.key(e,t);n in this.cells||(this.cells[n]={row:e,column:t,level:0})}},{key:"complete",value:function(e){var t,n=this.putLevelAndCollectMaxLevel(e);this.assignSubCells(),this.parent&&this.reportToParent(this.parent),null==(t=this.onCollectedCells)||t.call(this,n,this.cells)}},{key:"putLevelAndCollectMaxLevel",value:function(e){var t=0;for(var n in this.cells){var r=this.cells[n].level;this.cells[n].level=Math.max(r,e),t=Math.max(t,e)}return Math.max(t,e)}},{key:"assignSubCells",value:function(){for(var e in this.subCells)if(e in this.cells){var t=this.cells[e].level;this.cells[e].level=Math.max(t,this.subCells[e].level)}else this.cells[e]=this.subCells[e]}},{key:"reportToParent",value:function(e){var t=e.subCells;for(var n in this.cells){var r=t[n],i=this.cells[n];r&&r.level>i.level&&(i=r),t[n]=i}}}]),e}(),th=function(){function e(t){C(this,e),this.phase=1,this.cells=null,this.release=t}return P(e,[{key:"canBeMoreDirty",get:function(){return 1!==this.phase}},{key:"takeDirtyState",value:function(){var e=new nh(this.phase,this.cells);return this.phase=0,this.cells=null,e}},{key:"dirtyAll",value:function(){this.phase=1,this.cells=null}},{key:"dirtyCells",value:function(e,t){1!==this.phase&&(e>=2&&(this.phase=2),this.cells?Object.assign(this.cells,t):this.cells=Zu({},t))}}],[{key:"key",value:function(e,t){return"".concat(e,",").concat(t)}}]),e}(),nh=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;C(this,e),this.cells=null,this.phase=t,this.cells=n}return P(e,[{key:"isDirty",value:function(e,t){switch(this.phase){case 2:if(this.cells){var n=th.key(e,t),r=this.cells[n];return!!r&&r.level>=2}return!1;case 1:return!0;default:return!1}}},{key:"forEachDirtyBuckets",value:function(e,t,n){switch(this.phase){case 1:e.forEachBuckets(n);break;case 2:if(this.cells)for(var r in this.cells){var i=this.cells[r],a=i.row,o=i.column;if(i.level>=t){var s=e.bucket(a,o);s&&n(s,a,o)}}}}}]),e}(),rh=function(){function e(t){var n=this;C(this,e),this.paintableBucketsQueue=[],this.isFloatChunk=function(e){return e.id in n.chunkToFloatMap},this.grid=t.grid,this.cleanBucketsBackground=t.cleanBucketsBackground,this.dirtyState=t.dirtyState,this.floatLeafPainter=t.floatLeafPainter,this.paintBucket=t.bucketPainter,this.chunkToFloatMap=t.floatNodesInfo.chunkToFloatMap,this.pendingByFloats=t.floatNodesInfo.pendingByFloats}return P(e,[{key:"collectBuckets",value:function(){var e=this;this.dirtyState.forEachDirtyBuckets(this.grid,Kl.CoverByTop,(function(t,n,r){e.startToPaintBucket({bucket:t,row:n,column:r},e.cleanBucketsBackground)}))}},{key:"runLoopToPaintAll",value:function(){for(;this.paintableBucketsQueue.length>0;)this.startToPaintBucket(this.paintableBucketsQueue.pop(),false);gl(this.pendingByFloats)&&this.printPendingFloatNodesWarn()}},{key:"printPendingFloatNodesWarn",value:function(){for(var e in console.warn("found pending float nodes were never paint"),this.pendingByFloats){var t=this.pendingByFloats[e],n=t.untouched,r=t.pending,i=Object.keys(n).join(", "),a=Object.keys(r).join(", ");console.warn("float ".concat(e," is waiting ").concat(i," to touch, and is padding buckets ").concat(a))}}},{key:"startToPaintBucket",value:function(e,t){var n=e.bucket,r=e.row,i=e.column,a=e.iterator,o=this.paintBucket(n,r,i,this.isFloatChunk,t,a),s=o.iterator,c=o.floatChunk;if(c){var u=this.pendingByFloatInfo(c);if(u){var l=u.untouched,h=u.pending,d=c.getSampleNode();delete l[n.id],h[n.id]={bucket:n,row:r,column:i,iterator:s},gl(l)||this.startToPaintFloatNode(d,h)}}}},{key:"pendingByFloatInfo",value:function(e){var t=this.chunkToFloatMap[e.id];return t?t.info:null}},{key:"startToPaintFloatNode",value:function(e,t){for(var n in this.floatLeafPainter(e.related),delete this.pendingByFloats[e.id],t){var r=t[n];this.paintableBucketsQueue.unshift(r)}}}],[{key:"paintBuckets",value:function(t){var n=new e(t);n.collectBuckets(),n.runLoopToPaintAll()}}]),e}();var ih=function(){function e(t){C(this,e),this.chunkContext=t.chunkContext,this.grid=t.grid,this.visions=t.visions,this.dirtyCells=t.dirtyCells}return P(e,[{key:"search",value:function(){var e=this,t={},n={},r={};return this.chunkContext.forEachCandidateFloatNodes((function(i){var a,o=i,s=null==(a=e.dirtyCells)?void 0:a.createSub(),c=e.searchCoverBuckets(o,s);if(c){var u=c.buckets,l=c.range,h={},d=!0,p=!0,f=null;for(var v in u){var m=u[v].findChunk(o);if(!m||!m.isFloat){d=!1;break}f||(f={leaf:o,info:{untouched:u,pending:{}}}),m.nextChunk&&(p=!1),h[m.id]=f}d&&f&&(Object.assign(t,h),n[o.id]=f.info,p?r[o.id]={leaf:o,range:l,dirtyCells:s}:null==s||s.complete(Kl.Repaint))}})),{chunkToFloatMap:t,pendingByFloats:n,topFloatNodes:r}}},{key:"searchCoverBuckets",value:function(e,t){var n=this,r=this.visions.visions(e.id);if(!r)return null;var i=this.visionSceneRect(r),a=fl.rectToRange(i,this.grid.unitSize),o=fl.calcIntersection(a,this.grid.range);if(!o)return null;var s={};return o.forEach((function(e,r){var i=n.grid.bucket(e,r);i&&(s[i.id]=i),null==t||t.collect(e,r)})),gl(s)?{range:o,buckets:s}:null}},{key:"visionSceneRect",value:function(e){var t=e[0].sceneRect,n=e[1];if(n){var r=n.sceneRect,i=Math.min(t.originX,r.originX),a=Math.min(t.originY,r.originY);t={originX:i,originY:a,width:Math.max(t.originX+t.width,r.originX+r.width)-i,height:Math.max(t.originY+t.height,r.originY+r.height)-a}}return t}}]),e}(),ah=function(){function e(t){var n=this;C(this,e),this.painters={},this.canvasPool=new Hl,this.floatCanvasSize=null,this.nextFloatNodesInfo=null,this.topFloatRangeSet={},this.toScreenPoint=function(e,t,r){var i=t*r.width,a=e*r.height;return{x:(i-n.camera.centerX)*n.camera.scale+n.screenSize.width/2,y:(a-n.camera.centerY)*n.camera.scale+n.screenSize.height/2}},this.onLeafNodeVisible=function(e){var t=e.value,r=n.getRenderConstructor(t.definition);if(r)try{var i=new r(t,n.context),a=new kl(n.screen,n.visions,e,n.fixedSize,i,n.onRepaint);n.painters[e.id]=a}catch(i){console.error(i)}},this.onLeafNodeInvisible=function(e){var t=n.painters[e.id];t&&(delete n.painters[e.id],t.remove())},this.fixedSize=t.fixedSize,this.willPrintGrid=!!t.willPrintGrid,this.onRepaint=t.onRepaint,this.getRenderConstructor=t.getRenderConstructor,this.screen=t.screen,this.dirtyNotify=t.dirtyNotify,this.visions=t.visions,this.camera=this.screen.camera,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.context=t.context,this.statistical=t.statistical,this.visionRectangle=this.createVisionRectangle(this.camera,this.screenSize),this.bucketFactory=new Zl((function(e){return n.painters[e]}),this.visions,this.canvasPool,this.statistical),this.grid=new bl({tree:t.tree,ratio:t.ratio,visions:t.visions,bucketFactory:this.bucketFactory,visionRectangle:this.visionRectangle,scale:this.camera.scale,rate:t.rate,bucketUnitSize:t.bucketUnitSize,favorBucketsCount:t.favorBucketsCount,toScreenPoint:this.toScreenPoint,onLeafNodeVisible:this.onLeafNodeVisible,onLeafNodeInvisible:this.onLeafNodeInvisible});var r,i=T(t.tree);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.onLeafNodeVisible(a)}}catch(e){i.e(e)}finally{i.f()}}return P(e,[{key:"dispose",value:function(){this.canvasPool.clear()}},{key:"update",value:function(e){var t,n,r,i=!1,a=!1;if(e.context){for(var o in this.painters)this.painters[o].updateContext(e.context);this.context=e.context,i=!0}for(var s in e.camera&&(this.camera=e.camera,a=!0),e.screenSize&&(this.screenSize=e.screenSize,a=!0),e.updateSet)null==(t=this.painters[s])||t.refreshPayload();a&&(this.visionRectangle=n=this.createVisionRectangle(this.camera,this.screenSize)),i||a?this.dirtyNotify.dirtyAll():this.dirtyNotify.canBeMoreDirty&&(r=this.dirtyNotify.createDirtyCellsCollection());var c=this.grid.update({shouldUpdateAll:i,dirtyCells:r,visionRectangle:n,scale:this.camera.scale,ratio:e.ratio,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:e.refresh});e.floatCanvasSize&&(this.floatCanvasSize=e.floatCanvasSize),this.nextFloatNodesInfo=this.searchFloatNodes({dirtyCells:r,visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext}),r&&(this.dirtyTouchedBuckets(r,this.nextFloatNodesInfo,c),r.complete(Kl.Repaint))}},{key:"dirtyTouchedBuckets",value:function(t,n,r){var i=n.topFloatNodes;if(i){var a,o=i.leaves,s=T(r);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=c.row,l=c.column,h=c.touchedLeaves;e.isAllKeysBelongTo(h,o)||t.collect(u,l)}}catch(e){s.e(e)}finally{s.f()}}else{var d,p=T(r);try{for(p.s();!(d=p.n()).done;){var f=d.value,v=f.row,m=f.column;t.collect(v,m)}}catch(e){p.e(e)}finally{p.f()}}}},{key:"createVisionRectangle",value:function(e,t){var n,r,i,a;return 0===e.scale?(n=0,r=0,i=0,a=0):(i=t.width/e.scale,a=t.height/e.scale,n=e.centerX-i/2,r=e.centerY-a/2),Object.freeze({originX:n,originY:r,width:i,height:a})}},{key:"paintTopFloatAndGetOrigin",value:function(e,t,n){var r,i=this.getPaintFloatNodesInfo().topFloatNodes,a=null;if(i){var o=i.zone,s=i.leaves;for(var c in a={x:o.originX,y:o.originY},t.resetTransform(),t.clearRect(0,0,e.width,e.height),s){var u=this.painters[c];u&&(t.resetTransform(),t.scale(n,n),t.translate(-a.x,-a.y),u.paint(t,mp.Directly),null==(r=this.statistical)||r.recordPaintFloat())}}return a}},{key:"paintBackground",value:function(t){var n,r,i=this,a=t.context,o=t.ratio,s=t.refresh,c=t.cleanBucketsBackground,u=t.dirtyState,l=this.getPaintFloatNodesInfo(),h=null!=(r=null==(n=l.topFloatNodes)?void 0:n.leaves)?r:e.voidLeaves;rh.paintBuckets({grid:this.grid,floatNodesInfo:l,dirtyState:u,cleanBucketsBackground:c,floatLeafPainter:function(e){var t,n=e.id,r=i.painters[n];r&&!h[n]&&(a.resetTransform(),a.scale(o,o),r.paint(a,mp.Directly),null==(t=i.statistical)||t.recordPaintFloat())},bucketPainter:function(e,t,n,r,i,c){var u=e.protoProjectiveRect,l=Math.ceil(u.originX*o),h=Math.ceil(u.originY*o),d=Math.ceil((u.originX+u.width)*o)-l,p=Math.ceil((u.originY+u.height)*o)-h;return a.resetTransform(),a.translate(l,h),e.updateRatioAndRefresh(o,s),i&&a.clearRect(0,0,d,p),e.paint(a,r,c)}}),this.willPrintGrid&&(a.resetTransform(),a.scale(o,o),this.paintGrid(a))}},{key:"completePaint",value:function(){this.nextFloatNodesInfo=null}},{key:"getPaintFloatNodesInfo",value:function(){var e;return null!=(e=this.nextFloatNodesInfo)?e:this.searchFloatNodes({visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext})}},{key:"paintGrid",value:function(e){var t=this,n=this.grid,r=n.range,i=n.unitSize;e.lineWidth=1,e.strokeStyle="rgba(0,0,0,0.5)",e.fillStyle="rgba(0,0,0,0.5)",r.forEach((function(n,r){var a=t.toScreenPoint(n,r,i),o=a.x,s=a.y,c=Math.ceil(i.width*t.camera.scale),u=Math.ceil(i.height*t.camera.scale);e.strokeRect(o,s,c,u),e.fillText("".concat(n,",").concat(r),o+2,s+14)}))}},{key:"searchFloatNodes",value:function(e){var t=function(e){return new ih(e).search()}(e),n=null,r=null;if(this.floatCanvasSize){var i=this.floatCanvasSize,a=i.width,o=i.height,s=this.searchBorderRectange(t.topFloatNodes);s&&s.width<=a&&s.height<=o&&(n=s)}var c={},u=e.dirtyCells;if(n){var l={};for(var h in t.topFloatNodes){var d=Kl.CoverByTop,p=t.topFloatNodes[h],f=p.leaf,v=p.range,m=p.dirtyCells;l[h]=f,h in this.topFloatRangeSet?delete this.topFloatRangeSet[h]:d=Kl.Repaint,null==m||m.complete(d),c[h]=v}r={zone:n,leaves:l}}else for(var g in t.topFloatNodes){var y=t.topFloatNodes[g].dirtyCells;y&&y.complete(Kl.Repaint)}if(u)for(var b in this.topFloatRangeSet)this.topFloatRangeSet[b].forEach((function(e,t){u.collect(e,t)}));return this.topFloatRangeSet=c,{topFloatNodes:r,chunkToFloatMap:t.chunkToFloatMap,pendingByFloats:t.pendingByFloats}}},{key:"searchBorderRectange",value:function(e){var t=null,n=0,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(var s in e){var c=this.visions.vision(s);if(c){var u=c.screenRect,l=u.originX,h=u.originX+u.width,d=u.originY,p=u.originY+u.height;r>l&&(r=l),i<h&&(i=h),a>d&&(a=d),o<p&&(o=p),n+=1}}if(n>0){var f=32*Math.floor(r/32),v=32*Math.floor(a/32);t={originX:f,originY:v,width:Math.ceil(i-f),height:Math.ceil(o-v)}}return t}}],[{key:"isAllKeysBelongTo",value:function(e,t){for(var n in e)if(!(n in t))return!1;return!0}}]),e}(),oh=ah;oh.voidLeaves={};var sh=new(function(){function e(){C(this,e),"undefined"==typeof performance?this.fetch=this.fetchByMilliseconds:this.fetch=this.fetchByMicroseconds}return P(e,[{key:"fetchByMilliseconds",value:function(){return 1e3*Date.now()}},{key:"fetchByMicroseconds",value:function(){return Math.floor(1e3*performance.now())}}]),e}());function ch(){return sh.fetch()}var uh="object"==("undefined"==typeof window?"undefined":M(window))&&"WebKit"===Ou.default.getParser(window.navigator.userAgent).getEngineName();function lh(){return uh}var hh=function(){function e(t){var n=this;C(this,e),this.dirtyNotify=new $l,this.refresh=!0,this.onRepaint=function(e){n.screen.scene.reportComponentUpdate(e,Jd.PropertiesUpdated)},this.setupAfterCanvasReady=function(){1!==n.backgroundCanvas.ratio&&n.update({isTransition:!1,diff:new Pl({},{},{}),updateSet:{},moveSet:{}}),n.paint()},this.renderMode=t.renderMode,this.engine=t.engine,this.screen=t.screen,this.onRenderDuration=t.onRenderDuration,this.statistical=t.willPrintStatistical?new hl:void 0,this.className=t.className,this.style=Object.freeze(Ju(Zu({},t.style),{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:this.engine.orderIndex}));var r=cl;lh()&&(r=ul);var i=new fh(this.setupAfterCanvasReady);this.floatCanvas=r(this.createFloatSize(this.screen),void 0,i.createUnlockCall()),this.floatCanvas.visibility=!1,this.backgroundCanvas=cl({width:this.screen.width,height:this.screen.height},this.dirtyNotify,i.createUnlockCall()),this.painter=new oh({ratio:1,tree:t.tree,fixedSize:t.fixedSize,screen:t.screen,visions:t.visions,context:this.screen.context,statistical:this.statistical,dirtyNotify:this.dirtyNotify,getRenderConstructor:t.getRenderConstructor,onRepaint:this.onRepaint,rate:2,favorBucketsCount:12,bucketUnitSize:Object.freeze({width:256,height:256})})}return P(e,[{key:"willInterruptEvent",value:function(){return!1}},{key:"findComponentWithTarget",value:function(){}},{key:"update",value:function(e){var t,n,r,i=ch();switch(e.screenSize&&(r=this.createFloatSize(e.screenSize),this.backgroundCanvas.size=e.screenSize,this.floatCanvas.size=r),this.renderMode){case ph.HighQuality:this.refresh=!0;break;case ph.PerformanceWhileTransition:this.refresh=!e.isTransition}this.painter.update({context:e.context,camera:e.camera,screenSize:e.screenSize,floatCanvasSize:r,diff:e.diff,ratio:this.backgroundCanvas.ratio,updateSet:e.updateSet,moveSet:e.moveSet,refresh:this.refresh}),this.backgroundCanvas.hasNextCanvasNode?(this.paint(),null==(t=this.statistical)||t.print(),this.onRenderDuration&&this.onRenderDuration(ch()-i)):null==(n=this.statistical)||n.clear()}},{key:"paint",value:function(){var e=this,t=null,n=!1,r=this.floatCanvas.nextCanvasNode(),i=this.backgroundCanvas.nextCanvasNode();if(r){var a=this.floatCanvas.get2DContext(r);a.resetTransform(),t=this.painter.paintTopFloatAndGetOrigin(r.canvas,a,this.floatCanvas.ratio)}if(i){var o=i.dirty.takeDirtyState();if(o.phase!==ql.None){var s=this.backgroundCanvas.get2DContext(i),c=o.phase===ql.Part;if(s.resetTransform(),o.phase===ql.All){var u=i.canvas,l=u.width,h=u.height;s.clearRect(0,0,l,h)}this.painter.paintBackground({context:s,ratio:this.backgroundCanvas.ratio,refresh:this.refresh,dirtyState:o,cleanBucketsBackground:c}),n=!0}}this.painter.completePaint(),(!r||!i)&&console.warn("cannot find canvas"),(r||i)&&Promise.resolve().then((function(){return e.doAfterPaint(t,r,n)})).catch((function(e){return console.error(e)}))}},{key:"doAfterPaint",value:function(e,t,n){if(e&&t){var r=e.x,i=e.y;this.floatCanvas.visibility=!0,t.canvas.style.transform="translate(".concat(r,"px, ").concat(i,"px)"),this.floatCanvas.updateToNextBuffering()}else this.floatCanvas.visibility=!1;n&&this.backgroundCanvas.updateToNextBuffering()}},{key:"dispose",value:function(){this.painter.dispose()}},{key:"createFloatSize",value:function(t){if(lh())return e.floatCanvasMaxSize;var n=e.floatCanvasMaxSize,r=t.width*e.floatCanvasRate,i=t.height*e.floatCanvasRate;return r>n.width&&(r=n.width),i>n.height&&(i=n.height),{width:r=Math.floor(r),height:i=Math.floor(i)}}},{key:"getRender",value:function(){var e=this,t=this.backgroundCanvas.getRender(),n=this.floatCanvas.getRender();return function(r){g(a,r);var i=b(a);function a(e){return C(this,a),i.call(this,e)}return P(a,[{key:"componentWillUnmount",value:function(){e.dispose()}},{key:"render",value:function(){return(0,Tu.createElement)(Tu.Fragment,null,(0,Tu.createElement)(t,{className:e.className,style:e.style}),(0,Tu.createElement)(n,{className:e.className,style:e.style}))}}]),a}(Tu.Component)}}]),e}(),dh=hh;dh.floatCanvasRate=.25,dh.floatCanvasMaxSize=Object.freeze({width:340,height:240});var ph,fh=function(){function e(t){C(this,e),this.onUnlock=t,this.didUnLock=!1,this.unlockCount=0,this.lockCount=0}return P(e,[{key:"createUnlockCall",value:function(){var e=this;return this.lockCount+=1,function(){e.unlockCount+=1,!e.didUnLock&&e.unlockCount===e.lockCount&&(e.didUnLock=!0,setTimeout(e.onUnlock,0))}}}]),e}();function vh(e,t){return void 0===e?t:e}function mh(e,t){return"number"==typeof e?e:t}!function(e){e[e.HighQuality=0]="HighQuality",e[e.PerformanceWhileTransition=1]="PerformanceWhileTransition"}(ph||(ph={}));var gh=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e.orderIndex)).constructors={},r.getRenderConstructor=function(e){return r.constructors[e.id]},r.fixedSize=e.fixedSize,r.renderMode=vh(e.renderMode,0),r}return P(n,[{key:"bind",value:function(e,t){if(!(e instanceof cp))throw new Error("it is not ComponentDefinition");if(this.constructors[e.id])throw new Error("define duplicated ComponentDefinition");this.constructors[e.id]=t,e.addEngine(this,{isVisible:t.isVisible}),this.addDefinition(e)}},{key:"createRenderLayout",value:function(e){return new dh({engine:this,screen:e.screen,tree:e.tree,visions:e.visions,fixedSize:this.fixedSize,renderMode:this.renderMode,getRenderConstructor:this.getRenderConstructor,onRenderDuration:e.onRenderDuration})}}]),n}(el);function yh(e){return new gh(e)}function bh(e){return e instanceof gh}var kh=function(){function e(t){var n=this;C(this,e),this.setCNodeElement=function(e,t){var r=e.treeNode.id,i=n.shadowList.node(r);i&&(i.value=t)},this.engine=t.engine,this.renderComponent=t.renderComponent,this.screen=t.screen,this.fixedSize=t.fixedSize,this.className=t.className,this.style=t.style,this.visions=t.visions,this.leafFilter=t.leafFilter,this.mode=t.mode,this.camera=t.initCamera||this.screen.camera,this.context=this.screen.context,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.shadowList=Dl.create({tree:t.tree,valueInitializer:function(){return null},initLeafFilter:function(e){return n.visions.includes(e.id)&&t.leafFilter(e)}})}return P(e,[{key:"willInterruptEvent",value:function(e,t,n){var r=this.findComponentWithTarget(n);if(r){var i=this.engine.getDefinitionNode(r.definition);if(i)return i.willInterruptEvent(e,r,t)}return!1}},{key:"findComponentWithTarget",value:function(e){var t=this.shadowList.findNode((function(t){var n=t.value;return!(!n||e!==n&&!n.contains(e))}));if(t){var n=t.related;if(n.value)return n.value}}},{key:"update",value:function(e){var t=this.shadowList.appendDiff(e.diff),n=!1;e.camera&&(this.camera=e.camera,n=!0),e.screenSize&&(this.screenSize=e.screenSize,n=!0),e.context&&(this.context=e.context,n=!0),(gl(e.updateSet)||gl(e.moveSet)||t.addedNodes.length>0||t.removedNodes.length>0||t.sortedNodes.length>0)&&(n=!0),this.setState&&n&&this.setState(this.getRenderLayoutState())}},{key:"getRender",value:function(){var e={self:this},t=this.renderComponent;return function(n){g(i,n);var r=b(i);function i(t){var n;return C(this,i),(n=r.call(this,t)).state=e.self.getRenderLayoutState(),e.self.setState=function(e){return n.setState(e)},n}return P(i,[{key:"componentWillUnmount",value:function(){this.setState({context:null}),e.self.setState=void 0,e.self=null}},{key:"render",value:function(){var n=this.state,r=n.camera,i=n.screenSize,a=n.context,o=e.self;return(0,Ru.createElement)(t,{engine:o.engine,screen:o.screen,mode:o.mode,visions:o.visions,leafFilter:o.leafFilter,camera:r,screenSize:i,context:a,fixedSize:o.fixedSize,className:o.className,style:o.style,onCNodeRef:o.setCNodeElement})}}]),i}(Ru.Component)}},{key:"getRenderLayoutState",value:function(){return{camera:this.camera,screenSize:this.screenSize,context:this.context}}}]),e}(),wh=function(e){g(n,e);var t=b(n);function n(){var e;return C(this,n),(e=t.apply(this,arguments)).onRef=function(t){var n=e.props,r=n.onRef,i=n.context;r&&r(t);var a=i;a&&a.onRef(a.component,t)},e}return P(n,[{key:"render",value:function(){var e=this.props,t=e.context,n=e.children,r=e.fixedMode,i=e.style,a=t;if(a){var o=a.vision,s=a.component,c=a.margin,u=o.screenRect,l=u.originX,h=u.originY,d="absolute";if(r){var p=a.screen.bounding;l+=p.left,h+=p.top,d="fixed"}var f="translate(".concat(l,"px,").concat(h,"px) scale(").concat(a.scale,",").concat(a.scale,")"),v=Zu({WebkitTransform:f,transform:f,WebkitTransformOrigin:"0px 0px 0px",transformOrigin:"0px 0px 0px",position:d,overflow:"visible",width:a.size.width+a.margin.left+a.margin.right,height:a.size.height+a.margin.top+a.margin.bottom,margin:0,paddingLeft:c.left,paddingRight:c.right,paddingTop:c.top,paddingBottom:c.bottom,zIndex:s.orderIndex},i),m=Zu({},this.props);return delete m.context,delete m.fixedMode,delete m.onRef,(0,Lu.createElement)("div",Ju(Zu({},m),{style:v,ref:this.onRef}),n)}return(0,Lu.createElement)(Lu.Fragment,null,n)}}]),n}(Lu.Component),Sh=wh,xh=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"getPreviewURL",value:function(e){if(this.props.mode===Su.Preview)return e.previewURL}},{key:"getPositionInfo",value:function(e,t,n){var r,i,a,o=this.props.fixedSize;return a=e.absoluteCoordinates?1:n,o?(i={left:t.margin.left/a,right:t.margin.right/a,top:t.margin.top/a,bottom:t.margin.bottom/a},r={width:e.width,height:e.height}):(i=t.margin,r={width:t.screenRect.width-i.left-i.right,height:t.screenRect.height-i.top-i.bottom}),{margin:i,size:r,origin:{x:t.screenRect.originX,y:t.screenRect.originY},cnodeScale:a}}},{key:"renderPreview",value:function(e,t,n,r){var i=this.props,a=i.screen,o=i.onCNodeRef,s=this.getPositionInfo(e,t,r),c=s.margin,u=s.size,l={vision:t,component:e,screen:a,onRef:o,margin:c,size:u,scale:s.cnodeScale};return(0,Nu.createElement)(Sh,{key:e.id,context:l},(0,Nu.createElement)("img",{src:n,alt:"",width:u.width,height:u.height}))}},{key:"renderLeafNode",value:function(e,t,n,r){var i=e.definition,a=this.props,o=a.engine,s=a.context,c=a.screen,u=a.onCNodeRef,l=o.getDefinitionNode(i);if(l){var h=this.getPositionInfo(e,t,r),d=h.margin,p=h.size,f=h.origin,v=h.cnodeScale,m=l.render,g={vision:t,component:e,margin:d,size:p,scale:v,screen:c,onRef:u};return(0,Nu.createElement)(m,{key:e.id,id:e.id,cnode:g,screen:c,payload:e.payload,context:s,size:p,origin:f,margin:d,scale:n,layout:o.orderIndex})}return null}},{key:"render",value:function(){var e=this,t=[],n=this.props,r=n.visions,i=n.leafFilter,a=n.style,o=n.className,s=n.engine,c=n.fixedSize;return r.forEach((function(n,r){if(i(n)){var a=n.value,o=e.getPreviewURL(a),s=c?r.scale:1;if(o)t.push(e.renderPreview(a,r,o,s));else{var u=c?1:r.scale,l=e.renderLeafNode(a,r,u,s);t.push(l)}}})),(0,Nu.createElement)("div",{className:o,style:Ju(Zu({},a),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},t)}}]),n}(Nu.Component),Ch=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.origin,r=t.size,i=t.zIndex,a=t.margin,o=t.payload,s=t.context;return n.x!==e.origin.x||n.y!==e.origin.y||r.width!==e.size.width||r.height!==e.size.height||i!==e.zIndex||a.left!==e.margin.left||a.right!==e.margin.right||a.top!==e.margin.top||a.bottom!==e.margin.bottom||o!==e.payload||s!==e.context}},{key:"render",value:function(){var e=this.props,t=e.render,n=e.screen,r=e.engine,i=e.component,a=e.context,o=e.origin,s=e.zIndex,c=e.size,u=e.margin,l=e.payload,h="translate(".concat(o.x,"px,").concat(o.y,"px)");return(0,ju.createElement)("g",{style:{transform:h,zIndex:s,WebkitTransform:h}},(0,ju.createElement)(t,{id:i.id,screen:n,payload:l,context:a,size:c,origin:o,margin:u,scale:1,layout:r.orderIndex}))}}]),n}(ju.Component),Ih=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"getPreviewURL",value:function(e){if(this.props.mode===Su.Preview)return e.previewURL}},{key:"createViewBox",value:function(){var e=this.props,t=e.screenSize,n=e.camera,r=n.scale,i=n.centerX,a=n.centerY,o=t.width/r,s=t.height/r;return Number.isNaN(o)&&(o=0),Number.isNaN(s)&&(s=0),"".concat(i-o/2," ").concat(a-s/2," ").concat(o," ").concat(s)}},{key:"render",value:function(){var e=this,t=[],n=this.props,r=n.visions,i=n.leafFilter,a=n.className,o=n.screen,s=n.engine,c=n.context,u=n.style;return r.forEach((function(n,r){if(i(n)){var a=n.value,u=s.getDefinitionNode(a.definition);if(u){var l=e.getPreviewURL(a),h={x:a.originX,y:a.originY},d={width:a.width,height:a.height};if(l)t.push((0,ju.createElement)("image",{key:a.id,x:h.x,y:h.y,width:d.width,height:d.height,xlinkHref:l}));else{var p=r.margin,f=a.orderIndex;t.push((0,ju.createElement)(Ch,{key:a.id,screen:o,engine:s,render:u.render,context:c,component:a,margin:p,size:d,zIndex:f,origin:h,payload:a.payload}))}}}})),(0,ju.createElement)("svg",{className:a,fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:this.createViewBox(),preserveAspectRatio:"xMidYMid",style:Ju(Zu({},u),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},t)}}]),n}(ju.Component),Ph=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e.orderIndex)).definitionNodes={},r.fixedSize=e.fixedSize,r.isSVG=e.isSVG,r.className=e.className,r.style=e.style&&Object.freeze(Zu({},e.style)),r}return P(n,[{key:"getDefinitionNode",value:function(e){return this.definitionNodes[e.id]}},{key:"bind",value:function(e){var t=this;return function(n){if(!(e instanceof cp))throw new Error("it is not ComponentDefinition");if(t.definitionNodes[e.id])throw new Error("define duplicated ComponentDefinition");var r;if("boolean"==typeof n.willInterruptEvent){var i=n.willInterruptEvent;r=function(){return i}}else r=n.willInterruptEvent?n.willInterruptEvent.bind(n):function(){return!1};return t.definitionNodes[e.id]=Object.freeze({willInterruptEvent:r,render:n}),e.addEngine(t,{isVisible:n.isVisible}),t.addDefinition(e),n}}},{key:"createRenderLayout",value:function(e){var t;return t=this.isSVG?Ih:xh,new kh({engine:this,screen:e.screen,mode:e.mode,initCamera:e.initCamera,tree:e.tree,visions:e.visions,leafFilter:e.leafFilter,renderComponent:t,fixedSize:this.fixedSize,className:this.className,style:this.style})}}]),n}(el);function Mh(e){return new Ph(e)}function Th(e){return e instanceof Ph}var Ah=function(){function e(){C(this,e),this.nodes={},this.touched={}}return P(e,[{key:"includes",value:function(e){return e in this.nodes}},{key:"leaf",value:function(e){var t=this.nodes[e];return t?t.leaf:null}},{key:"vision",value:function(e){var t=this.nodes[e];return t?t.visions[0]:null}},{key:"visions",value:function(e){var t=this.nodes[e];return t?t.visions:null}},{key:"bindVision",value:function(e,t){var n=e.id,r=this.nodes[n];r?r.visions[0]=t:this.nodes[n]={leaf:e,visions:[t,null]},this.touched[n]=!0}},{key:"unbindVision",value:function(e){delete this.nodes[e]}},{key:"forEach",value:function(e){for(var t in this.nodes){var n=this.nodes[t];e(n.leaf,n.visions[0])}}},{key:"completeFrame",value:function(){var e=!1;for(var t in this.touched){var n=this.nodes[t];if(n){var r=l(n.visions,1)[0];n.visions[1]=r,e=!0}}e&&(this.touched={})}},{key:"clean",value:function(){this.nodes={},this.touched={}}}]),e}(),Eh=function(){function e(t){var n=this;C(this,e),this.binder=t,this.isLeftButtonPressed=!1,this.onMouseDown=function(e){if(0===e.button&&(n.checkMouseDidUp(e),n.isLeftButtonPressed=!0,!n.binder.willInterruptMouseOrTouchEvent(e,e.target))){var t=n.binder.eventPosition(e),r={kind:wu.MouseDown,nativeEvent:e,isOnScreen:!0,pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseMove=function(e){if(0===e.button){n.checkMouseDidUp(e);var t=n.binder.eventPosition(e),r={kind:wu.MouseMove,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseLeave=function(e){if(0===e.button&&(n.checkMouseDidUp(e),e.target===n.binder.divElement)){var t=n.binder.eventPosition(e),r={kind:wu.MouseLeave,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseUp=function(e){0===e.button&&(n.isLeftButtonPressed=!1,n.fireMouseUpEvent(e))}}return P(e,[{key:"checkMouseDidUp",value:function(e){var t=0!==e.which;this.isLeftButtonPressed&&!t&&this.fireMouseUpEvent(e)}},{key:"fireMouseUpEvent",value:function(e){var t=this.binder.eventPosition(e),n={kind:wu.MouseUp,nativeEvent:e,isOnScreen:this.binder.isEventFiredOnElement(e.target,this.binder.divElement),pointOnScreen:t,pointOnScene:this.binder.toPointInScene(t.x,t.y)};this.binder.fireEvent(n)}}]),e}(),Oh=function(){function e(t){var n=this;C(this,e),this.binder=t,this.latestScale=1,this.onMouseWheel=function(e){if(!n.binder.willInterruptMouseOrTouchEvent(e,e.target)){var t=n.binder.eventPosition(e),r=e.deltaX,i=e.deltaY,a=Math.sqrt(r*r+i*i),o=0,s=0;"Windows"===n.binder.getOS()&&(a=-a),r+i<0&&(a=-a),n.isMacTouchpadTwoFingerZoom(e)?a=.5*-a:n.isMacTouchpadTwoFingerScroll(e)?(o=-r,s=-i,a=0):a*=.035;var c={kind:wu.MouseWheel,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),offsetPoint:{x:o,y:s},scale:n.adjustScale(a),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(c)}e.preventDefault()},this.onGestureStart=function(e){n.binder.willInterruptMouseOrTouchEvent(e,e.target)||(e.preventDefault(),n.latestScale=1)},this.onGestureChange=function(t){if(!n.binder.willInterruptMouseOrTouchEvent(t,t.target)){t.preventDefault();var r=(t.scale/n.latestScale-1)*e.safariScaleNumber,i={x:t.layerX,y:t.layerY},a={kind:wu.MouseWheel,nativeEvent:t,isOnScreen:n.binder.isEventFiredOnElement(t.target,n.binder.divElement),offsetPoint:{x:0,y:0},scale:n.adjustScale(r),pointOnScreen:i,pointOnScene:n.binder.toPointInScene(i.x,i.y)};n.binder.fireEvent(a)}},this.onGestureEnd=function(e){n.binder.willInterruptMouseOrTouchEvent(e,e.target)||e.preventDefault()},this.isMacTouchpadTwoFingerZoom=function(e){return-1!==navigator.platform.indexOf("Mac")&&e.ctrlKey},this.isMacTouchpadTwoFingerScroll=function(e){return-1!==navigator.platform.indexOf("Mac")&&(e.wheelDelta%120!=0||0!==e.movementX||0!==e.deltaX)}}return P(e,[{key:"adjustScale",value:function(t){return Math.max(t,e.minScaleStep)*e.scaleRate}}]),e}(),Rh=Oh;Rh.safariScaleNumber=10,Rh.minScaleStep=-40,Rh.scaleRate=.02;var Nh,Lh=function(){function e(t){var n=this;C(this,e),this.binder=t,this.onTouchStart=function(e){var t=e.target,r=!t||t&&!t.classList.contains("ppt-event-source");e.cancelable&&r&&e.preventDefault();for(var i=[],a=0;a<e.changedTouches.length;++a){var o=e.changedTouches.item(a);if(!n.binder.willInterruptMouseOrTouchEvent(e,o.target)){var s="".concat(o.identifier),c=n.binder.eventPosition(o);i.push({identifier:s,pointOnScreen:c,pointOnScene:n.binder.toPointInScene(c.x,c.y)})}}if(i.length>0){var u={kind:wu.TouchStart,nativeEvent:e,touches:i};n.binder.fireEvent(u)}},this.onTouchMove=function(e){e.cancelable&&e.preventDefault();for(var t=[],r=0;r<e.changedTouches.length;++r){var i=e.changedTouches.item(r),a="".concat(i.identifier),o=n.binder.eventPosition(i);t.push({identifier:a,pointOnScreen:o,pointOnScene:n.binder.toPointInScene(o.x,o.y)})}if(t.length>0){var s={kind:wu.TouchMove,nativeEvent:e,touches:t};n.binder.fireEvent(s)}},this.onTouchEnd=function(e){var t=e.target,r=!t||t&&!t.classList.contains("ppt-event-source");e.cancelable&&r&&e.preventDefault();var i=n.cleanAcceptedTouchesByTouchEvent(e);if(i.length>0){var a={kind:wu.TouchEnd,nativeEvent:e,touches:i};n.binder.fireEvent(a)}},this.onTouchCancel=function(e){e.cancelable&&e.preventDefault();var t=n.cleanAcceptedTouchesByTouchEvent(e);if(t.length>0){var r={kind:wu.TouchCancel,nativeEvent:e,touches:t};n.binder.fireEvent(r)}}}return P(e,[{key:"cleanAcceptedTouchesByTouchEvent",value:function(e){for(var t=[],n=0;n<e.changedTouches.length;++n){var r=e.changedTouches.item(n),i="".concat(r.identifier),a=this.binder.eventPosition(r);t.push({identifier:i,pointOnScreen:a,pointOnScene:this.binder.toPointInScene(a.x,a.y)})}return t}}]),e}(),jh=function e(t){var n=this;C(this,e),this.binder=t,this.onKeyDown=function(e){if(!n.binder.willInterruptKeyboardEvent(e,e.target)){var t=e.key,r=e.altKey,i=e.ctrlKey,a=e.shiftKey,o={kind:wu.KeyDown,nativeEvent:e,key:t,altKey:r,ctrlKey:i,shiftKey:a};n.binder.fireEvent(o)}},this.onKeyUp=function(e){var t=e.key,r=e.altKey,i=e.ctrlKey,a=e.shiftKey,o={kind:wu.KeyUp,nativeEvent:e,key:t,altKey:r,ctrlKey:i,shiftKey:a};n.binder.fireEvent(o)}},Dh=function(){function e(t,n,r){C(this,e),this.mouseEventHandler=new Eh(this),this.touchEventHandler=new Lh(this),this.wheelEventHandler=new Rh(this),this.keyboardEventHandler=new jh(this),this.divElement=n,this.eventParamMap=this.createEventParamMap(t),this.delegate=r,this.addListeners()}return P(e,[{key:"createEventParamMap",value:function(e){var t={};switch(e){case up.Desktop:t=Ju(Zu({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body}});break;case up.Touch:t=Ju(Zu({},t),{touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break;case up.Surface:t=Ju(Zu({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body},touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}})}return Object.freeze(t)}},{key:"addListeners",value:function(){for(var e in this.eventParamMap){var t=this.eventParamMap[e],n=t.method;(t.element||this.divElement).addEventListener(e,n,true)}}},{key:"release",value:function(){for(var e in this.eventParamMap){var t=this.eventParamMap[e],n=t.method;(t.element||this.divElement).removeEventListener(e,n,true)}}},{key:"fireEvent",value:function(e){this.delegate.fireEvent(e)}},{key:"getOS",value:function(){var e=window.navigator,t=e.userAgent,n=e.platform,r="";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?r="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?r="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?r="Windows":/Android/.test(t)?r="Android":!r&&/Linux/.test(n)&&(r="Linux"),r}},{key:"toPointInScene",value:function(e,t){return this.delegate.toPointInScene(e,t)}},{key:"willInterruptMouseOrTouchEvent",value:function(e,t){return!!t&&(!this.isEventFiredOnElement(t,this.divElement)||this.delegate.willInterruptEvent(e,t))}},{key:"willInterruptKeyboardEvent",value:function(e,t){return!!t&&(!!this.delegate.willInterruptEvent(e,t)||t!==document.body&&!this.isEventFiredOnElement(t,this.divElement))}},{key:"isEventFiredOnElement",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}},{key:"eventPosition",value:function(e){var t=this.divElement.getBoundingClientRect(),n=t.left,r=t.top;return{x:Math.floor(e.clientX)-n,y:Math.floor(e.clientY)-r}}}]),e}(),Fh=function(){function e(){C(this,e),this.listeners=[]}return P(e,[{key:"dispatch",value:function(e){var t,n=T(this.listeners);try{for(n.s();!(t=n.n()).done;){var r=t.value;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addListener",value:function(e){-1===this.listeners.indexOf(e)&&this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"removeAllListeners",value:function(){this.listeners.splice(0)}}]),e}();!function(e){e[e.Start=0]="Start",e[e.Update=1]="Update",e[e.End=2]="End",e[e.Other=3]="Other"}(Nh||(Nh={}));var zh=function(){function e(t,n){C(this,e),this._disable=!1,this.onCancelEvent=t,this.adapterNodes=Object.freeze(n.map((function(e){var t={},n={};return e.setEventDescriptionStateGetter&&e.setEventDescriptionStateGetter((function(e){var r=t[e];if(r)return{payload:r,isCanceled:!!n[e]}})),{adapter:e,payloads:t,canceledMap:n}})))}return P(e,[{key:"disable",get:function(){return this._disable},set:function(e){this._disable!==e&&(this._disable=e,e&&this.cancel())}},{key:"cancel",value:function(){var e,t=T(this.adapterNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.adapter,i=n.payloads,a=n.canceledMap,o={},s=!1;for(var c in i)c in a||(o[c]=i[c],a[c]=!0,s=!0);if(s){var u=r.createCancelEvent(o);u&&this.onCancelEvent(u)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"interruptEvent",value:function(e){if(this.isMetaUp(e))return{kind:wu.MetaKeyUp,nativeEvent:e.nativeEvent};var t=this.adapterNodes.find((function(t){return t.adapter.isEventAccessible(e)}));if(t){var n,r=t.adapter,i=t.canceledMap,a=r.takeEventDescription(e),o=[],s=T(a?"number"==typeof a.length?a:[a]:[]);try{for(s.s();!(n=s.n()).done;){var c=n.value;if(3===c.phase)o.push(c);else{var u=this.handleAndCheckIgnoreEventDescription(t,c),l=i[c.identifier];!u&&!l&&o.push(c)}}}catch(e){s.e(e)}finally{s.f()}return!this._disable&&o.length>0?r.convertToEvent(e,o):null}return e}},{key:"isMetaUp",value:function(e){return e.kind===wu.KeyUp&&"Meta"===e.nativeEvent.key}},{key:"handleAndCheckIgnoreEventDescription",value:function(e,t){var n=e.payloads,r=e.canceledMap,i=t.identifier,a=t.phase,o=t.payload;switch(a){case 0:return i in n||(n[i]=o,this._disable&&(r[i]=!0),!1);case 1:return!(i in n)||(n[i]=o,!1);case 2:if(i in n){var s=!!r[i];return delete n[i],delete r[i],s}return!0;default:return!0}}}]),e}(),Bh=function(){function e(){C(this,e),this.currentIdentifier=0}return P(e,[{key:"setEventDescriptionStateGetter",value:function(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function(e){return e.kind===wu.MouseDown||e.kind===wu.MouseMove||e.kind===wu.MouseUp||e.kind===wu.MouseLeave}},{key:"convertToEvent",value:function(e,t){var n=l(t,1)[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,isOnScreen:n.isOnScreen,pointOnScreen:n.pointOnScreen,pointOnScene:n.pointOnScene}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=e[n];return{kind:wu.MouseUp,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"takeEventDescription",value:function(e){e.kind===wu.MouseDown&&(this.currentIdentifier+=1);var t,n="".concat(this.currentIdentifier);switch(e.kind===wu.MouseUp&&(this.currentIdentifier+=1),e.kind){case wu.MouseDown:t=Nh.Start;break;case wu.MouseMove:case wu.MouseLeave:var r=this.getDescriptionState(n);if(r){if(r.isCanceled)return null;t=Nh.Update}else{if(!e.isOnScreen)return null;t=Nh.Other}break;case wu.MouseUp:t=Nh.End;break;default:return null}return{identifier:n,phase:t,payload:{isOnScreen:e.isOnScreen,pointOnScreen:e.pointOnScreen,pointOnScene:e.pointOnScene}}}}]),e}(),Uh=function(){function e(){C(this,e)}return P(e,[{key:"isEventAccessible",value:function(e){return e.kind===wu.TouchStart||e.kind===wu.TouchMove||e.kind===wu.TouchEnd||e.kind===wu.TouchCancel}},{key:"convertToEvent",value:function(e,t){var n,r=[],i=T(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.identifier,s=a.payload;r.push(Zu({identifier:o},s))}}catch(e){i.e(e)}finally{i.f()}return{kind:e.kind,nativeEvent:e.nativeEvent,touches:r}}},{key:"createCancelEvent",value:function(e){var t=[];for(var n in e)t.push(Zu({identifier:n},e[n]));return{kind:wu.TouchCancel,touches:t}}},{key:"takeEventDescription",value:function(e){var t;switch(e.kind){case wu.TouchStart:t=Nh.Start;break;case wu.TouchMove:t=Nh.Update;break;case wu.TouchEnd:case wu.TouchCancel:t=Nh.End;break;default:return null}var n,r=[],i=T(e.touches);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.identifier,s=a.pointOnScene,c=a.pointOnScreen;r.push({identifier:o,phase:t,payload:{pointOnScene:s,pointOnScreen:c}})}}catch(e){i.e(e)}finally{i.f()}return r}}]),e}(),Vh=function(){function e(){C(this,e)}return P(e,[{key:"isEventAccessible",value:function(e){return e.kind===wu.SortedTouchStart||e.kind===wu.SortedTouchMove||e.kind===wu.SortedTouchEnd||e.kind===wu.SortedTouchCancel}},{key:"convertToEvent",value:function(e,t){var n=l(t,1)[0],r=n.identifier,i=n.payload;return{kind:e.kind,nativeEvent:e.nativeEvent,identifier:r,pointOnScene:i.pointOnScene,pointOnScreen:i.pointOnScreen}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=n;var r=e[t],i=r.pointOnScene,a=r.pointOnScreen;return{kind:wu.SortedTouchCancel,identifier:t,pointOnScene:i,pointOnScreen:a}}},{key:"takeEventDescription",value:function(e){var t;switch(e.kind){case wu.SortedTouchStart:t=Nh.Start;break;case wu.SortedTouchMove:t=Nh.Update;break;case wu.SortedTouchEnd:case wu.SortedTouchCancel:t=Nh.End;break;default:return null}return[{identifier:e.identifier,phase:t,payload:{pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen}}]}}]),e}(),Wh=function(){function e(){C(this,e)}return P(e,[{key:"isEventAccessible",value:function(e){return e.kind===wu.KeyUp||e.kind===wu.KeyDown}},{key:"convertToEvent",value:function(e,t){var n=l(t,1)[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,key:n.key,altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=e[n];return{kind:wu.KeyUp,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"takeEventDescription",value:function(e){var t,n;if("Meta"===e.key&&(null==(t=e.nativeEvent)?void 0:t.metaKey))n=Nh.Other;else switch(e.kind){case wu.KeyDown:n=Nh.Start;break;case wu.KeyUp:n=Nh.End;break;default:return null}return{identifier:e.key,phase:n,payload:{key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}}}}]),e}(),Hh=function(){function e(){C(this,e),this.currentIdentifier=0}return P(e,[{key:"setEventDescriptionStateGetter",value:function(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function(e){return e.kind===wu.MouseWheel}},{key:"takeEventDescription",value:function(e){var t="".concat(this.currentIdentifier);this.getDescriptionState(t),this.currentIdentifier+=1;var n={isOnScreen:e.isOnScreen,pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen,offsetPoint:e.offsetPoint,scale:e.scale};return{identifier:t,phase:Nh.Other,payload:n}}},{key:"convertToEvent",value:function(e,t){return e}},{key:"createCancelEvent",value:function(e){return null}}]),e}();function _h(e){return new zh(e,[new Bh,new Uh,new Vh,new Wh,new Hh])}var Gh,Yh=function(){function e(t,n){var r=this;C(this,e),this.eventDispatcher=new Fh,this.binder=null,this.fireEvent=function(e){var t=r.continuityNode.interruptEvent(e);t&&r.eventDispatcher.dispatch(t)},this.screen=t,this.eventInterrupter=n,this.continuityNode=_h((function(e){return r.eventDispatcher.dispatch(e)}))}return P(e,[{key:"bindDivElement",value:function(e){e!==(this.binder?this.binder.divElement:null)&&(this.binder&&this.binder.release(),this.binder=e?new Dh(this.screen.deviceType,e,this):null)}},{key:"disable",get:function(){return this.continuityNode.disable},set:function(e){this.continuityNode.disable=e}},{key:"cancelCurrentContinuityEvent",value:function(){this.continuityNode.cancel()}},{key:"toPointInScene",value:function(e,t){return this.screen.convertPointToScene(e,t)}},{key:"willInterruptEvent",value:function(e,t){return!(this.disable||!this.eventInterrupter(e))||!!t&&this.screen.willInterruptEvent(e,t)}},{key:"addListener",value:function(e){this.eventDispatcher.addListener(e)}},{key:"removeListener",value:function(e){this.eventDispatcher.removeListener(e)}}]),e}(),Xh=function(){function e(t){var n=this;C(this,e),this.invoker=t,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var e=Date.now();if(e>=n.fireAt)n.timer=null,n.fireAt=-1,n.invoker();else{var t=n.fireAt-e;n.timer=setTimeout(n.invokeWhenTimeout,t)}}}return P(e,[{key:"isRunning",get:function(){return null!==this.timer}},{key:"refreshAndInvokeAfterInterval",value:function(e){var t=Date.now();if(null===this.timer)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var n=t+e;n<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=n}}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}(),Qh=function(){function e(t){var n=this;C(this,e),this.onPushedBoundlessEvent=t,this.operationBuffer=[],this.willBlockOperation=!1,this.flushingOperationBufferTimer=null,this.flushOperationBuffer=function(){if(n.operationBuffer){var e,t=T(n.operationBuffer);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}n.operationBuffer.splice(0,n.operationBuffer.length),n.willBlockOperation=!1}n.flushingOperationBufferTimer=null}}return P(e,[{key:"unknownIsMultiFingers",get:function(){return this.willBlockOperation}},{key:"startOperation",value:function(){this.willBlockOperation=!0,this.flushingOperationBufferTimer=setTimeout(this.flushOperationBuffer,300)}},{key:"assertMultiFingers",value:function(){this.operationBuffer.splice(0,this.operationBuffer.length),this.willBlockOperation=!1,null!==this.flushingOperationBufferTimer&&(clearTimeout(this.flushingOperationBufferTimer),this.flushingOperationBufferTimer=null)}},{key:"assertSingleFinger",value:function(){null!==this.flushingOperationBufferTimer&&clearTimeout(this.flushingOperationBufferTimer),this.flushOperationBuffer()}},{key:"pushBoundlessEvent",value:function(e){var t=this;this.willBlockOperation?this.operationBuffer.push((function(){return t.onPushedBoundlessEvent(e)})):this.onPushedBoundlessEvent(e)}}]),e}(),Kh=function(){function e(){C(this,e),this.pressedTouches={},this.emptyResolves=[],this.pressedTouchesCount=0}return P(e,[{key:"receiveTouchStartOrMoveEvent",value:function(e){var t,n=T(e.touches);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.identifier in this.pressedTouches||(this.pressedTouchesCount+=1),this.pressedTouches[r.identifier]=r}}catch(e){n.e(e)}finally{n.f()}}},{key:"receiveTouchEndOrCancelEvent",value:function(e){var t,n=T(e.touches);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identifier in this.pressedTouches&&(this.pressedTouchesCount-=1,delete this.pressedTouches[r.identifier],0===this.pressedTouchesCount)){var i,a=T(this.emptyResolves.splice(0));try{for(a.s();!(i=a.n()).done;){(0,i.value)()}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"waitUntilNoPressedTouches",value:function(){var e=this;return 0===this.pressedTouchesCount?Promise.resolve():new Promise((function(t){return e.emptyResolves.push(t)}))}}]),e}();!function(e){e[e.None=0]="None",e[e.Event=1]="Event",e[e.Camera=2]="Camera",e[e.Cancel=3]="Cancel"}(Gh||(Gh={}));var qh=function(){function e(t){C(this,e),this.pressedTouches=new Kh,this.state=0,this.pinchTouches=null,this.previousTouchesCount=0,this.firstPressedTouch=null,this.firstPressedTouchBeginX=0,this.firstPressedTouchBeginY=0,this.blocker=new Qh(t.onReceivedSortedTouchEvent),this.callbacks=Object.freeze(Zu({},t))}return P(e,[{key:"pushTouchEvent",value:function(e){switch(e.kind){case wu.TouchStart:this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchStartEvent(e);break;case wu.TouchMove:this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchMoveEvent(e);break;case wu.TouchEnd:case wu.TouchCancel:this.pressedTouches.receiveTouchEndOrCancelEvent(e),this.pushTouchEndOrCancelEvent(e)}}},{key:"cancel",value:function(){var e=this;0!==this.state&&3!==this.state&&(this.state=3,this.pressedTouches.waitUntilNoPressedTouches().then((function(){e.state=0})).catch((function(e){return console.error(e)})))}},{key:"pushTouchStartEvent",value:function(e){var t=e.touches;switch(this.state){case 0:this.blocker.startOperation(),1===t.length?(this.state=1,this.firstPressedTouchBeginX=t[0].pointOnScreen.x,this.firstPressedTouchBeginY=t[0].pointOnScreen.y,this.firstPressedTouch={identifier:t[0].identifier,x:this.firstPressedTouchBeginX,y:this.firstPressedTouchBeginY},this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,0))):(this.state=2,this.pinchTouches=t.map((function(e){return{identifier:e.identifier,x:e.pointOnScreen.x,y:e.pointOnScreen.y}})),this.handleTouchEvents(this.pinchTouches));break;case 1:this.pinchTouches=[{identifier:this.firstPressedTouch.identifier,x:this.firstPressedTouch.x,y:this.firstPressedTouch.y}],this.blocker.unknownIsMultiFingers&&(this.blocker.assertMultiFingers(),this.firstPressedTouch=null),this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches),this.state=2;break;case 2:this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches)}}},{key:"pushTouchMoveEvent",value:function(e){var t=this,n=e.touches;switch(this.refreshFirstPressedTouch(n),this.state){case 1:var r=n.findIndex((function(e){return e.identifier===t.firstPressedTouch.identifier}));this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,r));break;case 2:var i,a=T(this.pinchTouches);try{var o=function(){var e=i.value,t=n.find((function(t){return t.identifier===e.identifier}));t&&(e.x=t.pointOnScreen.x,e.y=t.pointOnScreen.y)};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.handleTouchEvents(this.pinchTouches)}}},{key:"pushTouchEndOrCancelEvent",value:function(e){var t=this,n=e.touches;if(this.firstPressedTouch&&3!==this.state){var r=n.findIndex((function(e){return e.identifier===t.firstPressedTouch.identifier}));if(-1!==r){var i=this.covertToSortedTouchEvent(e,r);this.callbacks.onReceivedPreEndTouchEvent(i),this.blocker.pushBoundlessEvent(i),this.firstPressedTouch=null}}switch(this.state){case 1:this.blocker.assertSingleFinger(),this.completeOperation();break;case 2:this.blocker.assertMultiFingers();var a,o=T(n);try{var s=function(){var e=a.value,n=t.pinchTouches.findIndex((function(t){return t.identifier===e.identifier}));-1!==n&&t.pinchTouches.splice(n,1)};for(o.s();!(a=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}this.firstPressedTouch&&1===this.pinchTouches.length?(this.state=1,this.handleTouchEvents([]),this.pinchTouches=null):0===this.pinchTouches.length?(this.handleTouchEvents(this.pinchTouches),this.pinchTouches=null,this.completeOperation()):this.handleTouchEvents(this.pinchTouches)}}},{key:"handleTouchEvents",value:function(e){try{0===this.previousTouchesCount&&e.length>0&&this.callbacks.onBeginTransformCamera(e),this.previousTouchesCount>0&&0===e.length?this.callbacks.onAfterTransformCamera():this.callbacks.onTransformCamera(e)}finally{this.previousTouchesCount=e.length}}},{key:"pushToPinchTouches",value:function(e){var t=this;if(this.pinchTouches){var n,r=T(e);try{var i=function(){var e=n.value;t.pinchTouches.some((function(t){return t.identifier===e.identifier}))||t.pinchTouches.push({x:e.pointOnScreen.x,y:e.pointOnScreen.y,identifier:e.identifier})};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}}},{key:"refreshFirstPressedTouch",value:function(e){if(this.firstPressedTouch){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identifier===this.firstPressedTouch.identifier){this.firstPressedTouch.x=r.pointOnScreen.x,this.firstPressedTouch.y=r.pointOnScreen.y;break}}}catch(e){n.e(e)}finally{n.f()}if(this.blocker.unknownIsMultiFingers){var i=this.firstPressedTouch.x-this.firstPressedTouchBeginX,a=this.firstPressedTouch.y-this.firstPressedTouchBeginY;i*i+a*a>=9&&this.blocker.assertSingleFinger()}}}},{key:"completeOperation",value:function(){this.state=0,this.blocker.unknownIsMultiFingers&&this.blocker.assertMultiFingers(),this.callbacks.onCompleteGroupOfEvents()}},{key:"covertToSortedTouchEvent",value:function(e,t){var n,r=e.touches[t],i=r.identifier,a=r.pointOnScreen,o=r.pointOnScene;switch(e.kind){case wu.TouchStart:n=wu.SortedTouchStart;break;case wu.TouchMove:n=wu.SortedTouchMove;break;case wu.TouchEnd:n=wu.SortedTouchEnd;break;case wu.TouchCancel:n=wu.SortedTouchCancel;break;default:throw new Error("unexpected kind ".concat(e.kind))}return{identifier:i,nativeEvent:e.nativeEvent,kind:n,pointOnScreen:a,pointOnScene:o}}}]),e}();function Zh(e,t,n,r){if(t===1/0||r===1/0)return{center:0,scale:1/0};var i=t/r;return Number.isNaN(i)&&(i=1),{center:n-e,scale:i}}var Jh=function(){function e(t){C(this,e),this.originBorder=t,this.currentBorder=t,this._transform=Object.freeze({deltaX:0,deltaY:0,scale:1})}return P(e,[{key:"transform",get:function(){return this._transform}},{key:"adaptOriginBorder",get:function(){return this._adaptOriginBorder}},{key:"setCurrentBorder",value:function(e){this.currentBorder=e;var t=Zh(this.originBorder.centerX,this.originBorder.width,this.currentBorder.centerX,this.currentBorder.width),n=t.center,r=t.scale,i=Zh(this.originBorder.centerY,this.originBorder.height,this.currentBorder.centerY,this.currentBorder.height),a=i.center,o=i.scale,s=Math.min(r,o);s===1/0&&(s=1),this._transform=Object.freeze({deltaX:n,deltaY:a,scale:s}),this._adaptOriginBorder=Object.freeze({damping:e.damping,centerX:e.centerX-n,centerY:e.centerY-a,width:e.width*s,height:e.height*s,maxScale:e.maxScale/s,minScale:e.minScale/s})}}]),e}(),$h=function(){function e(){C(this,e),this.eccentricityRate=1,this.centroidXOffset=0,this.centroidYOffset=0,this.beginCentroidX=0,this.beginCentroidY=0,this.centroidX=0,this.centroidY=0,this._scale=1,this.isHanding=!1,this.previousTouchesCount=0}return P(e,[{key:"beginCentroid",get:function(){return this.isHanding?{x:this.beginCentroidX,y:this.beginCentroidY}:e.zeroPoint}},{key:"centroid",get:function(){return this.isHanding?{x:this.centroidX,y:this.centroidY}:e.zeroPoint}},{key:"scale",get:function(){return this.isHanding?this._scale:1}},{key:"handleTouches",value:function(e){var t=this.findTouchesExpression(e);this.isHanding?(this.previousTouchesCount!==e.length&&(this.centroidXOffset=this.centroidX-t.centroidX,this.centroidYOffset=this.centroidY-t.centroidY,this.eccentricityRate=this._scale/t.eccentricity,this.previousTouchesCount=e.length),this.centroidX=t.centroidX+this.centroidXOffset,this.centroidY=t.centroidY+this.centroidYOffset,this._scale=t.eccentricity*this.eccentricityRate):(this.centroidXOffset=0,this.centroidYOffset=0,this.eccentricityRate=1/t.eccentricity,this.beginCentroidX=t.centroidX,this.beginCentroidY=t.centroidY,this.centroidX=t.centroidX,this.centroidY=t.centroidY,this._scale=1,this.previousTouchesCount=e.length,this.isHanding=!0)}},{key:"findTouchesExpression",value:function(e){var t,n=0,r=0,i=T(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.x,s=a.y;n+=o,r+=s}}catch(e){i.e(e)}finally{i.f()}var c,u=n/e.length,l=r/e.length,h=0,d=T(e);try{for(d.s();!(c=d.n()).done;){var p=c.value,f=p.x,v=p.y,m=f-u,g=v-l;h+=Math.sqrt(m*m+g*g)}}catch(e){d.e(e)}finally{d.f()}return 0===h&&(h=1),{eccentricity:h,centroidX:u,centroidY:l}}}]),e}(),ed=$h;ed.zeroPoint=Object.freeze({x:0,y:0});var td=function(){function e(t){C(this,e),this.border={centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},this.scaleStart=0,this.scaleEnd=Number.POSITIVE_INFINITY,this.screenSize=t}return P(e,[{key:"findClosestValidCamera",value:function(e){var t=this.findClosestValidScale(e.scale),n=e.centerX,r=e.centerY;if(this.pinPoint&&e.scale!==t){var i=n-this.pinPoint.x,a=r-this.pinPoint.y,o=t/e.scale;n=this.pinPoint.x+i/o,r=this.pinPoint.y+a/o}return{centerX:n=this.findClosestValidCenter(n,t,this.screenSize.width,this.border.centerX,this.border.width),centerY:r=this.findClosestValidCenter(r,t,this.screenSize.height,this.border.centerY,this.border.height),scale:t}}},{key:"findClosestValidScale",value:function(e){var t=e;return this.scaleStart>t?t=this.scaleStart:this.scaleEnd<t&&(t=this.scaleEnd),t}},{key:"findClosestValidCenter",value:function(e,t,n,r,i){var a=e;if(t<=n/i)a=r;else{var o=n/t/2,s=i/2,c=r-s+o,u=r+s-o;a<c?a=c:a>u&&(a=u)}return a}}]),e}();function nd(e,t){return{x:e.x-t.width/2,y:e.y-t.height/2}}function rd(e,t,n){var r=e.x-t.width/2,i=e.y-t.height/2;return{x:n.centerX+r/n.scale,y:n.centerY+i/n.scale}}var id=function(){function e(t){C(this,e),this.pincher=null,this.damping=0,this.camera=null,this.lastValidCamera=null,this.domain=new td(t)}return P(e,[{key:"isHandingPinch",get:function(){return!!this.pincher}},{key:"screenSize",get:function(){return this.domain.screenSize},set:function(e){this.domain.screenSize=e}},{key:"setCameraBorder",value:function(e){this.damping=e.damping,this.domain.scaleStart=e.minScale,this.domain.scaleEnd=e.maxScale,this.domain.border.centerX=e.centerX,this.domain.border.centerY=e.centerY,this.domain.border.width=e.width,this.domain.border.height=e.height}},{key:"beginWithCamera",value:function(e){this.pincher=new ed,this.camera=e}},{key:"handleTouchesAndGetCameraMoving",value:function(e){this.pincher.handleTouches(e);var t=this.pincher.centroid,n=this.currentTargetCamera();return this.transformToCombinedCamera(n,t)}},{key:"transformToCombinedCamera",value:function(e,t){var n=this.domain.screenSize,r=rd(t,n,e);this.domain.pinPoint=r;var i,a=this.domain.findClosestValidCamera(e);if(this.lastValidCamera=a,0===this.damping)i=e;else if(1===this.damping)i=a;else if(function(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.scale===t.scale}(e,a))i=e;else{var o=rd(t,n,a);i=this.viewCamera(r,o,e,a,this.damping)}return{valid:a,view:i}}},{key:"completeAndGetValidCamera",value:function(){var e=this.lastValidCamera;return this.pincher=null,this.camera=null,this.lastValidCamera=null,e}},{key:"currentTargetCamera",value:function(){var e=this.camera,t=this.pincher,n=this.domain.screenSize,r=e.scale*t.scale,i=nd(t.beginCentroid,n),a=nd(t.centroid,n),o=i.x/e.scale-a.x/r,s=i.y/e.scale-a.y/r;return{centerX:e.centerX+o,centerY:e.centerY+s,scale:r}}},{key:"viewCamera",value:function(e,t,n,r,i){var a=Ip(n.centerX,n.centerY,e.x,e.y),o=xp(n.scale,r.scale,i),s=a*n.scale/o,c=xp(e.x,t.x,i),u=xp(e.y,t.y,i),l=Cp(xp(n.centerX,r.centerX,i)-c,xp(n.centerY,r.centerY,i)-u);return{centerX:c+s*l.x,centerY:u+s*l.y,scale:o}}}]),e}(),ad=function(){function e(t){C(this,e),this._isActive=!1,this._key=void 0,this.previousPressEvent=null,this.cameraman=t.cameraman,this.activeDispatch=t.activeDispatch}return P(e,[{key:"active",get:function(){return this._isActive},set:function(e){this._isActive=e}},{key:"key",get:function(){return this._key},set:function(e){this._key=e}},{key:"willInterruptEvent",value:function(e){return this.active&&!!e&&(e.kind===wu.SortedTouchMove||e.kind===wu.MouseMove)}},{key:"moveCameraByEvent",value:function(e){if(e&&this.previousPressEvent&&this.isMouseOrSortedTouch(this.previousPressEvent)&&this.isMouseOrSortedTouch(e)){var t=e.pointOnScreen.x-this.previousPressEvent.pointOnScreen.x,n=e.pointOnScreen.y-this.previousPressEvent.pointOnScreen.y,r=this.cameraman.screen.camera,i=r.centerX,a=r.centerY,o=r.scale;this.cameraman.transformCamera({centerX:i-t/o,centerY:a-n/o,scale:o,animationMode:yp.Immediately,operatorId:this.cameraman.operatorId,boundCamera:!0})}}},{key:"handlePreviousEvent",value:function(e){this.needUpdatePrevious(e)?this.previousPressEvent=e:this.needReleasePrevious(e)&&(this.previousPressEvent=null)}},{key:"isKeyEvent",value:function(e){return!!e.nativeEvent&&e.nativeEvent instanceof KeyboardEvent&&e.nativeEvent.key===this.key}},{key:"handleKeyEvent",value:function(e){var t=this.active;e.kind===wu.KeyDown&&!0!==t?this.active=!0:e.kind===wu.KeyUp&&!1!==t&&(this.active=!1),t!==this.active&&this.activeDispatch(this.active)}},{key:"isMouseOrSortedTouch",value:function(e){var t=e.kind;return t===wu.MouseDown||t===wu.MouseUp||t===wu.MouseLeave||t===wu.MouseMove||t===wu.SortedTouchStart||t===wu.SortedTouchMove||t===wu.SortedTouchEnd||t===wu.SortedTouchCancel}},{key:"needUpdatePrevious",value:function(e){return!(!e||(!this.previousPressEvent||e.kind!==wu.MouseMove&&e.kind!==wu.SortedTouchMove)&&e.kind!==wu.MouseDown&&e.kind!==wu.SortedTouchStart)}},{key:"needReleasePrevious",value:function(e){return!!e&&(e.kind===wu.MouseUp||e.kind===wu.SortedTouchEnd||e.kind===wu.SortedTouchCancel)}}]),e}(),od=function(){function e(t,n,r){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};C(this,e),this.disableCameraTransform=!1,this.boundlessEventDispatcher=new Fh,this.preEndTouchEventDisplayer=new Fh,this.transformationEventDispatcher=new Fh,this.handToolActiveEventDispatcher=new Fh,this.transformer=null,this.border=Object.freeze({damping:.75,centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY,minScale:0,maxScale:Number.POSITIVE_INFINITY}),this.moveToCamera=null,this.didRelease=!1,this.isPaddingCameraOperations=!1,this.paddingCameraOperation=null,this.onBoundlessEvent=function(e){switch(i.screen.deviceType){case up.Surface:i.handleBoundlessEventWhenItIsSurface(e);break;case up.Desktop:i.handleBoundlessEventWhenItIsDesktop(e);break;case up.Touch:i.handleBoundlessEventWhenItIsTouch(e)}},this.onScreenUpdatedListener=function(e){var t=e.camera,n=e.width,r=e.height,a=i.cameraView.screenSize;if(a.width!==n||a.height!==r){i.cameraView.screenSize=Object.freeze({width:n,height:r});var o=i.cameraView.transformToCombinedCamera(i.screen.camera,{x:n/2,y:r/2}).valid;(t.centerX!==o.centerX||t.centerY!==o.centerY||t.scale!==o.scale)&&i.screen.transformCamera(Ju(Zu({},o),{animationMode:yp.Immediately}))}},this.dispatchBoundlessEvent=function(e){var t=i.continuityNode.interruptEvent(e);i.handTool.willInterruptEvent(t)?i.handTool.moveCameraByEvent(t):t&&i.boundlessEventDispatcher.dispatch(t),i.handTool.handlePreviousEvent(t)},this.dispatchPreEndTouchEvent=function(e){i.preEndTouchEventDisplayer.dispatch(e)},this.onAfterMouseWheel=function(){i.transformationEventDispatcher.dispatch(gp.End),i.screen.setTransition(!1,i.operatorId)},this.onBeginTransformCamera=function(e){i.disableCameraTransform||(i.isPaddingCameraOperations=!0,i.transformationEventDispatcher.dispatch(gp.Begin),i.cameraView.beginWithCamera(i.screen.camera),i.transformer=new Jh(i.border),i.onTransformCamera(e))},this.onTransformCamera=function(e){if(!i.disableCameraTransform){var t=i.cameraView.handleTouchesAndGetCameraMoving(e),n=Ju(Zu({},i.cameraAppendBorderTransform(t.view)),{animationMode:yp.Immediately,operatorId:i.operatorId});i.moveToCamera=t.view,i.screen.setCameraTransfrom(n,!0)}},this.onAfterTransformCamera=function(){if(!i.disableCameraTransform){var e=i.cameraView.completeAndGetValidCamera();i.isPaddingCameraOperations=!1,i.moveToCamera=i.cameraAppendBorderTransform(e),i.cameraView.setCameraBorder(i.border),i.paddingCameraOperation&&(i.paddingCameraOperation(),i.paddingCameraOperation=null),i.transformer=null,i.transformationEventDispatcher.dispatch(gp.End)}},this.onCompleteGroupOfEvents=function(){if(i.moveToCamera){var e=i.screen.camera;if(i.moveToCamera.centerX!==e.centerX||i.moveToCamera.centerY!==e.centerY||i.moveToCamera.scale!==e.scale){var t=Ju(Zu({},i.moveToCamera),{animationMode:yp.Continuous,operatorId:i.operatorId});i.screen.setCameraTransfrom(t,!1)}else i.screen.setTransition(!1,i.operatorId);i.moveToCamera=null}},this.onContinuityNodeCancel=function(e){i.boundlessEventDispatcher.dispatch(e),i.sorter&&i.sorter.cancel()},this.screen=t,this.operatorId=r,this.eventProxy=n,this.afterWheelDelayer=new Xh(this.onAfterMouseWheel),this.continuityNode=_h(this.onContinuityNodeCancel),this.cameraView=new id({width:t.width,height:t.height}),this.handTool=new ad({cameraman:this,activeDispatch:function(e){return i.handToolActiveEventDispatcher.dispatch(e)}}),this.setCameraBorder(a),(t.deviceType===up.Touch||t.deviceType===up.Surface)&&(this.sorter=new qh({onBeginTransformCamera:this.onBeginTransformCamera,onTransformCamera:this.onTransformCamera,onAfterTransformCamera:this.onAfterTransformCamera,onCompleteGroupOfEvents:this.onCompleteGroupOfEvents,onReceivedSortedTouchEvent:this.dispatchBoundlessEvent,onReceivedPreEndTouchEvent:this.dispatchPreEndTouchEvent})),n.addListener(this.onBoundlessEvent),t.addScreenUpdatedListener(this.onScreenUpdatedListener)}return P(e,[{key:"handToolActive",get:function(){return this.handTool.active},set:function(e){this.handTool.active=e}},{key:"handToolKey",get:function(){return this.handTool.key},set:function(e){this.handTool.key=e}},{key:"cameraBorder",get:function(){return this.border}},{key:"cancelCurrentContinuityEvent",value:function(){this.continuityNode.cancel()}},{key:"setCameraBorder",value:function(e){var t=this.border,n=this.border=Object.freeze(Zu(Zu({},this.border),e));if(!function(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.damping===t.damping&&e.width===t.width&&e.height===t.height&&e.minScale===t.minScale&&e.maxScale===t.maxScale}(t,n)){var r;this.transformer?((r=this.transformer).setCurrentBorder(n),n=r.adaptOriginBorder):(r=new Jh(t)).setCurrentBorder(n),this.cameraView.setCameraBorder(n);var i=this.moveToCamera||this.screen.camera,a=r.transform;(0!==a.deltaX||0!==a.deltaY||1!==a.scale)&&this.screen.transformCamera({animationMode:yp.Immediately,centerX:i.centerX+a.deltaX,centerY:i.centerY+a.deltaY,scale:i.scale*a.scale})}return this.border}},{key:"disableBoundlessEvent",get:function(){return this.continuityNode.disable},set:function(e){this.continuityNode.disable=e}},{key:"transformCamera",value:function(e){var t=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return t.executeTransformCamera(e)}:this.executeTransformCamera(e)}},{key:"executeTransformCamera",value:function(e){var t=e;if(t.boundCamera){var n=this.screen.camera,r=n.centerX,i=n.centerY,a=n.scale,o={centerX:vh(t.centerX,r),centerY:vh(t.centerY,i),scale:vh(t.scale,a)},s=this.cameraView.screenSize,c=s.width,u=s.height,l=this.cameraView.transformToCombinedCamera(o,{x:c/2,y:u/2}).valid;(l.centerX!==o.centerX||l.centerY!==o.centerY||l.scale!==o.scale)&&(t=Ju(Zu({},t),{centerX:l.centerX,centerY:l.centerY,scale:l.scale}))}this.screen.transformCamera(t)}},{key:"adaptRectangle",value:function(e){var t=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return t.screen.adaptRectangle(e)}:this.screen.adaptRectangle(e)}},{key:"release",value:function(){this.didRelease||(this.sorter&&this.sorter.cancel(),this.eventProxy.removeListener(this.onBoundlessEvent),this.screen.removeScreenUpdatedListener(this.onScreenUpdatedListener),this.afterWheelDelayer.cancel(),this.didRelease=!0)}},{key:"handleBoundlessEventWhenItIsDesktop",value:function(e){switch(e.kind){case wu.MouseWheel:this.onMouseWheel(e);break;case wu.TouchStart:case wu.TouchMove:case wu.TouchEnd:case wu.TouchCancel:break;case wu.KeyDown:case wu.KeyUp:this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break;default:this.dispatchBoundlessEvent(e)}}},{key:"handleBoundlessEventWhenItIsTouch",value:function(e){switch(e.kind){case wu.TouchStart:case wu.TouchMove:case wu.TouchEnd:case wu.TouchCancel:this.sorter.pushTouchEvent(e);break;case wu.MouseDown:case wu.MouseUp:case wu.MouseMove:case wu.MouseLeave:break;case wu.KeyDown:case wu.KeyUp:this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break;default:this.dispatchBoundlessEvent(e)}}},{key:"handleBoundlessEventWhenItIsSurface",value:function(e){switch(e.kind){case wu.MouseWheel:this.onMouseWheel(e);break;case wu.TouchStart:case wu.TouchMove:case wu.TouchEnd:case wu.TouchCancel:this.sorter.pushTouchEvent(e);break;case wu.MouseDown:case wu.MouseUp:case wu.MouseMove:case wu.MouseLeave:default:this.dispatchBoundlessEvent(e)}}},{key:"onMouseWheel",value:function(t){if(!this.disableCameraTransform){var n=this.screen.camera,r=n.centerX,i=n.centerY,a=n.scale;if(0!==t.scale){var o=1+t.scale,s=t.pointOnScreen.x,c=t.pointOnScreen.y,u=(1-1/o)/a;r+=u*(s-this.screen.width/2),i+=u*(c-this.screen.height/2),a*=o}r-=t.offsetPoint.x/a,i-=t.offsetPoint.y/a;var l=this.cameraView.transformToCombinedCamera({centerX:r,centerY:i,scale:a},t.pointOnScreen),h=Ju(Zu({},this.cameraAppendBorderTransform(l.valid)),{animationMode:yp.Immediately,operatorId:this.operatorId});this.transformationEventDispatcher.dispatch(gp.Begin),this.afterWheelDelayer.refreshAndInvokeAfterInterval(e.RefreshTimeoutOnDesktop),this.screen.setCameraTransfrom(h,!0)}}},{key:"cameraAppendBorderTransform",value:function(e){if(this.transformer){var t=this.transformer.transform;return Object.freeze({centerX:e.centerX+t.deltaX,centerY:e.centerY+t.deltaY,scale:e.scale*t.scale})}return e}},{key:"addHandToolActiveListener",value:function(e){this.handToolActiveEventDispatcher.addListener(e)}},{key:"removeHandToolActiveListener",value:function(e){this.handToolActiveEventDispatcher.removeListener(e)}},{key:"addCameraTransformationListener",value:function(e){this.transformationEventDispatcher.addListener(e)}},{key:"removeCameraTransformationListener",value:function(e){this.transformationEventDispatcher.removeListener(e)}},{key:"addBoundlessEventListener",value:function(e){this.boundlessEventDispatcher.addListener(e)}},{key:"removeBoundlessEventListener",value:function(e){this.boundlessEventDispatcher.removeListener(e)}},{key:"addPreTouchEventListener",value:function(e){this.preEndTouchEventDisplayer.addListener(e)}},{key:"removePreTouchEventListener",value:function(e){this.preEndTouchEventDisplayer.removeListener(e)}}]),e}(),sd=od;function cd(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function ud(e,t){-1===e.indexOf(t)&&e.push(t)}sd.RefreshTimeoutOnDesktop=200;var ld=function(){function e(){var t=this;C(this,e),this.animationPriorities=[],this.animations={},this.afterAnimationsInvokers=[],this.animationId=null,this.isInAnimationFrame=!1,this.onAnimationFrame=function(){try{t.isInAnimationFrame=!0;var e,n=T(t.animationPriorities);try{for(n.s();!(e=n.n()).done;)for(var r=e.value,i=0,a=p(t.animations[r]);i<a.length;i++){(0,a[i])()}}catch(e){n.e(e)}finally{n.f()}for(var o=0,s=p(t.afterAnimationsInvokers);o<s.length;o++){(0,s[o])()}t.animationPriorities.length>0?t.animationId=window.requestAnimationFrame(t.onAnimationFrame):t.animationId=null}finally{t.isInAnimationFrame=!1}}}return P(e,[{key:"addAnimation",value:function(e,t){var n=this.animations[e],r=!1;n||(n=this.animations[e]=[],this.animationPriorities.push(e),this.animationPriorities.sort(),r=1===this.animationPriorities.length),ud(n,t),r&&null===this.animationId&&(this.animationId=window.requestAnimationFrame(this.onAnimationFrame))}},{key:"removeAnimation",value:function(e,t){var n=this.animations[e];n&&(cd(n,t),0===n.length&&(delete this.animations[e],cd(this.animationPriorities,e),0===this.animationPriorities.length&&!this.isInAnimationFrame&&null!==this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=null)))}},{key:"addAfterAnimationsInvoker",value:function(e){ud(this.afterAnimationsInvokers,e)}},{key:"removeAfterAnimationsInvoker",value:function(e){cd(this.afterAnimationsInvokers,e)}}]),e}(),hd=function(){function e(){C(this,e)}return P(e,[{key:"createAnimationGroup",value:function(){return new dd}},{key:"createAnimation",value:function(e,t){return new pd(e,t)}},{key:"createAnimationFrameInvoker",value:function(e){return new vd(e)}},{key:"createAfterAnimationsInvoker",value:function(e){return new fd(e)}}]),e}();hd.animationFrames=new ld;var dd=function(){function e(){C(this,e),this.children=[]}return P(e,[{key:"createAnimation",value:function(e,t){var n=this,r=new pd(e,t,(function(e){return cd(n.children,e)}));return this.children.push(r),r}},{key:"createAfterAnimationsInvoker",value:function(e){var t=this,n=new fd(e,(function(e){return cd(t.children,e)}));return this.children.push(n),n}},{key:"release",value:function(){var e,t=T(this.children.splice(0));try{for(t.s();!(e=t.n()).done;){e.value.release()}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),pd=function(){function e(t,n,r){var i=this;C(this,e),this.priority=t,this.onRefresh=n,this.onRelease=r,this.onAnimationFrame=function(){gd(i,i.onRefresh)},hd.animationFrames.addAnimation(this.priority,this.onAnimationFrame)}return P(e,[{key:"release",value:function(){hd.animationFrames.removeAnimation(this.priority,this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]),e}(),fd=function(){function e(t,n){var r=this;C(this,e),this.onRefresh=t,this.onRelease=n,this.onAnimationFrame=function(){gd(r,r.onRefresh)},hd.animationFrames.addAfterAnimationsInvoker(this.onAnimationFrame)}return P(e,[{key:"release",value:function(){hd.animationFrames.removeAfterAnimationsInvoker(this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]),e}(),vd=function(){function e(t){var n=this;C(this,e),this.priority=t,this.nextHandler=null,this.banAnimationChange=!1,this.onAnimationFrame=function(){if(n.nextHandler){var e=n.nextHandler;n.nextHandler=null;try{n.banAnimationChange=!0,gd(n,e)}finally{n.banAnimationChange=!1}null===n.nextHandler&&hd.animationFrames.removeAnimation(n.priority,n.onAnimationFrame)}}}return P(e,[{key:"invoke",value:function(e){!this.banAnimationChange&&!this.nextHandler&&hd.animationFrames.addAnimation(this.priority,this.onAnimationFrame),this.nextHandler=e}},{key:"release",value:function(){!this.banAnimationChange&&this.nextHandler&&(this.nextHandler=null,hd.animationFrames.removeAnimation(this.priority,this.onAnimationFrame))}}]),e}(),md=new hd;function gd(e,t){try{t(e)}catch(e){console.error(e)}}function yd(e){var t=Math.abs(e),n=1/(1+t/2),r=n*Math.exp(-t*t-1.26551223+n*(1.00002368+n*(.37409196+n*(.09678418+n*(n*(.27886807+n*(n*(1.48851587+n*(.17087277*n-.82215223))-1.13520398))-.18628806)))));return e>=0?r:2-r}function bd(e,t){return new Sd(e,t)}function kd(e,t){return bd(t/e,1/e)}var wd,Sd=function(){function e(t,n){C(this,e),this.mean=t,this.variance=n,this.standardDeviation=Math.sqrt(n)}return P(e,[{key:"pdf",value:function(e){var t=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(e-this.mean,2)/(2*this.variance))/t}},{key:"cdf",value:function(e){return.5*yd(-(e-this.mean)/(this.standardDeviation*Math.sqrt(2)))}},{key:"ppf",value:function(e){return this.mean-this.standardDeviation*Math.sqrt(2)*function(e){if(e>=2)return-100;if(e<=0)return 100;for(var t=e<1?e:2-e,n=Math.sqrt(-2*Math.log(t/2)),r=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n),i=0;i<2;i++){var a=yd(r)-t;r+=a/(1.1283791670955126*Math.exp(-r*r)-r*a)}return e<1?r:-r}(2*e)}},{key:"mul",value:function(e){if("number"==typeof e)return this.scale(e);var t=1/this.variance,n=1/e.variance;return kd(t+n,t*this.mean+n*e.mean)}},{key:"div",value:function(e){if("number"==typeof e)return this.scale(1/e);var t=1/this.variance,n=1/e.variance;return kd(t-n,t*this.mean-n*e.mean)}},{key:"add",value:function(e){return bd(this.mean+e.mean,this.variance+e.variance)}},{key:"sub",value:function(e){return bd(this.mean-e.mean,this.variance+e.variance)}},{key:"scale",value:function(e){return bd(this.mean*e,this.variance*e*e)}}]),e}(),xd=function(){function e(){C(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.configurations=Object.freeze(n.map((function(e){return Object.freeze(Zu({},e))})))}return P(e,[{key:"create",value:function(e,t,n){return new Id(e,p(this.configurations),t,n)}}]),e}(),Cd=function(){function e(t,n,r,i){var a=this;C(this,e),this.priority=t,this._point=r,this.onPointUpdate=i,this.completeTick=!1,this.playingAnimation=null,this.updateIdealPoint=function(t){e.setPoint(a.idealPoint,t),!a.playingAnimation&&a.shouldContinueMoving()&&(a.playingAnimation=md.createAnimation(a.priority,a.onTick)),a.completeTick=!1},this.onTick=function(){if(a.completeTick)a.stop();else{a.executePhysicalSimulate();var e=!a.shouldContinueMoving();a.onPointUpdate&&a.onPointUpdate(a._point,e),e&&(a.completeTick=!0)}};var o=l(n.splice(0,1),1)[0];this.configuration=o,this._point=p(r),this.idealPoint=p(r),this.velocity=r.map((function(){return 0})),n.length>0&&(this.guider=new e(this.priority,n,r,this.updateIdealPoint));var s=this.configuration.pedesisSpeedMean,c=this.configuration.pedesisSpeedVariance;this.gaussian=0!==s&&0!==c?bd(s,c):null,this.noPedesisRadius=(s+Math.sqrt(c))*e.noPedesisRadiusRate}return P(e,[{key:"point",get:function(){return this._point}},{key:"isPlayingAnimation",get:function(){return!!this.playingAnimation}},{key:"moveRightNow",value:function(t){this.guider&&this.guider.moveRightNow(t),e.setPoint(this.idealPoint,t),e.setPoint(this._point,t),e.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"moveTo",value:function(e){this.guider?this.guider.moveTo(e):this.updateIdealPoint(e)}},{key:"moveToAndChangeCoordinate",value:function(e,t){for(var n=0;n<this._point.length;++n)this._point[n]+=e[n];this.guider?this.guider.moveToAndChangeCoordinate(e,t):this.updateIdealPoint(t)}},{key:"stop",value:function(){e.setPoint(this.idealPoint,this._point),e.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"executePhysicalSimulate",value:function(){for(var e=this.squareDistanceToIdealPoint(),t=this.velocityDamping(e),n=e>this.noPedesisRadius*this.noPedesisRadius,r=0;r<this._point.length;++r){var i=this.idealPoint[r]-this._point[r],a=this.configuration.kDistance*i;if(this.velocity[r]+=a,n&&this.gaussian){var o=this.gaussian.ppf(Math.random());Math.random()>=.5&&(o=-o),this.velocity[r]+=o}this._point[r]+=this.velocity[r],this.velocity[r]*=1-t}}},{key:"velocityDamping",value:function(e){for(var t=0,n=0;n<this.velocity.length;++n)t+=this.velocity[n]*this.velocity[n];var r=this.configuration,i=r.heavyDampingRadius,a=r.heavyDampingSpeed;return t<a*a||e>i*i?this.configuration.velocityDamping:Math.min(1,t*this.configuration.velocityDamping)}},{key:"squareDistanceToIdealPoint",value:function(){for(var e=0,t=0;t<this.velocity.length;++t){var n=this.idealPoint[t]-this._point[t];e+=n*n}return e}},{key:"shouldContinueMoving",value:function(){for(var e=0;e<this._point.length;++e)if(Math.abs(this._point[e]-this.idealPoint[e])>this.configuration.matchingDistance||Math.abs(this.velocity[e])>this.configuration.zeroSpeed)return!0;return!1}}],[{key:"setPoint",value:function(e,t){for(var n=0;n<e.length;++n)e[n]=n in t?t[n]:0}},{key:"setPointZero",value:function(e){for(var t=0;t<e.length;++t)e[t]=0}}]),e}(),Id=Cd;Id.noPedesisRadiusRate=2.7,function(e){e[e.ComponentMoving=0]="ComponentMoving",e[e.CameraMoving=1]="CameraMoving",e[e.Rendering=2]="Rendering"}(wd||(wd={}));var Pd=function(){function e(t,n){var r=this;C(this,e),this.referPoint=[],this._isTransition=!1;var i=n&&function(e,t){var i=r.convertPointToCamera(e,t),a=r._isTransition||!t;n(i,a,r.currentOperatorId),t&&(r.currentOperatorId=void 0)};this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring=e.spaceSpringFactory.create(wd.CameraMoving,[0,0,0],i)}return P(e,[{key:"isTransition",get:function(){return this._isTransition}},{key:"convertPointToCamera",value:function(t,n){return n?{centerX:this.referPoint[0],centerY:this.referPoint[1],scale:this.referPoint[2]/e.kScale}:{centerX:this.referPoint[0]+t[0],centerY:this.referPoint[1]+t[1],scale:(this.referPoint[2]+t[2])/e.kScale}}},{key:"moveTo",value:function(t,n,r){var i=[this.referPoint[0]-t.centerX,this.referPoint[1]-t.centerY,this.referPoint[2]-t.scale*e.kScale];this._isTransition=n,this.currentOperatorId=r,this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring.moveToAndChangeCoordinate(i,[0,0,0])}},{key:"moveToRightNow",value:function(t,n){this._isTransition=n,this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring.moveRightNow([0,0,0])}}]),e}(),Md=Pd;function Td(e,t){var n,r=t,i=T(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=(0,zu.createElement)(a,null,r)}}catch(e){i.e(e)}finally{i.f()}return r}function Ad(e){var t,n={},r=T(e.engines);try{var i=function(){var r=t.value;n[r.id]=r.createRenderLayout({screen:e.screen,tree:e.tree,mode:e.mode,initCamera:e.initCamera,visions:e.visions,leafFilter:function(e){return e.value.isVisible(r)},onRenderDuration:e.onRenderDuration})};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}return n}Md.kScale=700,Md.spaceSpringFactory=new xd({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0});var Ed,Od=function(){function e(t){C(this,e),this.className=t.screen.className,this.layouts=Object.freeze(Ad({tree:t.tree,screen:t.screen,initCamera:t.initCamera,visions:t.visions,engines:t.engines,onRenderDuration:t.onRenderDuration,mode:Su.Preview}))}return P(e,[{key:"render",value:function(e){var t=[];for(var n in this.layouts){var r=this.layouts[n].getRender();t.push((0,Fu.createElement)(r,{key:n}))}return Td(e,(0,Fu.createElement)("div",{className:this.className,style:{width:"100%",height:"100%",position:"relative"}},t))}}]),e}();function Rd(e,t,n,r){var i=t,a=n,o=r,s=e>a;if(s){var c=e,u=i;a,a=c,i=o,o=u}return i<a?Ed.Result.Disjoint:i<o?Ed.Result.Cross:s?Ed.Result.IncludeByRectangle:Ed.Result.IncludeRectangle}!function(e){var t;(t=e.Result||(e.Result={}))[t.Disjoint=0]="Disjoint",t[t.Cross=1]="Cross",t[t.IncludeRectangle=2]="IncludeRectangle",t[t.IncludeByRectangle=3]="IncludeByRectangle",e.testPoint=function(e,t,n,r,i,a){return i>=e&&i<=e+n&&a>=t&&a<=t+r},e.testRectangle=function(e,t,n,r,i,a,o,s){var c=Rd(e,e+n,i,i+o),u=Rd(t,t+r,a,a+s);return 0===c||0===u?0:1===c||1===u?1:2===c&&2===u?2:3===c&&3===u?3:1},e.iterate=function(e,t,n,r,i){i(e,t),i(e+n,t),i(e+n,t+r),i(e,t+r)},e.allPoints=function(e,t,n,r){return[{x:e,y:t},{x:e+n,y:t},{x:e+n,y:t+r},{x:e,y:t+r}]}}(Ed||(Ed={}));var Nd=function(){function e(t){C(this,e),this.component=null,this.componentState={className:t.screen.className},this.layouts=Object.freeze(Ad({tree:t.tree,screen:t.screen,engines:t.engines,visions:t.visions,onRenderDuration:t.onRenderDuration,mode:Su.Normal})),this.logger=t.screen.scene.logger,this.renderClass=this.createRender()}return P(e,[{key:"setState",value:function(e){var t;this.componentState=Zu({},e),null==(t=this.component)||t.setState(e)}},{key:"renderLayouts",get:function(){return this.layouts}},{key:"getRender",value:function(){return this.renderClass}},{key:"createRender",value:function(){var e={self:this};return function(t){g(r,t);var n=b(r);function r(t){var i;return C(this,r),(i=n.call(this,t)).state=Zu({},e.self.componentState),e.self.component=w(i),i}return P(r,[{key:"componentWillUnmount",value:function(){e.self.component=null,e.self=null}},{key:"render",value:function(){var t=[],n=this.state,r=n.className,i=n.style,a=Ju(Zu({},i),{width:"100%",height:"100%",position:"relative",overflow:"hidden"});for(var o in e.self.layouts)t.push((0,Vu.createElement)(Ld,{key:o,logger:e.self.logger,layout:e.self.layouts[o]}));return(0,Vu.createElement)("div",{className:r,style:a,tabIndex:-1},t)}}]),r}(Vu.Component)}}]),e}(),Ld=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).state={error:void 0},r}return P(n,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props.layout,r=this.state.error;return n!==e.layout||r!==t.error}},{key:"componentDidCatch",value:function(e,t){var n=this.props,r=n.layout;n.logger.error("boundless layout ".concat(r.engine.id," render catch error:"),e," stack: ",t.componentStack)}},{key:"render",value:function(){var e=this.props.layout;if(this.state.error)return null;var t=e.getRender();return(0,Vu.createElement)(t,null)}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{error:e}}}]),n}(Vu.Component),jd=function(){function e(t,n,r,i,a){C(this,e);var o={},s=function(e){var r=t.renderLayouts[e],i={};n.forEach((function(e){e.value.isVisible(r.engine)&&(i[e.id]=!0)})),o[e]=Object.seal({layout:r,visibleSet:i})};for(var c in t.renderLayouts)s(c);this.camera=i,this.screenSize=a,this.context=r,this.engineNodes=Object.freeze(o)}return P(e,[{key:"flush",value:function(e){var t,n,r;for(var i in ml(this.camera,e.camera)||(t=this.camera=e.camera),ml(this.screenSize,e.screenSize)||(n=this.screenSize=e.screenSize),this.context!==e.context&&(r=this.context=e.context),this.engineNodes)this.flushEngine(this.engineNodes[i],e,r,t,n)}},{key:"flushEngine",value:function(e,t,n,r,i){var a=e.visibleSet,o=e.layout.engine,s=t.testSet,c=t.updateSet,u=t.moveSet,l=t.isTransition,h=t.diff,d=h.addedSet,p=h.removedSet,f=[],v=[],m=[];for(var g in d)d[g].value.isVisible(o)?a[g]=!0:m.push(g);for(var y in s){var b=s[y],k=b.treeNode,w=b.isVisible(o),S=y in a;S&&!w?(v.push(k),delete a[y]):!S&&w&&(f.push(k),a[y]=!0)}for(var x in p)delete a[x];var C=t.diff.decorate({insertToAdded:f,insertToRemoved:v,maskAdded:m}),I={},P={};for(var M in c)M in a&&(I[M]=c[M].treeNode);for(var T in u)T in a&&(P[T]=u[T].treeNode);e.layout.update({context:n,camera:r,screenSize:i,isTransition:l,diff:C,updateSet:I,moveSet:P})}}]),e}(),Dd=function(){function e(t){var n=this;C(this,e),this.frameInvoker=md.createAnimationFrameInvoker(wd.Rendering),this.didReceiveTransitionFalse=!1,this.onFrameInvoke=function(){var e=!n.didReceiveTransitionFalse;n.didReceiveTransitionFalse=!1,n.frameHandler(e)},this.frameHandler=t}return P(e,[{key:"release",value:function(){this.frameInvoker.release()}},{key:"fire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(this.didReceiveTransitionFalse=!0),this.frameInvoker.invoke(this.onFrameInvoke)}}]),e}();function Fd(e,t,n,r){var i=Vd(t);Ud(e.treeNode,i,n,r)}function zd(e,t,n,r){switch(e.kind){case fp.Component:var i=e,a=Bd(i.treeNode.parent,t);if(a){var o=_d(e,a);o?n(i,o):r(i)}break;case fp.Group:var s=e.treeNode,c=Bd(s,t);c&&Ud(s,c,n,r)}}function Bd(e,t){for(var n=[],r=e;r.parent;)n.push(r),r=r.parent;for(var i=Vd(t),a=n.length-1;a>=0;a--){var o=n[a].value,s=_d(o,i);if(!s){i=null;break}i=Hd(i,s,o)}return i}function Ud(e,t,n,r){var i,a=T(e);try{for(a.s();!(i=a.n()).done;){var o=i.value.value,s=_d(o,t);switch(o.kind){case fp.Component:var c=o;s?n(c,s):r(c);break;case fp.Group:if(s){var u=o;Ud(u.treeNode,Hd(t,s,u),n,r)}}}}catch(e){a.e(e)}finally{a.f()}}function Vd(e){var t=e.camera,n=e.width,r=e.height;return{scene:{dx:0,dy:0,scale:1},screen:{dx:-(t.centerX-n/t.scale/2)*t.scale,dy:-(t.centerY-r/t.scale/2)*t.scale,scale:t.scale},rect:{originX:0,originY:0,width:n,height:r},tailor:{left:0,right:0,top:0,bottom:0},absolute:Wd(n,r)}}function Wd(e,t){var n={scene:{dx:0,dy:0,scale:1},screen:{dx:e/2,dy:t/2,scale:1},rect:{originX:0,originY:0,width:e,height:t},tailor:{left:0,right:0,top:0,bottom:0},absolute:null};return n.absolute=n,n}function Hd(e,t,n){var r=t.sceneRect,i=t.screenRect,a=t.tailor;return{scene:{dx:r.originX,dy:r.originY,scale:e.scene.scale*n.scale},screen:{dx:i.originX,dy:i.originY,scale:e.screen.scale*n.scale},rect:i,tailor:a,absolute:e.absolute}}function _d(e,t){if(e.kind===fp.Component&&!e.isVisible())return null;var n,r=t;e.absoluteCoordinates&&(r=r.absolute),e instanceof lp&&(n=e.rotation);var i=r,a=i.scene,o=i.screen,s=o.scale,c=o.dx,u=o.dy,l=function(e,t){var n=e.sceneMargin,r=e.parallaxMargin,i=n.left*t+r.left,a=n.top*t+r.top,o=n.right*t+r.right,s=n.bottom*t+r.bottom;return Object.freeze({left:i,right:o,top:a,bottom:s})}(e,s),h=Gd(e.originX*s+c-l.left,e.originY*s+u-l.top,e.width*s+l.left+l.right,e.height*s+l.top+l.bottom,n),d=h.originX,p=h.originY,f=h.width,v=h.height,m=r.rect,g=r.tailor,y=m.originX+g.left-d,b=m.originY+g.top-p,k=d+f-(m.originX+m.width-g.right),w=p+v-(m.originY+m.height-g.bottom);if(!e.disableVisionTrim&&(y>=f||k>=f||y+k>=f||b>=v||w>=v||b+w>=v))return null;var S={left:y,top:b,right:k,bottom:w},x={originX:d,originY:p,width:f,height:v},C=Yd(e,s);return{margin:l,scale:s,tailor:S,sceneRect:Gd(e.originX+a.dx-C.left,e.originY+a.dy-C.top,e.width*a.scale+C.left+C.right,e.height*a.scale+C.top+C.bottom,n),screenRect:x,rotation:n}}function Gd(e,t,n,r,i){if(void 0===i)return{originX:e,originY:t,width:n,height:r};var a=n/2,o=r/2,s=-a,c=o,u=-a,l=-o,h=a,d=-o,p=a,f=o,v=Math.cos(i),m=Math.sin(i),g=s*v+c*m,y=c*v-s*m,b=u*v+l*m,k=l*v-u*m,w=h*v+d*m,S=d*v-h*m,x=p*v+f*m,C=f*v-p*m,I=Math.min(g,b,w,x),P=Math.max(g,b,w,x),M=Math.min(y,k,S,C);return{originX:e+a+I,originY:t+o+M,width:P-I,height:Math.max(y,k,S,C)-M}}function Yd(e,t){var n=e.sceneMargin,r=e.parallaxMargin,i=n.left+r.left/t,a=n.top+r.top/t,o=n.right+r.right/t,s=n.bottom+r.bottom/t;return Object.freeze({left:i,right:o,top:a,bottom:s})}function Xd(e,t,n){Fd(t,n,(function(t,n){e.bindVision(t.treeNode,n)}),(function(){}))}var Qd=function(){function e(t){var n=this;C(this,e),this.isCameraUpdated=!1,this.toTestAppearSet={},this.toTestVisibleSet={},this.toUpdateSet={},this.toSortSet={},this.toMoveSet={},this.toShowSet={},this.toHideSet={},this.onScreenUpdate=function(e){ml(n.screenState,e)||(n.isCameraUpdated=!0,n.screenState=e,n.refreshFrameNode.fire(e.isTransition))},this.onGroupSorted=function(e){n.toSortSet[e.treeNode.id]=e,n.refreshFrameNode.fire()},this.onComponentUpdate=function(e){var t=e.node;switch(e.behavior){case Jd.Removed:delete n.toTestAppearSet[t.treeNode.id],delete n.toUpdateSet[t.treeNode.id],delete n.toTestVisibleSet[t.treeNode.id];break;case Jd.Added:case Jd.AppearUpdated:n.toTestAppearSet[t.treeNode.id]=t;break;case Jd.VisibleUpdated:t instanceof lp&&(n.toTestVisibleSet[t.treeNode.id]=t);break;case Jd.PropertiesUpdated:t instanceof lp&&(n.toUpdateSet[t.treeNode.id]=t)}n.refreshFrameNode.fire()},this.handleFrame=function(e){try{n.sortAllGroups();var t=n.diffBuffer.fetchDiff();n.testComponents(t);var r=n.commitVisibleAndDecorateDiff(t);n.notify(r,e),n.cleanSet(),n.visions.completeFrame()}catch(t){n.logger.error(t)}},this.refreshComponent=function(e,t){var r=e.treeNode.id,i=n.visions.leaf(r),a=n.visions.vision(r);if(a){var o=a.sceneRect,s=i.value;(!ml(o,t.sceneRect)||!ml(s.parallaxMargin,e.parallaxMargin)||!ml(s.sceneMargin,e.sceneMargin))&&(n.toMoveSet[r]={component:e,vision:t})}else n.toShowSet[r]={component:e,vision:t};i&&n.visions.bindVision(i,t)},this.removeComponent=function(e){var t=e.treeNode;n.visions.includes(t.id)&&(n.toHideSet[t.id]=e),n.visions.unbindVision(t.id)},this.screen=t.screen,this.visions=t.visions,this.logger=this.screen.scene.logger,this.tree=this.screen.scene.tree,this.diffBuffer=this.tree.createDiffBuffer(),this.screenState={width:this.screen.width,height:this.screen.height,camera:Object.freeze(Zu({},this.screen.camera)),visionRectangle:this.screen.visionRectangle,isTransition:!1},Xd(this.visions,this.screen.scene,this.screenState),this.renderer=new Nd({screen:this.screen,engines:t.engines,tree:this.tree,visions:this.visions,onRenderDuration:t.onRenderDuration});var r=this.screen,i=r.context,a=r.camera;this.notifier=new jd(this.renderer,this.visions,i,a,Object.freeze({width:this.screen.width,height:this.screen.height})),this.refreshFrameNode=new Dd(this.handleFrame),this.screen.addScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.addGroupSortedListener(this.onGroupSorted),this.screen.scene.addComponentUpdateListener(this.onComponentUpdate)}return P(e,[{key:"willInterruptEvent",value:function(e,t){for(var n in this.renderer.renderLayouts)if(this.renderer.renderLayouts[n].willInterruptEvent(this.screen,e,t))return!0;return!1}},{key:"findComponentWithTarget",value:function(e){for(var t in this.renderer.renderLayouts){var n=this.renderer.renderLayouts[t],r=n.findComponentWithTarget(e);if(r)return{component:r,engine:n.engine}}}},{key:"forEachVisibleComponent",value:function(e){var t,n=T(this.tree);try{for(n.s();!(t=n.n()).done;){e(t.value.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"release",value:function(){this.refreshFrameNode.release(),this.diffBuffer.release(),this.screen.removeScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.removeGroupSortedListener(this.onGroupSorted),this.screen.scene.removeComponentUpdateListener(this.onComponentUpdate)}},{key:"refreshScreenContext",value:function(){this.refreshFrameNode.fire()}},{key:"sortAllGroups",value:function(){for(var e in this.toSortSet)this.toSortSet[e].sortIfNeed()}},{key:"testComponents",value:function(e){for(var t in e.removedSet)this.visions.includes(t)&&(this.toHideSet[t]=e.removedSet[t].value);if(this.isCameraUpdated)Fd(this.screen.scene,this.screenState,this.refreshComponent,this.removeComponent),this.isCameraUpdated=!1;else for(var n in this.toTestAppearSet){var r=this.toTestAppearSet[n];r.treeNode.parent&&zd(r,this.screenState,this.refreshComponent,this.removeComponent)}}},{key:"commitVisibleAndDecorateDiff",value:function(e){var t=[],n=[],r=[];for(var i in this.toShowSet){var a=this.toShowSet[i],o=a.vision,s=a.component.treeNode;e.addedSet[i]||t.push(s),this.visions.bindVision(s,o)}for(var c in this.toMoveSet){var u=this.toMoveSet[c],l=u.vision,h=u.component.treeNode;this.visions.bindVision(h,l)}for(var d in this.toHideSet){var p=this.toHideSet[d].treeNode;e.removedSet[d]||n.push(p),this.visions.unbindVision(d)}for(var f in e.addedSet)this.visions.includes(f)||r.push(f);return e.decorate({insertToAdded:t,insertToRemoved:n,maskAdded:r})}},{key:"notify",value:function(e,t){var n={};for(var r in this.toMoveSet)n[r]=this.toMoveSet[r].component;for(var i in this.toUpdateSet)this.visions.includes(i)||delete this.toUpdateSet[i];for(var a in this.toTestVisibleSet)this.visions.includes(a)||delete this.toTestVisibleSet[a];this.notifier.flush({context:this.screen.context,camera:this.screenState.camera,diff:e,isTransition:t,moveSet:n,testSet:this.toTestVisibleSet,updateSet:this.toUpdateSet,screenSize:Object.freeze({width:this.screen.width,height:this.screen.height})})}},{key:"cleanSet",value:function(){this.toTestVisibleSet={},this.toUpdateSet={},gl(this.toTestAppearSet)&&(this.toTestAppearSet={}),gl(this.toSortSet)&&(this.toSortSet={}),gl(this.toMoveSet)&&(this.toMoveSet={}),gl(this.toShowSet)&&(this.toShowSet={}),gl(this.toHideSet)&&(this.toHideSet={})}}]),e}(),Kd=function(){function e(t){C(this,e),this.context=null,this.screen=t.screen,this.engines=t.engines,this.onRenderDuration=t.onRenderDuration,this.visions=new Ah,this._wrappedComponents=Object.freeze(p(t.wrappedComponents))}return P(e,[{key:"hitTest",value:function(e,t){var n=this,r=[];if(this.context){var i=t/this.screen.camera.scale;this.context.visibleTestNode.forEachVisibleComponent((function(t){n.isHitComponent(t,e,i)&&r.push(t.id)}))}return r.reverse()}},{key:"findComponentWithTarget",value:function(e){if(this.context)return this.context.visibleTestNode.findComponentWithTarget(e)}},{key:"willInterruptEvent",value:function(e,t){return!!this.context&&this.context.visibleTestNode.willInterruptEvent(e,t)}},{key:"refreshScreenRendererState",value:function(e){var t;null==(t=this.context)||t.visibleTestNode.renderer.setState(e)}},{key:"refreshScreenContext",value:function(){this.context&&this.context.visibleTestNode.refreshScreenContext()}},{key:"isHitComponent",value:function(e,t,n){var r=t.x,i=t.y;if(void 0===e.rotation){var a=Yd(e,this.screen.camera.scale),o=Math.max(a.left,n),s=Math.max(a.right,n),c=Math.max(a.top,n),u=Math.max(a.bottom,n),l=e.originX-o,h=e.originY-c,d=e.width+o+s,p=e.height+c+u;if(Ed.testPoint(l,h,d,p,r,i))return e.definition.hitTest(this.screen,e,r,i,n)}return!1}},{key:"divElement",get:function(){return this.context&&this.context.divElement},set:function(e){e!==(this.context&&this.context.divElement)&&(this.context&&(this.context.visibleTestNode.release(),(0,Uu.unmountComponentAtNode)(this.context.divElement)),e?this.context=Object.freeze({divElement:e,visibleTestNode:new Qd({screen:this.screen,engines:this.engines,visions:this.visions,onRenderDuration:this.onRenderDuration})}):(this.visions.clean(),this.context=null),this.refreshScreenRender())}},{key:"wrappedComponents",get:function(){return this._wrappedComponents},set:function(e){this._wrappedComponents!==e&&(this._wrappedComponents=Object.freeze(p(e)),this.refreshScreenRender())}},{key:"refreshScreenRender",value:function(){if(this.context){var e=(0,Bu.createElement)(this.context.visibleTestNode.renderer.getRender()),t=Td(this._wrappedComponents,e);(0,Uu.render)(t,this.context.divElement)}}}]),e}(),qd=function(){function e(t){var n=this;C(this,e),this.screenUpdatedDispatcher=new Fh,this.cameraUpdatedDispatcher=new Fh,this.renderErrorCatchedDispatcher=new Fh,this.sizeUpdatedDispatcher=new Fh,this.centerX=0,this.centerY=0,this.scale=1,this.adaptedRectangle=null,this.dispatchUpdatedEvent=function(e,t,r){var i=n.convertVisionRectangle(e,n._width,n._height);n.screenUpdatedDispatcher.dispatch({width:n._width,height:n._height,camera:e,visionRectangle:i,isTransition:t}),n.cameraUpdatedDispatcher.dispatch(Ju(Zu({},e),{operatorId:r}))},this.onResize=function(e){var t=e[0];if(t){var r=t.contentRect,i=r.width,a=r.height;n.refreshSize(i,a)}},this.deviceType=t.scene.deviceType,this.scene=t.scene,this._className=t.className,this._style=t.style,this._context=t.context,this._width=t.width,this._height=t.height,this.cameraAnimation=new Md(this.camera,this.dispatchUpdatedEvent),this.eventInterrupter=t.eventInterrupter,this.onRenderDuration=t.onRenderDuration,this.updater=new Kd({screen:this,engines:t.engines,wrappedComponents:t.wrappedComponents,onRenderDuration:t.onRenderDuration}),t.autoResize&&("object"==("undefined"==typeof window?"undefined":M(window))&&"string"in window?this.resizeObserver=new window.ResizeObserver(this.onResize):this.resizeObserver=new Du.ResizeObserver(this.onResize))}return P(e,[{key:"className",get:function(){return this._className},set:function(e){this._className!==e&&(this._className=e,this.updater.refreshScreenRendererState({className:e}))}},{key:"style",get:function(){return this._style},set:function(e){this._style!==e&&(this._style=e,this.updater.refreshScreenRendererState({style:e}))}},{key:"wrappedComponents",get:function(){return this.updater.wrappedComponents},set:function(e){this.updater.wrappedComponents=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"divElement",get:function(){return this.updater.divElement},set:function(e){var t=this.updater.divElement;if(t!==e){if(this.resizeObserver&&t&&this.resizeObserver.unobserve(t),this.updater.divElement=e,e){var n=e.clientWidth,r=e.clientHeight;this.refreshSize(n,r),this.resizeObserver&&this.resizeObserver.observe(e)}this._eventProxy&&this._eventProxy.bindDivElement(e)}}},{key:"eventProxy",get:function(){return this._eventProxy||(this._eventProxy=new Yh(this,this.eventInterrupter),this._eventProxy.bindDivElement(this.divElement)),this._eventProxy}},{key:"context",get:function(){return this._context},set:function(e){this._context!==e&&(this._context=e,this.updater.refreshScreenContext())}},{key:"bounding",get:function(){if(this.divElement){var e=this.divElement.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}}return{left:0,right:0,top:0,bottom:0,width:0,height:0}}},{key:"bindCameraman",value:function(e,t){return new sd(this,this.eventProxy,t,e)}},{key:"convertPointToScreen",value:function(e,t){return{x:(e-this.centerX)*this.scale+this._width/2,y:(t-this.centerY)*this.scale+this._height/2}}},{key:"convertPointToScene",value:function(e,t){return{x:(e-this._width/2)/this.scale+this.centerX,y:(t-this._height/2)/this.scale+this.centerY}}},{key:"cameraWithAdaptRectangle",value:function(e,t){var n=e.originX+e.width/2,r=e.originY+e.height/2,i=this._width/e.width,a=this._height/e.height;switch((Number.isNaN(i)||i<=0)&&(i=1),(Number.isNaN(a)||a<=0)&&(a=1),t){case pp.Centering:return{centerX:n,centerY:r,scale:Math.min(i,a)};case pp.Tailor:return{centerX:n,centerY:r,scale:Math.max(i,a)};default:throw new Error("invalid adapter mode ".concat(t))}}},{key:"adaptRectangle",value:function(e){if(0===e.width||0===e.height)this.transformCamera({animationMode:e.animationMode,centerX:e.originX+e.width/2,centerY:e.originY+e.height/2,scale:1,operatorId:e.operatorId});else{var t=Ju(Zu({},this.cameraWithAdaptRectangle(e,e.adapterMode)),{animationMode:e.animationMode,operatorId:e.operatorId});this.setCameraTransfrom(t,!1),this.adaptedRectangle=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height,adapterMode:e.adapterMode})}}},{key:"transformCamera",value:function(e){this.adaptedRectangle=null,this.setCameraTransfrom(e,!1)}},{key:"setTransition",value:function(e,t){e!==this.cameraAnimation.isTransition&&this.updateCameraAnimation(this.camera,yp.Immediately,e,t)}},{key:"setCameraTransfrom",value:function(e,t){var n=mh(e.centerX,this.centerX),r=mh(e.centerY,this.centerY),i=mh(e.scale,this.scale);(n!==this.centerX||r!==this.centerY||i!==this.scale||t!==this.cameraAnimation.isTransition)&&(this.centerX=n,this.centerY=r,this.scale=i,this.updateCameraAnimation(this.camera,e.animationMode,t,e.operatorId))}},{key:"updateCameraAnimation",value:function(e,t,n,r){switch(t){case yp.Immediately:this.dispatchUpdatedEvent(e,n,r),this.cameraAnimation.moveToRightNow(e,n);break;case yp.Continuous:this.cameraAnimation.moveTo(e,n,r)}}},{key:"camera",get:function(){return{centerX:this.centerX,centerY:this.centerY,scale:this.scale}}},{key:"visionRectangle",get:function(){return this.convertVisionRectangle(this.camera,this._width,this._height)}},{key:"willInterruptEvent",value:function(e,t){return this.updater.willInterruptEvent(e,t)}},{key:"convertVisionRectangle",value:function(e,t,n){var r=t/e.scale,i=n/e.scale;return{originX:e.centerX-r/2,originY:e.centerY-i/2,width:r,height:i}}},{key:"hitTest",value:function(e,t,n){return this.updater.hitTest(this.convertPointToScene(e,t),n)}},{key:"findComponentWithTarget",value:function(e){return this.updater.findComponentWithTarget(e)}},{key:"renderScreenshot",value:function(e){var t=vh(e.camera,Object.freeze(this.camera)),n=vh(e.width,this._width),r=vh(e.height,this._height),i=new Ah;return Xd(i,this.scene,{width:this._width,height:this._height,camera:t,isTransition:!1,visionRectangle:this.convertVisionRectangle(t,n,r)}),new Od({visions:i,tree:this.scene.tree,screen:this,initCamera:t,engines:this.updater.engines,onRenderDuration:this.onRenderDuration}).render(this.updater.wrappedComponents)}},{key:"resize",value:function(){if(this.divElement&&!this.resizeObserver){var e=this.divElement;this.refreshSize(e.clientWidth,e.clientHeight)}}},{key:"refreshSize",value:function(e,t){var n;this._width===e&&this._height===t||(this._width=e,this._height=t,n=this.adaptedRectangle?this.cameraWithAdaptRectangle(this.adaptedRectangle,this.adaptedRectangle.adapterMode):this.camera,this.setCameraTransfrom(Ju(Zu({},n),{animationMode:yp.Immediately}),!1),this.dispatchUpdatedEvent(n,!1),this.sizeUpdatedDispatcher.dispatch({width:e,height:t}))}},{key:"addCameraUpdatedListener",value:function(e){this.cameraUpdatedDispatcher.addListener(e)}},{key:"removeCameraUpdatedListener",value:function(e){this.cameraUpdatedDispatcher.removeListener(e)}},{key:"addRenderErrorCatchedListener",value:function(e){this.renderErrorCatchedDispatcher.addListener(e)}},{key:"removeRenderErrorCatchedListener",value:function(e){this.renderErrorCatchedDispatcher.removeListener(e)}},{key:"addSizeUpdatedListener",value:function(e){this.sizeUpdatedDispatcher.addListener(e)}},{key:"removeSizeUpdatedListener",value:function(e){this.sizeUpdatedDispatcher.removeListener(e)}},{key:"addScreenUpdatedListener",value:function(e){this.screenUpdatedDispatcher.addListener(e)}},{key:"removeScreenUpdatedListener",value:function(e){this.screenUpdatedDispatcher.removeListener(e)}},{key:"layoutComponentWithTarget",value:function(e){var t=this.findComponentWithTarget(e);if(t)return{componentId:t.component.id,layout:t.engine.orderIndex}}}]),e}();function Zd(e,t,n){var r=t,i=e.orderIndex,a=function(e){g(a,e);var n=b(a);function a(){return C(this,a),n.apply(this,arguments)}return P(a,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.margin,a=e.origin,o=e.size,s=e.scale,c=e.payload,u=e.context,l=e.cnode;return(0,Wu.createElement)(r,{id:t,layout:i,margin:n,origin:a,size:o,scale:s,payload:c,context:u,cnode:l})}}],[{key:"willInterruptEvent",value:function(e,n,r){return"function"==typeof t.willInterruptEvent?t.willInterruptEvent(e,n,i,r):"boolean"==typeof t.willInterruptEvent&&t.willInterruptEvent}}]),a}(Wu.Component);return a.isVisible=n,a}var Jd,$d=function(){function e(t){C(this,e),this.definitionNodes=[];var n,r=p(t).sort((function(e,t){return e.layout-t.layout})),i={},a={},o=T(r);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=this.createEngine(s);s.renderMode===kp.Screen&&(a[c.id]=!0),i[c.id]=c}}catch(e){o.e(e)}finally{o.f()}this.engines=Object.freeze(Zu({},i)),this.absoluteCoordinatesSet=Object.freeze(Zu({},a))}return P(e,[{key:"createEngine",value:function(e){var t,n=e.layout,r=e.kind,i=e.renderMode,a=e.className,o=e.style;switch(r){case bp.HTML:case bp.SVG:t=Mh({orderIndex:n,fixedSize:i===kp.AbsoluteSize,isSVG:r===bp.SVG,className:a,style:o});break;case bp.CANVAS:t=yh({orderIndex:n,fixedSize:!0});break;default:throw new Error("invalid kind ".concat(r))}return t}},{key:"adaptComponentConstructor",value:function(e){if(e.definition)return e;var t=e,n=this.findDefinitionNode(t).definition,r=this.checkIsAbsoluteCoordinates(t);return{id:t.id,definition:n,originX:t.originX,originY:t.originY,width:t.width,height:t.height,parallaxMargin:t.parallaxMargin,sceneMargin:t.sceneMargin,disableVisionTrim:t.disableVisionTrim,absoluteCoordinates:r,payload:t.payload,orderIndex:t.orderIndex}}},{key:"checkIsAbsoluteCoordinates",value:function(e){for(var t in e.render.layouts){var n=this.findEngineWithLayout(parseInt(t,10));if(n)return!!this.absoluteCoordinatesSet[n.id]}return!1}},{key:"findDefinitionNode",value:function(e){var t,n=null,r=T(this.definitionNodes);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.render===e.render){n=i;break}}}catch(e){r.e(e)}finally{r.f()}return n||(n=Object.freeze({definition:this.createDefinition(e),render:e.render,painter:e.painter}),this.definitionNodes.push(n)),n}},{key:"createDefinition",value:function(e){var t,n=e.render,r=new cp({name:n.name||"ComponentDefinition",hitTest:null==(t=n.hitTest)?void 0:t.bind(n)});for(var i in n.layouts){var a=this.findEngineWithLayout(parseInt(i,10)),o=n.layouts[i].isVisible;a instanceof Ph&&a.bind(r)(Zd(a,n,o))}return r}},{key:"findEngineWithLayout",value:function(e){for(var t in this.engines)if(this.engines[t].orderIndex===e)return this.engines[t];return null}}]),e}();!function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.VisibleUpdated=2]="VisibleUpdated",e[e.AppearUpdated=3]="AppearUpdated",e[e.PropertiesUpdated=4]="PropertiesUpdated"}(Jd||(Jd={}));var ep=Object.freeze({left:0,right:0,top:0,bottom:0}),tp=new xd({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0}),np=function(){function e(t,n,r){var i=this;C(this,e),this.onRemovedDispatcher=new Fh,this.onRectangleUpdatedDispatcher=new Fh,this.onRectanglePointUpdate=function(){i.reporter.update(i,Jd.AppearUpdated),i.onRectangleUpdatedDispatcher.dispatch(i)},this.reporter=t,this.id=n.id||(0,Hu.v4)().replace(/-/g,""),this.treeNode=r,this._parallaxMargin=ip(n.parallaxMargin),this._sceneMargin=ip(n.sceneMargin),this.disableVisionTrim=!!n.disableVisionTrim,this.absoluteCoordinates=!!n.absoluteCoordinates,this._orderIndex=n.orderIndex,this.rectangleTarget={originX:rp(n.originX),originY:rp(n.originY),width:rp(n.width),height:rp(n.height)};var a=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];this.rectangleAnimation=tp.create(wd.ComponentMoving,a,this.onRectanglePointUpdate)}return P(e,[{key:"originX",get:function(){return this.rectangleAnimation.point[0]}},{key:"originY",get:function(){return this.rectangleAnimation.point[1]}},{key:"width",get:function(){return this.rectangleAnimation.point[2]}},{key:"height",get:function(){return this.rectangleAnimation.point[3]}},{key:"parallaxMargin",get:function(){return this._parallaxMargin}},{key:"sceneMargin",get:function(){return this._sceneMargin}},{key:"orderIndex",get:function(){return this._orderIndex},set:function(e){if(e!==this._orderIndex){var t=this.treeNode.parent.value;this._orderIndex=e,t.reportChildOrderUpdate()}}},{key:"moveTo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yp.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.syncRectangleTarget(n))}},{key:"resize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yp.Immediately;(this.rectangleTarget.width!==e||this.rectangleTarget.height!==t)&&(this.rectangleTarget.width=e,this.rectangleTarget.height=t,this.syncRectangleTarget(n))}},{key:"setRectangle",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:yp.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t||this.rectangleTarget.width!==n||this.rectangleTarget.height!==r)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.rectangleTarget.width=n,this.rectangleTarget.height=r,this.syncRectangleTarget(i))}},{key:"syncRectangleTarget",value:function(e){var t=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];switch(e){case yp.Immediately:this.rectangleAnimation.moveRightNow(t),this.reporter.update(this,Jd.AppearUpdated);break;case yp.Continuous:this.rectangleAnimation.moveTo(t)}}},{key:"setParallaxMargin",value:function(e){ap(this._parallaxMargin,e)||(this._parallaxMargin=ip(e),this.reporter.update(this,Jd.AppearUpdated))}},{key:"setSceneMargin",value:function(e){ap(this._sceneMargin,e)||(this._sceneMargin=ip(e),this.reporter.update(this,Jd.AppearUpdated))}},{key:"release",value:function(){this.rectangleAnimation.stop(),this.onRemovedDispatcher.dispatch(this)}},{key:"addRemovedListener",value:function(e){this.onRemovedDispatcher.addListener(e)}},{key:"removeRemovedListener",value:function(e){this.onRemovedDispatcher.removeListener(e)}},{key:"addRectangleUpdatedListener",value:function(e){this.onRectangleUpdatedDispatcher.addListener(e)}},{key:"removeRectangleUpdatedListener",value:function(e){this.onRectangleUpdatedDispatcher.removeListener(e)}}]),e}();function rp(e){return"number"==typeof e?e:0}function ip(e){return void 0===e||0===e?ep:"number"==typeof e?Object.freeze({left:e,right:e,top:e,bottom:e}):Object.freeze(Zu({},e))}function ap(e,t){return void 0===t?0===e.top&&0===e.left&&0===e.right&&0===e.bottom:"number"==typeof t?e.top===t&&e.left===t&&e.right===t&&e.bottom===t:e.top===t.top&&e.left===t.left&&e.right===t.right&&e.bottom===t.bottom}var op=function(e){g(n,e);var t=b(n);function n(e,r,i,a){var o;return C(this,n),(o=t.call(this,e,a,i)).group=new hp(e,r,i),o._scale=vh(a.scale,1),o}return P(n,[{key:"kind",get:function(){return fp.Group}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e)}},{key:"components",get:function(){return this.group.components}},{key:"removeComponent",value:function(e){return this.group.removeComponent(e)}},{key:"reportChildOrderUpdate",value:function(){this.group.reportChildOrderUpdate()}},{key:"addComponent",value:function(e){return this.group.addComponent(e)}},{key:"addComponentGroup",value:function(e){return this.group.addComponentGroup(e)}}]),n}(np),sp=function(){function e(t){if(C(this,e),this.engineNodes={},this.enginesCache=null,this.id="".concat(e.nextId),this.name=t.name,e.nextId+=1,"boolean"==typeof t.hitTest){var n=t.hitTest;this.hitTest=function(){return n}}else t.hitTest?this.hitTest=t.hitTest:this.hitTest=function(){return!0}}return P(e,[{key:"engines",get:function(){if(!this.enginesCache){var e=[],t=[];for(var n in this.engineNodes){var r=this.engineNodes[n].engine;void 0===r.orderIndex?t.push(r):e.push(r)}e.sort((function(e,t){return e.orderIndex-t.orderIndex})),this.enginesCache=Object.freeze([].concat(e,t))}return this.enginesCache}},{key:"addEngine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.enginesCache)throw new Error("definition is frozon. you can only do it before bind with screen");if(!(e instanceof el))throw new Error("it is not RenderEngine");this.engineNodes[e.id]=Object.freeze({engine:e,options:Object.freeze({isVisible:vh(t.isVisible,!0)})})}},{key:"options",value:function(e){var t;return null==(t=this.engineNodes[e.id])?void 0:t.options}}]),e}(),cp=sp;cp.nextId=0;var up,lp=function(e){g(n,e);var t=b(n);function n(e,r,i){var a;if(C(this,n),(a=t.call(this,e,r,i)).visibleMap={},a.visibleCount=0,!(r.definition instanceof cp))throw new Error("it is not ComponentDefinition");a.definition=r.definition,a._rotation=r.rotation,a._payload=r.payload;var o,s=T(a.definition.engines);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=a.definition.options(c).isVisible;u&&(a.visibleCount+=1),a.visibleMap[c.id]=u}}catch(e){s.e(e)}finally{s.f()}return a}return P(n,[{key:"kind",get:function(){return fp.Component}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.reporter.update(this,Jd.AppearUpdated))}},{key:"payload",get:function(){return this._payload},set:function(e){e!==this._payload&&(this._payload=e,this.reporter.update(this,Jd.PropertiesUpdated))}},{key:"isVisible",value:function(e){return"number"==typeof e?this.visibleMap[e]||!1:e?this.visibleMap[e.id]||!1:this.visibleCount>0}},{key:"setVisible",value:function(e,t){var n;if(n="number"==typeof e?"".concat(e):e.id,void 0!==this.visibleMap[n]&&this.visibleMap[n]!==t){var r=0===this.visibleCount;this.visibleMap[n]=t,t?this.visibleCount+=1:this.visibleCount-=1,r===(0===this.visibleCount)?this.reporter.update(this,Jd.VisibleUpdated):this.reporter.update(this,Jd.AppearUpdated)}}}]),n}(np),hp=function(){function e(t,n,r){C(this,e),this.shouldSort=!1,this.reporter=t,this.tree=n,this.treeNode=r}return P(e,[{key:"components",get:function(){this.sortIfNeed();var e,t=[],n=T(this.treeNode);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.value)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"reportChildOrderUpdate",value:function(){this.shouldSort=!0,this.reporter.sortGroup(this)}},{key:"sortIfNeed",value:function(){this.shouldSort&&(this.shouldSort=!1,this.tree.sort(this.treeNode,(function(e,t){var n=e.value.orderIndex,r=t.value.orderIndex;return void 0!==n&&void 0!==r?n-r:void 0!==n?-1:void 0!==r?1:e.id.localeCompare(t.id)})))}},{key:"removeComponent",value:function(e){return this.treeNode===e.treeNode.parent&&(this.tree.remove(e.treeNode),this.reporter.update(e,Jd.Removed),e.release(),!0)}},{key:"addComponent",value:function(e){var t=this.tree.wrapLeaf(),n=new lp(this.reporter,e,t);return this.addNode(t,n)}},{key:"addComponentGroup",value:function(e){var t=this.tree.wrapGroup(),n=new op(this.reporter,this.tree,t,e);return this.addNode(t,n)}},{key:"addNode",value:function(e,t){return e.value=t,this.tree.append(e,this.treeNode),this.reporter.update(t,Jd.Added),t}}]),e}(),dp=function(e){g(n,e);var t=b(n);function n(e,r,i,a,o){var s;return C(this,n),(s=t.call(this,a,o,o.root)).componentUpdateDispatcher=new Fh,s.groupSortedDispatcher=new Fh,s.deviceType=e,s.logger=r,s.legacy=i,s}return P(n,[{key:"createScreen",value:function(e){return new qd({scene:this,context:e.context,className:e.className,autoResize:!!e.autoResize,width:mh(e.width,0),height:mh(e.height,0),engines:this.collectEngines(e),eventInterrupter:e.eventInterrupter||function(){return!1},wrappedComponents:e.wrappedComponents||[],onRenderDuration:e.onRenderDuration})}},{key:"collectEngines",value:function(e){var t;if(e.engines){t={};var n,r=T(e.engines);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!(i instanceof el))throw new Error("it is not RenderEngine");t[i.id]=i}}catch(e){r.e(e)}finally{r.f()}}else t=this.legacy.engines;var a=[],o=[];for(var s in t){var c=t[s];void 0===c.orderIndex?o.push(c):a.push(c)}return Object.freeze([].concat(a,o))}},{key:"getEngineWithLegacyLayout",value:function(e){for(var t in this.legacy.engines){var n=this.legacy.engines[t];if(n.orderIndex===e)return n}}},{key:"addComponentUpdateListener",value:function(e){this.componentUpdateDispatcher.addListener(e)}},{key:"removeComponentUpdateListener",value:function(e){this.componentUpdateDispatcher.removeListener(e)}},{key:"reportComponentUpdate",value:function(e,t){this.componentUpdateDispatcher.dispatch({node:e,behavior:t})}},{key:"addGroupSortedListener",value:function(e){this.groupSortedDispatcher.addListener(e)}},{key:"removeGroupSortedListener",value:function(e){this.groupSortedDispatcher.removeListener(e)}}],[{key:"create",value:function(e,t,r){var i,a=new Ll,o={update:function(e,t){return i.reportComponentUpdate(e,t)},sortGroup:function(e){return i.groupSortedDispatcher.dispatch(e)}};return i=new n(e,t,r,o,a),a.root.value=i,i}}]),n}(hp);!function(e){e.Desktop="desktop",e.Touch="touch",e.Surface="surface"}(up||(up={}));var pp,fp,vp,mp,gp,yp,bp,kp,wp=function(){function e(t){C(this,e),this.deviceType=t}return P(e,[{key:"createScene",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.createDefaultLogger();return dp.create(this.deviceType,t,new $d([]))}},{key:"createSceneWithLegacyLayoutDescriptions",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.createDefaultLogger();return dp.create(this.deviceType,n,new $d(t))}}],[{key:"createDefaultLogger",value:function(){return vu(new du,"Boundless")}}]),e}();function Sp(e){return new cp(e)}function xp(e,t,n){return e+(t-e)*n}function Cp(e,t){var n=Math.sqrt(e*e+t*t);return 0===n?{x:1,y:0}:{x:e/n,y:t/n}}function Ip(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}!function(e){e.Centering="centering",e.Tailor="tailor"}(pp||(pp={})),function(e){e[e.Group=0]="Group",e[e.Component=1]="Component"}(fp||(fp={})),function(e){e[e.Unchanged=0]="Unchanged",e[e.Overlay=1]="Overlay",e[e.Changed=2]="Changed"}(vp||(vp={})),function(e){e[e.Directly=0]="Directly",e[e.GenerateCache=1]="GenerateCache",e[e.Overlay=2]="Overlay",e[e.OverlayOnCache=3]="OverlayOnCache"}(mp||(mp={})),function(e){e.Begin="Begin",e.End="End"}(gp||(gp={})),function(e){e.Continuous="continuous",e.Immediately="immediately"}(yp||(yp={})),function(e){e[e.HTML=0]="HTML",e[e.SVG=1]="SVG",e[e.CANVAS=2]="CANVAS"}(bp||(bp={})),function(e){e[e.AbsoluteSize=0]="AbsoluteSize",e[e.RelativeSize=1]="RelativeSize",e[e.Screen=2]="Screen"}(kp||(kp={}));var Pp=Y(n(68949)),Mp={};G(Mp,{MobXProviderContext:function(){return Gf},Observer:function(){return af},PropTypes:function(){return iv},Provider:function(){return Yf},disposeOnUnmount:function(){return $f},enableStaticRendering:function(){return Kp},inject:function(){return Kf},isUsingStaticRendering:function(){return qp},observer:function(){return Hf},observerBatching:function(){return Lp},useAsObservableSource:function(){return pf},useLocalObservable:function(){return cf},useLocalStore:function(){return ff},useObserver:function(){return vf},useStaticRendering:function(){return mf}});var Tp=Y(n(68949)),Ap=Y(n(67294)),Ep=Y(n(68949));if(!Y(n(67294)).useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!Ep.makeObservable)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");var Op=Y(n(73935)),Rp=Y(n(68949));function Np(e){e()}function Lp(e){e||(e=Np),(0,Rp.configure)({reactionScheduler:e})}var jp=Y(n(67294)),Dp=[];function Fp(){var e=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}((0,jp.useState)(0),2),t=e[1];return(0,jp.useCallback)((function(){t((function(e){return e+1}))}),Dp)}var zp=Y(n(68949)),Bp=Y(n(67294)),Up=Y(n(68949));function Vp(e){return(0,Up.getDependencyTree)(e)}var Wp="undefined"==typeof FinalizationRegistry?void 0:FinalizationRegistry;function Hp(e){return{reaction:e,mounted:!1,changedBeforeMount:!1,cleanAt:Date.now()+_p}}var _p=1e4;var Gp=Wp?function(e){var t=new Map,n=1,r=new e((function(e){var n=t.get(e);n&&(n.reaction.dispose(),t.delete(e))}));return{addReactionToTrack:function(e,i,a){var o=n++;return r.register(a,o,e),e.current=Hp(i),e.current.finalizationRegistryCleanupToken=o,t.set(o,e.current),e.current},recordReactionAsCommitted:function(e){r.unregister(e),e.current&&e.current.finalizationRegistryCleanupToken&&t.delete(e.current.finalizationRegistryCleanupToken)},forceCleanupTimerToRunNowForTests:function(){},resetCleanupScheduleForTests:function(){}}}(Wp):function(){var e,t=new Set;function n(){void 0===e&&(e=setTimeout(r,1e4))}function r(){e=void 0;var r=Date.now();t.forEach((function(e){var n=e.current;n&&r>=n.cleanAt&&(n.reaction.dispose(),e.current=null,t.delete(e))})),t.size>0&&n()}return{addReactionToTrack:function(e,r,i){return e.current=Hp(r),function(e){t.add(e),n()}(e),e.current},recordReactionAsCommitted:function(e){t.delete(e)},forceCleanupTimerToRunNowForTests:function(){e&&(clearTimeout(e),r())},resetCleanupScheduleForTests:function(){var n,r;if(t.size>0){try{for(var i=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),a=i.next();!a.done;a=i.next()){var o=a.value,s=o.current;s&&(s.reaction.dispose(),o.current=null)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}t.clear()}e&&(clearTimeout(e),e=void 0)}}}(),Yp=Gp.addReactionToTrack,Xp=Gp.recordReactionAsCommitted,Qp=(Gp.resetCleanupScheduleForTests,Gp.forceCleanupTimerToRunNowForTests,!1);function Kp(e){Qp=e}function qp(){return Qp}function Zp(e){return"observer"+e}var Jp=function(){};function $p(e,t){if(void 0===t&&(t="observed"),qp())return e();var n=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}(Bp.default.useState(new Jp),1),r=n[0],i=Fp(),a=Bp.default.useRef(null);if(!a.current)var o=new zp.Reaction(Zp(t),(function(){s.mounted?i():s.changedBeforeMount=!0})),s=Yp(a,o,r);var c,u,l=a.current.reaction;if(Bp.default.useDebugValue(l,Vp),Bp.default.useEffect((function(){return Xp(a),a.current?(a.current.mounted=!0,a.current.changedBeforeMount&&(a.current.changedBeforeMount=!1,i())):(a.current={reaction:new zp.Reaction(Zp(t),(function(){i()})),mounted:!0,changedBeforeMount:!1,cleanAt:1/0},i()),function(){a.current.reaction.dispose(),a.current=null}}),[]),l.track((function(){try{c=e()}catch(e){u=e}})),u)throw u;return c}var ef=Y(n(67294)),tf=function(){return tf=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},tf.apply(this,arguments)};function nf(e,t){if(qp())return e;var n,r=tf({forwardRef:!1},t),i=e.displayName||e.name,a=function(t,n){return $p((function(){return e(t,n)}),i)};return a.displayName=i,n=r.forwardRef?(0,ef.memo)((0,ef.forwardRef)(a)):(0,ef.memo)(a),function(e,t){Object.keys(e).forEach((function(n){rf[n]||Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}(e,n),n.displayName=i,n}var rf={$$typeof:!0,render:!0,compare:!0,type:!0};function af(e){var t=e.children,n=e.render,r=t||n;return"function"!=typeof r?null:$p(r)}af.displayName="Observer";var of=Y(n(68949)),sf=Y(n(67294));function cf(e,t){return(0,sf.useState)((function(){return(0,of.observable)(e(),t,{autoBind:!0})}))[0]}var uf=Y(n(68949)),lf=Y(n(67294)),hf=Y(n(68949)),df=Y(n(67294));function pf(e){var t=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}((0,df.useState)((function(){return(0,hf.observable)(e,{},{deep:!1})})),1),n=t[0];return(0,hf.runInAction)((function(){Object.assign(n,e)})),n}function ff(e,t){var n=t&&pf(t);return(0,lf.useState)((function(){return(0,uf.observable)(e(n),void 0,{autoBind:!0})}))[0]}function vf(e,t){return void 0===t&&(t="observed"),$p(e,t)}function mf(e){Kp(e)}Lp(Op.unstable_batchedUpdates);var gf=0;var yf={};function bf(e){return yf[e]||(yf[e]=function(e){if("function"==typeof Symbol)return Symbol(e);var t="__$mobx-react "+e+" ("+gf+")";return gf++,t}(e)),yf[e]}function kf(e,t){if(wf(e,t))return!0;if("object"!=M(e)||null===e||"object"!=M(t)||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(!Object.hasOwnProperty.call(t,n[i])||!wf(e[n[i]],t[n[i]]))return!1;return!0}function wf(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var Sf={$$typeof:1,render:1,compare:1,type:1,childContextTypes:1,contextType:1,contextTypes:1,defaultProps:1,getDefaultProps:1,getDerivedStateFromError:1,getDerivedStateFromProps:1,mixins:1,displayName:1,propTypes:1};function xf(e,t,n){Object.hasOwnProperty.call(e,t)?e[t]=n:Object.defineProperty(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})}var Cf=bf("patchMixins"),If=bf("patchedDefinition");function Pf(e,t){for(var n=this,r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];t.locks++;try{var o;return null!=e&&(o=e.apply(this,i)),o}finally{t.locks--,0===t.locks&&t.methods.forEach((function(e){e.apply(n,i)}))}}function Mf(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];Pf.call.apply(Pf,[this,e,t].concat(r))}}function Tf(e,t,n){var r=function(e,t){var n=e[Cf]=e[Cf]||{},r=n[t]=n[t]||{};return r.locks=r.locks||0,r.methods=r.methods||[],r}(e,t);r.methods.indexOf(n)<0&&r.methods.push(n);var i=Object.getOwnPropertyDescriptor(e,t);if(!i||!i[If]){var a=e[t],o=Af(e,t,i?i.enumerable:void 0,r,a);Object.defineProperty(e,t,o)}}function Af(e,t,n,r,i){var a,o=Mf(i,r);return(a={})[If]=!0,a.get=function(){return o},a.set=function(i){if(this===e)o=Mf(i,r);else{var a=Af(this,t,n,r,i);Object.defineProperty(this,t,a)}},a.configurable=!0,a.enumerable=n,a}var Ef=Tp.$mobx||"$mobx",Of=bf("isMobXReactObserver"),Rf=bf("isUnmounted"),Nf=bf("skipRender"),Lf=bf("isForcingUpdate");function jf(e){var t=e.prototype;if(e[Of]){var n=Df(t);console.warn("The provided component class ("+n+") \n                has already been declared as an observer component.")}else e[Of]=!0;if(t.componentWillReact)throw new Error("The componentWillReact life-cycle event is no longer supported");if(e.__proto__!==Ap.PureComponent)if(t.shouldComponentUpdate){if(t.shouldComponentUpdate!==zf)throw new Error("It is not allowed to use shouldComponentUpdate in observer based components.")}else t.shouldComponentUpdate=zf;Bf(t,"props"),Bf(t,"state");var r=t.render;return t.render=function(){return Ff.call(this,r)},Tf(t,"componentWillUnmount",(function(){var e;if(!0!==qp()&&(null==(e=this.render[Ef])||e.dispose(),this[Rf]=!0,!this.render[Ef])){var t=Df(this);console.warn("The reactive render of an observer class component ("+t+") \n                was overriden after MobX attached. This may result in a memory leak if the \n                overriden reactive render was not properly disposed.")}})),e}function Df(e){return e.displayName||e.name||e.constructor&&(e.constructor.displayName||e.constructor.name)||"<component>"}function Ff(e){var t=this;if(!0===qp())return e.call(this);xf(this,Nf,!1),xf(this,Lf,!1);var n=Df(this),r=e.bind(this),i=!1,a=new Tp.Reaction(n+".render()",(function(){if(!i&&(i=!0,!0!==t[Rf])){var e=!0;try{xf(t,Lf,!0),t[Nf]||Ap.Component.prototype.forceUpdate.call(t),e=!1}finally{xf(t,Lf,!1),e&&a.dispose()}}}));function o(){i=!1;var e=void 0,t=void 0;if(a.track((function(){try{t=(0,Tp._allowStateChanges)(!1,r)}catch(t){e=t}})),e)throw e;return t}return a.reactComponent=this,o[Ef]=a,this.render=o,o.call(this)}function zf(e,t){return qp()&&console.warn("[mobx-react] It seems that a re-rendering of a React component is triggered while in static (server-side) mode. Please make sure components are rendered only once server-side."),this.state!==t||!kf(this.props,e)}function Bf(e,t){var n=bf("reactProp_"+t+"_valueHolder"),r=bf("reactProp_"+t+"_atomHolder");function i(){return this[r]||xf(this,r,(0,Tp.createAtom)("reactive "+t)),this[r]}Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){var e=!1;return Tp._allowStateReadsStart&&Tp._allowStateReadsEnd&&(e=(0,Tp._allowStateReadsStart)(!0)),i.call(this).reportObserved(),Tp._allowStateReadsStart&&Tp._allowStateReadsEnd&&(0,Tp._allowStateReadsEnd)(e),this[n]},set:function(e){this[Lf]||kf(this[n],e)?xf(this,n,e):(xf(this,n,e),xf(this,Nf,!0),i.call(this).reportChanged(),xf(this,Nf,!1))}})}var Uf="function"==typeof Symbol&&Symbol.for,Vf=Uf?Symbol.for("react.forward_ref"):"function"==typeof Ap.forwardRef&&(0,Ap.forwardRef)((function(e){return null})).$$typeof,Wf=Uf?Symbol.for("react.memo"):"function"==typeof Ap.memo&&(0,Ap.memo)((function(e){return null})).$$typeof;function Hf(e){if(!0===e.isMobxInjector&&console.warn("Mobx observer: You are trying to use 'observer' on a component that already has 'inject'. Please apply 'observer' before applying 'inject'"),Wf&&e.$$typeof===Wf)throw new Error("Mobx observer: You are trying to use 'observer' on a function component wrapped in either another observer or 'React.memo'. The observer already applies 'React.memo' for you.");if(Vf&&e.$$typeof===Vf){var t=e.render;if("function"!=typeof t)throw new Error("render property of ForwardRef was not a function");return(0,Ap.forwardRef)((function(){var e=arguments;return(0,Ap.createElement)(af,null,(function(){return t.apply(void 0,e)}))}))}return"function"!=typeof e||e.prototype&&e.prototype.render||e.isReactClass||Object.prototype.isPrototypeOf.call(Ap.Component,e)?jf(e):nf(e)}function _f(){return _f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_f.apply(this,arguments)}var Gf=Ap.default.createContext({});function Yf(e){var t=e.children,n=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],!(t.indexOf(n)>=0)&&(i[n]=e[n]);return i}(e,["children"]),r=Ap.default.useContext(Gf),i=Ap.default.useRef(_f({},r,n)).current;return Ap.default.createElement(Gf.Provider,{value:i},t)}function Xf(e,t,n,r){var i=Ap.default.forwardRef((function(n,r){var i=_f({},n),a=Ap.default.useContext(Gf);return Object.assign(i,e(a||{},i)||{}),r&&(i.ref=r),Ap.default.createElement(t,i)}));return r&&(i=Hf(i)),i.isMobxInjector=!0,function(e,t){var n=Object.getOwnPropertyNames(Object.getPrototypeOf(e));Object.getOwnPropertyNames(e).forEach((function(r){!Sf[r]&&-1===n.indexOf(r)&&Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}(t,i),i.wrappedComponent=t,i.displayName=function(e,t){var n,r=e.displayName||e.name||e.constructor&&e.constructor.name||"Component";return n=t?"inject-with-"+t+"("+r+")":"inject("+r+")",n}(t,n),i}function Qf(e){return function(t,n){return e.forEach((function(e){if(!(e in n)){if(!(e in t))throw new Error("MobX injector: Store '"+e+"' is not available! Make sure it is provided by some Provider");n[e]=t[e]}})),n}}function Kf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("function"==typeof arguments[0]){var r=arguments[0];return function(e){return Xf(r,e,r.name,!0)}}return function(e){return Xf(Qf(t),e,t.join("-"),!1)}}Yf.displayName="MobXProvider";var qf=bf("disposeOnUnmountProto"),Zf=bf("disposeOnUnmountInst");function Jf(){var e=this;[].concat(this[qf]||[],this[Zf]||[]).forEach((function(t){var n="string"==typeof t?e[t]:t;null!=n&&(Array.isArray(n)?n.map((function(e){return e()})):n())}))}function $f(e,t){if(Array.isArray(t))return t.map((function(t){return $f(e,t)}));var n=Object.getPrototypeOf(e).constructor,r=Object.getPrototypeOf(e.constructor),i=Object.getPrototypeOf(Object.getPrototypeOf(e));if(n!==Ap.default.Component&&n!==Ap.default.PureComponent&&r!==Ap.default.Component&&r!==Ap.default.PureComponent&&i!==Ap.default.Component&&i!==Ap.default.PureComponent)throw new Error("[mobx-react] disposeOnUnmount only supports direct subclasses of React.Component or React.PureComponent.");if("string"!=typeof t&&"function"!=typeof t&&!Array.isArray(t))throw new Error("[mobx-react] disposeOnUnmount only works if the parameter is either a property key or a function.");var a="string"==typeof t,o=!!e[qf]||!!e[Zf];return(a?e[qf]||(e[qf]=[]):e[Zf]||(e[Zf]=[])).push(t),o||Tf(e,"componentWillUnmount",Jf),"string"!=typeof t?t:void 0}function ev(e){function t(t,n,r,i,a,o){for(var s=arguments.length,c=new Array(s>6?s-6:0),u=6;u<s;u++)c[u-6]=arguments[u];return(0,Tp.untracked)((function(){if(i=i||"<<anonymous>>",o=o||r,null==n[r]){if(t){var s=null===n[r]?"null":"undefined";return new Error("The "+a+" `"+o+"` is marked as required in `"+i+"`, but its value is `"+s+"`.")}return null}return e.apply(void 0,[n,r,i,a,o].concat(c))}))}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}function tv(e){var t=M(e);return Array.isArray(e)?"array":e instanceof RegExp?"object":function(e,t){return"symbol"===e||"Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol}(t,e)?"symbol":t}function nv(e,t){return ev((function(n,r,i,a,o){return(0,Tp.untracked)((function(){if(e&&tv(n[r])===t.toLowerCase())return null;var a;switch(t){case"Array":a=Tp.isObservableArray;break;case"Object":a=Tp.isObservableObject;break;case"Map":a=Tp.isObservableMap;break;default:throw new Error("Unexpected mobxType: "+t)}var s=n[r];if(!a(s)){var c=function(e){var t=tv(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}(s),u=e?" or javascript `"+t.toLowerCase()+"`":"";return new Error("Invalid prop `"+o+"` of type `"+c+"` supplied to `"+i+"`, expected `mobx.Observable"+t+"`"+u+".")}return null}))}))}function rv(e,t){return ev((function(n,r,i,a,o){for(var s=arguments.length,c=new Array(s>5?s-5:0),u=5;u<s;u++)c[u-5]=arguments[u];return(0,Tp.untracked)((function(){if("function"!=typeof t)return new Error("Property `"+o+"` of component `"+i+"` has invalid PropType notation.");var s=nv(e,"Array")(n,r,i,a,o);if(s instanceof Error)return s;for(var u=n[r],l=0;l<u.length;l++)if((s=t.apply(void 0,[u,l,i,a,o+"["+l+"]"].concat(c)))instanceof Error)return s;return null}))}))}var iv={observableArray:nv(!1,"Array"),observableArrayOf:rv.bind(null,!1),observableMap:nv(!1,"Map"),observableObject:nv(!1,"Object"),arrayOrObservableArray:nv(!0,"Array"),arrayOrObservableArrayOf:rv.bind(null,!0),objectOrObservableObject:nv(!0,"Object")};if(!Ap.Component)throw new Error("mobx-react requires React to be available");if(!Tp.observable)throw new Error("mobx-react requires mobx to be available");var av={};G(av,{EmuToPt:function(){return Ly},EmuToPx:function(){return jy},RenderMode:function(){return gw},Slide:function(){return xw},disableAutoPlayKey:function(){return ww},loadPPT:function(){return BS},playLastStepKey:function(){return Sw},previewPPT:function(){return KS},sequenceIndexesKey:function(){return kw},toNumber:function(){return Vy},toPt:function(){return By}});var ov,sv,cv=Y(n(67294)),uv=Y(n(26729)),lv=Y(n(67294)),hv=Y(n(6767)),dv=Y(n(55166)),pv=Y(n(67294)),fv=Y(n(67294)),vv=Y(n(67294)),mv=Y(n(67294)),gv=Y(n(67294)),yv=Y(n(55341)),bv=Object.defineProperty,kv=Object.defineProperties,wv=Object.getOwnPropertyDescriptors,Sv=Object.getOwnPropertySymbols,xv=Object.prototype.hasOwnProperty,Cv=Object.prototype.propertyIsEnumerable,Iv=function(e,t,n){return t in e?bv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Pv=function(e,t){for(var n in t||(t={}))xv.call(t,n)&&Iv(e,n,t[n]);if(Sv){var r,i=T(Sv(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Cv.call(t,n)&&Iv(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Mv=function(e,t){return kv(e,wv(t))};(sv=ov||(ov={}))[sv.Cmd=1]="Cmd",sv[sv.State=2]="State";var Tv=function(){function e(t){var n=t.playerID,r=t.players,i=t.effectType,a=void 0===i?"clickEffect":i;C(this,e),this.players=[],this._playerID=n,this.players=r,this.effectType=a,this.repeat=Math.max.apply(Math,p(r.map((function(e){return e.repeat}))).concat([1])),this.duration=Math.max.apply(Math,p(r.map((function(e){return e.duration}))).concat([0])),this.delay=r.length>0?Math.min.apply(Math,p(r.map((function(e){return e.delay})))):0}return P(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="par[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"progressTime",get:function(){return Math.max.apply(Math,p(this.players.map((function(e){return e.progressTime}))||0))}},{key:"isPlaying",get:function(){return this.players.some((function(e){return e.isPlaying}))}},{key:"isComplete",get:function(){return this.players.every((function(e){return e.isComplete}))}},{key:"play",value:function(){this.players.forEach((function(e){return e.play()}))}},{key:"pause",value:function(){this.players.forEach((function(e){return e.pause()}))}},{key:"seek",value:function(e){if(e>this.progressTime)this.players.forEach((function(t){return t.seek(e)}));else if(e<this.progressTime)for(var t=this.players.length-1;t>=0;t--)this.players[t].seek(e)}},{key:"onFrame",value:function(e){if(e>this.progressTime)this.players.forEach((function(t){return t.onFrame(e)}));else if(e<this.progressTime)for(var t=this.players.length-1;t>=0;t--)this.players[t].onFrame(e)}},{key:"reset",value:function(){for(var e=this.players.length-1;e>=0;e--)this.players[e].reset()}},{key:"stop",value:function(){this.players.forEach((function(e){return e.stop()}))}},{key:"stopFinite",value:function(){this.players.forEach((function(e){return e.stopFinite()}))}}]),e}(),Av=function(){return(Av=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Ev(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}var Ov=function(e,t){return function(n){return Math.max(Math.min(n,t),e)}},Rv=function(e){return e%1?Number(e.toFixed(5)):e},Nv=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,Lv={test:function(e){return"number"==typeof e},parse:parseFloat,transform:function(e){return e}},jv=Av(Av({},Lv),{transform:Ov(0,1)}),Dv=Av(Av({},Lv),{default:1}),Fv=function(e){return{test:function(t){return"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},zv=Fv("deg"),Bv=Fv("%"),Uv=Fv("px"),Vv=Av(Av({},Bv),{parse:function(e){return Bv.parse(e)/100},transform:function(e){return Bv.transform(100*e)}}),Wv=Ov(0,255),Hv=function(e){return void 0!==e.red},_v=function(e){return void 0!==e.hue},Gv=function(e){return function(t){if("string"!=typeof t)return t;for(var n={},r=(a=t,a.substring(a.indexOf("(")+1,a.lastIndexOf(")"))).replace(/(,|\/)/g," ").split(/ \s*/),i=0;i<4;i++)n[e[i]]=void 0!==r[i]?parseFloat(r[i]):1;var a;return n}},Yv=Av(Av({},Lv),{transform:function(e){return Math.round(Wv(e))}});function Xv(e,t){return e.startsWith(t)&&Nv.test(e)}var Qv,Kv={test:function(e){return"string"==typeof e?Xv(e,"rgb"):Hv(e)},parse:Gv(["red","green","blue","alpha"]),transform:function(e){var t,n,r=e.red,i=e.green,a=e.blue,o=e.alpha,s=void 0===o?1:o;return"rgba("+(t={red:Yv.transform(r),green:Yv.transform(i),blue:Yv.transform(a),alpha:Rv(jv.transform(s))}).red+", "+t.green+", "+t.blue+", "+(void 0===(n=t.alpha)?1:n)+")"}},qv={test:function(e){return"string"==typeof e?Xv(e,"hsl"):_v(e)},parse:Gv(["hue","saturation","lightness","alpha"]),transform:function(e){var t,n,r=e.hue,i=e.saturation,a=e.lightness,o=e.alpha,s=void 0===o?1:o;return"hsla("+(t={hue:Math.round(r),saturation:Bv.transform(Rv(i)),lightness:Bv.transform(Rv(a)),alpha:Rv(jv.transform(s))}).hue+", "+t.saturation+", "+t.lightness+", "+(void 0===(n=t.alpha)?1:n)+")"}},Zv=Av(Av({},Kv),{test:function(e){return"string"==typeof e&&Xv(e,"#")},parse:function(e){var t="",n="",r="";return e.length>4?(t=e.substr(1,2),n=e.substr(3,2),r=e.substr(5,2)):(t=e.substr(1,1),n=e.substr(2,1),r=e.substr(3,1),t+=t,n+=n,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:1}}}),Jv={test:function(e){return"string"==typeof e&&Nv.test(e)||Hv(e)||_v(e)},parse:function(e){return Kv.test(e)?Kv.parse(e):qv.test(e)?qv.parse(e):Zv.test(e)?Zv.parse(e):e},transform:function(e){return Hv(e)?Kv.transform(e):_v(e)?qv.transform(e):e}},$v=function(e){return e},em=(Qv=function(e,t,n){return Math.min(Math.max(n,e),t)},function(e,t,n){return void 0!==n?Qv(e,t,n):function(n){return Qv(e,t,n)}});em(0,1);var tm="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},nm="undefined"!=typeof window?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout((function(){return e(tm())}),16.666666666666668)},rm=!0,im=!1,am=!1,om={delta:0,timestamp:0},sm=["read","update","preRender","render","postRender"],cm=sm.reduce((function(e,t){var n,r,i,a,o,s,c;return e[t]=(n=function(){return im=!0},r=[],i=[],a=0,o=!1,s=new WeakSet,c={schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var c=n&&o,u=c?r:i;return t&&s.add(e),-1===u.indexOf(e)&&(u.push(e),c&&o&&(a=r.length)),e},cancel:function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1),s.delete(e)},process:function(e){var t;if(o=!0,r=(t=[i,r])[0],(i=t[1]).length=0,a=r.length)for(var u=0;u<a;u++){var l=r[u];l(e),s.has(l)&&(c.schedule(l),n())}o=!1}}),e}),{}),um=sm.reduce((function(e,t){var n=cm[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),im||pm(),n.schedule(e,t,r)},e}),{}),lm=sm.reduce((function(e,t){return e[t]=cm[t].cancel,e}),{}),hm=function(e){return cm[e].process(om)},dm=function e(t){im=!1,om.delta=rm?16.666666666666668:Math.max(Math.min(t-om.timestamp,40),1),om.timestamp=t,am=!0,sm.forEach(hm),am=!1,im&&(rm=!1,nm(e))},pm=function(){im=!0,rm=!0,am||nm(dm)},fm=function(){function e(t){var n=t.playerID,r=t.players,i=t.effectType,a=void 0===i?"clickEffect":i,o=t.repeat,s=t.rewind,c=void 0!==s&&s,u=t.reverse,l=void 0!==u&&u,h=t.delay,d=void 0===h?0:h;C(this,e),this.players=[],this.progressTime=0,this.loopCount=0,this.elapsed=0,this._playerID=n,this.players=r,this.effectType=a,this.roundDuration=Math.max.apply(Math,p(r.map((function(e){return e.duration}))).concat([0])),this.repeat=null!=o?Math.max(1,o):Math.max.apply(Math,p(r.map((function(e){return e.repeat}))).concat([1])),this.rewind=c,this.reverse=l,this.delay=d,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat}return P(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="par-plus[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;this.isPlaying||this.isComplete||(this.frameProcess=um.update((function(t){var n=t.delta;if(e.progressTime+=n,!(e.progressTime<=e.delay)&&(e.elapsed+=n,e.update(),e.isPlaying&&e.elapsed>e.roundDuration)){if(e.loopCount<e.loop)return e.elapsed=0,void(e.loopCount+=1);e.pause()}}),!0))}},{key:"pause",value:function(){this.frameProcess&&(lm.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){var t=this.progressTime;this.progressTime=em(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var n=this.reverse&&this.loopCount%2!=0,r=n?this.roundDuration-this.elapsed:this.elapsed;if(t>e||n)for(var i=this.players.length-1;i>=0;i--)this.players[i].seek(r);else t<e&&this.players.forEach((function(e){return e.seek(r)}))}},{key:"onFrame",value:function(e){var t=this.progressTime;this.progressTime=em(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var n=this.reverse&&this.loopCount%2!=0,r=n?this.roundDuration-this.elapsed:this.elapsed;if(t>e||n)for(var i=this.players.length-1;i>=0;i--)this.players[i].onFrame(r);else t<e&&this.players.forEach((function(e){return e.onFrame(r)}))}},{key:"reset",value:function(){if(this.progressTime>0){this.pause(),this.loopCount=0,this.elapsed=0,this.progressTime=0;for(var e=this.players.length-1;e>=0;e--)this.players[e].reset()}}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function(){var e=this;if(this.reverse&&this.loopCount%2!=0)for(var t=this.players.length-1;t>=0;t--)this.players[t].onFrame(this.roundDuration-this.elapsed);else this.players.forEach((function(t){return t.onFrame(e.elapsed)}))}}]),e}(),vm=function(){function e(t){var n,r,i=t.playerID,a=t.players,o=t.effectType,s=void 0===o?"clickEffect":o;C(this,e),this.players=[],this.index=0,this.progressTime=0,this._playerIndex=0,this.elapsed=0,this._playerID=i,this.players=a,this.effectType=s,this.duration=a.reduce((function(e,t){return e+t.duration}),0),this.delay=null!=(r=null==(n=this.players[0])?void 0:n.delay)?r:0,this.blocks=[],this.indexBlocks=[];for(var c=0;c<this.players.length;c++)0!==c&&"clickEffect"!==this.players[c].effectType||this.blocks.push(c),this.indexBlocks.push(this.blocks.length-1)}return P(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="seq[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"length",get:function(){return this.blocks.length}},{key:"currentPlayer",get:function(){return this.players[this._playerIndex]}},{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.index>=this.blocks.length}},{key:"repeat",get:function(){var e,t;return null!=(t=null==(e=this.currentPlayer)?void 0:e.repeat)?t:1}},{key:"play",value:function(){var e=this;!this.currentPlayer||this.isPlaying||this.isComplete||(this.currentPlayer.play(),this.frameProcess=um.update((function(t){var n,r=t.delta,i=e.currentPlayer;if(i){if(e.elapsed+=r,e.progressTime+=r,i.isPlaying||i.play(),e.elapsed>i.duration){e._playerIndex<e.players.length&&(e._playerIndex+=1,e.elapsed=0,e.index=null!=(n=e.indexBlocks[e._playerIndex])?n:e.blocks.length);var a=e.players[e._playerIndex];if(a&&"clickEffect"!==a.effectType)return void a.play();e.stopTimer()}}else e.stopTimer()}),!0))}},{key:"pause",value:function(){var e;null==(e=this.currentPlayer)||e.pause(),this.stopTimer()}},{key:"seek",value:function(e){var t,n;if(e>this.duration){this.pause();for(var r=this._playerIndex;r<this.players.length;r++){var i=this.players[r];i.seek(i.duration)}this.progressTime=this.duration,this.elapsed=0,this._playerIndex=this.players.length,this.index=this.blocks.length}this.progressTime=em(0,this.duration,e),this.elapsed=this.progressTime;for(var a=0;a<this.players.length;){var o=this.players[a];if(this.elapsed<=o.duration)break;this.elapsed-=o.duration,a++}if(this._playerIndex<a){for(var s=this._playerIndex;s<a;s++){var c=this.players[s];!Number.isFinite(c.repeat)&&c.isPlaying||c.seek(c.duration)}null==(t=this.players[a])||t.seek(this.elapsed)}else if(this._playerIndex>a)for(var u=this.safePlayerIndex(this._playerIndex);u>=a;u--){var l=this.players[u];u===a?(l.pause(),l.seek(this.elapsed)):l.reset()}this._playerIndex=a,this.index=null!=(n=this.indexBlocks[this._playerIndex])?n:this.blocks.length}},{key:"onFrame",value:function(e){throw new Error("onFrame not implemented in seq player")}},{key:"reset",value:function(){if(this.progressTime>0&&this.players.length>0)for(var e=this.safePlayerIndex(this._playerIndex);e>=0;e--)this.players[e].reset();this._playerIndex=0,this.index=0,this.progressTime=0,this.elapsed=0}},{key:"stop",value:function(){this.pause(),this.seek(this.duration+1)}},{key:"stopFinite",value:function(){this.players.forEach((function(e){return e.stopFinite()}))}},{key:"seekIndex",value:function(e){var t;this.seekPlayerIndex(null!=(t=this.blocks[e])?t:this.players.length)}},{key:"next",value:function(){this.elapsed>0&&this.seekIndex(this.index+1),this.play()}},{key:"back",value:function(){this.pause(),this.progressTime<=0||(this.seekIndex(this.elapsed>0?this.index:this.index-1),this.pause())}},{key:"stopTimer",value:function(){this.frameProcess&&(lm.update(this.frameProcess),this.frameProcess=void 0)}},{key:"safePlayerIndex",value:function(e){return Math.min(e,this.players.length-1)}},{key:"seekPlayerIndex",value:function(e){var t;if(e=em(0,this.players.length,e),this._playerIndex<e)for(var n=this._playerIndex;n<e;n++)this.players[n].stopFinite();else for(var r=this.safePlayerIndex(this._playerIndex);r>=e;r--)this.players[r].reset();this.progressTime=this.getProgressTimeByPlayerIndex(e),this._playerIndex=e,this.index=null!=(t=this.indexBlocks[e])?t:this.blocks.length,this.elapsed=0}},{key:"getProgressTimeByPlayerIndex",value:function(e){for(var t=0,n=0;n<e;n++)t+=this.players[n].duration;return t}}]),e}();function mm(e,t,n){return(t-e)*n+e}var gm={exports:{}},ym={exports:{}},bm=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},km=Array.prototype.concat,wm=Array.prototype.slice,Sm=ym.exports=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];bm(i)?t=km.call(t,wm.call(i)):t.push(i)}return t};Sm.wrap=function(e){return function(){return e(Sm(arguments))}};var xm={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Cm=ym.exports,Im={};for(Pm in xm)xm.hasOwnProperty(Pm)&&(Im[xm[Pm]]=Pm);var Pm,Mm=gm.exports={to:{},get:{}};function Tm(e,t,n){return Math.min(Math.max(t,e),n)}function Am(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}Mm.get=function(e){var t,n;switch(e.substring(0,3).toLowerCase()){case"hsl":t=Mm.get.hsl(e),n="hsl";break;case"hwb":t=Mm.get.hwb(e),n="hwb";break;default:t=Mm.get.rgb(e),n="rgb"}return t?{model:n,value:t}:null},Mm.get.rgb=function(e){if(!e)return null;var t,n,r,i=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],n=0;n<3;n++){var a=2*n;i[n]=parseInt(t.slice(a,a+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],n=0;n<3;n++)i[n]=parseInt(t[n]+t[n],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(n=0;n<3;n++)i[n]=parseInt(t[n+1],0);t[4]&&(i[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(i=xm[t[1]])?(i[3]=1,i):null:null;for(n=0;n<3;n++)i[n]=Math.round(2.55*parseFloat(t[n+1]));t[4]&&(i[3]=parseFloat(t[4]))}for(n=0;n<3;n++)i[n]=Tm(i[n],0,255);return i[3]=Tm(i[3],0,1),i},Mm.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,Tm(parseFloat(t[2]),0,100),Tm(parseFloat(t[3]),0,100),Tm(isNaN(n)?1:n,0,1)]}return null},Mm.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,Tm(parseFloat(t[2]),0,100),Tm(parseFloat(t[3]),0,100),Tm(isNaN(n)?1:n,0,1)]}return null},Mm.to.hex=function(){var e=Cm(arguments);return"#"+Am(e[0])+Am(e[1])+Am(e[2])+(e[3]<1?Am(Math.round(255*e[3])):"")},Mm.to.rgb=function(){var e=Cm(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},Mm.to.rgb.percent=function(){var e=Cm(arguments),t=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+n+"%, "+r+"%)":"rgba("+t+"%, "+n+"%, "+r+"%, "+e[3]+")"},Mm.to.hsl=function(){var e=Cm(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},Mm.to.hwb=function(){var e=Cm(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},Mm.to.keyword=function(e){return Im[e.slice(0,3)]};var Em,Om,Rm=gm.exports;(Om=Em||(Em={}))[Om.RGB=0]="RGB",Om[Om.HSL=1]="HSL";var Nm=function(){function e(t){C(this,e),this.animBox=t,this.$=1}return P(e,[{key:"snapshot",get:function(){if(!this._snapshot){var e=this;this._snapshot={$ppt_x:this.animBox.initState.ppt_x,$ppt_y:this.animBox.initState.ppt_y,$ppt_w:this.animBox.initState.ppt_w,$ppt_h:this.animBox.initState.ppt_h,ppt_x:Number(e.animBox.currentState.ppt_x),ppt_y:Number(e.animBox.currentState.ppt_y),ppt_w:Number(e.animBox.currentState.ppt_w),ppt_h:Number(e.animBox.currentState.ppt_h),get $(){return e.$}}}return this._snapshot}}]),e}(),Lm=function(){function e(t,n){C(this,e),this.expr=t,this.scope=n}return P(e,[{key:"valueOf",value:function(){var e;return null!=(e=this.value)?e:this.evaluate(1)}},{key:"evaluate",value:function(e){this.scope.$=e;try{return this.value=this.formula.evaluate(this.scope.snapshot),this.value}catch(t){return console.error(t),e}}},{key:"formula",get:function(){if(!this._formula)try{this._formula=(0,yv.compile)(this.expr.replace(/#/g,"$"))}catch(e){console.error(e),this._formula={evaluate:function(e){return e}}}return this._formula}}]),e}(),jm=Object.prototype.hasOwnProperty;function Dm(e,t){return jm.call(e,t)}function Fm(e){return e instanceof Lm||"number"==typeof e&&!Number.isNaN(e)}function zm(e){return e/12700+"pt"}var Bm=function(){function e(t){if(C(this,e),"string"==typeof t){var n=Rm.get(t);if(n){var r=n.model,i=n.value;switch(r){case"hsl":return this.model=Em.HSL,void(this._hslCache={h:i[0],s:i[1],l:i[2],a:i[3]});case"rgb":return this.model=Em.RGB,void(this._rgbCache={r:i[0],g:i[1],b:i[2],a:i[3]})}}}else{if(function(e){return!!(e&&Dm(e,"r")&&Dm(e,"g")&&Dm(e,"b")&&Dm(e,"a"))}(t))return this.model=Em.RGB,this._rgbCache=t,void(this._hslCache=void 0);if(function(e){return!!(e&&Dm(e,"h")&&Dm(e,"s")&&Dm(e,"l")&&Dm(e,"a"))}(t))return this.model=Em.HSL,this._hslCache=t,void(this._rgbCache=void 0)}throw new TypeError("[Animatic] incorrect color: ".concat(t))}return P(e,[{key:"rgb",get:function(){if(!this._rgbCache){if(!this._hslCache)throw new Error("[Animatic] No color available");this._rgbCache=this.hslToRgb(this._hslCache)}return this._rgbCache}},{key:"hsl",get:function(){if(!this._hslCache){if(!this._rgbCache)throw new Error("[Animatic] No color available");this._hslCache=this.rbgToHsl(this._rgbCache)}return this._hslCache}},{key:"toString",value:function(){if(this.model===Em.HSL){var e=this.hsl,t=e.h,n=e.s,r=e.l,i=e.a;return"hsla(".concat(t,",").concat(n,",").concat(r,",").concat(i,")")}var a=this.rgb,o=a.r,s=a.g,c=a.b,u=a.a;return"rgba(".concat(o,",").concat(s,",").concat(c,",").concat(u,")")}},{key:"lighten",value:function(t){var n=this.hsl;return new e(Mv(Pv({},n),{l:em(0,100,n.l*(1+t))}))}},{key:"darken",value:function(t){var n=this.hsl;return new e(Mv(Pv({},n),{l:em(0,100,n.l*(1-t))}))}},{key:"alpha",value:function(t){var n=this.model===Em.HSL?this.hsl:this.rgb;if(null==t)return n.a;var r=em(0,1,t);return r===n.a?this:new e(Mv(Pv({},n),{a:r}))}},{key:"rbgToHsl",value:function(e){var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=a-i,s=0;a===i?s=0:t===a?s=(n-r)/o:n===a?s=2+(r-t)/o:r===a&&(s=4+(t-n)/o),(s=Math.min(60*s,360))<0&&(s+=360);var c=(i+a)/2;return{h:s,s:100*(a===i?0:c<=.5?o/(a+i):o/(2-a-i)),l:100*c,a:e.a}}},{key:"hslToRgb",value:function(e){var t=e.s/100,n=e.l/100;if(0===t){var r=255*n;return{r:r,g:r,b:r,a:e.a}}for(var i,a,o,s=e.h/360,c=2*n-(i=n<.5?n*(1+t):n+t-n*t),u=[0,0,0],l=0;l<3;l++)(a=s+1/3*-(l-1))<0&&a++,a>1&&a--,o=6*a<1?c+6*(i-c)*a:2*a<1?i:3*a<2?c+(i-c)*(2/3-a)*6:c,u[l]=255*o;return{r:u[0],g:u[1],b:u[2],a:e.a}}}]),e}();function Um(e,t,n){if(e.model===Em.HSL||t.model===Em.HSL){var r=e.hsl,i=t.hsl;return new Bm({h:mm(r.h,i.h,n),s:mm(r.s,i.s,n),l:mm(r.l,i.l,n),a:mm(r.a,i.a,n)})}var a=e.rgb,o=t.rgb;return new Bm({r:Vm(a.r,o.r,n),g:Vm(a.g,o.g,n),b:Vm(a.b,o.b,n),a:mm(a.a,o.a,n)})}function Vm(e,t,n){var r=e*e,i=t*t;return Math.sqrt(Math.max(0,n*(i-r)+r))}function Wm(e,t){var n=Object.keys(t),r=n.reduce((function(n,r){switch(r){case"visible":var i=e[r],a=t[r];n[r]=function(e){return e<=0?i:a};break;case"fillcolor":var o=e[r],s=t[r];if(!o||!s)throw new Error("Mismatch color animation (Key: ".concat(r,", From: ").concat(o,", To: ").concat(s,")"));n[r]=function(e){return Um(o,s,e)};break;default:var c=e[r],u=t[r];if(!Fm(c)||!Fm(u))throw new Error("Mismatch number animation (Key: ".concat(r,", From: ").concat(c,", To: ").concat(u,")"));n[r]=function(e){return mm(c,u,e)}}return n}),{});return function(e){return n.reduce((function(t,n){var i,a=null==(i=r[n])?void 0:i.call(r,e);return null!=a&&(t[n]=a),t}),{})}}function Hm(e,t){var n;return function(r){return n||(n=Wm(e(),t)),n(r)}}var _m=function(){function e(t){var n=t.animBox,r=t.eventSource,i=t.playerID,a=t.effectType,o=void 0===a?"clickEffect":a,s=t.duration,c=t.transform,u=t.ease,l=void 0===u?$v:u,h=t.repeat,d=void 0===h?0:h,p=t.rewind,f=void 0!==p&&p,v=t.reverse,m=void 0!==v&&v,g=t.delay,y=void 0===g?0:g,b=t.by,k=void 0!==b&&b;C(this,e),this.progressTime=0,this.loopCount=0,this.fvTime=0,this.elapsed=0,this.animBox=n,this.eventSource=r,this.playerID=i,this.effectType=o,this.roundDuration=s,this.ease=l,this.repeat=Math.max(1,d),this.rewind=f,this.reverse=m,this.delay=y,this.by=k,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat,this.transform=function(e,t){return function(n){return t(e(n))}}(l,null!=c?c:this.noopTransform)}return P(e,[{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;this.isPlaying||this.isComplete||(this.preAnimationState||(this.preAnimationState=Pv({},this.animBox.currentPureState)),this.frameProcess=um.update((function(t){var n=t.delta;if(e.progressTime+=n,e.progressTime<=e.delay)e.fvTime=0;else if(e.fvTime<=0&&(e.fvTime=Date.now()),e.elapsed+=n,e.update(),e.isPlaying&&e.elapsed>e.roundDuration){if(e.loopCount<e.loop)return e.elapsed=0,void(e.loopCount+=1);e.pause()}}),!0))}},{key:"pause",value:function(){this.frameProcess&&(lm.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){var t=this;this.preAnimationState||(this.preAnimationState=Pv({},this.animBox.currentPureState)),e<=0&&(this.fvTime=0),this.progressTime=em(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1),um.update((function(){return t.update()}),!1,!1)}},{key:"onFrame",value:function(e){if(e<=0){if(this.progressTime<=0)return;this.fvTime=0}if(!(e>=this.duration&&this.progressTime>=this.duration)){if(this.preAnimationState||(this.preAnimationState=Pv({},this.animBox.currentPureState)),this.progressTime=em(0,this.duration,e),this.progressTime<=this.delay)return this.loopCount=0,this.elapsed=0,void(this.by&&this.update());this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration),this.reverse?this.elapsed=(this.progressTime-this.delay)%this.roundDuration:this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1,this.update()}}},{key:"reset",value:function(){var e=this;this.progressTime>0&&(this.pause(),this.loopCount=0,this.fvTime=0,this.elapsed=0,this.progressTime=0),this.preAnimationState&&um.update((function(){e.preAnimationState&&(e.animBox.resetState(e.playerID,e.preAnimationState),e.preAnimationState=void 0)}),!1,!1)}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function(){var e=em(0,1,this.elapsed/this.roundDuration),t=this.transform(this.reverse&&this.loopCount%2!=0?1-e:e);null!=t&&this.animBox.handleStateEvent({type:ov.State,playerID:this.playerID,srcID:this.eventSource,by:this.by,fvTime:this.fvTime,value:t})}},{key:"noopTransform",value:function(){return{}}}]),e}(),Gm=function(){function e(t){var n=t.cmd,r=t.animBox,i=t.eventSource,a=t.playerID,o=t.effectType,s=void 0===o?"clickEffect":o,c=t.rewind,u=void 0!==c&&c,l=t.delay,h=void 0===l?0:l;C(this,e),this.repeat=1,this.progressTime=0,this.fvTime=0,this.cmd=n,this.animBox=r,this.eventSource=i,this.playerID=a,this.effectType=s,this.rewind=u,this.delay=h,this.duration=this.delay+1}return P(e,[{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;if(!this.isPlaying&&!this.isComplete)return 1===this.duration?(this.progressTime=1,void um.update((function(){return e.sendEvent()}),!1,!1)):void(this.frameProcess=um.update((function(t){var n=t.delta;e.progressTime+=n,e.progressTime<=e.delay?e.fvTime=0:(e.fvTime<=0&&(e.fvTime=Date.now()),e.sendEvent(),e.pause())}),!0))}},{key:"pause",value:function(){this.frameProcess&&(lm.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){e<=0&&(this.fvTime=0),this.progressTime=em(0,this.duration,e),e<=0&&"pause"!==this.cmd.name&&"stop"!==this.cmd.name&&this.animBox.handleCmdEvent({type:ov.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:Date.now(),value:{name:"pause"}})}},{key:"onFrame",value:function(e){e<=0&&(this.fvTime=0,this.progressTime<=0)||e>=this.duration&&this.progressTime>=this.duration||(this.progressTime=em(0,this.duration,e),this.progressTime>=this.delay&&this.sendEvent())}},{key:"reset",value:function(){this.progressTime>0&&(this.pause(),this.fvTime=0,this.progressTime=0)}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"sendEvent",value:function(){this.animBox.handleCmdEvent({type:ov.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:this.fvTime,value:this.cmd})}}]),e}();function Ym(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;if(e.model===Em.HSL&&e.model===t.model){var r=e.hsl,i=t.hsl,a=r.h,o=i.h;return new Bm({h:a+n*(o>a&&o-a>180?o-(a+360):o<a&&a-o>180?o+360-a:o-a),s:r.s+n*(i.s-r.s),l:r.l+n*(i.l-r.l),a:r.a*n+i.a*(1-n)})}var s=e.rgb,c=t.rgb,u=2*n-1,l=s.a-c.a,h=((u*l==-1?u:(u+l)/(1+u*l))+1)/2,d=1-h;return new Bm({r:h*s.r+d*c.r,g:h*s.g+d*c.g,b:h*s.b+d*c.b,a:s.a*n+c.a*(1-n)})}var Xm,Qm=new Bm({r:0,g:0,b:0,a:0}),Km=0,qm="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),n=Math.max(0,16.7-(t-Km));Km=t+n,setTimeout((function(){return e(Km)}),n)},Zm=1/60*1e3,Jm=!0,$m=!1,eg=!1,tg={delta:0,timestamp:0},ng=["read","update","preRender","render","postRender"],rg=function(e){return $m=e},ig=ng.reduce((function(e,t){var n,r,i,a,o,s,c,u,l;return e[t]=(n=rg,r=[],i=[],a=0,o=!1,s=0,c=new WeakSet,u=new WeakSet,l={cancel:function(e){var t=i.indexOf(e);c.add(e),-1!==t&&i.splice(t,1)},process:function(e){var t,h;if(o=!0,r=(t=[i,r])[0],(i=t[1]).length=0,a=r.length)for(s=0;s<a;s++)(h=r[s])(e),!0!==u.has(h)||c.has(h)||(l.schedule(h),n(!0));o=!1},schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var s=n&&o,l=s?r:i;c.delete(e),t&&u.add(e),-1===l.indexOf(e)&&(l.push(e),s&&(a=r.length))}}),e}),{}),ag=ng.reduce((function(e,t){var n=ig[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),$m||cg(),n.schedule(e,t,r),e},e}),{}),og=function(e){return ig[e].process(tg)},sg=function e(t){$m=!1,tg.delta=Jm?Zm:Math.max(Math.min(t-tg.timestamp,40),1),Jm||(Zm=tg.delta),tg.timestamp=t,eg=!0,ng.forEach(og),eg=!1,$m&&(Jm=!1,qm(e))},cg=function(){$m=!0,Jm=!0,eg||qm(sg)},ug=function(e){var t=e.onRead,n=e.onRender,r=e.uncachedValues,i=void 0===r?new Set:r,a=e.useCache,o=void 0===a||a;return function(e){void 0===e&&(e={});var r=Ev(e,[]),a={},s=[],c=!1;function u(e,t){e.startsWith("--")&&(r.hasCSSVariable=!0);var n=a[e];a[e]=t,a[e]!==n&&(-1===s.indexOf(e)&&s.push(e),c||(c=!0,ag.render(l.render)))}var l={get:function(e,n){return void 0===n&&(n=!1),n||!o||i.has(e)||void 0===a[e]?t(e,r):a[e]},set:function(e,t){if("string"==typeof e)u(e,t);else for(var n in e)u(n,e[n]);return this},render:function(e){return void 0===e&&(e=!1),(c||!0===e)&&(n(a,r,s),c=!1,s.length=0),this}};return l}},lg=/([a-z])([A-Z])/g,hg=function(e){return e.replace(lg,"$1-$2").toLowerCase()},dg=new Map,pg=new Map,fg=["Webkit","Moz","O","ms",""],vg=fg.length,mg="undefined"!=typeof document,gg=function(e,t){return pg.set(e,hg(t))},yg=function(e,t){void 0===t&&(t=!1);var n,r=t?pg:dg;return r.has(e)||(mg?function(e){Xm=Xm||document.createElement("div");for(var t=0;t<vg;t++){var n=fg[t],r=""===n,i=r?e:n+e.charAt(0).toUpperCase()+e.slice(1);if(i in Xm.style||r){if(r&&"clipPath"===e&&pg.has(e))return;dg.set(e,i),gg(e,(r?"":"-")+hg(i))}}}(e):gg(n=e,n)),r.get(e)||e},bg=["","X","Y","Z"],kg=["translate","scale","rotate","skew","transformPerspective"].reduce((function(e,t){return bg.reduce((function(e,n){return e.push(t+n),e}),e)}),["x","y","z"]),wg=kg.reduce((function(e,t){return e[t]=!0,e}),{});function Sg(e){return!0===wg[e]}function xg(e,t){return kg.indexOf(e)-kg.indexOf(t)}var Cg=new Set(["originX","originY","originZ"]);function Ig(e){return Cg.has(e)}var Pg=Av(Av({},Lv),{transform:Math.round}),Mg={color:Jv,backgroundColor:Jv,outlineColor:Jv,fill:Jv,stroke:Jv,borderColor:Jv,borderTopColor:Jv,borderRightColor:Jv,borderBottomColor:Jv,borderLeftColor:Jv,borderWidth:Uv,borderTopWidth:Uv,borderRightWidth:Uv,borderBottomWidth:Uv,borderLeftWidth:Uv,borderRadius:Uv,radius:Uv,borderTopLeftRadius:Uv,borderTopRightRadius:Uv,borderBottomRightRadius:Uv,borderBottomLeftRadius:Uv,width:Uv,maxWidth:Uv,height:Uv,maxHeight:Uv,size:Uv,top:Uv,right:Uv,bottom:Uv,left:Uv,padding:Uv,paddingTop:Uv,paddingRight:Uv,paddingBottom:Uv,paddingLeft:Uv,margin:Uv,marginTop:Uv,marginRight:Uv,marginBottom:Uv,marginLeft:Uv,rotate:zv,rotateX:zv,rotateY:zv,rotateZ:zv,scale:Dv,scaleX:Dv,scaleY:Dv,scaleZ:Dv,skew:zv,skewX:zv,skewY:zv,distance:Uv,translateX:Uv,translateY:Uv,translateZ:Uv,x:Uv,y:Uv,z:Uv,perspective:Uv,opacity:jv,originX:Vv,originY:Vv,originZ:Uv,zIndex:Pg,fillOpacity:jv,strokeOpacity:jv,numOctaves:Pg},Tg=function(e){return Mg[e]},Ag=function(e,t){return t&&"number"==typeof e?t.transform(e):e},Eg=new Set(["scrollLeft","scrollTop"]),Og=new Set(["scrollLeft","scrollTop","transform"]),Rg={x:"translateX",y:"translateY",z:"translateZ"};function Ng(e){return"function"==typeof e}function Lg(e){var t=void 0===e?{}:e,n=t.enableHardwareAcceleration,r=void 0===n||n,i=t.isDashCase,a=void 0===i||i,o=t.allowTransformNone,s=void 0===o||o,c={},u={},l={},h=[];return function(e){return h.length=0,function(e,t,n,r,i,a,o,s){void 0===t&&(t=!0),void 0===n&&(n={}),void 0===r&&(r={}),void 0===i&&(i={}),void 0===a&&(a=[]),void 0===o&&(o=!1),void 0===s&&(s=!0);var c=!0,u=!1,l=!1;for(var h in e){var d=e[h],p=Tg(h),f=Ag(d,p);Sg(h)?(u=!0,r[h]=f,a.push(h),c&&(p.default&&d!==p.default||!p.default&&0!==d)&&(c=!1)):Ig(h)?(i[h]=f,l=!0):Og.has(h)&&Ng(f)||(n[yg(h,o)]=f)}(u||"function"==typeof e.transform)&&(n.transform=function(e,t,n,r,i,a){void 0===a&&(a=!0);var o="",s=!1;n.sort(xg);for(var c=n.length,u=0;u<c;u++){var l=n[u];o+=(Rg[l]||l)+"("+t[l]+") ",s="z"===l||s}return!s&&i?o+="translateZ(0)":o=o.trim(),Ng(e.transform)?o=e.transform(t,r?"":o):a&&r&&(o="none"),o}(e,r,a,c,t,s)),l&&(n.transformOrigin=(i.originX||"50%")+" "+(i.originY||"50%")+" "+(i.originZ||0))}(e,r,c,u,l,h,a,s),c}}var jg=ug({onRead:function(e,t){var n=t.element,r=t.preparseOutput,i=Tg(e);if(Sg(e))return i&&i.default||0;if(Eg.has(e))return n[e];var a=window.getComputedStyle(n,null).getPropertyValue(yg(e,!0))||0;return r&&i&&i.test(a)&&i.parse?i.parse(a):a},onRender:function(e,t,n){var r=t.element,i=t.buildStyles,a=t.hasCSSVariable;if(Object.assign(r.style,i(e)),a)for(var o=n.length,s=0;s<o;s++){var c=n[s];c.startsWith("--")&&r.style.setProperty(c,e[c])}-1!==n.indexOf("scrollLeft")&&(r.scrollLeft=e.scrollLeft),-1!==n.indexOf("scrollTop")&&(r.scrollTop=e.scrollTop)},uncachedValues:Eg}),Dg=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues"]),Fg=function(e,t){return Uv.transform(e*t)},zg={x:0,y:0,width:0,height:0};function Bg(e,t,n){return"string"==typeof e?e:Uv.transform(t+n*e)}var Ug={enableHardwareAcceleration:!1,isDashCase:!1};function Vg(e,t,n){void 0===n&&(n=!0);var r={style:{}},i=Lg(Ug);return function(a){return function(e,t,n,r,i,a){void 0===t&&(t=zg),void 0===r&&(r=Lg(Ug)),void 0===i&&(i={style:{}}),void 0===a&&(a=!0);var o,s,c=e.attrX,u=e.attrY,l=e.originX,h=e.originY,d=e.pathLength,p=e.pathSpacing,f=void 0===p?1:p,v=e.pathOffset,m=void 0===v?0:v,g=r(Ev(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]));for(var y in g)"transform"===y?i.style.transform=g[y]:i[a&&!Dg.has(y)?hg(y):y]=g[y];return(void 0!==l||void 0!==h||g.transform)&&(i.style.transformOrigin=(s=void 0!==h?h:.5,Bg(void 0!==l?l:.5,(o=t).x,o.width)+" "+Bg(s,o.y,o.height))),void 0!==c&&(i.x=c),void 0!==u&&(i.y=u),void 0!==n&&void 0!==d&&(i[a?"stroke-dashoffset":"strokeDashoffset"]=Fg(-m,n),i[a?"stroke-dasharray":"strokeDasharray"]=Fg(d,n)+" "+Fg(f,n)),i}(a,e,t,i,r,n)}}var Wg,Hg,_g=ug({onRead:function(e,t){var n=t.element;if(Sg(e=Dg.has(e)?e:hg(e))){var r=Tg(e);return r&&r.default||0}return n.getAttribute(e)},onRender:function(e,t){var n=t.element,r=(0,t.buildAttrs)(e);for(var i in r)"style"===i?Object.assign(n.style,r.style):n.setAttribute(i,r[i])}}),Gg=ug({useCache:!1,onRead:function(e){return"scrollTop"===e?window.pageYOffset:window.pageXOffset},onRender:function(e){var t=e.scrollTop,n=void 0===t?0:t,r=e.scrollLeft,i=void 0===r?0:r;return window.scrollTo(i,n)}}),Yg=new WeakMap;function Xg(e,t){return n="string"==typeof e?document.querySelector(e):e,r=t,Yg.has(n)?Yg.get(n):function(e,t){var n,r,i,a,o;return e===window?n=Gg(e):(o=e)instanceof HTMLElement||"function"==typeof o.click?n=function(e,t){void 0===t&&(t={});var n=t.enableHardwareAcceleration,r=t.allowTransformNone,i=Ev(t,["enableHardwareAcceleration","allowTransformNone"]);return jg(Av({element:e,buildStyles:Lg({enableHardwareAcceleration:n,allowTransformNone:r}),preparseOutput:!0},i))}(e,t):function(e){return e instanceof SVGElement||"ownerSVGElement"in e}(e)&&(i=function(e){try{return"function"==typeof(t=e).getBBox?t.getBBox():t.getBoundingClientRect()}catch(t){return{x:0,y:0,width:0,height:0}}var t}(r=e),a=function(e){return"path"===e.tagName}(r)&&r.getTotalLength?r.getTotalLength():void 0,n=_g({element:r,buildAttrs:Vg(i,a)})),Yg.set(e,n),n}(n,r);var n,r}function Qg(e){switch(e){case"rotate":case"scaleX":case"scaleY":case"fillcolor":return!0;default:return!1}}(Hg=Wg||(Wg={})).Paragraph="anim-p",Hg.Text="anim-t";var Kg=function(){function e(t){var n=this,r=t.target,i=t.pIndex,a=t.tIndex,o=t.constants,s=t.initState,c=void 0===s?{}:s,u=t.applyStyles;C(this,e),this.handleStateEvent=function(e){var t=e.playerID,r=e.by,i=e.value,a=Object.keys(i).filter((function(e){return null!=i[e]}));if(r){var o=n.byStates.get(t);o||(o={},n.byStates.set(t,o));var s,c=T(a);try{for(c.s();!(s=c.n()).done;){var u=s.value;Qg(u)?(o[u]=i[u],n.currentState[u]=n.currentPureState[u]):(n.currentState[u]=i[u],n.currentPureState[u]=i[u])}}catch(e){c.e(e)}finally{c.f()}}else{n.lastStateEvent=e;var l,h=T(a);try{for(h.s();!(l=h.n()).done;){var d=l.value;n.currentState[d]=i[d],n.currentPureState[d]=i[d]}}catch(e){h.e(e)}finally{h.f()}}var p,f=T(n.byStates.values());try{for(f.s();!(p=f.n()).done;){var v,m=p.value,g=T(a);try{for(g.s();!(v=g.n()).done;){var y=v.value;n.mergeByStates(y,m)}}catch(e){g.e(e)}finally{g.f()}}}catch(e){f.e(e)}finally{f.f()}n.applyStyles(n.convertStyles(n.currentState))},this.handleCmdEvent=function(e){n.lastCmdEvent=e,"playFrom"===e.value.name?null==window||window.postMessage({type:"_changeAudioState",targetID:n.target,play:1,stop:0},"*"):"playSF"===e.value.name?null==window||window.postMessage({type:"_playSoundEffect",targetID:n.target,soundEffectId:e.value.value},"*"):null==window||window.postMessage({type:"_changeAudioState",targetID:n.target,play:0,stop:1},"*")},this.byStates=new Map,this.target=r,this.pIndex=i,this.tIndex=a,this.constants=o,this.withSubElem=null!=this.pIndex||null!=this.tIndex;var l=o.x,h=o.y,d=o.slideWidth,p=o.slideHeight,f=o.width,v=o.height;this.initState=Mv(Pv({scaleX:1,scaleY:1,rotate:0,opacity:1,xshear:0,yshear:0,fillcolor:Qm,visible:!0},c),{ppt_x:l/d,ppt_y:h/p,ppt_w:f/d,ppt_h:v/p}),this.currentState=Pv({},this.initState),this.currentPureState=Pv({},this.initState),u&&(this.applyStyles=u)}return P(e,[{key:"resetState",value:function(e,t){this.lastStateEvent=void 0,this.lastCmdEvent=void 0,this.byStates.delete(e),Object.assign(this.currentPureState,t),Object.assign(this.currentState,this.currentPureState);var n,r=T(this.byStates.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;for(var a in i)this.mergeByStates(a,i)}}catch(e){r.e(e)}finally{r.f()}this.applyStyles(this.convertStyles(this.currentState))}},{key:"applyStyles",value:function(e){var t=this.getStyler();t&&t.forEach((function(t,n){n?t.set({"pointer-events":e["pointer-events"]}):t.set(e)}))}},{key:"applyPreAnimation",value:function(){this.preAnimationState&&this.applyStyles(this.convertStyles(this.preAnimationState))}},{key:"preAnimation",value:function(e){if(!e)return this.preAnimationState;this.preAnimationState||(this.preAnimationState={});for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=e[r];null!=i&&(this.preAnimationState[r]=i,this.currentState[r]=i,this.currentPureState[r]=i)}}},{key:"clearCache",value:function(){this._stylerList=void 0}},{key:"mergeByStates",value:function(e,t){var n,r,i,a,o,s;switch(e){case"rotate":this.currentState.rotate=(null!=(n=this.currentState.rotate)?n:0)+(null!=(r=t.rotate)?r:0);break;case"scaleX":this.currentState.scaleX=(null!=(i=this.currentState.scaleX)?i:1)*(null!=(a=t.scaleX)?a:1);break;case"scaleY":this.currentState.scaleY=(null!=(o=this.currentState.scaleY)?o:1)*(null!=(s=t.scaleY)?s:1);break;case"fillcolor":this.currentState.fillcolor&&t.fillcolor?this.currentState.fillcolor=Ym(this.currentState.fillcolor,t.fillcolor):t.fillcolor&&(this.currentState.fillcolor=t.fillcolor)}}},{key:"convertStyles",value:function(e){var t,n,r,i,a,o,s,c,u={"will-change":"opacity,transform"},l=this.constants,h=l.x,d=l.y,p=l.width,f=l.height,v=l.slideWidth,m=l.slideHeight;for(var g in e)if(Dm(e,g))switch(g){case"ppt_x":var y=null!=(t=e.ppt_x)?t:this.currentState.ppt_x;u.translateX=zm(y*v-h);break;case"ppt_y":var b=null!=(n=e.ppt_y)?n:this.currentState.ppt_y;u.translateY=zm(b*m-d);break;case"scaleX":var k=null!=(r=e.scaleX)?r:1,w=this.currentState.ppt_w;u.scaleX=k*w*v/p;break;case"ppt_w":var S=null!=(i=this.currentState.scaleX)?i:1,x=null!=(a=e.ppt_w)?a:this.currentState.ppt_w;u.scaleX=S*x*v/p;break;case"scaleY":var C=null!=(o=e.scaleY)?o:1,I=this.currentState.ppt_h;u.scaleY=C*I*m/f;break;case"ppt_h":var P=null!=(s=this.currentState.scaleY)?s:1,M=null!=(c=e.ppt_h)?c:this.currentState.ppt_h;u.scaleY=P*M*m/f;break;case"fillcolor":if(null!=e.fillcolor){var T=e.fillcolor.hsl;u["--sp-fill"]="hsla(".concat(T.h,",").concat(T.s,"%,").concat(T.l,"%,").concat(T.a,")"),u["--sp-fill-h"]=T.h,u["--sp-fill-s"]=T.s+"%",u["--sp-fill-l"]=T.l+"%",u["--sp-fill-a"]=T.a}break;case"visible":null!=e.visible&&(u.opacity=this.currentState.opacity*(e.visible?1:0),u["pointer-events"]=e.visible?"initial":"none");break;case"opacity":null!=e.opacity&&(u.opacity=e.opacity*(this.currentState.visible?1:0));break;case"rotate":null!=e.rotate&&(u.rotate=Number(e.rotate));break;case"xshear":null!=e.xshear&&(u.skewX=45*e.xshear);break;case"yshear":null!=e.yshear&&(u.skewY=45*e.yshear);break;default:null!=e[g]&&(u[g]=e[g])}return this.constants.flipH&&Dm(u,"scaleX")&&(u.scaleX*=-1),this.constants.flipV&&Dm(u,"scaleY")&&(u.scaleY*=-1),Dm(u,"rotate")&&(u.scaleX<0&&(u.rotate*=-1),u.scaleY<0&&(u.rotate*=-1)),u}},{key:"getStyler",value:function(){if(!this._stylerList){var e=document.getElementById(this.target);if(e&&null!=this.pIndex&&(e=e.querySelectorAll(".".concat(Wg.Paragraph))[this.pIndex]),e&&null!=this.tIndex&&(e=e.querySelectorAll(".".concat(Wg.Text))[this.tIndex]),e){this._stylerList=[Xg(e)];for(var t=0;t<e.children.length;t+=1)e.children[t].classList.contains("ppt-event-source")&&this._stylerList.push(Xg(e.children[t]))}}return this._stylerList}}]),e}(),qg={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,a),!0;case 6:return l.fn.call(l.context,t,r,i,a,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(qg);var Zg=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.call(this)}return n}(qg.exports),Jg=Y(n(67294)),$g=Y(n(67294)),ey=Y(n(67294)),ty=Y(n(67294)),ny=Y(n(67294)),ry=Y(n(67294)),iy=Y(n(67294)),ay=Y(n(67294)),oy=Y(n(67294)),sy=Y(n(67294)),cy=Y(n(67294)),uy=Y(n(67294)),ly=Y(n(67294)),hy=Y(n(73935)),dy=Y(n(67294)),py=Y(n(67294)),fy=Y(n(67294)),vy=Y(n(67294)),my=Y(n(67294)),gy=Y(n(6767)),yy=Y(n(55874)),by=Y(n(67294)),ky=Y(n(73935)),wy=Y(n(26729)),Sy=Y(n(67294)),xy=Y(n(67294)),Cy=Y(n(67294)),Iy=Object.defineProperty,Py=Object.defineProperties,My=Object.getOwnPropertyDescriptors,Ty=Object.getOwnPropertySymbols,Ay=Object.prototype.hasOwnProperty,Ey=Object.prototype.propertyIsEnumerable,Oy=function(e,t,n){return t in e?Iy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Ry=function(e,t){for(var n in t||(t={}))Ay.call(t,n)&&Oy(e,n,t[n]);if(Ty){var r,i=T(Ty(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Ey.call(t,n)&&Oy(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Ny=function(e,t){return Py(e,My(t))},Ly=12700,jy=9525,Dy=1e5,Fy=6e4;function zy(e){if("number"==typeof e)return e/Dy;var t=e.endsWith("%");return parseFloat(e)/(t?100:Dy)}function By(e){return"".concat(Vy(e)/Ly,"pt")}function Uy(e){return 0===e?0:e/Fy}function Vy(e){return"string"==typeof e?parseFloat(e):e}function Wy(e){return.75*Vy(e)}function Hy(e){return Vy(e)/.75}function _y(e,t){var n=function(e){var t,n={},r=T(e);try{for(r.s();!(t=r.n()).done;){var i=t.value.name||"";if(i in n)return!0;n[i]=!0}}catch(e){r.e(e)}finally{r.f()}return!1}(e.elements)||t;if(e.elements.length>0){var r,i={},a=n&&e.elements.length>1,o=T(e.elements);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=Gy(s,a),u=_y(s,t);void 0===s.text?i[c]=u:i[c]=Ny(Ry({},u),{body:s.text})}}catch(e){o.e(e)}finally{o.f()}return i}return null}function Gy(e,t){var n=[];e.attr.forEach((function(t){var r=e.attr.getOptional(t);"string"==typeof r?n.push("".concat(t,"=").concat(JSON.stringify(r))):n.push("".concat(t,"=").concat(r))}));var r="";return t&&(r+="[".concat(e.index,"] ")),r+="<".concat(e.name),n.length>0&&(r+=" "+n.join(" ")),r+=">"}var Yy=function(){function e(t){C(this,e),this.tagName=t}return P(e,[{key:"get",value:function(e,t){return this.assignDefaultValue(e,this.getOptional(e),t)}},{key:"getString",value:function(e,t){return this.assignDefaultValue(e,this.getStringOptional(e),t)}},{key:"getNumber",value:function(e,t){return this.assignDefaultValue(e,this.getNumberOptional(e),t)}},{key:"getBoolean",value:function(e,t){return this.assignDefaultValue(e,this.getBooleanOptional(e),t)}},{key:"getColor",value:function(e,t){return this.assignDefaultValue(e,this.getColorOptional(e),t)}},{key:"getColorOptional",value:function(e){return this.getOptional(e)}},{key:"getStringOptional",value:function(e){var t=this.getOptional(e);return"number"==typeof t&&(t="".concat(t)),t}},{key:"getNumberOptional",value:function(e){var t=this.getOptional(e);if("string"!=typeof t||(t=parseInt(t,10),!Number.isNaN(t)))return t}},{key:"getBooleanOptional",value:function(e){var t=this.getOptional(e);return"true"===t||"1"===t||"on"===t?t=!0:"false"===t||"0"===t||"off"===t?t=!1:void 0!==t&&(t=!!t),t}},{key:"assignDefaultValue",value:function(e,t,n){var r=t;if(void 0===r&&(r=n),void 0===r)throw new Error("can't find attribute ".concat(JSON.stringify(e)," from ").concat(this.tagName));return r}}]),e}(),Xy=function(e){g(n,e);var t=b(n);function n(e){return C(this,n),t.call(this,e)}return P(n,[{key:"length",value:function(){return 0}},{key:"forEach",value:function(e){}},{key:"getOptional",value:function(e){}},{key:"has",value:function(e){return!1}}]),n}(Yy),Qy=function(e){g(n,e);var t=b(n);function n(e,r){var i;return C(this,n),(i=t.call(this,e)).attributes=r,i}return P(n,[{key:"length",value:function(){return Object.keys(this.attributes).length}},{key:"forEach",value:function(e){for(var t in this.attributes)e(t)}},{key:"has",value:function(e){return e in this.attributes}},{key:"getOptional",value:function(e){return this.attributes[e]}}]),n}(Yy),Ky=function(e){g(n,e);var t=b(n);function n(e,r,i){var a;return C(this,n),(a=t.call(this,e.name)).xml=e,a.picker=r,a.resourceType=i,a}return P(n,[{key:"length",value:function(){return-1}},{key:"forEach",value:function(e){void 0!==this.tagName&&this.picker.forEachAttributes(this.tagName,e)}},{key:"has",value:function(e){return void 0!==this.getOptional(e)}},{key:"getOptional",value:function(e){var t;return this.cachedValues&&e in this.cachedValues?t=this.cachedValues[e]:void 0!==this.tagName&&(this.cachedXMLMap||(this.cachedXMLMap={}),t=this.picker.getAttribute(this.tagName,e,this.xml,this.cachedXMLMap,this.resourceType),this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t),t}}]),n}(Yy),qy=function(){function e(t,n){C(this,e),this.picker=n,this.resourceType=t}return P(e,[{key:"parse",value:function(e){return new Jy(this.picker,null,0,(0,dv.xml2js)(e,{compact:!1,captureSpacesBetweenElements:!0}),this.resourceType)}}]),e}(),Zy=function(){function e(){C(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.tagNames=n}return P(e,[{key:"execute",value:function(e){return void 0!==this.tagNames.find((function(t){return t===e}))}},{key:"toString",value:function(){return this.tagNames.join(" or ")}}]),e}(),Jy=function(){function e(t,n,r,i,a){C(this,e),this.picker=t,this.parent=n,this.index=r,this.resourceType=a,this.name=i.name,this.type=i.type,this.attr=new Qy(this.name,Object.freeze(Ry({},i.attributes))),this.extraAttr=t?new Ky(this,t,a):new Xy(this.name);var o=[];if(i.elements)for(var s=0;s<i.elements.length;++s){var c=i.elements[s];"text"===c.type?this.text=c.text:o.push(new e(t,this,s,c,a))}this.elements=Object.freeze(o)}return P(e,[{key:"element",get:function(){return this.elements[0]}},{key:"displayer",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return a({},Gy(e,t),_y(e,t))}(this,e)}},{key:"elementWithName",value:function(e){var t,n=T(this.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.name===e)return r}}catch(e){n.e(e)}finally{n.f()}}},{key:"extraElementWithName",value:function(e){if(this.picker&&this.name)return this.cachedXMLMap||(this.cachedXMLMap={}),this.picker.getChild(this.name,e,this,this.cachedXMLMap,this.resourceType)}},{key:"elementsWithName",value:function(e){var t,n=[],r=T(this.elements);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.name===e&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"childElementOptional",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.searchChildElement(t),i=r.xml,a=r.found;if(a)return i}},{key:"childElement",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.searchChildElement(t),i=r.xml,a=r.found;if(a)return i;"string"==typeof this.name&&t.unshift(this.name);var o=t.join(" -> "),s=t.findIndex((function(e){return e===i.name})),c=t.splice(s+1)[0],u=t.join(" -> ");throw new Error("can't find child ".concat(o,": lack of child ").concat(c," from ").concat(u))}},{key:"searchChildElement",value:function(e){for(var t=this,n=0;n<e.length;++n){var r,i=e[n],a=t,o=T(t.elements);try{for(o.s();!(r=o.n()).done;){var s=r.value;if("string"==typeof i){if(s.name===i){t=s;break}}else if(i.execute(s.name)){t=s;break}}}catch(e){o.e(e)}finally{o.f()}if(a===t)return{xml:t,found:!1}}return{xml:t,found:!0}}},{key:"hasChildElementWithName",value:function(e){var t,n=T(this.elements);try{for(n.s();!(t=n.n()).done;){if(t.value.name===e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"parentElement",value:function(e){var t=this.parentElementOptional(e);if(t)return t;throw new Error("can't find parent ".concat(e," from ").concat(this.name))}},{key:"parentElementOptional",value:function(e){for(var t=this.parent;t;){if("string"==typeof e){if(t.name===e)return t}else if(e.execute(t.name))return t;t=t.parent}}}]),e}(),$y={"Arial Rounded MT Bold":"https://convertcdn.netless.link/fonts/ArialRoundedMTBold.woff",Arial:"https://convertcdn.netless.link/fonts/arial.woff","Cooper Black":"https://convertcdn.netless.link/fonts/COOPBL.woff",Calibri:"https://convertcdn.netless.link/fonts/Calibri.woff","":"https://convertcdn.netless.link/fonts/msyh.woff","":"https://convertcdn.netless.link/fonts/HuaWenXinWei-1.woff","-":"https://convertcdn.netless.link/fonts/yuppy.woff","":"https://convertcdn.netless.link/fonts/simhei.woff","":"https://convertcdn.netless.link/fonts/simkai.woff",Heiti:"https://convertcdn.netless.link/fonts/simhei.woff",Aharoni:"https://convertcdn.netless.link/fonts/Aharoni.woff","Aharoni Bold":"https://convertcdn.netless.link/fonts/Aharoni%20Bold.woff","source-han-sans":"https://convertcdn.netless.link/fonts/simhei.woff"},eb="netless-ppt-font-face";function tb(e,t,n){if(document&&n){var r=document.getElementById("".concat(eb,"-").concat(t));if(r)return;(r=document.createElement("style")).id="".concat(eb,"-").concat(t),document.head.appendChild(r);var i=n.filter((function(e){return e.src})).map((function(n){var r=n.src.split("."),i=r[(null==r?void 0:r.length)-1],a={"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-family":'"'.concat(n.fontFamily,"-").concat(t,'"'),src:'url("'.concat(e,"/fonts/").concat(n.src,'") format("').concat(i,'")')};return JSON.parse(JSON.stringify(a))})).map((function(e){return"@font-face {".concat(Object.keys(e).reduce((function(t,n){return"".concat(t,"\n").concat(n,": ").concat(e[n],";")}),""),"}")}));r.innerHTML=i.join("\n")}}var nb=new Map;function rb(e,t){return ib.apply(this,arguments)}function ib(){return ib=u(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:nb.has(t)||(nb.set(t,!0),n&&n[t]?ab(t,n[t]).then((function(){}),(function(){})):n&&n["*"]?(ab(t,n["*"]).then((function(){}),(function(){})),ab(t,n["*-bold"],{weight:"500"}).then((function(){}),(function(){})),ab(t,n["*-italic"],{style:"italic"}).then((function(){}),(function(){})),ab(t,n["*-bold-italic"],{weight:"500",style:"italic"}).then((function(){}),(function(){}))):$y[t]&&ab(t,$y[t]).then((function(){}),(function(){})));case 1:case"end":return e.stop()}}),e)}))),ib.apply(this,arguments)}function ab(e,t,n){return ob.apply(this,arguments)}function ob(){return ob=u(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n,!e.t0){e.next=7;break}return e.next=4,fetch(n,{cache:"force-cache"});case 4:return e.next=6,e.sent.arrayBuffer();case 6:i=e.sent;case 7:if(!i){e.next=20;break}return a=new FontFace(t,i,r),e.prev=9,e.next=12,a.load();case 12:document.fonts.add(a),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(9),console.error("".concat(t," load error font"),e.t1);case 18:e.next=21;break;case 20:nb.delete(t);case 21:case"end":return e.stop()}}),e,null,[[9,15]])}))),ob.apply(this,arguments)}function sb(e,t){if(t.masterThemeColorMapping[e]){var n="a:".concat(t.masterThemeColorMapping[e]),r=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",n,"a:srgbClr");if(r)return r.attr.getString("val");var i=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",n,"a:sysClr");return i?i.attr.getString("lastClr",e):e}var a="a:".concat(e),o=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",a,"a:srgbClr");if(o)return o.attr.getString("val");var s=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",a,"a:sysClr");return s?s.attr.getString("lastClr",e):e}function cb(e){var t=hb(e).childElementOptional("a:majorFont");return void 0===t?{}:lb(t)}function ub(e){var t=hb(e).childElementOptional("a:minorFont");return void 0===t?{}:lb(t)}function lb(e){var t={},n=e.childElementOptional("a:latin"),r=e.childElementOptional("a:ea"),i=e.childElementOptional("a:cs");n&&(t.latin=""===n.attr.getString("typeface","")?[]:[n.attr.getString("typeface")]),r&&(t.ea=""===r.attr.getString("typeface","")?[]:[r.attr.getString("typeface")]),i&&(t.cs=""===i.attr.getString("typeface","")?[]:[i.attr.getString("typeface")]);var a=e.elementsWithName("a:font").filter((function(e){return["Hans","Hant","Jpan","Hang"].includes(e.attr.getString("script"))})).map((function(e){return e.attr.getString("typeface")}));return void 0!==t.ea?t.ea=t.ea.concat(a):t.ea=a,t}function hb(e){return e.theme.childElement("a:theme","a:themeElements","a:fontScheme")}function db(e){var t=[];return void 0!==e.latin&&t.concat(e.latin),void 0!==e.ea&&t.concat(e.ea),void 0!==e.cs&&t.concat(e.cs),t}var pb=["a:blipFill","a:gradFill","a:grpFill","a:noFill","a:pattFill","a:solidFill"],fb=["a:hslClr","a:schemeClr","a:srgbClr","a:scrgbClr","a:sysClr","a:prstClr"];function vb(e,t){var n,r=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme"),i=e.childElement("a:effectRef"),a=i.childElement(m(Zy,fb)),o=i.attr.getNumber("idx"),s=r.childElement("a:effectStyleLst").elements[o-1],c=e.childElement("a:fillRef"),u=c.childElement(m(Zy,fb)),l=c.attr.getNumber("idx"),h=r.childElement("a:fillStyleLst").elements[l-1],d=e.childElement("a:fontRef"),p=d.attr.getString("idx");"none"!==p&&(n=hb(t).childElement("a:".concat(p,"Font")));var f=e.childElement("a:lnRef"),v=f.childElement(m(Zy,fb)),g=f.attr.getNumber("idx");return{effect:{xml:s,phClr:a},fill:{xml:h,phClr:u},font:{xml:n,fontRef:d},ln:{xml:r.childElement("a:lnStyleLst").elements[g-1],phClr:v}}}var mb,gb=(0,hv.default)("#FFFFFF").alpha(0),yb=(0,hv.default)("#FFFFFF").alpha(0);!function(e){e.None="none",e.Norm="norm",e.Lighten="lighten",e.LightenLess="lightenLess",e.Darken="darken",e.DarkenLess="darkenLess"}(mb||(mb={}));var bb=function(){function e(){C(this,e),this.fillColor=gb.hsl()}return P(e,[{key:"setFillColor",value:function(e){this.fillColor=e||gb.hsl()}},{key:"hsl",value:function(){return this.fillColor.hsl()}},{key:"rgb",value:function(){return this.fillColor.rgb()}}]),e}(),kb=function(){function e(t){C(this,e),this.alphaModFix=1,this.resId=t.childElement("a:blip").attr.getString("r:embed"),void 0!==t.childElementOptional("a:tile")?this.tile=!0:this.tile=!1;var n=t.childElement("a:blip").childElementOptional("a:alphaModFix");if(void 0!==n){var r=n.attr.getNumberOptional("amt");r&&(this.alphaModFix=zy(r))}}return P(e,[{key:"getResId",value:function(){return this.resId}},{key:"getAlphaModFix",value:function(){return this.alphaModFix}},{key:"hsl",value:function(){return gb.hsl()}},{key:"rgb",value:function(){return gb.rgb()}}]),e}(),wb=function(){function e(t,n,r,i){C(this,e),this.colors=[],this.rotation=0,this.path=void 0;var a=t.hasChildElementWithName("a:gsLst")?t.childElement("a:gsLst").elementsWithName("a:gs"):[];if(this.colors=a.sort((function(e,t){return e.attr.getNumber("pos")/Dy-t.attr.getNumber("pos")/Dy})).map((function(e){return{stop:e.attr.getNumber("pos")/Dy,color:Sb(e.childElement(m(Zy,fb)),n,r,i)}})),t.hasChildElementWithName("a:lin")&&(this.rotation=Uy(t.childElement("a:lin").attr.getNumber("ang",0))),t.hasChildElementWithName("a:path")){var o=t.childElement("a:path"),s=o.attr.getStringOptional("path"),c=o.childElementOptional("a:fillToRect");if(!c)return void(this.path={path:s,fillToRect:{left:0,top:0,bottom:0,right:0}});var u=c.attr.getNumber("l",0),l=c.attr.getNumber("t",0),h=c.attr.getNumber("b",0),d=c.attr.getNumber("r",0);this.path={path:s,fillToRect:{left:u,top:l,bottom:h,right:d}}}}return P(e,[{key:"getGradientPath",value:function(){return this.path}},{key:"getColors",value:function(){return this.colors}},{key:"getRotation",value:function(){return this.rotation}},{key:"hsl",value:function(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.hsl():gb.hsl()}},{key:"rgb",value:function(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.rgb():gb.rgb()}},{key:"getGradientStyles",value:function(){var e="linear-gradient(".concat(this.rotation+90,"deg, ");return e+=this.colors.filter((function(e){return e.color})).map((function(e){var t;return"".concat(null==(t=e.color)?void 0:t.rgb().string()," ").concat(100*e.stop,"%")})).join(","),e+=")"}}]),e}();function Sb(e,t,n,r){var i;if(e.attr.has("val")){var a=e.childElementOptional("a:alpha"),o=e.childElementOptional("a:shade"),s=e.childElementOptional("a:tint"),c=e.childElementOptional("a:lumMod"),u=e.childElementOptional("a:satMod"),l=e.childElementOptional("a:satOff"),h=e.childElementOptional("a:lumOff"),d=e.childElementOptional("a:hueMod"),p=e.childElementOptional("a:hueOff");switch(e.name){case"a:prstClr":return Cb((0,hv.default)(e.attr.getString("val")),a,o,c,s,u,h,l,d,p);case"a:srgbClr":return Cb((0,hv.default)("#".concat(e.attr.getString("val"))),a,o,c,s,u,h,l,d,p);case"a:schemeClr":var f=e.attr.getString("val");return"phClr"===f&&(f=r||("a:sysClr"===n.name?null!=(i=n.attr.getStringOptional("lastClr"))?i:"accent1":n.attr.getString("val"))),Cb((0,hv.default)("#".concat(sb(f,t))),a,o,c,s,u,h,l,d,p);case"a:hslClr":var v=e.attr.getNumber("hue")/Fy,m=e.attr.getNumber("sat")/Dy,g=e.attr.getNumber("lum")/Dy;return Cb((0,hv.default)({h:v,s:m,l:g}),a,o,c,s,u,h);case"a:scrgbClr":var y=255*e.attr.getNumber("r")/Dy,b=255*e.attr.getNumber("g")/Dy,k=255*e.attr.getNumber("b")/Dy;return Cb((0,hv.default)({r:y,g:b,b:k}),a,o,c,s,u,h);case"a:sysClr":return Cb((0,hv.default)("#".concat(e.attr.getString("lastClr"))),a,o,c,s,u,h,l,d,p);default:return}}}function xb(e,t){var n,r,i,a,o,s,c,u,l,h=Number(null==(n=e.alpha)?void 0:n.val),d=Number(null==(r=e.shade)?void 0:r.val),p=Number(null==(i=e.tint)?void 0:i.val),f=Number(null==(a=e.lumMod)?void 0:a.val),v=Number(null==(o=e.satMod)?void 0:o.val),m=Number(null==(s=e.satOff)?void 0:s.val),g=Number(null==(c=e.lumOff)?void 0:c.val),y=Number(null==(u=e.hueMod)?void 0:u.val),b=Number(null==(l=e.hueOff)?void 0:l.val);return function(e,t,n,r,i,a,o,s,c,u){var l=e;if(i&&(l=e.mix((0,hv.default)("white"),1-i/Dy)),n&&(l=e.mix((0,hv.default)("black"),1-n/Dy)),a){var h=e.hsl().object(),d=h.h,p=h.s,f=h.l,v=p*a/Dy;l=(0,hv.default)({l:f,s:v,h:d})}if(s){var m=e.hsl().object(),g=m.h,y=m.s,b=m.l,k=s/Dy*100+y;l=(0,hv.default)({l:b,s:k,h:g})}if(r){var w=e.hsl().object(),S=w.h,x=w.s,C=w.l*r/Dy;l=(0,hv.default)({l:C,s:x,h:S})}if(o){var I=e.hsl().object(),P=I.h,M=I.s,T=I.l,A=o/Dy*100+T;l=(0,hv.default)({l:A,s:M,h:P})}if(c){var E=e.hsl().object(),O=E.h,R=E.s,N=E.l,L=O*c/Dy;l=(0,hv.default)({l:N,s:R,h:L})}if(u){var j=e.hsl().object(),D=j.h,F=j.s,z=j.l,B=u/Fy+D;l=(0,hv.default)({l:z,s:F,h:B})}return t&&(l=e.alpha(t/Dy)),l}((0,hv.default)("#".concat(sb(e.val,t))),h,d,f,p,v,g,m,y,b)}function Cb(e,t,n,r,i,a,o,s,c,u){var l=e;if(i&&(l=l.mix((0,hv.default)("white"),1-i.attr.getNumber("val")/Dy)),n&&(l=l.mix((0,hv.default)("black"),1-n.attr.getNumber("val")/Dy)),a){var h=l.hsl().object(),d=h.h,p=h.s,f=h.l,v=p*a.attr.getNumber("val")/Dy;l=(0,hv.default)({l:f,s:v,h:d})}if(s){var m=l.hsl().object(),g=m.h,y=m.s,b=m.l,k=s.attr.getNumber("val")/Dy*100+y;l=(0,hv.default)({l:b,s:k,h:g})}if(r){var w=l.hsl().object(),S=w.h,x=w.s,C=w.l*r.attr.getNumber("val")/Dy;l=(0,hv.default)({l:C,s:x,h:S})}if(o){var I=l.hsl().object(),P=I.h,M=I.s,T=I.l,A=o.attr.getNumber("val")/Dy*100+T;l=(0,hv.default)({l:A,s:M,h:P})}if(c){var E=l.hsl().object(),O=E.h,R=E.s,N=E.l,L=O*c.attr.getNumber("val")/Dy;l=(0,hv.default)({l:N,s:R,h:L})}if(u){var j=l.hsl().object(),D=j.h,F=j.s,z=j.l,B=u.attr.getNumber("val")/Fy+D;l=(0,hv.default)({l:z,s:F,h:B})}return t&&(l=l.alpha(t.attr.getNumber("val")/Dy)),l}var Ib=function(){function e(t){C(this,e),this.placeHolderColor=t}return P(e,[{key:"read",value:function(e,t){if(void 0===e)return yb;switch(e.name){case"a:noFill":return gb;case"a:solidFill":return Sb(e.childElement(m(Zy,fb)),t,this.placeHolderColor);case"a:gradFill":return new wb(e,t,this.placeHolderColor);case"a:blipFill":return void 0!==(e.hasChildElementWithName("a:blip")?e.childElement("a:blip").attr.getStringOptional("r:embed"):void 0)?new kb(e):gb;case"a:grpFill":return new bb;default:return yb}}}]),e}();function Pb(e){return e instanceof kb||void 0===e?"none":e.rgb().string()}function Mb(e,t){if("none"===e)return e;switch(t){case mb.None:return"none";case mb.Norm:return e;case mb.Darken:return(0,hv.default)(e).darken(.4).rgb().string();case mb.DarkenLess:return(0,hv.default)(e).darken(.2).rgb().string();case mb.Lighten:return(0,hv.default)(e).lighten(.4).rgb().string();case mb.LightenLess:return(0,hv.default)(e).lighten(.2).rgb().string();default:return e}}var Tb=function(){function e(){C(this,e),this.tasks={slideDidUpdate:!1},this.isLoadFinished=!1}var t;return P(e,[{key:"reset",value:function(e){this.tasks={slideDidUpdate:!1},this.eventHub=e}},{key:"endLoadTask",value:function(e){var t=this;return this.tasks[e]=!0,!!Object.keys(this.tasks).every((function(e){return t.tasks[e]}))&&(this.eventHub.emit("__PresetTransactionReady__"),!0)}},{key:"addLoadTask",value:function(e){this.tasks[e]=!1}},{key:"loadImage",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return n=e.sent,r=new FileReader,e.next=7,n.blob();case 7:return i=e.sent,a=new Promise((function(e){r.onload=function(t){var n;e(null==(n=t.target)?void 0:n.result)},r.onerror=function(){e(t)}})),r.readAsDataURL(i),e.next=12,a;case 12:return e.abrupt("return",e.sent);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",t);case 18:case"end":return e.stop()}}),e,null,[[0,15]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Ab=new Tb,Eb=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).imageUrl="",r.state={imageBase64Url:""},r.updateImageUrl(r.props),r}return P(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateImageUrl(e)}},{key:"updateImageUrl",value:function(e){var t=this,n=e.cSld.extraAttr.getStringOptional("backgroundResId"),r=e.cSld.extraAttr.getStringOptional("backgroundImageResourceType");if(n&&r){var i=e.resourceLoader.loadURL(r,n);this.imageUrl!==i&&(this.imageUrl=i,Ab.addLoadTask(i),Ab.loadImage(i).then((function(e){t.setState({imageBase64Url:e},(function(){Ab.endLoadTask(i)}))}),(function(){})))}}},{key:"renderImage",value:function(e,t){var n=this.props.cSld,r=this.state.imageBase64Url,i=n.extraAttr.getStringOptional("backgroundResId"),a=n.extraAttr.getStringOptional("backgroundImageResourceType");if(i&&a){var o=n.extraElementWithName("getBackgroundImageFill");if(void 0===o||void 0===o.childElementOptional("a:blip"))return null;var s=o.childElement("a:blip").childElementOptional("a:alphaModFix"),c=!!o.childElementOptional("a:tile"),u=1;if(s){var l=s.attr.getNumberOptional("amt");l&&(u=zy(l))}var h={position:"absolute",left:0,top:0,width:By(e),height:By(t),opacity:u,backgroundImage:"url(".concat(r,")"),backgroundSize:c?"auto":"".concat(By(e)," ").concat(By(t))};return lv.default.createElement("div",{style:h})}var d,p=n.extraAttr.getColorOptional("backgroundColor");return d=p instanceof wb?p.getGradientStyles():Pb(p),p?lv.default.createElement("div",{style:{position:"absolute",left:0,top:0,width:By(e),height:By(t),background:d}}):null}},{key:"render",value:function(){var e=this.props,t=e.slideContext,n=e.slideRef,r=e.className,i=e.children,a={position:"relative",width:By(t.slideWidth),height:By(t.slideHeight),overflow:"hidden"};return lv.default.createElement("div",{id:"ppt-animation-hub",ref:n,className:r,style:a},this.renderImage(t.slideWidth,t.slideHeight),i)}}]),n}(lv.default.Component),Ob=function(){function e(t){C(this,e),this.mapper=t}return P(e,[{key:"map",value:function(e,t,n){return(!this.buffer||this.buffer.source!==e)&&(this.buffer={source:e,target:this.mapper(e,t,void 0,n)}),this.buffer.target}}]),e}();function Rb(e){switch(e){case"b":return"flex-end";case"ctr":return"center";default:return"flex-start"}}function Nb(e){switch(e){case"l":default:return"left";case"r":return"right";case"ctr":return"center";case"just":case"dist":return"justify"}}function Lb(e){return"sng"===e?"underline":"none"}function jb(e,t){var n=t.scaleX,r=t.scaleY;return Math.abs(Math.cos(e/180*Math.PI))>=Math.abs(Math.sin(e/180*Math.PI))?{scaleX:n,scaleY:r}:{scaleX:r,scaleY:n}}var Db=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"renderAutoNum",value:function(e){var t=this.props,n=t.buIndexCounter,r=t.paragraphXML,i=t.firstRangeXML,a=e.attr.getString("type"),o=e.attr.getNumber("startAt",1);return Ub(n.get(r,o,i)+o,a)}},{key:"renderBuChar",value:function(e){return Fb(e)}},{key:"render",value:function(){var e=this.props,t=e.buXML,n=e.buIndexCounter;switch(t.name){case"a:buChar":return n.reset(),this.renderBuChar(t.attr.getString("char"));case"a:buAutoNum":return this.renderAutoNum(t);case"a:buNone":case"a:buBlip":return n.reset(),""}return""}}]),n}(Jg.default.Component);function Fb(e){switch(e){case String.fromCodePoint(159):case" ":case"l":return"";case"":return"";case"":return"";case"n":return"";case"":return"";case"v":return"";case"u":return"";case"&":return"";case"":return"";case"p":return"";default:return e}}function zb(e){var t=e%26;t=0===t?26:t;var n=Math.ceil(e/26);return String.fromCodePoint(t+64).repeat(n)}function Bb(e){var t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},n="",r=e;for(var i in t)for(;r>=t[i];)n+=i,r-=t[i];return n}function Ub(e,t){switch(t){case"alphaLcParenBoth":case"alphaUcParenBoth":return"(".concat(zb(e),")");case"alphaLcParenR":return"".concat(zb(e).toLowerCase(),")");case"alphaLcPeriod":return"".concat(zb(e).toLowerCase(),".");case"alphaUcParenR":return"".concat(zb(e),")");case"alphaUcPeriod":return"".concat(zb(e),".");case"arabicParenBoth":return"(".concat(e,")");case"arabicParenR":return"".concat(e,")");case"arabicPeriod":default:return"".concat(e,".");case"arabicPlain":return"".concat(e);case"ea1JpnChsDbParenBoth":return"(".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbParenR":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbPeriod":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),".");case"ea1JpnChsDbPlain":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"));case"circleNumDbPlain":return function(e){return e<=20?String.fromCodePoint(e+9311):e<=35?String.fromCodePoint(e+12860):e<=50?String.fromCodePoint(e+12941):"".concat(e)}(e);case"romanLcParenBoth":return"(".concat(Bb(e).toLowerCase(),")");case"romanLcParenR":return"".concat(Bb(e).toLowerCase(),")");case"romanLcPeriod":return"".concat(Bb(e).toLowerCase(),".");case"romanUcParenBoth":return"(".concat(Bb(e),")");case"romanUcParenR":return"".concat(Bb(e),")");case"romanUcPeriod":return"".concat(Bb(e),".")}}var Vb,Wb=function(e){g(n,e);var t=b(n);function n(e){return C(this,n),t.call(this,e)}return P(n,[{key:"hasUnderLine",value:function(e){return"none"===e?"none":"underline"}},{key:"render",value:function(){var e=this.props,t=e.text,n=e.highlightColor,r=e.underLineStyle,i=e.indent,a=e.lineHeight,o=e.isTextWrap,s=e.fontFamily,c=e.isBold,u=e.color,l=e.isItalic,h=e.letterSpacing,d=e.fontSize;return t?$g.default.createElement("span",{style:{display:"inline-flex",justifyContent:"space-between",backgroundColor:Pb(n),textDecoration:this.hasUnderLine(r),width:"100%"}},Array.from(t).map((function(e,t){return 0===t&&i?$g.default.createElement("span",{key:"run-text-".concat(t),style:{display:i?"inline-block":"inline",lineHeight:a,whiteSpace:o?"pre-wrap":"pre",fontSize:"".concat(d,"pt"),fontFamily:s,fontWeight:c?500:400,color:Pb(u),fontStyle:l?"italic":"normal",letterSpacing:"".concat(h/100,"pt"),textIndent:i?By(i):0}},e):$g.default.createElement("span",{key:"run-text-".concat(t),style:{display:"inline",lineHeight:a,whiteSpace:o?"pre-wrap":"pre",fontSize:"".concat(d,"pt"),fontFamily:s,fontWeight:c?500:400,color:Pb(u),fontStyle:l?"italic":"normal",letterSpacing:"".concat(h/100,"pt")}},e)}))):null}}]),n}($g.default.Component),Hb=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).defaultPtSize=18;var i,a=e.rNodeOrBrNode,o=e.lineHeight,s=e.fontScale,c=a.extraAttr.getNumberOptional("sz");return i=void 0===c?r.defaultPtSize:c,r.lineHeight="string"==typeof o?o:"".concat(i*s*1.2*o,"pt"),r.fontSize="".concat(i*s,"pt"),r}return P(n,[{key:"hasUnderLine",value:function(e){return"none"===e?"none":"underline"}},{key:"renderText",value:function(){var e,t=this.props,n=t.rNodeOrBrNode,r=t.slideIndex,i=t.fontScale,a=t.lineHeight,o=t.indent,s=t.isTextWrap,c=t.runIndex,u=t.align,l=t.lastRunInParagraph,h=n.attr.getStringOptional("type");if(h)if("slidenum"===h)e=r;else e=new Date(Date.now()).toLocaleDateString();var d=n.childElementOptional("a:t");if(void 0===d)return $g.default.createElement("span",null);var p,f,v,m,g=n.extraAttr.getBoolean("b",!1),y=n.extraAttr.getString("u","none"),b=n.extraAttr.getNumber("spc",0),k=n.extraAttr.getBoolean("i",!1),w=n.extraAttr.getColorOptional("color"),S=n.extraAttr.getNumber("sz",0)*i,x=n.extraAttr.getString("fontType",""),C=n.extraAttr.getColorOptional("highlight",void 0),I=n.childElementOptional("a:rPr");(void 0!==I&&(p=I.attr.getNumberOptional("baseline")),void 0===p)?f=e||d.text:p>0?(v=40,f=$g.default.createElement("sup",{style:{fontSize:"small",verticalAlign:"".concat(v+p/Dy*100,"%")}},e||d.text)):p<0?(v=0,f=$g.default.createElement("sub",{style:{fontSize:"small",verticalAlign:"".concat(v+p/Dy*100,"%")}},e||d.text)):f=e||d.text;if(m="string"==typeof a?a:"".concat(1.2*S*a,"pt"),"dist"===u)return $g.default.createElement(Wb,{fontSize:S,text:"".concat(f),lineHeight:m,indent:o,isTextWrap:s,isBold:g,isItalic:k,underLineStyle:y,fontFamily:x,letterSpacing:b,color:w,highlightColor:C});var P={display:o?"inline-block":"inline",lineHeight:a,whiteSpace:s?"pre-wrap":"pre",backgroundColor:Pb(C),fontSize:"".concat(S,"pt"),textDecoration:this.hasUnderLine(y),fontFamily:x,fontWeight:g?500:400,color:Pb(w),fontStyle:k?"italic":"normal",letterSpacing:"".concat(b/100,"pt"),overflowWrap:"break-word",textIndent:o?By(o):0};if(!l||"string"!=typeof f&&"number"!=typeof f)return $g.default.createElement("span",{key:"run-".concat(c),style:P},f);var M="",T=f;if("string"==typeof f)f.length>0&&(T=f.substring(0,f.length-1),M=f.substring(f.length-1));else if("number"==typeof f){var A=f+"";T=A.substring(0,A.length-1),M=A.substring(A.length-1)}return P["--data-last-word-indent"]=o?"".concat(By(-o)):"0pt",$g.default.createElement("span",{className:"netless-ppt-last-run","data-last-word":M,key:"run-".concat(c),style:P},T)}},{key:"render",value:function(){var e=this.props,t=e.rNodeOrBrNode,n=e.runIndex,r=e.prevElement;switch(t.name){case"a:fld":case"a:r":return this.renderText();case"a:br":return $g.default.createElement("span",{key:"br-".concat(n),style:{lineHeight:this.lineHeight,fontSize:this.fontSize}},$g.default.createElement("br",null));case"a:endParaRPr":return r&&"a:br"===r.name?$g.default.createElement("span",{key:"endParaRPr-".concat(n),style:{lineHeight:this.lineHeight,display:"inline",fontSize:this.fontSize}},$g.default.createElement("br",null)):null;default:return null}}}]),n}($g.default.Component);function _b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz;switch(e){case Vb.MongolianVert:case Vb.WordArtVert:return"vertical-lr";case Vb.WordArtVertRtl:case Vb.EaVert:return"vertical-rl";default:return"horizontal-tb"}}function Gb(e,t,n){var r,i,a,o=null!=(r=e.left)?r:0,s=null!=(i=e.right)?i:0,c=0,u=0;(null==(a=e.textBodyWrapResource)?void 0:a.prop)?(c=e.textBodyWrapResource.prop.width*jy,u=e.textBodyWrapResource.prop.height*jy):(c=e.width,u=e.height);var l=s?s-u/2+c/2:u/2-c/2;if(n===Vb.Vert270&&t.paddingTop&&"string"==typeof t.paddingTop){var h=parseFloat(t.paddingTop)*Ly;Number.isNaN(h)||(l-=h)}return{left:By(o?o-c/2+u/2:c/2-u/2),top:By(l),width:By(u),height:By(c)}}function Yb(e){var t=e.childElement("a:bodyPr").attr.getStringOptional("vert");if(!t){var n=e.parentElementOptional("a:tc");if(n){var r=n.childElementOptional("a:tcPr");r&&(t=r.attr.getStringOptional("vert"))}}return t||Vb.Horz}function Xb(e){if(void 0===e)return e;if(/^#([A-Fa-f0-9]{8})$/.test(e)){var t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),i=parseInt(e.slice(7,9),16);return 255===i?"rgb(".concat(t,",").concat(n,",").concat(r,")"):"rgba(".concat(t,",").concat(n,",").concat(r,",").concat(i/256,")")}return e}function Qb(e){var t,n,r,i=e.run.prop;i.underLine&&(n="underline"),i.strikeThrough&&(n=n?"".concat(n," line-through"):"line-through"),"tab"===e.run.runType&&(r={display:"inline-block",width:e.run.prop.width});var a="'".concat(i.font,"-").concat(e.uuid,"','").concat(i.font,"'"),o=(1-Math.abs(i.baseline))*i.size,s={fontSize:"".concat(o/e.transformScale,"px"),lineHeight:"".concat(i.lineSpacing/e.transformScale,"px")};return Ry(Ry({color:Xb(null==(t=i.fillType)?void 0:t.color),fontFamily:a,fontSize:"".concat(o,"px"),fontStyle:i.italic?"italic":"normal",fontWeight:Kb(i),letterSpacing:"".concat(i.kerning||0,"px"),lineHeight:"".concat(i.lineSpacing,"px"),backgroundColor:i.highlightColor,verticalAlign:i.baseline?"".concat(100*i.baseline,"%"):void 0,textDecoration:n},r),s)}function Kb(e){return e.fontWeight?e.fontWeight:e.bold?"bold":"normal"}!function(e){e.Horz="horz",e.Vert="vert",e.Vert270="vert270",e.WordArtVert="wordArtVert",e.EaVert="eaVert",e.MongolianVert="mongolianVert",e.WordArtVertRtl="wordArtVertRtl"}(Vb||(Vb={}));var qb,Zb={display:"inline-block",textIndent:0},Jb=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).styles=Qb(e),r}return P(n,[{key:"renderSingleTextNodes",value:function(e){return e.split("").map((function(e,t){return ty.default.createElement("span",{key:t,className:Wg.Text,style:Zb},e)}))}},{key:"render",value:function(){var e=this.props,t=e.run,n=e.withAnimation,r=e.isSplitRun,i=t.text||" ",a=i.split("").map((function(e,t){return ty.default.createElement("span",{key:t,className:Wg.Text,style:Zb},e)})),o=ty.default.createElement("span",{style:Ny(Ry({},this.styles),{whiteSpace:"pre"})}," ");return ty.default.createElement("span",{style:Ny(Ry({},this.styles),{whiteSpace:"nowrap",display:"inline-block",minWidth:r&&"text"===t.runType?void 0:t.prop.width})},n?a:i.split("").map((function(e){return" "===e?o:e})))}}]),n}(ty.default.Component),$b=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).horizontalText="",r.needSideWayCharacterList=function(){switch(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz){case Vb.EaVert:return["","","","","","","","","","",""];case Vb.WordArtVertRtl:case Vb.WordArtVert:return["","","","","[","]","{","}","<",">","","","","(",")","",""];default:return[]}}(e.vert),r.needUpRightCharacterList=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz)===Vb.EaVert?["","","","",""]:[]}(e.vert);var i=Qb(e);return r.fontSpanStyle=Ry(Ny(Ry({},i),{maxHeight:i.fontSize}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz;return e===Vb.WordArtVert||e===Vb.WordArtVertRtl?{padding:"0.1em"}:{}}(e.vert)),r}return P(n,[{key:"renderHorizontalNumber",value:function(e,t){if(!this.horizontalText)return null;var n=this.horizontalText,r=this.props,i=r.run,a=r.vert;return this.horizontalText="",i.prop.kumimoji&&a===Vb.EaVert?ty.default.createElement("span",{className:Wg.Text,key:t+n,style:Ry(Ny(Ry({},e),{writingMode:"horizontal-tb"}),Zb)},n):ty.default.createElement("span",{key:t+n,style:e},ty.default.createElement("span",{className:Wg.Text,style:Zb},n))}},{key:"render",value:function(){var e=this,t=this.props,n=t.run,r=t.vert,i="tab"===n.runType?" ":n.text||" ",a=Qb(this.props),o=Ny(Ry({},this.fontSpanStyle),{display:"inline-block",verticalAlign:"middle",textIndent:0});return ty.default.createElement("span",{style:Ry({},a)},i&&i.split("").map((function(t,n){return r!==Vb.EaVert||Number.isNaN(parseInt(t,10))?e.needSideWayCharacterList.includes(t)?ty.default.createElement("span",{className:Wg.Text,key:n,style:Ny(Ry({},o),{transform:"rotate(90deg)",display:"inline-block"})},t):e.needUpRightCharacterList.includes(t)?ty.default.createElement("span",{className:Wg.Text,key:n,style:Ny(Ry({},o),{transform:"rotate(-90deg)",display:"inline-block"})},t):ty.default.createElement("span",{className:Wg.Text,key:n,style:Ny(Ry({},e.fontSpanStyle),{display:"inline-block"})},t):(e.horizontalText+=t,2===e.horizontalText.length||Number.isNaN(parseInt(i[n+1],10))?e.renderHorizontalNumber(e.fontSpanStyle,n):null)})))}}]),n}(ty.default.Component),ek=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"getScaleStyle",value:function(e){var t=e.reduce((function(e,t){return(1-Math.abs(t.prop.baseline))*t.prop.size<(1-Math.abs(e.prop.baseline))*e.prop.size?t:e})),n=(1-Math.abs(t.prop.baseline))*t.prop.size,r={},i=1;return n<12&&(i=n/12,r.transform="scale(".concat(i,")"),r.transformOrigin="0 0",r.lineHeight="1",r.display="block"),{scaleStyle:r,transformScale:i}}},{key:"splitRuns",value:function(e){function t(e){var t=e.codePointAt(0)||0;return t>=65&&t<=122}return(e.text||"").split("").reduce((function(n,r){var i=n[n.length-1];if(void 0===i)return n.push(Ny(Ry({},e),{text:r})),n;var a=i.text||"",o=t(a[a.length-1]),s=t(r);return o&&s?i.text="".concat(a).concat(r):n.push(Ny(Ry({},e),{text:r})),n}),[])}},{key:"render",value:function(){var e=this,t=this.props,n=t.line,r=t.justify,i=t.vert,a=t.lineIndent,o=t.align,s=t.textBodyWrapResource,c=n,u=this.props.uuid,l=!1,h={};r?(l=!0,c=n.reduce((function(t,n){var r="text"===n.runType?e.splitRuns(n):[n],i=t;return i=i.concat(r)}),[]),h={display:"flex",justifyContent:"space-between",width:"calc(100% - ".concat(a||0,"px"),position:"relative",left:a}):h={textIndent:a};var d=c.reduce((function(e,t){return t.prop.lineSpacing>e.prop.lineSpacing?t:e})).prop.lineSpacing,p=0;c.forEach((function(e){p+=Number(e.prop.width)}));var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return e===Vb.Horz?r.height="".concat(n,"px"):(r.height="".concat(t,"px"),r.width="".concat(n,"px"),(e===Vb.Vert||e===Vb.Vert270)&&(r.width="".concat(t,"px"),r.height="".concat(n,"px")),e===Vb.WordArtVert||e===Vb.WordArtVertRtl?r.margin="0 0.6em":r.whiteSpace="nowrap",(e===Vb.EaVert||e===Vb.WordArtVertRtl)&&(r.transformOrigin="100% 0")),r}(i,p,d);"dist"===o&&i!==Vb.Horz&&(f.height=null==s?void 0:s.prop.height);var v=this.getScaleStyle(c),m=v.scaleStyle,g=v.transformScale,y=Ny(Ry(Ry(Ry({},h),f),m),{whiteSpace:"pre"}),b=this.props.withAnimation;return i!==Vb.Horz?ey.default.createElement("div",{style:y},c.map((function(e,t){return ey.default.createElement($b,{withAnimation:b,transformScale:g,vert:i,uuid:u,key:t,run:e,firstRun:0===t})}))):ey.default.createElement("div",{style:y},c.map((function(e,t){return ey.default.createElement(Jb,{withAnimation:b,transformScale:g,isSplitRun:l,uuid:u,key:t,run:e,firstRun:0===t})})))}}]),n}(ey.default.Component);!function(e){e.r="r",e.l="l",e.crl="ctr",e.dist="dist",e.just="just"}(qb||(qb={}));var tk=function(e){g(n,e);var t=b(n);function n(e){var r;if(C(this,n),r=t.call(this,e),!e.paragraphXML||!e.bodyPrXML)return k(r);var i=e.bodyPrXML,a=e.paragraphXML;r.runElements=a.elements.filter((function(e){return["a:fld","a:r","a:br","a:endParaRPr"].includes(e.name)})),r.biggestFontSize=p(r.runElements).filter((function(e){return"a:r"===e.name})).map((function(e){return e.extraAttr.getNumber("sz",0)})).sort((function(e,t){return e-t}))[0],r.fontScale=.01;var o=i.childElementOptional("a:normAutofit");if(o&&(r.fontScale=zy(o.attr.getNumber("fontScale",Dy))/100),r.buChar=a.extraElementWithName("bu"),r.indent=a.extraAttr.getNumber("indent",0),r.marL=a.extraAttr.getNumber("marL",0),r.lineHeightInXml=a.extraAttr.get("lineHeight"),"number"!=typeof r.lineHeightInXml)r.lineHeight="".concat(parseFloat(r.lineHeightInXml)*r.fontScale*100,"pt");else{var s=r.getBigestLineHeight(p(r.runElements),r.lineHeightInXml,r.fontScale);r.lineHeight=void 0===s?void 0:"".concat(s,"pt")}return r.buClr=a.extraAttr.getColorOptional("buClr"),r.noneBuChar=void 0===r.buChar||"a:buNone"===r.buChar.name,r.paddingBottom=r.getPaddingBottom(a.extraAttr.getStringOptional("a:spcAft"),r.biggestFontSize),r.paddingBottom=r.getPaddingTop(a.extraAttr.getStringOptional("a:spcBef"),r.biggestFontSize),r.align=a.extraAttr.getStringOptional("algn"),r}return P(n,[{key:"getPaddingBottom",value:function(e,t){var n=this.props,r=n.isLast,i=n.spcFirstLastPara;return r&&!i?"0pt":this.getPadding(e,t)}},{key:"getPaddingTop",value:function(e,t){var n=this.props,r=n.isFirst,i=n.spcFirstLastPara;return r&&!i?"0pt":this.getPadding(e,t)}},{key:"getPadding",value:function(e,t){if(e){if(-1!==e.indexOf("pt"))return e;if(t)return"".concat(t*parseFloat(e)/100,"pt")}return"0pt"}},{key:"getBigestLineHeight",value:function(e,t,n){var r;return e.forEach((function(e){switch(e.name){case"a:fld":case"a:r":case"a:br":case"a:endParaRPr":var i=1.2*e.extraAttr.getNumber("sz",0)*t*n;(void 0===r||r<i)&&(r=i)}})),r}},{key:"isFlexSpaceBetween",value:function(e,t,n){return e===qb.dist||e===qb.just&&t!==n-1}},{key:"renderWrapParagraph",value:function(e){var t=this.props,n=t.paragraphWrapResource,r=t.bulletInfo,i=t.vert,a=n,o=a.prop,s=o.spaceBefore,c=o.spaceAfter,u=o.firstLineIndent,l=a.prop,h=l.align,d=l.bulletChar,p=l.indent,f=l.marginLeft,v=l.marginRight;if(0===e.length&&a.endParagraphRunProp){var m=a.endParagraphRunProp;s=m.spaceBefore,c=m.spaceAfter}0===r.order&&(s=0),r.order+1===r.count&&(c=0);var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz,t=arguments.length>1?arguments[1]:void 0;return e===Vb.WordArtVertRtl?Ny(Ry({},t),{marginTop:t.marginLeft,marginLeft:t.marginBottom,marginRight:t.marginTop}):e===Vb.EaVert||e===Vb.WordArtVert?Ny(Ry({},t),{marginTop:t.marginLeft,marginLeft:t.marginTop,marginRight:t.marginBottom}):t}(i,{marginLeft:f,marginRight:v,marginTop:s,marginBottom:c}),y=Ny(Ry({textAlign:Nb(h),position:"relative",fontSize:"0",lineHeight:"0"},g),{whiteSpace:"pre"});return void 0===u&&(u=Math.max(p,-f),d&&(u=p>=0?p:Math.max(0,-(f+p)))),gv.default.createElement("div",{className:Wg.Paragraph,style:y},d&&this.renderBulletCharNode(e),this.renderLines(e,u,h))}},{key:"renderBulletCharNode",value:function(e){var t,n=this.props,r=n.paragraphWrapResource,i=n.bulletInfo,a=n.vert,o=r.prop,s=o.bulletChar,c=o.indent;if(s){var u=0===e.length,l=i.number,h=e.slice(0,1),d=h[0]&&h[0][0],p=s.colorFollowText&&d?null==(t=d.prop.fillType)?void 0:t.color:s.color,f=s.fontFollowText&&d?d.prop.font:s.font,v=s.sizeFollowText&&d?d.prop.size:s.size,m=d?"".concat(d.prop.lineSpacing,"px"):void 0,g=void 0!==s.autoNumber&&void 0!==s.autoNumberType,y=c>=0?0:c,b="";u||(g&&l&&(b=Ub(l,s.autoNumberType)),g||(b+=Fb(s.character||"l")));var k={position:"absolute",fontFamily:f,fontSize:v,textIndent:y,color:p,lineHeight:m};return a===Vb.EaVert&&(k.textOrientation="sideways"),gv.default.createElement("div",{style:k},b)}}},{key:"renderLines",value:function(e,t,n){var r=this,i=this.props,a=i.paragraphWrapResource,o=i.uuid,s=i.vert,c=i.withAnimation,u=i.textBodyWrapResource;if(0===e.length){var l,h={},d=a.endParagraphRunProp?a.endParagraphRunProp.lineSpacing:void 0,p=a.endParagraphRunProp?a.endParagraphRunProp.size:void 0;if(p&&p<12){var f=p/12;p=12,d=d?d*f:void 0,l="scale(".concat(f,")"),h.display="inline-block"}return h.lineHeight="".concat(d,"px"),h.fontSize="".concat(p,"px"),h.transform=l,gv.default.createElement("span",{style:{lineHeight:"".concat(d,"px"),fontSize:"".concat(p,"px"),transform:l}},gv.default.createElement("br",null))}return e.map((function(i,a){return gv.default.createElement(ek,{key:a,withAnimation:c,uuid:o,vert:s,lineIndent:0===a?t:void 0,line:i,align:n,textBodyWrapResource:u,justify:r.isFlexSpaceBetween(n,a,e.length)})}))}},{key:"renderRunOrBrOrEnd",value:function(e,t,n,r,i,a,o,s,c){var u=this.props,l=u.isTextWrap,h=u.slideContext;return gv.default.createElement(Hb,{key:"".concat(t,"-").concat(n),isTextWrap:l,paragraphHasRange:void 0!==s,rNodeOrBrNode:e,fontScale:r,runIndex:n,indent:0===n&&this.noneBuChar&&0!==this.marL?a:void 0,slideIndex:h.slideIndex,prevElement:c,lineHeight:i,align:this.align?this.align:"l",lastRunInParagraph:o})}},{key:"render",value:function(){var e=this,t=this.props,n=t.paragraphXML,r=t.resourceType,i=t.paragraphIndex,a=t.paragraphWrapResource,o=t.firstRangeXML,s=t.buIndexCounter,c=t.isTextWrap,u=null==n?void 0:n.extraAttr.getBoolean("placeHolderType");if("slide"!==r&&u)return gv.default.createElement("div",{key:"".concat(i)});if(a)return this.renderWrapParagraph(a.lines);if(!n)return null;var l,h=Nb(this.align),d=this.runElements.map((function(t,n){var r="left"===h&&n===e.runElements.length-1,a=e.renderRunOrBrOrEnd(t,i,n,e.fontScale,e.lineHeightInXml,e.indent,r,o,l);return l=t,a})),p=0;if(o){if(this.buChar&&"a:buNone"!==this.buChar.name){var f=o.extraAttr.getNumber("sz",0),v=o.extraAttr.getString("fontType","");d.unshift(gv.default.createElement("span",{key:"bu-".concat(p+=1),style:{display:"inline-block",position:"absolute",color:void 0!==this.buClr?Pb(this.buClr):Pb(o.extraAttr.getColorOptional("color")),fontSize:"".concat(f*this.fontScale,"pt"),lineHeight:this.lineHeight,fontFamily:v,textIndent:By(this.indent)}},gv.default.createElement(Db,{paragraphXML:n,firstRangeXML:o,buXML:this.buChar,buIndexCounter:s})))}}else{var m=0,g=n.childElementOptional("a:endParaRPr");if(g){var y=g.extraAttr.getNumberOptional("sz");m=void 0===y?0:y}else m=n.extraAttr.getNumber("sz",0);d.push(gv.default.createElement("span",{key:"end-".concat(p+=1),style:{display:"block",lineHeight:this.lineHeight,fontSize:"".concat(m*this.fontScale,"pt")}},gv.default.createElement("br",null)))}return this.buChar&&"a:buNone"===this.buChar.name&&s.reset(),gv.default.createElement("li",{key:"".concat(i),className:"".concat(Wg.Paragraph," Paragraph-").concat(i),style:{whiteSpace:c?"normal":"nowrap",paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,marginLeft:By(n.extraAttr.getNumber("marL",0)),marginRight:By(n.extraAttr.getNumber("marR",0)),lineHeight:"1pt",listStyleType:"none",textAlign:h}},d)}}]),n}(gv.default.Component),nk={"*/":function(e,t,n){return e*t/n},"+-":function(e,t,n){return e+t-n},"+/":function(e,t,n){return(e+t)/n},"?:":function(e,t,n){return e>0?t:n},abs:function(e){return Math.abs(e)},at2:function(e,t){return function(e){return e*(180/Math.PI)*Fy}(Math.atan2(t,e))},cat2:function(e,t,n){return e*Math.cos(Math.atan2(n,t))},cos:function(e,t){return e*Math.cos(rk(t))},max:function(e,t){return e>t?e:t},min:function(e,t){return e<t?e:t},mod:function(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))},pin:function(e,t,n){return t<e?e:t>n?n:t},sat2:function(e,t,n){return e*Math.sin(Math.atan2(n,t))},sin:function(e,t){return e*Math.sin(rk(t))},sqrt:function(e){return Math.sqrt(e)},tan:function(e,t){return e*Math.tan(rk(t))},val:function(e){return e}};function rk(e){return e/Fy*(Math.PI/180)}var ik=function(){function e(t){C(this,e),this.expr=t}return P(e,[{key:"standardizationTokenSplit",value:function(e){return e.replace(/\s+/g," ")}},{key:"eval",value:function(e){var t=this.standardizationTokenSplit(this.expr).split(" "),n=t.slice(1,t.length).map((function(t){return Number.isNaN(Number(t))?e.getRequiredVariable(t):parseInt(t,10)}));if(void 0===nk[t[0]])throw new Error("Formula ".concat(t[0]," not supported"));return nk[t[0]].apply(nk,p(n))}}],[{key:"deconstructShapeGuide",value:function(e){var t=o(e.split(" ")),n=t[0],r=t.slice(1).map((function(e){return parseInt(e,10)}));return nk[n].apply(nk,p(r))}}]),e}();function ak(e,t){return ok.apply(this,arguments)}function ok(){return ok=u(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hk(t,void 0,n,5e3);case 2:if(200===(r=e.sent).status){e.next=8;break}return e.next=6,r.text();case 6:throw i=e.sent,uk(t,r.status,n,new Error(i)).then((function(){}),(function(){})),new Error("fetch ".concat(t," failed with ").concat(r.status));case 8:return e.next=10,r.text();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)}))),ok.apply(this,arguments)}function sk(e,t){return ck.apply(this,arguments)}function ck(){return ck=u(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hk(t,{headers:{"content-type":"application/json",Accept:"application/json"}},n,5e3);case 2:if(200===(r=e.sent).status){e.next=8;break}return e.next=6,r.text();case 6:throw i=e.sent,uk(t,r.status,n,new Error(i)).then((function(){}),(function(){})),new Error("fetch ".concat(t," failed with ").concat(r.status));case 8:return e.next=10,r.json();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)}))),ck.apply(this,arguments)}function uk(e,t,n,r){return lk.apply(this,arguments)}function lk(){return lk=u(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window&&window.postMessage({name:"pptDataLoadError",src:t,event:"PPT data load failed",status:n},"*"),null==r||r.error("fetch ".concat(JSON.stringify(t)," failed with ").concat(n," : "),i);case 1:case"end":return e.stop()}}),e)}))),lk.apply(this,arguments)}function hk(e,t,n,r){return dk.apply(this,arguments)}function dk(){return dk=u(regeneratorRuntime.mark((function e(t,n,r,i){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=setTimeout((function(){null==r||r.warn("fetch ".concat(t," for ").concat(i,"ms"))}),i),e.prev=1,e.next=4,fetch(t,Ry({},n));case 4:return o=e.sent,e.abrupt("return",(clearTimeout(a),o));case 8:throw e.prev=8,e.t0=e.catch(1),clearTimeout(a),null==r||r.error("fetch ".concat(t," with error ").concat(e.t0)),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,8]])}))),dk.apply(this,arguments)}var pk,fk=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"keyval-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";C(this,e),this.storeName=n,this._dbp=new Promise((function(e,r){var i=indexedDB.open(t,1);i.onerror=function(){return r(i.error)},i.onsuccess=function(){return e(i.result)},i.onupgradeneeded=function(){i.result.createObjectStore(n)}}))}return P(e,[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then((function(r){return new Promise((function(i,a){var o=r.transaction(n.storeName,e);o.oncomplete=function(){return i()},o.onabort=o.onerror=function(){return a(o.error)},t(o.objectStore(n.storeName))}))}))}}]),e}();function vk(){return pk||(pk=new fk),pk}function mk(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vk();return n._withIDBStore("readonly",(function(n){t=n.get(e)})).then((function(){return t.result}))}function gk(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vk();return n._withIDBStore("readwrite",(function(n){n.put(t,e)}))}var yk,bk=function(){function e(){C(this,e),this.attributePickers={},this.childPickers={}}return P(e,[{key:"createPickers",value:function(){return new wk(this.attributePickers,this.childPickers)}},{key:"bindAttributePicker",value:function(e,t,n){this.bindPicker(e,t,n,this.attributePickers)}},{key:"bindChildPicker",value:function(e,t,n){this.bindPicker(e,t,n,this.childPickers)}},{key:"bindPicker",value:function(e,t,n,r){"string"==typeof e&&(e=[e]),"string"==typeof t&&(t=[t]);var i,a=T(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.bindPickerWithAttributeNames(o,t,n,r)}}catch(e){a.e(e)}finally{a.f()}}},{key:"bindPickerWithAttributeNames",value:function(e,t,n,r){var i=r[e];if(i||(i=r[e]={}),"object"==M(i)){var a,o=T(t);try{for(o.s();!(a=o.n()).done;){i[a.value]=n}}catch(e){o.e(e)}finally{o.f()}}}}]),e}(),kk=function(){function e(t){C(this,e),this.pickers=t}return P(e,[{key:"forEach",value:function(e,t){var n=this.pickers[e];if(n)for(var r in n)"*"!==r&&t(r)}},{key:"has",value:function(e,t){var n=this.pickers[e];return!!n&&(t in n||"*"in n)}},{key:"get",value:function(e,t,n,r,i,a){var o=this.pickers[t];if(o){var s=o[n];if(s||(s=o["*"]),s)return s(r,e,n,i,a)}}}]),e}(),wk=function(){function e(t,n){C(this,e),this.attributePickers=new kk(t),this.childPickers=new kk(n)}return P(e,[{key:"forEachAttributes",value:function(e,t){this.attributePickers.forEach(e,t)}},{key:"hasAttribute",value:function(e,t){return this.attributePickers.has(e,t)}},{key:"getAttribute",value:function(e,t,n,r,i){if(this.context)return this.attributePickers.get(this.context,e,t,n,r,i)}},{key:"getChild",value:function(e,t,n,r,i){if(this.context)return this.childPickers.get(this.context,e,t,n,r,i)}}]),e}(),Sk=function(){function e(t){C(this,e),this.resourceScheme=t}var t,n,r,i,a,o;return P(e,[{key:"loadLumiaPSD",value:(o=u(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a="https://convertcdn.netless.link/publicFiles/xml/PresetShapeDefinitions.xml",this.resourceScheme&&(a=a.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),!1!==n){t.next=8;break}return t.next=5,ak(a,r);case 5:i=t.sent,t.next=18;break;case 8:return t.next=10,mk("PresetShapeDefinitions");case 10:if(i=t.sent,t.t0=void 0===i,!t.t0){t.next=18;break}return t.next=15,ak(a,r);case 15:return i=t.sent,t.next=18,gk("PresetShapeDefinitions",i);case 18:e.presetShapeDefinitons=new qy("slide").parse(i).childElement("presetShapeDefinitons");case 19:case"end":return t.stop()}}),t,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"preLoad",value:(a=u(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllResourceUrl(n,r,i.logger);case 2:a=e.sent,o=0;case 4:if(!(o<a.length)){e.next=12;break}return s=o+1,c=a[o],e.next=8,this.prefetchPageResource(c);case 8:i.preloadProgress&&i.preloadProgress((s/a.length).toFixed(2));case 9:o++,e.next=4;break;case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"prefetchPageResource",value:(i=u(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],r=0,i=Object.keys(t);r<i.length;r++)a=i[r],n.push(this.prefetchResource(t[a]));return e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"prefetchResource",value:(r=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(t).length>0)){e.next=15;break}n=Object.keys(t),r=[],i=0,a=n;case 3:if(!(i<a.length)){e.next=13;break}if(o=a[i],!(s=t[o]).endsWith(".mp4")){e.next=8;break}return e.abrupt("continue",10);case 8:c=s,this.resourceScheme&&(c=s.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),r.push(this.fetch(c));case 10:i++,e.next=3;break;case 13:return e.next=15,Promise.all(r);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.debug("cache fail",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}())},{key:"fetchAllResourceUrl",value:(n=u(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],a=1;a<=n;a++)i.push(sk("".concat(t,"/resources/resource").concat(a,".json"),r));return e.next=4,Promise.all(i);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchPageResource",value:(t=u(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sk("".concat(t,"/resources/resource").concat(n,".json"),r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),xk=function(){function e(t){C(this,e),this.foundStartPostion=!1,this.variablesMap=t,this.injectConstant()}return P(e,[{key:"injectConstant",value:function(){this.setVariable("3cd4",162e5),this.setVariable("3cd8",81e5),this.setVariable("5cd8",135e5),this.setVariable("7cd8",189e5),this.setVariable("b",new ik("val h").eval(this)),this.setVariable("cd2",108e5),this.setVariable("cd4",54e5),this.setVariable("cd8",27e5),this.setVariable("hc",new ik("*/ w 1.0 2.0").eval(this)),this.setVariable("hd2",new ik("*/ h 1.0 2.0").eval(this)),this.setVariable("hd3",new ik("*/ h 1.0 3.0").eval(this)),this.setVariable("hd4",new ik("*/ h 1.0 4.0").eval(this)),this.setVariable("hd5",new ik("*/ h 1.0 5.0").eval(this)),this.setVariable("hd6",new ik("*/ h 1.0 6.0").eval(this)),this.setVariable("hd8",new ik("*/ h 1.0 8.0").eval(this)),this.setVariable("l",0),this.setVariable("ls",new ik("max w h").eval(this)),this.setVariable("r",new ik("val w").eval(this)),this.setVariable("ss",new ik("min w h").eval(this)),this.setVariable("ssd2",new ik("*/ ss 1.0 2.0").eval(this)),this.setVariable("ssd4",new ik("*/ ss 1.0 4.0").eval(this)),this.setVariable("ssd6",new ik("*/ ss 1.0 6.0").eval(this)),this.setVariable("ssd8",new ik("*/ ss 1.0 8.0").eval(this)),this.setVariable("ssd16",new ik("*/ ss 1.0 16.0").eval(this)),this.setVariable("ssd32",new ik("*/ ss 1.0 32.0").eval(this)),this.setVariable("t",0),this.setVariable("vc",new ik("*/ h 1.0 2.0").eval(this)),this.setVariable("wd2",new ik("*/ w 1.0 2.0").eval(this)),this.setVariable("wd3",new ik("*/ w 1.0 3.0").eval(this)),this.setVariable("wd4",new ik("*/ w 1.0 4.0").eval(this)),this.setVariable("wd5",new ik("*/ w 1.0 5.0").eval(this)),this.setVariable("wd6",new ik("*/ w 1.0 6.0").eval(this)),this.setVariable("wd8",new ik("*/ w 1.0 8.0").eval(this)),this.setVariable("wd10",new ik("*/ w 1.0 10.0").eval(this)),this.setVariable("wd12",new ik("*/ w 1.0 12.0").eval(this)),this.setVariable("wd32",new ik("*/ w 1.0 32.0").eval(this))}},{key:"getVariable",value:function(e,t){return void 0!==this.variablesMap[e]?this.variablesMap[e]:t}},{key:"getRequiredVariable",value:function(e){if(void 0!==this.variablesMap[e])return this.variablesMap[e];throw new Error("".concat(e," is required"))}},{key:"setVariable",value:function(e,t){this.variablesMap[e]=t}},{key:"setVariableIfNotExist",value:function(e,t){void 0===this.variablesMap[e]&&(this.variablesMap[e]=t)}},{key:"isNumeric",value:function(e){return/^-{0,1}\d+$/.test(e)}},{key:"accessValue",value:function(e){return this.isNumeric(e)?parseInt(e,10):this.getRequiredVariable(e)}},{key:"setLatestPostion",value:function(e,t){this.latestPostionX=e,this.latestPostionY=t,this.foundStartPostion||(this.startPostionX=e,this.startPostionY=t,this.foundStartPostion=!0)}},{key:"getLatestPostion",value:function(){return{x:this.latestPostionX,y:this.latestPostionY}}},{key:"getStartPostion",value:function(){return{x:this.startPostionX,y:this.startPostionY}}},{key:"inspect",value:function(){console.debug(JSON.stringify(this.variablesMap))}}]),e}(),Ck=function(){function e(){C(this,e)}return P(e,[{key:"renderLumiaPath",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=e.childElementOptional("".concat(r,"avLst"));i&&i.elementsWithName("".concat(r,"gd")).forEach((function(e){var n=e.attr.getString("fmla"),r=new ik(n).eval(t),i=e.attr.getString("name");t.setVariableIfNotExist(i,r)}));var a=e.childElementOptional("".concat(r,"gdLst"));a&&a.elementsWithName("".concat(r,"gd")).forEach((function(e){var n=e.attr.getString("fmla"),r=new ik(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}));var o=e.childElementOptional("".concat(r,"rect"));o?(t.setVariable("rectLeft",t.accessValue(o.attr.getString("l"))),t.setVariable("rectTop",t.accessValue(o.attr.getString("t"))),t.setVariable("rectRight",t.accessValue(o.attr.getString("r"))),t.setVariable("rectBottom",t.accessValue(o.attr.getString("b")))):(t.setVariable("rectLeft",t.accessValue("l")),t.setVariable("rectTop",t.accessValue("t")),t.setVariable("rectRight",t.accessValue("r")),t.setVariable("rectBottom",t.accessValue("b")));var s=e.childElement("".concat(r,"pathLst")).elementsWithName("".concat(r,"path")),c=[];return s.forEach((function(e){var i,a={fill:void 0,pathD:"",isBorder:null==(i=e.attr.getBooleanOptional("stroke"))||i};a.fill=e.attr.getStringOptional("fill")||void 0;var o=n.calcPathScale(e,t),s=o.pathWidthScale,u=o.pathHeightScale,l=e.elements.map((function(e){return new Ik(e,r,s,u).generate(t)}));a.pathD=l.join(" "),c.push(a)})),c}},{key:"calcPathScale",value:function(e,t){var n=e.attr.getNumberOptional("w"),r=e.attr.getNumberOptional("h"),i=1,a=1;return n&&(i=t.accessValue("w")/n),r&&(a=t.accessValue("h")/r),{pathWidthScale:i,pathHeightScale:a}}}]),e}(),Ik=function(){function e(t,n,r,i){C(this,e),this.actionXML=t,this.namespace=n,this.pathWidthScale=r,this.pathHeightScale=i}return P(e,[{key:"xUnitTransformAndPathScale",value:function(e){return e*this.pathWidthScale/jy}},{key:"yUnitTransformAndPathScale",value:function(e){return e*this.pathHeightScale/jy}},{key:"generate",value:function(e){var t=this,n=this.actionXML.elementsWithName("".concat(this.namespace,"pt")).map((function(e){return{x:e.attr.getString("x"),y:e.attr.getString("y")}})).map((function(n){return{x:t.getPtValue(n,e,"x"),y:t.getPtValue(n,e,"y")}})),r=n.length>0?n[0].x:0,i=n.length>0?n[0].y:0,a=n.length>1?n[1].x:0,o=n.length>1?n[1].y:0,s=n.length>2?n[2].x:0,c=n.length>2?n[2].y:0;switch(this.actionXML.name){case"".concat(this.namespace,"moveTo"):return e.setLatestPostion(r,i),["M",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i)].join(" ");case"".concat(this.namespace,"lnTo"):return e.setLatestPostion(r,i),["L",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i)].join(" ");case"".concat(this.namespace,"arcTo"):var u=e.accessValue(this.actionXML.attr.getString("wR")),l=e.accessValue(this.actionXML.attr.getString("hR")),h=e.accessValue(this.actionXML.attr.getString("stAng"))/Fy,d=e.accessValue(this.actionXML.attr.getString("swAng"))/Fy,p=e.getLatestPostion(),f=p.x,v=p.y,m=this.getSvgArc(u,l,h,d,f,v);return d>=360?(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.middleX),this.yUnitTransformAndPathScale(m.middleY),"A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" ")):(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" "));case"".concat(this.namespace,"cubicBezTo"):return e.setLatestPostion(s,c),["C",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i),this.xUnitTransformAndPathScale(a),this.yUnitTransformAndPathScale(o),this.xUnitTransformAndPathScale(s),this.yUnitTransformAndPathScale(c)].join(" ");case"".concat(this.namespace,"quadBezTo"):return e.setLatestPostion(n[1].x,n[1].y),["Q",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i),this.xUnitTransformAndPathScale(a),this.yUnitTransformAndPathScale(o)].join(" ");case"".concat(this.namespace,"close"):return e.setLatestPostion(e.getStartPostion().x,e.getStartPostion().y),"Z";default:throw new Error("unknow ".concat(this.actionXML.name))}}},{key:"getPtValue",value:function(e,t,n){return t.accessValue(e[n])}},{key:"getSvgArc",value:function(e,t,n,r,i,a){var o,s,c,u,l,h=e,d=t;if(0===r)o=i,s=a,l=0;else if(r>=360)o=i,s=a,c=i+2*e*Math.abs(Math.cos(-n/180*Math.PI)),u=a+2*t*Math.sin(-n/180*Math.PI),l=1;else{var p=-n,f=-(n+r),v=this.getCoordinateOnEllipse(p,h,d),m=i-v.x,g=a+v.y,y=this.getCoordinateOnEllipse(f,h,d);o=y.x+m,s=g-y.y,l=r>=-360&&r<-180?1:r>=-180&&r<0||r>0&&r<180?0:1}return{radiusX:h,radiusY:d,xAxisRotation:0,largeArcFlag:l,sweepFlag:r>0?1:0,endX:o,endY:s,middleX:c,middleY:u}}},{key:"getCoordinateOnEllipse",value:function(e,t,n){var r,i,a=e%360;if(a%180==0)r=Math.cos(a*(Math.PI/180))*t,i=0;else if(a%90==0)r=0,i=Math.sin(a*(Math.PI/180))*n;else{var o=this.getTanDeg(a);r=t*n/Math.sqrt(Math.pow(n,2)+Math.pow(t*o,2)),(a>90&&a<270||a<-90&&a>-270)&&(r=-r),i=o*r}return{x:r,y:i}}},{key:"getTanDeg",value:function(e){var t=e*Math.PI/180;return Math.tan(t)}}]),e}();function Pk(e){return Sk.presetShapeDefinitons.childElementOptional(e)||(console.warn("".concat(e," not include preset shape.")),Sk.presetShapeDefinitons.childElement("rect"))}function Mk(e){switch(e){case"none":default:return 0;case"triangle":return 1;case"stealth":return 2;case"diamond":return 3;case"oval":return 4;case"arrow":return 5}}!function(e){e[e.none=0]="none",e[e.triangle=1]="triangle",e[e.stealth=2]="stealth",e[e.diamond=3]="diamond",e[e.oval=4]="oval",e[e.arrow=5]="arrow"}(yk||(yk={}));var Tk=function(){function e(t){C(this,e),this.logger=t}return P(e,[{key:"createMonitor",value:function(){return new Ak(this.logger).ref}}]),e}(),Ak=function(){function e(t){var n=this;C(this,e),this.logger=t,this.image=null,this.timer=null,this.beginTimestamp=0,this.ref=function(e){e?n.bindImage(e):n.releaseImage()},this.onLoad=function(){0!==n.beginTimestamp&&(n.beginTimestamp=0,n.clearTimer())},this.onError=function(e){var t,r;0!==n.beginTimestamp&&(n.beginTimestamp=0,n.clearTimer(),r="string"==typeof e?new Error(e):new Error("".concat(e.message)),null==(t=n.logger)||t.error("loading image ".concat(n.getImageUrl()," with error: ").concat(r)))},this.onTimeout=function(){var e;n.beginTimestamp=0,null==(e=n.logger)||e.warn("loading image ".concat(n.getImageUrl()," timeout for ").concat(1e4,"ms"))},this.getImageUrl=function(){var e,t;return n.image&&n.image instanceof SVGImageElement?null==(e=n.image)?void 0:e.href.animVal:null==(t=n.image)?void 0:t.src}}return P(e,[{key:"bindImage",value:function(e){e.onload=this.onLoad,e.onerror=this.onError,this.image=e,this.timer=setTimeout(this.onTimeout,1e4),this.beginTimestamp=Date.now()}},{key:"releaseImage",value:function(){this.image&&(this.image.onload=null,this.image.onerror=null,this.image=null,this.beginTimestamp=0,this.clearTimer())}},{key:"clearTimer",value:function(){null!==this.timer&&clearTimeout(this.timer)}}]),e}(),Ek="body";function Ok(e,t,n){var r=function(e){var t=!1,n=e.childElementOptional("p:nvSpPr");return n&&n.childElement("p:cNvSpPr").attr.getBooleanOptional("txBox")&&(t=!0),t}(e),i=!0;if("master"===n){var a=Rk(e);if(!a)return i=!1,{allShape:[e],masterStyleXML:Lk(t),isTextBox:r,hasPlaceHolder:i};var o=a.type||Ek;return{placeHolderType:o,masterShape:e,masterStyleXML:Nk(o,t,r),allShape:[e],isTextBox:r,hasPlaceHolder:i}}if("layout"===n){var s=Rk(e);if(!s)return i=!1,{allShape:[e],masterStyleXML:Lk(t),isTextBox:r,hasPlaceHolder:i};var c=jk(s.type||Ek),u=t.masterIndex.typeIndex[c],l=[e];return u&&l.push(u),{allShape:l,placeHolderType:c,layoutShape:e,masterShape:u,masterStyleXML:Nk(c,t,r),isTextBox:r,hasPlaceHolder:i}}var h,d=Rk(e);if(!d)return i=!1,{allShape:[e],masterStyleXML:Lk(t),isTextBox:r,hasPlaceHolder:i};if(function(e){return void 0!==e&&void 0!==e.idx&&"4294967295"===e.idx}(d)&&(d.idx="1"),d.idx?(h=t.layoutIndex.idxIndex[d.idx],d.type&&void 0===h&&(h=t.layoutIndex.typeIndex[d.type])):d.type&&(h=t.layoutIndex.typeIndex[d.type]),h){var p=Rk(h);if(p){var f=jk(p.type||Ek),v=t.masterIndex.typeIndex[f],m=[e];return h&&m.push(h),v&&m.push(v),{allShape:m,placeHolderType:f,layoutShape:h,masterShape:v,masterStyleXML:Nk(f,t,r),isTextBox:r,hasPlaceHolder:i}}throw new Error("layout ph not existed.")}var g=jk(d.type||Ek),y=t.masterIndex.typeIndex[g],b=[e];return y&&b.push(y),{allShape:b,placeHolderType:g,layoutShape:e,masterShape:y,masterStyleXML:Nk(g,t,r),isTextBox:r,hasPlaceHolder:i}}function Rk(e){if(e){var t=e.childElementOptional(new Zy("p:nvSpPr","p:nvCxnSpPr"));if(t){var n=t.childElementOptional("p:nvPr","p:ph");if(n){var r=n.attr.getStringOptional("idx"),i=n.attr.getStringOptional("type");return("title"===i||"ctrTitle"===i)&&(r=r||"0"),{idx:r,type:i}}}}}function Nk(e,t,n){if(t.masterIndex.txStyle){var r=t.masterIndex.txStyle[e];return r||(r=n?t.masterIndex.txStyle[Ek]:t.masterIndex.txStyle.other),r}}function Lk(e){return e.main.childElementOptional("p:presentation","p:defaultTextStyle")}function jk(e){switch(e){case"ctrTitle":case"title":return"title";case"dt":return"dt";case"ftr":return"ftr";case"sldNum":return"sldNum";default:return"body"}}var Dk=6350;function Fk(e){var t="";return"master"===e?t="m":"layout"===e&&(t="l"),t}function zk(e,t,n,r){var i=n.lnStyleXMLDescription;return i||(i=n.lnStyleXMLDescription=Object.freeze(function(e,t,n){var r,i,a=[],o=Ok(e,t,n),s=o.allShape,c=o.placeHolderType,u=T(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.childElementOptional(new Zy("p:spPr","p:grpSpPr"));if(h){var d=h.childElementOptional("a:ln");d&&a.push(d)}var p=l.childElementOptional("p:style");if(p){var f=vb(p,t);f.ln.xml&&a.push(f.ln.xml),r=f.ln.phClr}}}catch(e){u.e(e)}finally{u.f()}return{shapeStyleXMLList:a,placeHolderType:c,placeHolderColor:r}}(e,t,r))),i}function Bk(e,t,n,r){var i=n.fillStyleXMLDescription;return i||(i=n.fillStyleXMLDescription=Object.freeze(function(e,t,n){var r,i,a=[],o=Ok(e,t,n),s=o.allShape,c=o.placeHolderType,u=T(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.childElementOptional(new Zy("p:spPr","p:grpSpPr"),m(Zy,pb));h&&a.push(h);var d=l.childElementOptional("p:style");if(d){var p=vb(d,t);p.fill.xml&&a.push(p.fill.xml),r=p.fill.phClr}}}catch(e){u.e(e)}finally{u.f()}return{shapeStyleXMLList:a,placeHolderType:c,placeHolderColor:r}}(e,t,r))),i}var Uk,Vk=function(e,t,n,r,i){var a,o=T(Ok(e,t,i).allShape);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("p:spPr",n);if(s)return s}}catch(e){o.e(e)}finally{o.f()}},Wk=function(e,t,n,r,i){if(e.attr.getBoolean("useBgFill",!1)){var a=e.parentElement("p:cSld");if(a){var o=a.extraAttr.getColorOptional("backgroundColor");if(o)return o}}var s,c=Bk(e,t,r,i),u=T(c.shapeStyleXMLList);try{for(u.s();!(s=u.n()).done;){var l=s.value;return new Ib(c.placeHolderColor).read(l,t)||void 0}}catch(e){u.e(e)}finally{u.f()}},Hk=function(e,t,n,r,i){var a,o=zk(e,t,r,i),s=T(o.shapeStyleXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value.childElementOptional(m(Zy,pb));if(c){var u=new Ib(o.placeHolderColor).read(c,t);if(u)return u}}}catch(e){s.e(e)}finally{s.f()}return yb},_k=function(e,t,n,r,i){var a,o=T(zk(e,t,r,i).shapeStyleXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s&&s.attr.has("w")){var c=s.attr.getNumber("w");return c>Dk?c:Dk}}}catch(e){o.e(e)}finally{o.f()}return Dk},Gk=function(e,t,n,r,i){var a,o=T(zk(e,t,r,i).shapeStyleXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("a:prstDash");if(s&&s.attr.has("val"))return s.attr.getString("val")}}catch(e){o.e(e)}finally{o.f()}return"solid"},Yk=function(e,t,n,r,i){var a=_k(e,t,n,r,i)/Ly;switch(Gk(e,t,n,r,i)){case"solid":default:return"0";case"dash":return"".concat(5*a);case"dashDot":return" ".concat(5*a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"dot":return"".concat(a,",  ").concat(5*a);case"lgDash":return"".concat(2*a,", ").concat(a);case"lgDashDot":return"".concat(10*a,", ").concat(5*a,", ").concat(a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"sysDash":return"".concat(5*a,", ").concat(2*a);case"sysDashDot":return"".concat(5*a,", ").concat(2*a,", ").concat(a,", ").concat(5*a);case"sysDashDotDot":return"".concat(5*a,", ").concat(2*a,", ").concat(a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"sysDot":return"".concat(2*a,", ").concat(5*a)}},Xk=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).isRender=!1,r.state={dataUrl:""};var i=e.xlinkHref||e.href;return i&&Ab.addLoadTask(i),r}return P(n,[{key:"componentDidMount",value:function(){this.isRender=!0,this.loadImage()}},{key:"getSnapshotBeforeUpdate",value:function(e){var t=this.props,n=t.xlinkHref,r=t.href,i=n||r;return!((e.xlinkHref||e.href)===i||!i)&&(Ab.addLoadTask(i),!0)}},{key:"componentDidUpdate",value:function(e,t,n){n&&this.loadImage()}},{key:"componentWillUnmount",value:function(){this.isRender=!1}},{key:"updateImageState",value:function(e,t){this.isRender&&this.setState({dataUrl:e},t)}},{key:"loadImage",value:function(){var e=this,t=this.props,n=t.xlinkHref,r=t.href,i=n||r;i&&Ab.loadImage(i).then((function(t){e.updateImageState(t,(function(){Ab.endLoadTask(i)}))})).then((function(){}),(function(){}))}},{key:"render",value:function(){var e=this.state.dataUrl,t=this.props,n=t.innerref,r=t.vertTextType,i=t.width,a=t.height,o=t.x,s=t.y,c=t.opacity,u=t.clipPath,l=t.preserveAspectRatio;if(e){var h={};r&&(h.transform="scale(".concat(i/a,", ").concat(a/i,") rotate(270deg)"),h.transformOrigin="center");var d={xlinkHref:e,href:e,width:By(i),height:By(a),opacity:c,clipPath:u,preserveAspectRatio:l,x:o,y:s};return iy.default.createElement("image",Ny(Ry({},d),{style:h,ref:n}))}return null}}]),n}(iy.default.Component),Qk=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).pathElements={},r.imageElement=ry.default.createRef();var i=e.shapeXML;return r.spId=e.spId,r.graphType="p:sp"===e.shapeXML.name?"shape":"connection",r.prestGeomXML=i.extraElementWithName("a:prstGeom"),r.custGeomXML=i.extraElementWithName("a:custGeom"),r.svgLoadingMonitor=new Tk(e.logger).createMonitor(),r}return P(n,[{key:"getCssVaribleColor",value:function(e){switch(e){case mb.Darken:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.6),var(--sp-fill-a))";case mb.DarkenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.8),var(--sp-fill-a))";case mb.Lighten:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.4),var(--sp-fill-a))";case mb.LightenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.2),var(--sp-fill-a))";default:return"hsla(var(--sp-fill-h),var(--sp-fill-s),var(--sp-fill-l),var(--sp-fill-a))"}}},{key:"updateFillColor",value:function(e){var t,n,r,i=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=[],s=0;if(e instanceof wb)o=e.getColors(),s=e.getRotation(),n=e.getGradientPath(),t="url(#".concat(this.identification(),"-gradient-fill)");else if(e instanceof kb)r=e.getResId();else if(e instanceof bb){var c=this.props.groupFillColor;t=Pb(c)}else t=Pb(e);if(a&&(Object.keys(this.pathElements).forEach((function(e){var n=i.pathElements[e];n&&t&&(void 0!==r?n.setAttribute("fill","none"):n.setAttribute("fill",t))})),this.imageElement.current&&e)){var u=e.getAlphaModFix();this.imageElement.current.setAttribute("opacity",u.toString())}return{path:n,imageResId:r,colorStops:o,rotation:s,fillColor:t}}},{key:"identification",value:function(){var e=this.props,t=e.slideIndex,n=e.spId;return"".concat(t,"-").concat(n,"-")}},{key:"injectAdjustValue",value:function(e,t){var n=e.childElementOptional("a:avLst");n&&n.elementsWithName("a:gd").forEach((function(e){var n=e.attr.getString("fmla"),r=new ik(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}))}},{key:"renderSVG",value:function(e,t,n,r){var i,a=null,o=null,s=this.props,c=s.shapeXML,u=s.width,l=s.height,h=s.fillColor,d=s.resourceLoader,p=s.resourceType,f=s.borderStyle,v=s.vertTextType,m=null==(i=c.childElementOptional("p:nvSpPr","p:cNvSpPr"))?void 0:i.attr.getBooleanOptional("txBox"),g=c.childElementOptional("p:spPr","a:blipFill","a:stretch","a:fillRect"),y=(g?g.attr.getNumber("l",0)/Dy:0)*u,b=(g?g.attr.getNumber("b",0)/Dy:0)*l,k=(g?g.attr.getNumber("r",0)/Dy:0)*u,w=(g?g.attr.getNumber("t",0)/Dy:0)*l;if(r){var S=h.getAlphaModFix();m||(a=ry.default.createElement("clipPath",{id:"clippath-".concat(this.identification())},e));var x=d.loadURL(p,r);o=ry.default.createElement(Xk,{innerref:this.imageElement,xlinkHref:x,vertTextType:v,href:x,width:u-k-y,height:l-b-w,x:By(y),y:By(w),opacity:S,clipPath:"url(#clippath-".concat(this.identification(),")"),preserveAspectRatio:"none"})}var C,I,P="connection"===this.graphType&&f.color||"shape"===this.graphType;return C=Vy(l)/jy<1?"1px":By(l),I=Vy(u)/jy<1?"1px":By(u),P?ry.default.createElement("svg",{style:{position:"absolute",width:I,height:C,overflow:"visible"}},ry.default.createElement("defs",null,a,t,ry.default.createElement("marker",{id:"".concat(this.identification(),"-arrow-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:1.5*n,markerHeight:1.5*n,stroke:Pb(f.color),fill:Pb(f.color),orient:"auto"},ry.default.createElement("path",{d:"M 1 0 L 10 5 L 1 10 L 0 9 L 7.18 5 L 0 1 Z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-arrow-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:1.5*n,markerHeight:1.5*n,stroke:Pb(f.color),fill:Pb(f.color),orient:"auto"},ry.default.createElement("path",{d:"M 9 0 L 0 5 L 9 10 L 10 9 L 2.82 5 L 10 1 L 9 0 Z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-triangle-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-triangle-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("path",{d:"M 10 0 L 0 5 L 10 10 z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-stealth-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("path",{d:"M 0 0 L 10 5 L 0 10 L 3 5 z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-stealth-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("path",{d:"M 10 0 L 0 5 L 10 10 L 7 5 z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-diamond-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-diamond-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-oval-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-oval-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},ry.default.createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:Pb(f.color)})),ry.default.createElement("marker",{id:"".concat(this.identification(),"-none")})),o,e):null}},{key:"render",value:function(){var e,t,n=this;this.pathElements={};var r,i=this.props,a=i.width,o=i.height,s=i.shapeXML,c=i.fillColor,u=i.borderStyle,l=i.children,h=new xk({w:a,h:o}),d="";if(this.prestGeomXML){var p=this.prestGeomXML.attr.getString("prst");this.injectAdjustValue(this.prestGeomXML,h),r=Pk(p)}else this.custGeomXML?(r=this.custGeomXML,d="a:"):r=Pk("rect");var f=yk.none,v=yk.none,m=s.childElementOptional("p:spPr","a:ln","a:headEnd"),g=s.childElementOptional("p:spPr","a:ln","a:tailEnd"),y=(null==(e=null==m?void 0:m.parent)?void 0:e.attr.getNumber("w",Dk))||(null==(t=null==g?void 0:g.parent)?void 0:t.attr.getNumber("w",Dk))||Dk,b=Math.max(y/jy*3,10);if(m){var k=m.attr.getString("type","none");f=Mk(k)}if(g){var w=g.attr.getString("type","none");v=Mk(w)}var S=this.updateFillColor(c,!1),x=S.fillColor,C=S.colorStops,I=S.imageResId,P=S.path,M=null;C.length>0&&(M=P?ry.default.createElement("radialGradient",{id:"".concat(this.identification(),"-gradient-fill")},C.map((function(e,t){return ry.default.createElement("stop",{key:"index-".concat(t),offset:e.stop,stopColor:Pb(e.color)})}))):ry.default.createElement("linearGradient",{id:"".concat(this.identification(),"-gradient-fill")},C.map((function(e,t){return ry.default.createElement("stop",{key:"index-".concat(t),offset:e.stop,stopColor:Pb(e.color)})}))));var T=(new Ck).renderLumiaPath(r,h,d).map((function(e,t){var r="none"!==e.fill?x:"none",i=e.isBorder?Pb(u.color):"none";0===C.length&&(x&&e.fill&&(r=Mb(x,e.fill)),!s.childElementOptional("p:spPr","a:ln","a:solidFill")&&"none"!==x&&(i=Mb(i,mb.Darken)));var c={};return"none"!==e.fill&&0===C.length&&(c.fill=n.getCssVaribleColor(e.fill)),ry.default.createElement("path",{ref:function(e){n.pathElements[t.toString()]=e},key:"path".concat(t),d:e.pathD,style:c,fill:I?"none":r,height:By(o),width:By(a),stroke:i,strokeWidth:By(u.width),strokeDasharray:u.strokeDashArray,markerStart:"url(#".concat(n.identification(),"-").concat(yk[f],"-start)"),markerEnd:"url(#".concat(n.identification(),"-").concat(yk[v],"-end)")})})),A=h.accessValue("rectLeft"),E=h.accessValue("rectTop"),O=h.accessValue("rectRight")-h.accessValue("rectLeft"),R=h.accessValue("rectBottom")-h.accessValue("rectTop"),N=ry.default.Children.map(l,(function(e){return ry.default.cloneElement(e,{left:A,right:E,width:O,height:R})}));return ry.default.createElement(ry.default.Fragment,null,N,this.renderSVG(T,M,b,I))}}]),n}(ry.default.Component),Kk=["textPlain"];!function(e){e.textNoShape="textNoShape",e.textPlain="textPlain",e.textRingInside="textRingInside",e.textRingOutside="textRingOutside"}(Uk||(Uk={}));var qk=function(e){g(n,e);var t=b(n);function n(e){var r,i;C(this,n),(r=t.call(this,e)).contentWidth=0,r.fontRowCount=0;var o=e.textBodyWrapResource;r.gbDataList=e.shapeGuideList.map((function(e){return a({},e.attr.getString("name"),e.attr.getString("fmla"))})),r.textContent=null==(i=e.textBodyWrapResource.paragraphs[0].runs)?void 0:i.map((function(e){return e.text})).join(""),r.height=Wy(o.prop.height),r.width=Wy(o.prop.width);var s=0;return o.paragraphs.forEach((function(e){r.fontRowCount+=e.lines.length,e.lines.forEach((function(e){var t=0;e.forEach((function(e){t+=parseInt(e.prop.width,10),s||(s=e.prop.lineSpacing),r.fontSize||(r.fontSize=Wy(e.prop.size))})),r.contentWidth=Math.max(r.contentWidth,t)}))})),r.contentHeight=Hy((r.fontRowCount-1)*s+r.fontSize||r.fontSize),r}return P(n,[{key:"textNoShape",value:function(){var e=this,t={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(this.height,"pt"),width:"".concat(this.width,"pt"),justifyContent:"center",alignItems:"center"},n=this.height,r=this.width,i=this.contentWidth,a=this.contentHeight,o=Number.isNaN(r/i)?1:Hy(r/i),s=Number.isNaN(n/a)?1:Hy(n/a),c={margin:0,padding:0,fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),width:"".concat(this.fontSize,"pt"),display:"inline-block"},u=this.props.textBodyWrapResource;return ny.default.createElement("div",{style:t},ny.default.createElement("div",{ref:function(t){e.spanRef=t},style:{whiteSpace:"initial",transform:"scaleX(".concat(o,") scaleY(").concat(s,")")}},u.paragraphs.map((function(e,t){var n;return ny.default.createElement("span",{key:t,style:{whiteSpace:"initial"}},null==(n=e.lines)?void 0:n.map((function(e,t){return ny.default.createElement(ny.default.Fragment,null,e.map((function(e){var n;return null==(n=e.text)?void 0:n.split("").map((function(e,n){return ny.default.createElement("pre",{style:c,key:"".concat(t,"-").concat(n)},e)}))})),ny.default.createElement("br",null))})))}))))}},{key:"textRing",value:function(e){var t,n,r,i=this,a=Math.atan(this.height/this.width),o=180*a/Math.PI,s=6e4;(null==(t=this.gbDataList[0])?void 0:t.adj)&&(s=ik.deconstructShapeGuide(this.gbDataList[0].adj));var c=200,u=100,l=(1-zy(s)*u)/this.fontSize;if(!(null==(n=this.textContent)?void 0:n.length))return this.textNoShape();var h=this.textContent.length;return ny.default.createElement("div",{style:{display:"inline-block",position:"relative",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(u,"pt"),width:"".concat(c,"pt"),transform:"scale(".concat(this.width/c,", ").concat(this.height/u/(Math.cos(a/180)*Math.PI),")")}},ny.default.createElement("div",{style:{transformStyle:"preserve-3d",height:"".concat(u,"pt"),width:"".concat(c,"pt"),transform:"rotateX(".concat(-o,"deg)")}},null==(r=this.textContent)?void 0:r.split("").map((function(t,n){return ny.default.createElement("span",{style:{position:"absolute",lineHeight:"".concat(i.fontSize,"pt"),left:"".concat(100-i.fontSize/2,"pt"),top:"".concat((u-i.fontSize)/2,"pt"),transform:e(n,h,l)},key:n},t)}))))}},{key:"textRingInside",value:function(){return this.textRing((function(e,t,n){return"rotateY(".concat(70-340/t*e,"deg) translateZ(").concat(-100,"pt) scaleY(").concat(n,")")}))}},{key:"textRingOutside",value:function(){return this.textRing((function(e,t,n){return"rotateY(".concat(320*e/(t-1)-60,"deg) translateZ(",100,"pt) scaleY(").concat(n,")")}))}},{key:"textPlain",value:function(){var e=this,t=this.gbDataList[0]?ik.deconstructShapeGuide(this.gbDataList[0].adj):5e4,n=this.width,r=this.height,i=zy(t),a=i>.5?(2*i-1)*n:(1-2*i)*n,o=Math.atan(a/r),s=180*o/Math.PI;i<.5&&(s=-s);var c={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"0, 0",height:"".concat(r,"pt"),width:"".concat(n,"pt"),justifyContent:"center",alignItems:"center"},u={display:"block",lineHeight:"".concat(this.fontSize,"pt"),textAlign:"center"},l={display:"inline-block",fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),transformOrigin:"50% 0",margin:0,padding:"0"},h=this.contentWidth,d=this.contentHeight,p=Number.isNaN(n/h)?1:Hy(n)/(h+Math.tan(o)*Hy(r)),f=Number.isNaN(r/d)?1:Hy(r/d),v=0,m=this.props.textBodyWrapResource;return ny.default.createElement("div",{style:Ry({},c)},ny.default.createElement("div",{ref:function(t){e.spanRef=t},style:Ny(Ry({},u),{whiteSpace:"initial",transform:"skew(".concat(s,"deg) scaleY(").concat(f,") scaleX(").concat(p,")")})},m.paragraphs.map((function(t,n){var r;return ny.default.createElement("div",{key:"wordart-".concat(n),style:Ny(Ry({},u),{whiteSpace:"initial"})},null==(r=t.lines)?void 0:r.map((function(n,r){var i=1===e.fontRowCount?e.fontSize:n[0].prop.lineSpacing,a={};return(0===v||v===e.fontRowCount-1)&&(i=(i+e.fontSize)/2,a.display="flex",v===e.fontRowCount-1&&(a.alignItems="flex-end")),"l"===t.prop.align||"just"===t.prop.align?a.justifyContent="flex-start":"r"===t.prop.align?a.justifyContent="flex-end":"dist"===t.prop.align?a.justifyContent="space-between":"ctr"===t.prop.align&&(a.justifyContent="center"),v+=1,ny.default.createElement("div",{key:n[0].text+r.toString(),style:Ry({whiteSpace:"nowrap",lineHeight:"".concat(i,"pt")},a)},n.map((function(e){var t;return null==(t=e.text)?void 0:t.split("").map((function(t,n){return ny.default.createElement("pre",{style:Ny(Ry({},l),{fontFamily:e.prop.font}),key:n},t)}))})),ny.default.createElement("br",null))})))}))))}},{key:"render",value:function(){var e=this.props.presetType;return this[e]?this[e]():this.textNoShape()}}]),n}(ny.default.Component),Zk=function(){function e(){C(this,e),this.indexByLevel=new Map,this.startAtByLevel=new Map}return P(e,[{key:"get",value:function(e,t,n){var r=e.extraAttr.getNumber("level");if(this.indexByLevel.has(r)||(this.indexByLevel.set(r,0),this.startAtByLevel.set(r,-1)),t!==this.startAtByLevel.get(r))this.indexByLevel.set(r,0),this.startAtByLevel.set(r,t);else{var i=this.indexByLevel.get(r);n&&(i+=1,this.indexByLevel.set(r,i))}return this.indexByLevel.get(r)}},{key:"reset",value:function(){this.indexByLevel=new Map,this.startAtByLevel=new Map}}]),e}(),Jk=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).buIndexCounter=new Zk,r.paragraphBulletInfo=[],r.numCol=1;var i=r.props,a=i.txBodyXML,o=i.textBodyWrapResource,s=i.flipH,c=i.flipV,u=i.insideTable,l=i.totalPadding,h=i.height,d=i.width,p=i.right,f=i.left;r.bodyPrXML=a.childElement("a:bodyPr"),r.paragraphXMLs=a.elementsWithName("a:p");var v=r.bodyPrXML.childElementOptional("a:prstTxWarp");v&&(r.presetType=v.attr.getString("prst","textNoShape"));var m=r.bodyPrXML.extraAttr.getString("anchor","t"),g=r.bodyPrXML.extraAttr.getString("wrap","square");r.isTextWrap="square"===g,r.spcFirstLastPara=r.bodyPrXML.extraAttr.getBoolean("spcFirstLastPara",!1),r.anchorCtr=r.bodyPrXML.extraAttr.getBoolean("anchorCtr",!1),r.numCol=r.bodyPrXML.extraAttr.getNumber("numCol",1);var y,b=0,k=0;if(o){var w=o.prop;r.vert=w.vert,r.paddingLeft=w.lIns*jy,r.paddingRight=w.rIns*jy,b=w.tIns*jy,k=w.bIns*jy}else r.vert=Yb(a),r.paddingLeft=r.bodyPrXML.extraAttr.getNumber("lIns",91440),r.paddingRight=r.bodyPrXML.extraAttr.getNumber("rIns",91440),b=r.bodyPrXML.extraAttr.getNumber("tIns",45720),k=r.bodyPrXML.extraAttr.getNumber("bIns",45720);return s!==c&&(y="scale(-1, 1)"),r.rectStyle=u?{position:"relative",left:0,top:0,width:By(d),paddingTop:By(b-l/2),paddingBottom:By(k-l/2),height:"calc(100% - ".concat(By(l),")"),transform:y}:{position:"absolute",left:By(void 0===f?0:f),top:By(void 0===p?0:p),width:By(d),height:By(h),transform:y},r.rectStyle=Ry({display:"inline-flex",flexDirection:"column",alignItems:r.anchorCtr?"center":"flex-start",justifyContent:Rb(m),zIndex:9999,paddingLeft:By(r.paddingLeft),paddingTop:By(b),paddingRight:By(r.paddingRight),paddingBottom:By(k),boxSizing:"border-box",whiteSpace:r.isTextWrap?"normal":"nowrap"},r.rectStyle),r.updateRectStyleByWrapResource(),r.generateParagraphBulletInfo(),r}return P(n,[{key:"updateRectStyleByWrapResource",value:function(){var e=this.props.textBodyWrapResource;if(void 0!==e){var t=e.prop.anchor;this.rectStyle=Ny(Ry({},this.rectStyle),{justifyContent:Rb(t)}),this.rectStyle=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;switch(n){case Vb.EaVert:return Ny(Ry({},r),{writingMode:_b(n)});case Vb.WordArtVert:case Vb.WordArtVertRtl:return Ny(Ry({},r),{writingMode:_b(n),textOrientation:"upright"});case Vb.Vert:var a=Gb(i,r,n),o=null!=(e=r.transform)?e:"";return Ny(Ry(Ry({},r),a),{position:"absolute",minHeight:i.insideTable?void 0:a.height,paddingLeft:r.paddingBottom,paddingTop:r.paddingLeft,paddingRight:r.paddingTop,paddingBottom:r.paddingRight,transform:"".concat(o," rotate(90deg)")});case Vb.Vert270:var s=Gb(i,r,n),c=null!=(t=r.transform)?t:"";return Ny(Ry(Ry({},r),s),{position:"absolute",minHeight:i.insideTable?void 0:s.height,paddingLeft:r.paddingTop,paddingTop:r.paddingRight,paddingRight:r.paddingBottom,paddingBottom:r.paddingLeft,transform:"".concat(c," rotate(-90deg)")});default:return r}}(this.vert,this.rectStyle,this.props)}}},{key:"generateParagraphBulletInfo",value:function(){var e=this.props.textBodyWrapResource;if(void 0!==e){var t=e.paragraphs.map((function(e){var t,n;return{autoNumber:null==(t=e.prop.bulletChar)?void 0:t.autoNumber,autoNumberType:null==(n=e.prop.bulletChar)?void 0:n.autoNumberType,level:e.prop.level,empty:0===e.lines.length}})),n=[0,0,0,0,0,0,0,0,0];this.paragraphBulletInfo=t.map((function(e,r){var i=e.level,a=e.autoNumberType;if(n=n.map((function(e,t){return t>i?0:t===i?a?e:0:e})),a){var o=e.autoNumber;if(r>0&&t[r-1].autoNumber!==o&&(n[i]=0),e.empty)return{order:r,count:t.length};var s=n[i];return n[i]=s+1,{number:s+(o||1),order:r,count:t.length}}return{order:r,count:t.length}}))}}},{key:"renderParagraph",value:function(e,t,n,r,i,a,o,s){var c=null==e?void 0:e.elements.find((function(e){return"a:r"===e.name})),u=this.props,l=u.slideContext,h=u.width,d=u.height,p=u.uuid,f=u.resourceType,v=u.withAnimation,m=u.textBodyWrapResource;return mv.default.createElement(tk,{key:"".concat(n),slideContext:l,isTextWrap:o,width:h,height:d,paragraphIndex:n,firstRangeXML:c,buIndexCounter:this.buIndexCounter,paragraphXML:e,bodyPrXML:t,uuid:p,round:0,spcFirstLastPara:r,isFirst:i,isLast:a,vert:this.vert,resourceType:f,paragraphWrapResource:s,textBodyWrapResource:m,withAnimation:!!v,bulletInfo:this.paragraphBulletInfo[n]})}},{key:"render",value:function(){var e=this,t=this.props,n=t.textBodyWrapResource,r=t.width;if(this.presetType&&this.presetType!==Uk.textNoShape&&Kk.includes(this.presetType)&&n){var i=this.bodyPrXML.childElementOptional("a:prstTxWarp"),a=null==i?void 0:i.childElementOptional("a:avLst"),o=(null==a?void 0:a.elementsWithName("a:gd"))||[];return mv.default.createElement("div",{style:Ny(Ry({},this.rectStyle),{display:"flex",justifyContent:"center",alignItems:"center",padding:0}),className:"txBody"},mv.default.createElement(qk,{presetType:this.presetType,shapeGuideList:o,textBodyWrapResource:n}))}var s,c=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vb.Horz)!==Vb.Horz?{maxHeight:"100%",width:void 0}:{}}(this.vert);return s=n?n.paragraphs.map((function(t,r){return e.renderParagraph(void 0,void 0,r,e.spcFirstLastPara,0===r,r===n.paragraphs.length-1,e.isTextWrap,t)})):this.paragraphXMLs.map((function(t,n){return e.renderParagraph(t,e.bodyPrXML,n,e.spcFirstLastPara,0===n,n===e.paragraphXMLs.length-1,e.isTextWrap)})),this.buIndexCounter.reset(),mv.default.createElement("div",{className:"txBoby",style:this.rectStyle},mv.default.createElement("ol",{style:Ry({width:By(r-this.paddingLeft-this.paddingRight),marginBlockEnd:0,marginBlockStart:0,paddingBlockStart:0,paddingBlockEnd:0,marginInlineEnd:0,marginInlineStart:0,paddingInlineStart:0,paddingInlineEnd:0,margin:0,padding:0,whiteSpace:this.isTextWrap?"normal":"nowrap",columnCount:1===this.numCol?void 0:this.numCol},c)},s))}}]),n}(mv.default.Component),$k=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"renderCol",value:function(e,t,n,r,i,a){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=function(){var e;return(e=[]).concat.apply(e,arguments).reduce((function(e,t){return e+t}),0)},u=e.childElementOptional("a:tcPr");if(!u)return null;var l,h=u.extraAttr.getColor("".concat(t,"-").concat(n,"-fillColor"),yb);l=h instanceof wb?h.getGradientStyles():Pb(h);var d=u.extraAttr.getStringOptional("".concat(t,"-").concat(n,"-fontFamily")),p=u.extraAttr.getBoolean("".concat(t,"-").concat(n,"-isBold"),!1),f=u.extraAttr.getBoolean("".concat(t,"-").concat(n,"-isItalic"),!1),v=u.extraAttr.getString("".concat(t,"-").concat(n,"-bottomBorderStyle"),"none"),m=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-bottomBorderWidth"),0),g=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-bottomBorderColor"),yb),y=u.extraAttr.getString("".concat(t,"-").concat(n,"-topBorderStyle"),"none"),b=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-topBorderWidth"),0),k=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-topBorderColor"),yb),w=u.extraAttr.getString("".concat(t,"-").concat(n,"-leftBorderStyle"),"none"),S=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-leftBorderWidth"),0),x=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-leftBorderColor"),yb),C=u.extraAttr.getString("".concat(t,"-").concat(n,"-rightBorderStyle"),"none"),I=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-rightBorderWidth"),0),P=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-rightBorderColor"),yb),M=e.childElementOptional("a:txBody");if(void 0===M)return null;var T=e.attr.getNumber("gridSpan",1),A=e.attr.getNumber("rowSpan",1),E=e.attr.getBoolean("hMerge",!1),O=e.attr.getBoolean("vMerge",!1),R=c(a.slice(n,n+T)),N="".concat(t,"-").concat(n),L=this.props,j=L.slideContext,D=L.uuid,F=L.shapeWrapResource;return E||O?null:vv.default.createElement("td",{colSpan:T,rowSpan:A,style:{position:"relative",fontFamily:d&&d,fontWeight:p?500:400,fontStyle:f?"italic":"normal",borderBottomStyle:v,borderTopStyle:y,borderLeftStyle:w,borderRightStyle:C,borderBottomWidth:By(m),borderTopWidth:By(b),borderLeftWidth:By(S),borderRightWidth:By(I),borderBottomColor:Pb(g),borderTopColor:Pb(k),borderLeftColor:Pb(x),borderRightColor:Pb(P),width:By(R),height:By(i),background:l,boxSizing:"border-box",fontSize:0,lineHeight:0},key:"tc-".concat(t,"-").concat(n),className:"tc-".concat(t,"-").concat(n)},vv.default.createElement(Jk,{slideContext:j,insideTable:!0,width:R,height:i,totalPadding:s,uuid:D,txBodyXML:M,resourceType:"slide",textBodyWrapResource:null==(o=null==F?void 0:F.textBodyMap)?void 0:o[N]}))}},{key:"render",value:function(){var e=this,t=this.props.graphXML.childElementOptional("a:graphic","a:graphicData","a:tbl"),n=t&&t.childElement("a:tblGrid"),r=n?n.elementsWithName("a:gridCol"):[],i=t?t.elementsWithName("a:tr"):[],a=i.length,o=0;if(a>0){var s=0;i.forEach((function(e,t){if(0===t){var n=0;e.elementsWithName("a:tc").forEach((function(e,r){var i=e.childElement("a:tcPr").extraAttr.getNumber("".concat(t,"-").concat(r,"-topBorderWidth"),0);n=Math.max(i,n)})),s+=n}var r=0;e.elementsWithName("a:tc").forEach((function(e,n){var i=e.childElement("a:tcPr").extraAttr.getNumber("".concat(t,"-").concat(n,"-bottomBorderWidth"),0);r=Math.max(i,r)})),s+=r})),o=s/a}var c=i.map((function(t,n){var i=t.attr.getNumber("h"),a=t.elementsWithName("a:tc").map((function(e,t){return r[t].attr.getNumber("w")})),s=t.elementsWithName("a:tc").map((function(t,s){var c=r[s].attr.getNumber("w");return e.renderCol(t,n,s,c,i,a,o)}));return vv.default.createElement("tr",{key:"tr-"+n},s)}));return vv.default.createElement("table",{style:{borderCollapse:"collapse"},cellSpacing:"0",cellPadding:"0"},vv.default.createElement("tbody",null,c))}}]),n}(vv.default.Component),ew=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new Tk(e.logger).createMonitor(),r}return P(n,[{key:"getId",value:function(){var e=this.props.graphXML,t=e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getStringOptional("id");return t?"spId".concat(t):e.parent&&"mc:Choice"===e.parent.name?this.getResId():void 0}},{key:"getResId",value:function(){var e,t=null==(e=this.props.graphXML.parent)?void 0:e.parent;if(t){var n=t.childElementOptional("mc:Fallback","p:pic","p:blipFill","a:blip");return n?n.attr.getStringOptional("r:embed"):void 0}}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return r?t.resourceLoader.loadURL(n,r):void 0}},{key:"render",value:function(){if(!this.url)return null;var e=this.props,t=e.width,n=e.height;return ay.default.createElement("img",{src:this.url,alt:"graph",style:{width:By(t),height:By(n)},ref:this.imageLoadingMonitor})}}]),n}(ay.default.Component),tw=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new Tk(e.logger).createMonitor(),r}return P(n,[{key:"getId",value:function(){return this.props.graphXML.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return t.resourceLoader.loadURL(n,"spId".concat(r))}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return oy.default.createElement("img",{src:this.url,alt:"diagram",style:{width:By(t),height:By(n)},ref:this.imageLoadingMonitor})}}]),n}(oy.default.Component),nw=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"render",value:function(){return sy.default.createElement("div",null)}}]),n}(sy.default.PureComponent),rw=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new Tk(e.logger).createMonitor(),r}return P(n,[{key:"getId",value:function(){return this.props.graphXML.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return t.resourceLoader.loadURL(n,"spId".concat(r))}},{key:"render",value:function(){if(this.url){var e=this.props,t=e.width,n=e.height;return cy.default.createElement("img",{src:this.url,alt:"oleGraph",style:{width:By(t),height:By(n)},ref:this.imageLoadingMonitor})}return cy.default.createElement("div",null)}}]),n}(cy.default.Component),iw=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n);var i=(r=t.call(this,e)).props.graphXML;return r.uri=i.childElement("a:graphic","a:graphicData").attr.getStringOptional("uri"),r}return P(n,[{key:"subGraphClassWithURI",value:function(e){switch(e){case"http://schemas.openxmlformats.org/drawingml/2006/table":return $k;case"http://schemas.microsoft.com/office/drawing/2014/chartex":case"http://schemas.openxmlformats.org/drawingml/2006/chart":return ew;case"http://schemas.openxmlformats.org/drawingml/2006/diagram":return tw;case"http://schemas.openxmlformats.org/presentationml/2006/ole":return rw;default:return console.debug("Unsupported graph",e),nw}}},{key:"render",value:function(){var e,t,n=this.props,r=n.shapeGroupTransform,i=n.width,a=n.height,o=this.subGraphClassWithURI(this.uri);r?(e=i*r.scaleX,t=a*r.scaleY):(e=i,t=a);var s=Ny(Ry({},this.props),{height:t,width:e});return fv.default.createElement(o,Ry({},s))}}]),n}(fv.default.Component),aw=function(e){var t=e.startTime,n=e.endTime,r=e.duration;return t&&(r-=t),n&&(r-=n),r},ow=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).state={total:aw(e)},r}return P(n,[{key:"componentDidMount",value:function(){var e=this.props.protalId;this.controllerPortal=document.getElementById(e)}},{key:"onPlayClick",value:function(e){var t=this.props.onPlayClick;e.stopPropagation(),t()}},{key:"onPauseClick",value:function(e){var t=this.props.onPauseClick;e.stopPropagation(),t()}},{key:"onBarClick",value:function(e){var t=this.props,n=t.duration,r=t.startTime,i=t.endTime,a=t.onSeekClick;if(e.stopPropagation(),n){var o=this.props.duration;r&&(o-=r),i&&(o-=i);var s=e.nativeEvent.offsetX/e.currentTarget.clientWidth*o;r&&(s+=r),a(Math.floor(s))}}},{key:"computedCurrent",value:function(){var e=this.props.startTime,t=this.props.currentTime,n=this.state.total;return e&&(t>e?t-=e:t=0),t>n&&(t=n),t}},{key:"formatTime",value:function(e){var t="00:00";if(e){var n=Math.floor(e/60),r=String(n<0?0:n).padStart(2,"0"),i=Math.floor(e%60),a=String(i<0?0:i).padStart(2,"0");t="".concat(r,":").concat(a)}return t}},{key:"renderController",value:function(e){var t=this.props,n=t.display,r=t.style,i=t.controllerRef,a=t.resourceLoader,o=t.playing,s=this.state.total;return ly.default.createElement("div",{className:"ppt-event-source",style:Ry({background:"#FFFFFF",borderRadius:50,height:50,width:300,display:n?"flex":"none",flexDirection:"row",alignItems:"center"},r),ref:i},ly.default.createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:o?"none":"block"},onClick:this.onPlayClick.bind(this)},ly.default.createElement("img",{style:{height:20},alt:"play",src:a.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/play.png")})),ly.default.createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:o?"block":"none"},onClick:this.onPauseClick.bind(this)},ly.default.createElement("img",{style:{height:20},alt:"pause",src:a.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/pause.png")})),ly.default.createElement("div",{style:{width:100},className:"timer"},ly.default.createElement("span",{className:"current"},this.formatTime(this.computedCurrent())),ly.default.createElement("span",null,"/"),ly.default.createElement("span",{className:"total"},this.formatTime(s))),ly.default.createElement("div",{className:"ppt-event-source",style:{flex:1,position:"relative",marginRight:10},onMouseDown:this.onBarClick.bind(this)},ly.default.createElement("div",{style:{background:"#D9D9D9",position:"relative",height:10,display:"flex"},className:"total"},ly.default.createElement("div",{style:{background:"#4F4F4F",top:0,left:0,height:10,flex:e},className:"played"}))))}},{key:"render",value:function(){var e=this.props,t=e.duration,n=e.endTime,r=e.currentTime,i=e.playing,a=e.onMediaEnd,o=this.state.total;n&&(t>0&&r+n>=t&&i&&a());var s=0;return t&&(s=this.computedCurrent()/o),this.controllerPortal?(0,hy.createPortal)(this.renderController(s),this.controllerPortal):this.renderController(s)}}],[{key:"getDerivedStateFromProps",value:function(e){return{total:aw(e)}}}]),n}(ly.default.Component),sw=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).videoIntervalId=void 0,r.lastAnimeState={stop:0,play:0},r.player=uy.default.createRef(),r.controller=uy.default.createRef(),e.mediaState?r.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:r.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var i=r.state.playing,a=r.props,o=a.mediaSlideActionUserIds,s=a.userId;return i&&r.hasControl(o,s)&&r.syncPlayTimeLoop(),r}return P(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.targetID;null==window||window.addEventListener("message",(function(n){"_changeAudioState"===n.data.type&&n.data.targetID===t&&e.updateAnimation(n.data)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.disableAnimation,r=t.outsidePausing,i=t.mediaState,a=t.rtcClient,o=this.state.playing;!0!==n&&(r||!e.outsidePausing)?!r||e.outsidePausing?void 0===i||i.playing!==e.mediaState.playing||i.currentTime!==e.mediaState.currentTime?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),void 0===i&&void 0!==e.mediaState?void 0===i&&void 0!==e.mediaState&&(this.player.current&&(this.pauseAudio(),this.player.current.currentTime=e.mediaState.currentTime,!0===e.mediaState.playing?this.playAudio():this.pauseAudio()),this.setState(e.mediaState)):void 0!==i&&void 0!==e.mediaState&&this.player.current&&(i.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(null==a||a.setAudioMixingPosition(Math.floor(1e3*this.player.current.currentTime)))):this.player.current.currentTime=e.mediaState.currentTime,o&&!e.mediaState.playing?this.pauseAudio():!o&&e.mediaState.playing&&this.playAudio(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))):o!==i.playing&&this.setState({playing:i.playing}):this.player.current&&this.playAudio():this.player.current&&this.pauseAudio()}},{key:"onMediaCanPlay",value:function(){var e=this.props,t=e.disableAnimation,n=e.mediaState,r=e.rtcClient;!0===t?this.pauseAudio():n&&n.playing&&(r&&!this.audioMixing||!0===this.player.current.paused&&(this.player.current.currentTime=n.currentTime,this.playAudio()))}},{key:"onMouseOver",value:function(e){var t=this.state.displayController,n=this.props.slideRef;if(!0!==t){var r=e.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.height,s=n.current.getBoundingClientRect(),c=s.x,u=s.y,l=s.width,h=s.height,d=getComputedStyle(this.controller.current),p=l/parseFloat(getComputedStyle(n.current).width),f=0,v=0;null!==d&&null!==d.width&&(f=parseInt(d.width,10)*p),null!==d&&null!==d.height&&(v=parseInt(d.height,10)*p);var m=0,g=0;g=i<c?0:c+l<i+f?l-f:i-c,m=a+o-v<u?0:a+o>u+h?h-v:a+o-u-v,this.setState({displayController:!0,controllerPositionTop:m/p,controllerPositionLeft:g/p})}}},{key:"onMediaPlay",value:function(){var e=this.props,t=e.onMediaPlay,n=e.shapeId,r=this.state.currentTime;t&&t(n,"audio",r)}},{key:"onMediaPause",value:function(){var e=this.props,t=e.onMediaPause,n=e.shapeId,r=this.state.currentTime;this.stopSyncPlayTime(),t&&t(n,"audio",r)}},{key:"stopSyncPlayTime",value:function(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"syncPlayTime",value:function(e){if(this.player.current){var t=this.props,n=t.mediaRef,r=t.onMediaChange,i=t.shapeId,a=this.state.currentTime,o=n.startTime,s=n.endTime,c=e||a,u=this.player.current.duration;s&&(u-=s);var l=c;this.player.current&&c>=u&&(l=o||0),o&&l<o&&(l=o),r({playing:!0,currentTime:l},i)}}},{key:"syncPlayTimeLoop",value:function(e){var t=this;this.props.onMediaChange&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval((function(){t.syncPlayTime()}),1e3))}},{key:"pauseAudio",value:function(){var e=this;this.player.current&&(void 0!==this.props.rtcClient?this.stopMixAudio((function(){return e.player.current.pause()})):this.player.current.pause())}},{key:"stopMixAudio",value:function(e){var t=this,n=this.props,r=n.rtcClient,i=n.logger;r.stopAudioMixing((function(n,r){714===n?(null==i||i.error("rtc mixing error : ".concat(r)),console.error(" stop audio mixing error :",r)):(t.audioMixing=!1,e())}))}},{key:"playLocalAudio",value:function(){var e=this.player.current.play();if(void 0!==e){var t=this.props,n=t.onMediaPlayError,r=t.logger,i=t.shapeId;e.then((function(){})).catch((function(e){r?r.error("play audio exception: ".concat(e)):console.error(e),n&&n(i,"audio",e)}))}}},{key:"playAudio",value:function(){this.player.current&&(void 0!==this.props.rtcClient?this.mixAudio(this.player.current.currentTime,this.playLocalAudio.bind(this)):this.playLocalAudio())}},{key:"mixAudio",value:function(e,t){var n=this,r=this.props,i=r.rtcClient,a=r.audioURL,o=r.logger;this.state.playing?(null==i||i.setAudioMixingPosition(Math.floor(1e3*e)),t()):null==i||i.startAudioMixing(a,!0,!1,1,(function(r,a){714===r?(null==o||o.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(null==i||i.setAudioMixingPosition(Math.floor(1e3*e)),n.audioMixing=!0,t())}))}},{key:"updateAnimation",value:function(e){if(this.player.current){var t=this.props,n=t.startTime,r=t.startTimePerfix,i=this.state.playing;1===e.play&&this.player.current.paused&&(this.player.current.currentTime=n?r+n:r,this.playAudio(),this.setState({playing:!0,currentTime:this.player.current.currentTime})),1===e.stop&&this.player.current&&i&&(this.pauseAudio(),this.setState({playing:!1}))}}},{key:"hasControl",value:function(e,t){var n=this.props.shapeId;return!(!e||void 0===t)&&e[n]===t}},{key:"UNSAFE_componentWillReceivePropseslintreact",value:function(){this.pauseAudio(),this.stopSyncPlayTime(),null==window||window.removeEventListener("_changeAudioState",(function(){}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.resourceLoader,r=t.width,i=t.height,a=t.rtcClient,o=t.audioURL,s=t.logger,c=t.controllerProtalId,u=t.mediaRef,l=this.state,h=l.controllerPositionTop,d=l.controllerPositionLeft,p=l.displayController,f=l.duration,v=l.playing,m=l.currentTime;return uy.default.createElement("div",{style:{position:"relative"},onMouseLeave:function(){return e.setState({displayController:!1})}},uy.default.createElement("img",{className:"ppt-event-source",alt:"audio",src:n.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/audio.png"),style:{width:By(r),height:By(i)},onMouseOver:this.onMouseOver.bind(this)}),uy.default.createElement("audio",{src:o,ref:this.player,muted:!!a,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function(){return e.setState({duration:e.player.current.duration})},onTimeUpdate:function(){return e.setState({currentTime:e.player.current.currentTime})},onLoadedMetadataCapture:function(){"ios"===window.__platform&&e.onMediaCanPlay()},onCanPlay:function(){"ios"!==window.__platform&&e.onMediaCanPlay()},onError:function(e){var t;null!==e.target.error&&(t=e.target.error),void 0!==t?null==s||s.error("load media: ".concat(o," error, code: ").concat(t.code,", message: ").concat(t.message)):null==s||s.error("load media: ".concat(o," error without error message"))}}),uy.default.createElement(ow,{controllerRef:this.controller,protalId:c,style:{position:"absolute",top:h,left:d,zIndex:1},resourceLoader:n,mediaRef:this.player,display:p,playing:v,duration:f,currentTime:m,onPlayClick:function(){e.stopSyncPlayTime(),e.syncPlayTimeLoop()},onPauseClick:function(){var t=e.props,n=t.onMediaChange,r=t.shapeId,i=e.state.currentTime;e.stopSyncPlayTime(),e.pauseAudio(),n&&n({playing:!1,currentTime:i},r)},onSeekClick:function(t){e.stopSyncPlayTime(),e.syncPlayTimeLoop(t)},onMediaEnd:function(){e.stopSyncPlayTime(),e.pauseAudio(),e.setState({playing:!1})},endTime:u.endTime,startTime:u.startTime}))}}]),n}(uy.default.Component),cw=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"identification",value:function(){var e=this.props,t=e.slideIndex,n=e.spId;return"".concat(t,"-").concat(n,"-")}},{key:"injectAdjustValue",value:function(e,t){var n=e.childElementOptional("a:avLst");n&&n.elementsWithName("a:gd").forEach((function(e){var n=e.attr.getString("fmla"),r=new ik(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}))}},{key:"render",value:function(){var e,t=this.props,n=t.shapeXML,r=t.width,i=t.height,a=t.fillColor,o=t.borderStyle,s=t.children,c=n.childElementOptional("p:spPr","a:prstGeom"),u=n.childElementOptional("p:spPr","a:custGeom"),l=new xk({w:r,h:i}),h="";if(c){var d=c.attr.getString("prst");this.injectAdjustValue(c,l),e=Pk(d)}else u?(e=u,h="a:"):e=Pk("rect");var p=(new Ck).renderLumiaPath(e,l,h).map((function(e,t){return py.default.createElement("path",{key:"path".concat(t),d:e.pathD,fill:Pb(a),height:By(i),width:By(r),stroke:Pb(o.color),strokeWidth:By(o.width),strokeDasharray:o.strokeDashArray})}));return py.default.createElement("svg",{style:{position:"absolute",width:By(r),height:By(i),overflow:"visible"}},py.default.createElement("defs",null,py.default.createElement("clipPath",{id:"clippath-".concat(this.identification())},p)),s,p)}}]),n}(py.default.Component),uw=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).spId="",r.opacity=1,r.imageLoadingMonitor=new Tk(e.logger).createMonitor(),r.svgLoadingMonitor=new Tk(e.logger).createMonitor(),r.spId=e.imageXML.extraAttr.getString("spId"),r.getAlphaModFix(),r}return P(n,[{key:"hasSoftEdge",get:function(){var e=this.props.imageXML.childElementOptional("p:spPr","a:effectLst","a:softEdge");return Boolean(e)}},{key:"hasBlipChild",get:function(){var e=this.props.imageXML.childElementOptional("p:blipFill","a:blip");return Boolean(null==e?void 0:e.elements.length)}},{key:"needSpUrl",get:function(){return this.hasSoftEdge||this.hasBlipChild}},{key:"getAlphaModFix",value:function(){var e=this.props.imageXML.childElement("p:blipFill"),t=new kb(e).getAlphaModFix();t&&(this.opacity=t)}},{key:"identification",value:function(){var e=this.props.slideIndex;return"".concat(e,"-").concat(this.spId,"-")}},{key:"render",value:function(){var e=this.props,t=e.imageXML,n=e.width,r=e.height,i=e.spURL,a=e.imageURL,o=e.margin,s=e.uuid,c=e.slideIndex,u=e.borderStyle,l=t.childElementOptional("p:blipFill","a:stretch","a:fillRect"),h=(l?l.attr.getNumber("l",0)/Dy:0)*n,d=(l?l.attr.getNumber("b",0)/Dy:0)*r,p=(l?l.attr.getNumber("r",0)/Dy:0)*n,f=(l?l.attr.getNumber("t",0)/Dy:0)*r;if(void 0===t.childElementOptional("p:spPr",new Zy("a:prstGeom","a:custGeom"))){var v=t.childElementOptional("p:blipFill","a:srcRect"),m={top:0,left:0,right:0,bottom:0};return v&&(m.top=zy(v.attr.getNumber("t",0)),m.left=zy(v.attr.getNumber("l",0)),m.right=zy(v.attr.getNumber("r",0)),m.bottom=zy(v.attr.getNumber("b",0))),dy.default.createElement("div",{style:{overflow:"hidden",height:"100%"}},dy.default.createElement("img",{src:a,style:{width:By(n),height:By(r),position:"relative",top:"".concat(By(r*-m.top)),left:"".concat(By(n*-m.left))},alt:"",ref:this.imageLoadingMonitor}))}var g,y,b,k,w=this.needSpUrl?i:a,S=this.needSpUrl?1:this.opacity;return this.needSpUrl&&i?(g=n-o.left-o.right,y=r-o.top-o.bottom,b=void 0,k=void 0):(g=n-h-p,y=r-f-d,b=By(-o.left+h),k=By(-o.top+f)),dy.default.createElement(cw,{uuid:s,slideIndex:c,borderStyle:u,width:n-o.left-o.right,height:r-o.top-o.bottom,shapeXML:t,spId:this.spId},dy.default.createElement(Xk,{innerref:this.svgLoadingMonitor,preserveAspectRatio:"none",xlinkHref:w||a,href:w||a,x:b,y:k,width:g,height:y,clipPath:"url(#clippath-".concat(this.identification(),")"),opacity:S}))}}]),n}(dy.default.Component),lw=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).videoIntervalId=void 0,r.lastAnimeState={stop:0,play:0},r.player=fy.default.createRef(),r.controller=fy.default.createRef(),r.imageLoadingMonitor=new Tk(e.logger).createMonitor(),e.mediaState?r.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:r.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var i=r.state.playing,a=r.props,o=a.mediaSlideActionUserIds,s=a.userId;return i&&r.hasControl(o,s)&&r.syncPlayTimeLoop(),r}return P(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.targetID;null==window||window.addEventListener("message",(function(n){"_changeAudioState"===n.data.type&&n.data.targetID===t&&e.updateAnimation(n.data)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.state.playing,n=this.props,r=n.disableAnimation,i=n.outsidePausing,a=n.mediaState,o=n.rtcClient;!0!==r&&(i||!e.outsidePausing)?!i||e.outsidePausing?void 0===a||a.playing!==e.mediaState.playing||a.currentTime!==e.mediaState.currentTime?void 0===a&&void 0!==e.mediaState?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),void 0===a&&void 0!==e.mediaState&&(this.player.current&&(this.pauseVideo(),this.player.current.currentTime=e.mediaState.currentTime,!0===e.mediaState.playing?this.playVideo():this.pauseVideo()),this.setState(e.mediaState))):void 0!==a&&void 0!==e.mediaState&&(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),this.player.current&&(a.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(null==o||o.setAudioMixingPosition(Math.floor(1e3*this.player.current.currentTime)))):this.player.current.currentTime=e.mediaState.currentTime,t&&!e.mediaState.playing?this.pauseVideo():!t&&e.mediaState.playing&&this.playVideo(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))):t!==a.playing&&this.setState({playing:a.playing}):this.player.current&&this.playVideo():this.player.current&&this.pauseVideo()}},{key:"componentWillUnmount",value:function(){this.pauseVideo(),this.stopSyncPlayTime(),null==window||window.removeEventListener("_changeAudioState",(function(){}))}},{key:"onMediaPause",value:function(){var e=this.state.currentTime,t=this.props,n=t.onMediaPause,r=t.shapeId;this.stopSyncPlayTime(),n&&n(r,"video",e)}},{key:"onMediaPlay",value:function(){var e=this.state.currentTime,t=this.props,n=t.onMediaPlay,r=t.shapeId;n&&n(r,"video",e)}},{key:"onMouseOver",value:function(e){var t=this.state.displayController,n=this.props.slideRef;if(!0!==t){var r=e.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.height,s=n.current.getBoundingClientRect(),c=s.x,u=s.y,l=s.width,h=s.height,d=getComputedStyle(this.controller.current),p=l/parseFloat(getComputedStyle(n.current).width),f=0,v=0;null!==d&&null!==d.width&&(f=parseInt(d.width,10)*p),null!==d&&null!==d.height&&(v=parseInt(d.height,10)*p);var m=0,g=0;g=i<c?0:c+l<i+f?l-f:i-c,m=a+o-v<u?0:a+o>u+h?h-v:a+o-u-v,this.setState({displayController:!0,controllerPositionTop:m/p,controllerPositionLeft:g/p})}}},{key:"onMediaCanPlay",value:function(){var e=this.props,t=e.disableAnimation,n=e.mediaState,r=e.rtcClient;!0===t?this.pauseVideo():n&&n.playing&&(r&&!this.audioMixing||!0===this.player.current.paused&&(this.player.current.currentTime=n.currentTime,this.playVideo()))}},{key:"hasControl",value:function(e,t){var n=this.props.shapeId;return!(!e||void 0===t)&&e[n]===t}},{key:"stopSyncPlayTime",value:function(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"mixAudio",value:function(e,t){var n=this,r=this.state.playing,i=this.props,a=i.rtcClient,o=i.logger,s=i.videoURL;r?(null==a||a.setAudioMixingPosition(Math.floor(1e3*e)),t()):null==a||a.startAudioMixing(s,!0,!1,1,(function(r,i){714===r?(null==o||o.error("rtc mixing error : ".concat(i)),console.error("rtc mixing error :",i)):(null==a||a.setAudioMixingPosition(Math.floor(1e3*e)),n.audioMixing=!0,t())}))}},{key:"updateAnimation",value:function(e){if(this.player.current&&this.lastAnimeState){var t=this.state.playing,n=this.props,r=n.startTime,i=n.startTimePerfix;0===this.lastAnimeState.play&&1===e.play&&this.player.current&&(1===e.stop?t&&(this.pauseVideo(),this.setState({playing:!1})):t||(this.player.current.currentTime=r?i+r:i,this.playVideo(),this.setState({playing:!0}))),0===this.lastAnimeState.stop&&1===e.stop&&this.player.current&&t&&(this.pauseVideo(),this.setState({playing:!1}))}this.lastAnimeState=e}},{key:"syncPlayTime",value:function(e){if(this.player.current){var t=this.state.currentTime,n=this.props,r=n.mediaRef,i=n.onMediaChange,a=n.shapeId,o=r.startTime,s=r.endTime,c=e||t,u=this.player.current.duration;s&&(u-=s);var l=c;this.player.current&&c>=u&&(l=o||0),o&&l<=o&&(l=o),i({playing:!0,currentTime:l},a)}}},{key:"pauseVideo",value:function(){var e=this,t=this.props.rtcClient;this.player.current&&(void 0!==t?this.stopMixAudio((function(){return e.player.current.pause()})):this.player.current.pause())}},{key:"syncPlayTimeLoop",value:function(e){var t=this;this.props.onMediaChange&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval((function(){t.syncPlayTime()}),1e3))}},{key:"stopMixAudio",value:function(e){var t=this,n=this.props,r=n.rtcClient,i=n.logger;r.stopAudioMixing((function(n,r){714===n?(null==i||i.error("rtc mixing error : ".concat(r)),console.error(" stop audio mixing error :",r)):(t.audioMixing=!1,e())}))}},{key:"playLocalVideo",value:function(){var e=this.player.current.play();if(void 0!==e){var t=this.props,n=t.onMediaPlayError,r=t.logger,i=t.shapeId;e.then((function(){})).catch((function(e){r?r.error("play video exception: ".concat(e)):console.error(e),n&&n(i,"video",e)}))}}},{key:"playVideo",value:function(){this.player.current&&(void 0!==this.props.rtcClient?this.mixAudio(this.player.current.currentTime,this.playLocalVideo.bind(this)):this.playLocalVideo())}},{key:"render",value:function(){var e=this,t=this.props,n=t.mediaRef,r=t.videoURL,i=t.width,a=t.height,o=t.rtcClient,s=t.logger,c=t.controllerProtalId,u=t.resourceLoader,l=t.onMediaChange,h=t.shapeId,d=this.state,p=d.controllerPositionTop,f=d.controllerPositionLeft,v=d.displayController,m=d.playing,g=d.duration,y=d.currentTime,b=n.startTime?1e3*n.startTime:1e4,k="".concat(r,"?x-oss-process=video/snapshot,t_").concat(b,",m_fast,w_800,f_png,ar_auto");return fy.default.createElement("div",{className:"ppt-event-source",style:{position:"relative",width:By(i),height:By(a)},onMouseLeave:function(){return e.setState({displayController:!1})}},fy.default.createElement("img",{src:k,alt:"poster",style:{position:"absolute",zIndex:0,top:0,left:0,width:By(i),height:By(a)},ref:this.imageLoadingMonitor}),fy.default.createElement("video",{className:"ppt-event-source","webkit-playsinline":"true",playsInline:!0,src:r,ref:this.player,muted:!!o,style:{position:"absolute",zIndex:1,top:0,left:0,width:By(i),height:By(a),objectFit:"fill"},poster:k,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function(){return e.setState({duration:e.player.current.duration})},onTimeUpdate:function(){return e.setState({currentTime:e.player.current.currentTime})},onLoadedMetadataCapture:function(){"ios"===window.__platform&&e.onMediaCanPlay()},onCanPlay:function(){"ios"!==window.__platform&&e.onMediaCanPlay()},onError:function(e){var t;null!==e.target.error&&(t=e.target.error),void 0!==t?null==s||s.error("load media: ".concat(r," error,\n                                code: ").concat(t.code,", message: ").concat(t.message)):null==s||s.error("load media: ".concat(r," error without error message"))},onMouseOver:this.onMouseOver.bind(this),preload:"auto"}),fy.default.createElement(ow,{protalId:c,style:{position:"absolute",top:p,left:f,zIndex:2,backfaceVisibility:"hidden"},resourceLoader:u,controllerRef:this.controller,mediaRef:this.player,display:v,playing:m,duration:g,currentTime:y,onPlayClick:function(){e.stopSyncPlayTime(),e.syncPlayTimeLoop()},onPauseClick:function(){e.stopSyncPlayTime(),l&&l({playing:!1,currentTime:y},h)},onSeekClick:function(t){e.stopSyncPlayTime(),e.syncPlayTimeLoop(t)},onMediaEnd:function(){e.stopSyncPlayTime(),e.pauseVideo(),e.setState({playing:!1})},endTime:n.endTime,startTime:n.startTime}))}}]),n}(fy.default.Component),hw=function(){function e(t){C(this,e),this.spTreeXML=t}return P(e,[{key:"indexBySpId",value:function(){var e,t={},n=0,r=T(this.spTreeXML.elements);try{for(r.s();!(e=r.n()).done;){var i=e.value.extraAttr.getStringOptional("spId");"string"==typeof i&&(t[i]=n,n+=1)}}catch(e){r.e(e)}finally{r.f()}return t}}]),e}(),dw=function(e){g(n,e);var t=b(n);function n(e){var r,i;C(this,n),(r=t.call(this,e)).lumiaRef=vy.default.createRef();var a=0,o=e.shapeGroupTransform,s=e.shapeXML;if("p:sp"===s.name){var c=s.childElementOptional("p:spPr","a:xfrm");if(c){var u=c.attr.getNumber("rot",0);a=Number(u)/Fy}}var l=function(e){var t,n=e.childElementOptional("p:txBody","a:bodyPr");return null!=(t=null==n?void 0:n.attr.getStringOptional("vert"))?t:Vb.Horz}(s),h=null!=(i=null==o?void 0:o.rotate)?i:0;return l===Vb.EaVert&&a+h===270&&(r.vertTextType=!0),r}return P(n,[{key:"renderTextBody",value:function(e){var t,n,r=this.props,i=r.shapeWrapResource,a=r.slideContext,o=r.width,s=r.height,c=r.resourceType,u=r.flipH,l=r.flipV,h=r.uuid,d=r.withAnimation;return i&&!i.prop.specialShape&&(n=null==(t=i.textBodyMap)?void 0:t[0]),vy.default.createElement(Jk,{slideContext:a,txBodyXML:e,width:o,height:s,resourceType:c,flipH:u,flipV:l,uuid:h,textBodyWrapResource:n,withAnimation:d})}},{key:"renderShape",value:function(e,t){var n,r,i=0,a=this.vertTextType,o=this.lumiaRef,s=this.props,c=s.shapeGroupTransform,u=s.width,l=s.height,h=s.fillColor,d=s.groupFillColor,p=s.borderStyle,f=s.slideIndex,v=s.uuid,m=s.resourceLoader,g=s.resourceType,y=s.logger;if("p:sp"===e.name){var b=e.childElementOptional("p:spPr","a:xfrm");if(b){var k=b.attr.getNumber("rot",0);i=Number(k)/Fy}}if(c){var w=jb(i,c);n=u*w.scaleX,r=l*w.scaleY}else n=u,r=l;return vy.default.createElement(Qk,{vertTextType:a,ref:o,fillColor:h,groupFillColor:d,spId:e.extraAttr.getString("spId"),borderStyle:p,width:n,height:r,slideIndex:f,uuid:v,resourceLoader:m,resourceType:g,logger:y,shapeXML:e},t?this.renderTextBody(t):null)}},{key:"render",value:function(){var e=this.props.shapeXML,t=e.childElementOptional("p:txBody");return this.renderShape(e,t)}}]),n}(vy.default.PureComponent);function pw(e,t,n){return"".concat(n,"_").concat(t,"_").concat(e)}function fw(e,t,n,r){var i=Vb.Horz,a=e.childElementOptional("p:txBody");a&&"p:txBody"===a.name&&(i=Yb(a));var o={x:e.extraAttr.getNumber("x"),y:e.extraAttr.getNumber("y"),width:e.extraAttr.getNumber("width"),height:e.extraAttr.getNumber("height")},s=e.extraAttr.getBoolean("hidden"),c=e.extraAttr.getBoolean("flipV"),u=e.extraAttr.getBoolean("flipH"),l=e.extraAttr.getNumberOptional("rot");if(i===Vb.EaVert&&162e5===l){l=0;var h=o,d=h.x,p=h.y,f=h.width,v=h.height;o=Ny(Ry({},o),{x:d+(f-v)/2,y:p+(v-f)/2,width:v,height:f})}var m,g={color:e.extraAttr.getColor("borderColor"),width:e.extraAttr.getNumber("borderWidth"),type:e.extraAttr.getString("borderType"),strokeDashArray:e.extraAttr.getString("borderStrokeDashArray")};e.extraAttr.getOptional("fillColor")&&((m=e.extraAttr.getColor("fillColor"))instanceof bb&&m.setFillColor(r.fillColor));var y,b=e.childElementOptional("p:blipFill","a:srcRect");if(b){var k=zy(b.attr.getNumber("l",0)),w=zy(b.attr.getNumber("r",0)),S=zy(b.attr.getNumber("t",0)),x=zy(b.attr.getNumber("b",0)),C=1-k-w,I=1-S-x,P=o.width/C,M=o.height/I;y={width:P,height:M,margin:{left:P*k,top:M*S,right:P*w,bottom:M*x}}}var T,A=e.childElementOptional(new Zy("p:nvSpPr","p:nvPicPr"),"p:cNvPr","a:hlinkClick");if(A&&!(T=A.attr.getStringOptional("r:id"))){var E=null==A?void 0:A.attr.getStringOptional("action"),O=new URL(null!=E?E:"");if("//hlinkshowjump"===O.pathname){var R=O.searchParams.get("jump");["firstslide","previousslide","nextslide","lastslide","endshow","lastslideviewed"].includes(R)&&(T=function(e,t){if(!t)return 1;var n=t.slideIndex,r=t.slideCount,i=t.preSlideIndex,a=1;switch(e){case"firstslide":a=1;break;case"previousslide":a=n-1;break;case"endshow":case"lastslide":a=r;break;case"nextslide":a=n+1;break;case"lastslideviewed":a=i+1}return a<1&&(a=1),a>r&&(a=r),a}(R,t))}}return{rectangle:o,borderStyle:g,fillColor:m,tailor:y,flipV:c,flipH:u,rotate:l,parentGroupShapeId:n,hidden:s,hyperLinkDestination:T}}var vw=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).animeTarget=my.default.createRef(),r.shapeMap=new Ob(fw),r.childrenRef=my.default.createRef(),r.eventSourceId=void 0,r.emptyClick=function(){},r.onClick=function(e){var t=r.props,n=t.onHyperLinkClick,i=t.onEventSourceClick;return void 0!==r.shapeWrapperParams.hyperLinkDestination?n?n(r.shapeWrapperParams.hyperLinkDestination,e):void 0:void 0!==r.eventSourceId&&i?i(r.eventSourceId):void 0},r.state={soundEffectUrl:null};var i=e.shapeXML,a=e.resourceType,o=e.shapeGroupTransform,s=e.onEventSourceClick;if(r.spId=i.extraAttr.getString("spId"),r.resourceType=a,r.player=my.default.createRef(),r.shapeWrapperParams=r.shapeMap.map(i,e.slideContext,o),void 0!==e.eventSourceId)r.eventSourceId=e.eventSourceId;else{var c=pw(e.slideContext.uuid,e.slideContext.slideIndex,r.spId);e.interactiveSeqsKeys&&-1!==e.interactiveSeqsKeys.indexOf(c)&&void 0!==s&&(r.eventSourceId=c)}return r}return P(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.slideContext;null==window||window.addEventListener("message",(function(n){"_playSoundEffect"===n.data.type&&n.data.targetID===pw(t.uuid,t.slideIndex,e.spId)&&e.playEffectSound(n.data.targetID,n.data.soundEffectId)}))}},{key:"getPositionAndSize",value:function(){var e,t,n,r,i=0,a=this.props,o=a.shapeXML,s=a.shapeGroupTransform;if("p:sp"===o.name||"p:pic"===o.name){var c=o.childElementOptional("p:spPr","a:xfrm");if(c){var u=c.attr.getNumber("rot",0);i=Number(u)/Fy}}if(s){var l=this.shapeWrapperParams.rectangle,h=l.x,d=l.y,p=l.width,f=l.height,v=s.scaleX,m=s.scaleY,g=s.translateX,y=s.translateY;Math.abs(Math.cos(i/180*Math.PI))>=Math.abs(Math.sin(i/180*Math.PI))?(e=(h+g)*v,t=(d+y)*m,n=p*v,r=f*m):(e=(h+g+p/2)*v-p*m/2,t=(d+y+f/2)*m-f*v/2,n=p*m,r=f*v)}else e=this.shapeWrapperParams.rectangle.x,t=this.shapeWrapperParams.rectangle.y,n=this.shapeWrapperParams.rectangle.width,r=this.shapeWrapperParams.rectangle.height;return{left:By(e),top:By(t),width:By(n),height:By(r)}}},{key:"transform",value:function(e){var t=this.transformWithShapeParams(e,{translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0}),n=t.translateX,r=t.translateY,i=t.scaleX,a=t.scaleY,o=t.rotate,s=(e.rotate||0)+o;return i<0&&(s=-s),a<0&&(s=-s),"translate(".concat(By(n),", ").concat(By(r),") scale(").concat(i,",").concat(a,") rotate(").concat(Uy(s),"deg)")}},{key:"transformWithShapeParams",value:function(e,t){var n=t.translateX,r=t.translateY,i=e.flipH?-t.scaleX:t.scaleX,a=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&"number"==typeof t.rotate&&(o=t.rotate),{translateX:n,translateY:r,scaleX:i,scaleY:a,rotate:o}}},{key:"playEffectSound",value:function(e,t){if(void 0!==t){var n=this.props,r=n.resourceType,i=n.slideContext;if("slide"===r){var a=i.resourceLoader.loadURL(r,t);if(a){var o=document.getElementById("".concat(e));if(o){var s=document.createElement("audio");return s.id="".concat(e,"-").concat(t),s.onpause=function(){s.remove()},s.src=a,s.controls=!1,o.appendChild(s),s.play().then((function(){}),(function(){})),!0}}}}return!1}},{key:"renderShape",value:function(e){var t=e.tailor,n={left:0,right:0,top:0,bottom:0},r=e.rectangle;t&&(r=Ny(Ry({},r),{width:t.width,height:t.height}),n=t.margin);var i=this.props,a=i.flipH,o=i.flipV,s=i.shapeGroupTransform,c=i.resourceType,u=!!a!==e.flipH,l=!!o!==e.flipV;return this.renderChildren({play:e.play,stop:e.stop,width:r.width,height:r.height,borderStyle:e.borderStyle,fillColor:e.fillColor,rotate:e.rotate,margin:n,shapeGroupTransform:s,flipH:u,flipV:l,resoureType:c})}},{key:"renderChildren",value:function(e){var t=this.props.children;if("function"==typeof t){var n=t(e);return n&&my.default.cloneElement(n,{ref:this.childrenRef})}return my.default.cloneElement(t,{ref:this.childrenRef})}},{key:"render",value:function(){var e,t,n=this.state.soundEffectUrl,r=this.getPositionAndSize(),i=r.left,a=r.top,o=r.height,s=r.width;!0===this.shapeWrapperParams.hidden&&(t="none");var c=null!=(e=this.shapeWrapperParams.hyperLinkDestination)?e:void 0!==this.eventSourceId,u="none"!==Pb(this.shapeWrapperParams.fillColor)?(0,gy.default)(Pb(this.shapeWrapperParams.fillColor)):(0,gy.default)("#FFFFFF00"),l=u.hsl().array(),h=this.props,d=h.slideContext,p=h.zIndex;return my.default.createElement("div",{className:"spId-".concat(this.spId," ").concat(c?" ppt-event-source":""),id:pw(d.uuid,d.slideIndex,this.spId),ref:this.animeTarget,style:{position:"absolute",display:t,zIndex:p,left:i,top:a,width:s,height:o,transform:this.transform(this.shapeWrapperParams),opacity:1,backfaceVisibility:"hidden","--sp-fill-h":u&&l[0],"--sp-fill-s":u&&l[1]+"%","--sp-fill-l":u&&l[2]+"%","--sp-fill-a":u?u.alpha():0},onClick:c?this.onClick.bind(this,this.spId):this.emptyClick},n&&my.default.createElement("audio",{src:n,ref:this.player,controls:!1}),this.renderShape(this.shapeWrapperParams))}}]),n}(my.default.Component);function mw(e,t,n,r){var i,a=e.childElementOptional("p:grpSpPr","a:xfrm"),o=0,s=0,c=0,u=0,l=1,h=1;e.extraAttr.getOptional("fillColor")&&((i=e.extraAttr.getColor("fillColor"))instanceof bb&&i.setFillColor(r.fillColor));var d=!1,p=!1,f=0,v={x:0,y:0,width:t?t.slideWidth:0,height:t?t.slideHeight:0},m=0;if(a){var g=e.childElementOptional("p:grpSpPr","a:xfrm","a:chExt"),y=e.childElementOptional("p:grpSpPr","a:xfrm","a:ext"),b=e.childElementOptional("p:grpSpPr","a:xfrm","a:chOff");c=g?g.attr.getNumber("cx"):0,u=g?g.attr.getNumber("cy"):0,l=0!==c&&y?y.attr.getNumber("cx")/c:1,l=Number.isNaN(l)?1:l,h=0!==c&&y?y.attr.getNumber("cy")/u:1,h=Number.isNaN(h)?1:h,o=b?-b.attr.getNumber("x"):0,s=b?-b.attr.getNumber("y"):0,f=(m=a.attr.getNumber("rot",0))/Fy,d=a.attr.getBoolean("flipV",!1),p=a.attr.getBoolean("flipH",!1);var k=e.childElementOptional("p:grpSpPr","a:xfrm","a:off");v={x:k?k.attr.getNumber("x"):0,y:k?k.attr.getNumber("y"):0,width:y?y.attr.getNumber("cx"):0,height:y?y.attr.getNumber("cy"):0}}return{rectangle:v,borderStyle:{},opacity:1,tailor:undefined,flipV:d,flipH:p,transform:{translateX:o,translateY:s,scaleX:l,scaleY:h,rotate:f,fillColor:i},parentGroupShapeId:n,fillColor:i,rotate:m,hidden:e.extraAttr.getBooleanOptional("hidden")}}var gw,yw=function(e){g(n,e);var t=b(n);function n(e){var r;C(this,n),(r=t.call(this,e)).animeTarget=pv.default.createRef(),r.eventSourceId=void 0,r.shapeWrappers=[],r.shapeMap=new Ob(mw),r.renderShape=function(e,t,n,i,a,o,s){var c=t.extraAttr.getString("spId"),u=c.replace("l","").replace("m",""),l=r.props,h=l.slideContext,d=l.interactiveSeqsKeys,p=l.onEventSourceClick,f=l.onHyperLinkClick,v=l.resourceType,m=l.uuid,g=l.wrapResource,y=l.animationManager,b=!1,k=t.childElementOptional(new Zy("p:nvSpPr","p:nvCxnSpPr"));if(k&&(b=!!k.childElementOptional("p:nvPr","p:ph")),"slide"===v||!b)return pv.default.createElement(vw,{key:"".concat(n),ref:function(e){return r.shapeWrappers.push(e)},shapeXML:t,slideContext:h,shapeGroupTransform:i,interactiveSeqsKeys:d,eventSourceId:r.eventSourceId,onEventSourceClick:p,onHyperLinkClick:f,zIndex:r.zIndex(e,t),resourceType:v,flipV:s,flipH:o},(function(e){return pv.default.createElement(dw,{uuid:m,width:e.width,fillColor:e.fillColor,slideContext:h,height:e.height,slideIndex:h.slideIndex,groupFillColor:a.fillColor,borderStyle:e.borderStyle,shapeGroupTransform:e.shapeGroupTransform,shapeXML:t,resourceLoader:h.resourceLoader,resourceType:v,shapeWrapResource:null==g?void 0:g.shapes[u],withAnimation:null==y?void 0:y.withTextAnimation(c),flipV:e.flipV,flipH:e.flipH})}))},r.renderPicture=function(e,t,n,i){var a=r.props,o=a.slideContext,s=a.interactiveSeqsKeys,c=a.onEventSourceClick,u=a.onHyperLinkClick,l=a.resourceType;return pv.default.createElement(vw,{key:"".concat(n),shapeXML:t,ref:function(e){return r.shapeWrappers.push(e)},slideContext:o,interactiveSeqsKeys:s,shapeGroupTransform:i,eventSourceId:r.eventSourceId,onEventSourceClick:c,onHyperLinkClick:u,zIndex:r.zIndex(e,t),resourceType:l},(function(e){return r.renderPictureContent(t,e,o.resourceLoader,i)}))},r.renderGraph=function(e,t,n,i){var a=t.extraAttr.getString("spId"),o=r.props,s=o.slideContext,c=o.interactiveSeqsKeys,u=o.onEventSourceClick,l=o.onHyperLinkClick,h=o.resourceType,d=o.uuid,p=o.wrapResource;return pv.default.createElement(vw,{key:"".concat(n),shapeXML:t,ref:function(e){return r.shapeWrappers.push(e)},slideContext:s,interactiveSeqsKeys:c,eventSourceId:r.eventSourceId,onEventSourceClick:u,onHyperLinkClick:l,zIndex:r.zIndex(e,t),resourceType:h,shapeGroupTransform:i},(function(e){return pv.default.createElement(iw,{uuid:d,slideContext:s,width:e.width,height:e.height,rotate:e.rotate,borderStyle:e.borderStyle,fillColor:e.fillColor,key:"".concat(n),shapeGroupTransform:e.shapeGroupTransform,graphXML:t,shapeWrapResource:null==p?void 0:p.shapes[a],resourceType:e.resoureType})}))},r.renderShapeGroup=function(e,t,i,a,o,s){var c=r.zIndex(e,t),u=r.props,l=u.uuid,h=u.slideRef,d=u.slideContext,p=u.interactiveSeqsKeys,f=u.resourceType,v=u.onEventSourceClick,m=u.onHyperLinkClick,g=u.meidaStates,y=u.disableAnimation,b=u.onMediaChange,k=u.onMediaPause,w=u.onMediaPlay,S=u.onMediaPlayError,x=u.mediaSlideActionUserIds,C=u.rtcClient,I=u.userId,P=u.wrapResource;return pv.default.createElement(n,{key:"".concat(i),uuid:l,slideRef:h,slideContext:d,zIndex:c,shapeGroupXML:t,interactiveSeqsKeys:p,eventSourceId:r.eventSourceId,resourceType:f,onEventSourceClick:v,onHyperLinkClick:m,shapeGroupTransform:a,flipH:o,flipV:s,meidaStates:g,disableAnimation:y,onMediaChange:b,onMediaPlay:w,onMediaPause:k,onMediaPlayError:S,userId:I,mediaSlideActionUserIds:x,wrapResource:P,rtcClient:C})},r.state={soundEffectUrl:null};var i=r.props,a=i.shapeGroupXML,o=i.onEventSourceClick,s=a.extraAttr.getString("spId");r.shapeId=s;var c=pw(e.slideContext.uuid,e.slideContext.slideIndex,s);return e.interactiveSeqsKeys&&-1!==e.interactiveSeqsKeys.indexOf(c)&&void 0!==o&&(r.eventSourceId=c),r.player=pv.default.createRef(),r}return P(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.slideContext;null==window||window.addEventListener("message",(function(n){"_playSoundEffect"===n.data.type&&n.data.targetID===pw(t.uuid,t.slideIndex,e.shapeId)&&e.playEffectSound(n.data.targetID,n.data.soundEffectId)}))}},{key:"componentDidCatch",value:function(e,t){var n=this.props.logger;n&&n.error("catch render error: ",e," stack: ",t.componentStack),this.setState({error:!0})}},{key:"transformWithShapeParams",value:function(e,t){var n=t.translateX,r=t.translateY,i=e.flipH?-t.scaleX:t.scaleX,a=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&"number"==typeof t.rotate&&(o=t.rotate),{translateX:n,translateY:r,scaleX:i,scaleY:a,rotate:o}}},{key:"transform",value:function(e){var t=this.props.shapeGroupTransform,n={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0};t&&(n.rotate=t.rotate+n.rotate);var r=this.transformWithShapeParams(e,n),i=r.translateX,a=r.translateY,o=r.scaleX,s=r.scaleY,c=r.rotate;return"translate(".concat(By(i),", ").concat(By(a),") scale(").concat(o,",").concat(s,") rotate(").concat(Uy(c)+e.transform.rotate,"deg)")}},{key:"updateAnimation",value:function(e){var t;(null==(t=this.player)?void 0:t.current)&&(1===e.play&&0===e.stop?this.player.current.play().then((function(){}),(function(){})):0===e.play&&1===e.stop&&this.player.current.pause())}},{key:"playEffectSound",value:function(e,t){if(void 0!==t){var n=this.props,r=n.resourceType,i=n.slideContext;if("slide"===r){var a=i.resourceLoader.loadURL(r,t);if(a){var o=document.getElementById("".concat(e));if(o){var s=document.createElement("audio");return s.id="".concat(e,"-").concat(t),s.onpause=function(){s.remove()},s.src=a,s.controls=!1,o.appendChild(s),s.play().then((function(){}),(function(){})),!0}}}}return!1}},{key:"parseMediaRef",value:function(e,t){if(t){var n=this.props.resourceType,r=t.childElementOptional(new Zy("a:videoFile","a:audioFile"));if(r){var i="a:videoFile"===r.name?"video":"audio",a=r.attr.getString("r:link"),o=e.loadURL(n,a);if(o)return{resURL:o,mediaType:i};var s=t.childElementOptional("p:extLst","p:ext");if(s&&"{DAA4B4D4-6D71-4841-9C94-3DE7FCFB9230}"===s.attr.getString("uri")){var c=s.childElement("p14:media"),u=c.attr.getStringOptional("r:link"),l=c.attr.getStringOptional("r:embed"),h=u||l||"unknow";if(c.hasChildElementWithName("p14:trim")){var d=c.childElement("p14:trim"),p=d.attr.getNumberOptional("st"),f=d.attr.getNumberOptional("end");return p&&(p/=1e3),f&&(f/=1e3),{resURL:e.loadURL(n,h),mediaType:i,startTime:p,endTime:f}}return{resURL:e.loadURL(n,h),mediaType:i}}}}else;}},{key:"zIndex",value:function(e,t){var n=t.extraAttr.getStringOptional("spId");if("string"==typeof n){var r=new hw(e).indexBySpId();if(n in r)return r[n]}return 999}},{key:"renderPictureContent",value:function(e,t,n,r){var i=t.width,a=t.height,o=t.fillColor,s=t.borderStyle,c=t.margin,u=e.childElementOptional("p:nvPicPr","p:nvPr"),l=e.childElement("p:nvPicPr","p:cNvPr").attr.getString("id"),h=this.parseMediaRef(n,u),d=e.childElementOptional("p:blipFill","a:blip"),p=0,f=null==e?void 0:e.childElementOptional("p:spPr","a:xfrm");if(f){var v=f.attr.getNumber("rot",0);p=Number(v)/Fy}var m,g,y=Ry({},c);if(r){var b=jb(p,r),k=b.scaleX,w=b.scaleY;m=i*k,g=a*w,y.left*=k,y.right*=k,y.top*=w,y.bottom*=w}else m=i,g=a;var S=this.props,x=S.meidaStates,C=S.uuid,I=S.slideContext,P=S.logger,M=S.slideRef,T=S.pausing,A=S.disableAnimation,E=S.onMediaChange,O=S.onMediaPause,R=S.onMediaPlay,N=S.onMediaPlayError,L=S.userId,j=S.mediaSlideActionUserIds,D=S.rtcClient,F=S.resourceType,z=x?x[l]:void 0;if(h&&"video"===h.mediaType)return pv.default.createElement(lw,{width:m,uuid:C,controllerProtalId:"netless-media-controller-portal-".concat(I.uuid),logger:P,slideRef:M,startTimePerfix:h.startTime?h.startTime:0,outsidePausing:T,height:g,fillColor:o,borderStyle:s,videoURL:h.resURL,shapeId:l,targetID:pw(I.uuid,I.slideIndex,l),mediaState:z,resourceLoader:n,disableAnimation:A,onMediaChange:E,onMediaPlay:R,onMediaPause:O,onMediaPlayError:N,userId:L,mediaSlideActionUserIds:j,rtcClient:D,mediaRef:h});if(h&&"audio"===h.mediaType)return pv.default.createElement(sw,{width:m,controllerProtalId:"netless-media-controller-portal-".concat(I.uuid),logger:P,slideRef:M,startTimePerfix:h.startTime?h.startTime:0,outsidePausing:T,height:g,borderStyle:s,uuid:C,audioURL:h.resURL,shapeId:l,targetID:pw(I.uuid,I.slideIndex,l),mediaState:z,resourceLoader:n,disableAnimation:A,onMediaChange:E,onMediaPlay:R,onMediaPause:O,onMediaPlayError:N,userId:L,mediaSlideActionUserIds:j,rtcClient:D,mediaRef:h});if(d){var B=d.attr.getStringOptional("r:embed");if(void 0===B)return null;var U,V=n.loadURL(F,B);return l&&(U=n.loadURL(F,"spId".concat(l))),pv.default.createElement(uw,{width:m,uuid:I.uuid,logger:P,resourceType:F,resId:B,height:g,slideIndex:I.slideIndex,fillColor:o,borderStyle:s,imageURL:V,margin:y,imageXML:e,preload:I.preload,spURL:U})}return null}},{key:"renderShapeGroupContent",value:function(e){var t=this,n=this.props,r=n.shapeGroupXML,i=n.shapeGroupTransform,a=n.flipH,o=n.flipV,s=r.elementsWithName("p:sp"),c=r.elementsWithName("p:cxnSp"),u=r.elementsWithName("p:pic"),l=r.elementsWithName("p:graphicFrame"),h=r.elementsWithName("p:grpSp");r.elementsWithName("mc:AlternateContent").forEach((function(e){var t=e.childElementOptional("mc:Choice","p:graphicFrame");if(t)l.push(t);else{var n=e.childElementOptional("mc:Fallback","p:pic");n&&u.push(n)}}));var d=Ry({},e.transform),p=i;p&&(d.rotate+=p.rotate,d.scaleX*=p.scaleX,d.scaleY*=p.scaleY);var f=!!a!==e.flipH,v=!!o!==e.flipV;return pv.default.createElement(pv.default.Fragment,null,s.map((function(n,i){return t.renderShape(r,n,i,d,e,f,v)})),c.map((function(n,i){return t.renderShape(r,n,i,d,e,f,v)})),u.map((function(e,n){return t.renderPicture(r,e,n,d)})),l.map((function(e,n){return t.renderGraph(r,e,n,d)})),h.map((function(e,n){return t.renderShapeGroup(r,e,n,d,f,v)})))}},{key:"render",value:function(){this.shapeWrappers=[];var e=this.state,t=e.error,n=e.soundEffectUrl;if(t)return pv.default.createElement("div",{"data-reason":"render error"});var r,i,a,o,s=this.props,c=s.shapeGroupXML,u=s.slideContext,l=s.shapeGroupTransform,h=s.zIndex,d=this.shapeMap.map(c,u,l),p=c.extraAttr.getString("spId");return l?(r=By((d.rectangle.x+l.translateX)*l.scaleX),i=By((d.rectangle.y+l.translateY)*l.scaleY),a=By(d.rectangle.width*l.scaleX),o=By(d.rectangle.height*l.scaleY)):(r=By(d.rectangle.x),i=By(d.rectangle.y),a=By(d.rectangle.width),o=By(d.rectangle.height)),pv.default.createElement("div",{ref:this.animeTarget,className:"spGoupId-"+p,id:pw(u.uuid,u.slideIndex,p),style:{position:"absolute",left:r,top:i,transform:this.transform(d),width:a,height:o,zIndex:h,opacity:d.opacity}},n&&pv.default.createElement("audio",{src:n,ref:this.player,controls:!1}),this.renderShapeGroupContent(d))}}]),n}(pv.default.Component),bw="-1",kw="sequenceIndexes",ww="disableAutoPlay",Sw="playLastStep";!function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"}(gw||(gw={}));var xw=function(e){g(n,e);var t=b(n);function n(e){var r,i,o;C(this,n),(r=t.call(this,e)).eventHub=new uv.default,r.isImageLoadFinished=!1,r.shapeGroupRef=cv.default.createRef(),r.onHyperLinkClick=function(e,t){var n,i,a=r.props,o=a.data,s=a.stateAdapter,c=r.getTurnToSlide(e,t);if(c){var u=c.match(/slide(\S*)/);null!==u&&(null==(n=null==s?void 0:s.onPageJumpTo)||n.call(s,o.uuid,parseInt(u[1],10)))}"number"==typeof e&&(null==(i=null==s?void 0:s.onPageJumpTo)||i.call(s,o.uuid,e))},r.onEventSourceClick=function(e){r.mainAnimationManager.interactiveSeqs.get(e)&&r.onMasterEventSourceClick(e)},r.onMediaPlay=function(e,t,n){void 0!==window&&window.postMessage({shapeId:e,mediaType:t,action:"play"},"*");var i=r.props.callbacks;i&&i.onMediaPlay&&i.onMediaPlay(e,t)},r.onMediaPause=function(e,t,n){var i=r.props,a=i.userId,o=i.callbacks,s=r.state.mediaActionUserIds;void 0!==a&&void 0!==s&&void 0!==s[r.currentSlideKey]&&s[r.currentSlideKey][e]===a&&r.setMediaState({playing:!1,currentTime:n},e),void 0!==window&&window.postMessage({shapeId:e,mediaType:t,action:"pause"},"*"),o&&o.onMediaPause&&o.onMediaPause(e,t)},r.setMediaState=function(e,t){var n,i,o=r.props,s=o.pptState,c=o.userId,u=o.stateAdapter,l=o.data;if(void 0===s||void 0===s.mediaStates)n=a({},r.currentSlideKey,a({},t,e)),void 0!==c&&(i=a({},r.currentSlideKey,a({},t,c)));else{var h=s.mediaStates[r.currentSlideKey];if(void 0===h?h=a({},t,e):h[t]=e,void 0!==c){var d=r.state.mediaActionUserIds;i=void 0!==d?void 0!==d[r.currentSlideKey]?Ny(Ry({},d),a({},r.currentSlideKey,Ny(Ry({},d[r.currentSlideKey]),a({},t,c)))):Ny(Ry({},d),a({},r.currentSlideKey,a({},t,c))):a({},r.currentSlideKey,a({},t,c))}n=Ny(Ry({},s.mediaStates),a({},r.currentSlideKey,h))}u.setState(l.uuid,l.index,Ny(Ry({},s),{mediaStates:n,mediaActionUserIds:i}))};var s=e.data;return r.preSlideIndex=null!=(o=null==(i=e.pptState)?void 0:i.preSlideIndex)?o:0,r.currentSlideKey="".concat(s.uuid,"-").concat(s.index),r.masterAnimationManager=s.animations.masterAnimationManager,r.layoutAnimationManager=s.animations.layoutAnimationManager,r.slideAnimationManager=s.animations.slideAnimationManager,r.mainAnimationManager=s.animations.mainAnimationManager,r.animationCount=s.animations.animationCount,r.initSlideStates(),r.masterInteractiveSeqsKeys=Array.from(r.masterAnimationManager.interactiveSeqs.keys()),r.layoutInteractiveSeqsKeys=Array.from(r.layoutAnimationManager.interactiveSeqs.keys()),r.slideInteractiveSeqsKeys=Array.from(r.slideAnimationManager.interactiveSeqs.keys()),r.slide=cv.default.createRef(),r.isRenderMaster=e.data.layoutXML.childElement("p:sldLayout").attr.getBoolean("showMasterSp",!0),r.changeStep.bind(w(r)),Ab.reset(r.eventHub),r}return P(n,[{key:"componentDidMount",value:function(){this.isImageLoadFinished=Ab.endLoadTask("slideDidUpdate"),this.mainAnimationManager.animBoxes.forEach((function(e){return e.applyPreAnimation()}));var e=this.getMainStepsFromSequences();"clickEffect"!==this.mainAnimationManager.mainSeq.effectType&&1===e?(this.mainAnimationManager.mainSeq.seekIndex(0),this.mainAnimationManager.mainSeq.play()):e&&this.mainAnimationManager.mainSeq.seekIndex(e);var t=this.state[this.currentSlideKey],n=t.sequenceSteps,r=t.layoutSequenceSteps,i=t.masterSequenceSteps;this.mainAnimationManager.interactiveSeqs.forEach((function(e,t){n&&n[t]?e.seekIndex(n[t]):r&&r[t]?e.seekIndex(r[t]):i&&i[t]?e.seekIndex(i[t]):e.seekIndex(0)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;if(void 0!==e.pptState){var n=this.props.pptState;if(this.setState(e.pptState),!n||!n[this.currentSlideKey])return this.playAnime(n,e.pptState,this.mainAnimationManager.mainSeq,bw),void this.mainAnimationManager.interactiveSeqs.forEach((function(r,i){t.playAnime(n,e.pptState,r,i)}));if(this.mainAnimationManager.interactiveSeqs.forEach((function(r,i){t.playAnime(n,e.pptState,r,i)})),!e.pptState[this.currentSlideKey])return;this.playAnime(n,e.pptState,this.mainAnimationManager.mainSeq,bw)}}},{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.props.data;e.data.index!==r.index&&Ab.endLoadTask("slideDidUpdate");var i=this.state[this.currentSlideKey];void 0!==t[this.currentSlideKey]&&void 0===i&&(this.resetAnimation(),this.mainAnimationManager.mainSeq.seekIndex(0),setTimeout((function(){"clickEffect"!==n.mainAnimationManager.mainSeq.effectType&&n.mainAnimationManager.mainSeq.play();var t=n.initSlideAnimationState();e.stateAdapter.setState(r.uuid,r.index,Ry({},n.composeSlideStateIntoPPTState(t)))}),80))}},{key:"componentDidCatch",value:function(e){console.error("catched error: ",e);var t=this.props,n=t.data,r=t.userId;n.logger&&n.logger.error("catched ppt: ".concat(n.uuid,",\n                index: ").concat(n.index,", user: ").concat(r," render error : "),e)}},{key:"componentWillUnmount",value:function(){this.masterAnimationManager.triggerEvent.emit("onUnmount",{target:"master"}),this.layoutAnimationManager.triggerEvent.emit("onUnmount",{target:"layout"}),this.slideAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"}),this.mainAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"})}},{key:"onPageToNext",value:function(){var e=this.props.stateAdapter;return this.setDisableAutoPlay(!1),this.pauseAllAnimation(!0),e.onPageToNext?e.onPageToNext():void 0}},{key:"onPageToPrev",value:function(){var e=this.props.stateAdapter;return this.pauseAllAnimation(),e.onPageToPrev?e.onPageToPrev():void 0}},{key:"onMasterEventSourceClick",value:function(e){var t,n,r=this,i=this.mainAnimationManager.interactiveSeqs.get(e),o=this.state[this.currentSlideKey],s=this.props,c=s.stateAdapter,u=s.data,l=o.masterSequenceSteps,h=o.layoutSequenceSteps,d=o.sequenceSteps,p=l[e],f="masterSequenceSteps",v=l;(void 0===p&&(p=h[e],f="layoutSequenceSteps",v=h),void 0===p&&(p=d[e],f="sequenceSteps",v=d),void 0!==p)&&(n=void 0!==i&&e!==bw&&(p>i.length||p===i.length&&!i.isPlaying)?0:p+1,c.setState(u.uuid,u.index,this.composeSlideStateIntoPPTState((a(t={},f,Ny(Ry({},v),a({},e,n))),a(t,"hasChangeStep",!0),t))),0!==p&&0===n&&setTimeout((function(){var t;c.setState(u.uuid,u.index,r.composeSlideStateIntoPPTState((a(t={},f,Ny(Ry({},v),a({},e,n+1))),a(t,"hasChangeStep",!0),t)))}),80))}},{key:"getTurnToSlide",value:function(e,t){var n=this.props.data.resourceLoader;if(t)return/m/.test(t)?n.resource.master[e]:/l/.test(t)?n.resource.layout[e]:n.resource.slide[e];var r=n.resource.master[e];return r||(r=n.resource.layout[e])||(r=n.resource.slide[e]),r}},{key:"getCurrentSequences",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=null!=t?t:this.state,i=r[this.currentSlideKey];if(!i)return[void 0,"masterSequenceSteps"];var a=i.sequenceSteps,o=i.layoutSequenceSteps,s=i.masterSequenceSteps;if("number"==typeof e){var c=this.animationCount,u=c.slide,l=c.layout,h=c.master;if(e<h||n&&e<=h)return[s,"masterSequenceSteps"];if(e<h+l||n&&e<=h+l)return[o,"layoutSequenceSteps"];if(e<h+l+u||n&&e<=h+l+u)return[a,"sequenceSteps"]}return void 0!==s[e]?[s,"masterSequenceSteps"]:void 0!==o[e]?[o,"layoutSequenceSteps"]:[a,"sequenceSteps"]}},{key:"getCurrentSequenceAnimationCount",value:function(e){return"sequenceSteps"===e?this.animationCount.slide:"layoutSequenceSteps"===e?this.animationCount.layout:"masterSequenceSteps"===e?this.animationCount.master:0}},{key:"getMainStepsFromSequences",value:function(e){var t=(null!=e?e:this.state)[this.currentSlideKey];if(t){var n=t.sequenceSteps,r=t.layoutSequenceSteps,i=t.masterSequenceSteps,a=0;return i&&i[bw]&&i[bw]>0&&(a+=i[bw]),r&&r[bw]&&r[bw]>0&&(a+=r[bw]),n&&n[bw]&&n[bw]>0&&(a+=n[bw]),a}}},{key:"getSequencesByKey",value:function(e,t){var n=(null!=t?t:this.state)[this.currentSlideKey];if(!n)return[void 0,void 0];var r=n.sequenceSteps,i=n.layoutSequenceSteps,a=n.masterSequenceSteps;return r&&void 0!==r[e]?[r,"sequenceSteps"]:i&&void 0!==i[e]?[i,"layoutSequenceSteps"]:a&&void 0!==a[e]?[a,"masterSequenceSteps"]:[void 0,void 0]}},{key:"setDisableAutoPlay",value:function(e){var t=this.props,n=t.stateAdapter,r=t.data,i=this.state[this.currentSlideKey],a=i.masterSequenceSteps,o=i.layoutSequenceSteps,s=i.sequenceSteps;n.setState(r.uuid,r.index,this.composeSlideStateIntoPPTState({masterSequenceSteps:a,layoutSequenceSteps:o,sequenceSteps:s},e))}},{key:"pauseAllAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mainAnimationManager.mainSeq.pause(),e){var t=this.animationCount,n=t.slide,r=t.layout,i=t.master;this.mainAnimationManager.mainSeq.seekIndex(n+r+i)}var a=this.getMainStepsFromSequences();a&&this.mainAnimationManager.mainSeq.seekIndex(a),this.mainAnimationManager.interactiveSeqs.forEach((function(e){return e.pause()}))}},{key:"initSlideAnimationState",value:function(){var e=a({},bw,0),t=a({},bw,0),n=a({},bw,0),r=!1,i=!1;return this.animationCount.master>0&&"clickEffect"!==this.masterAnimationManager.mainSeq.effectType&&(n[bw]=1,r=!0),this.masterAnimationManager.interactiveSeqs.forEach((function(e,t){n[t]=0})),this.animationCount.layout>0&&"clickEffect"!==this.layoutAnimationManager.mainSeq.effectType&&!r&&(t[bw]=1,i=!0),this.layoutAnimationManager.interactiveSeqs.forEach((function(e,n){t[n]=0})),this.animationCount.slide>0&&"clickEffect"!==this.slideAnimationManager.mainSeq.effectType&&!r&&!i&&(e[bw]=1),this.slideAnimationManager.interactiveSeqs.forEach((function(t,n){e[n]=0})),{masterSequenceSteps:n,layoutSequenceSteps:t,sequenceSteps:e,hasChangeStep:!1}}},{key:"initSlideStates",value:function(){var e,t,n=this.initSlideAnimationState(),r=n.hasChangeStep,i=n.sequenceSteps,a=n.layoutSequenceSteps,o=n.masterSequenceSteps,s=this.props.pptState,c={};void 0!==s&&(c=s);var u=c[this.currentSlideKey];u&&(o=null!=(e=u.masterSequenceSteps)?e:o,a=null!=(t=u.layoutSequenceSteps)?t:a,i=u.sequenceSteps),this.state=Ry({},this.composeSlideStateIntoPPTState({masterSequenceSteps:o,layoutSequenceSteps:a,sequenceSteps:i,hasChangeStep:r}))}},{key:"composeSlideStateIntoPPTState",value:function(e,t){var n,r,i,o=this.props,s=o.pptState,c=o.data;if(!this.state)return Ny(Ry({},s),(a(n={},this.currentSlideKey,Ry({},e)),a(n,"uuid",c.uuid),a(n,"pageIndex",c.index),n));var u=this.state[this.currentSlideKey];return Ny(Ry({},s),void 0!==t?(a(r={},this.currentSlideKey,Ry(Ry({},u),e)),a(r,"uuid",c.uuid),a(r,"pageIndex",c.index),a(r,"disableAutoPlay",t),r):(a(i={},this.currentSlideKey,Ry(Ry({},u),e)),a(i,"uuid",c.uuid),a(i,"pageIndex",c.index),i))}},{key:"playAnime",value:function(e,t,n,r){var i,a,o;if(r===bw)a=this.getMainStepsFromSequences(e),o=this.getMainStepsFromSequences(t);else{var s=l(this.getSequencesByKey(r,e),1)[0],c=l(this.getSequencesByKey(r,t),1)[0];s&&(a=s[r]),c&&(o=c[r])}if(a!==o)if(o){if(o!==a)if(-1===a)n.seekIndex((null==(i=this.slideAnimationManager.mainSeq)?void 0:i.length)||0);else if(o<=n.length&&o>=0){var u=o-(a||0);u>0?((n.index===o-2&&n.isPlaying||u>1)&&n.seekIndex(o-1),n.play()):u<0&&(n.pause(),n.seekIndex(o))}else o>n.length&&(n.pause(),n.seekIndex(n.length))}else n.pause(),n.seekIndex(0)}},{key:"resetAnimationSteps",value:function(){var e={},t={},n={};return this.masterAnimationManager.interactiveSeqs.forEach((function(e,t){n[t]=0})),n[bw]=0,this.layoutAnimationManager.interactiveSeqs.forEach((function(e,n){t[n]=0})),t[bw]=0,this.masterAnimationManager.interactiveSeqs.forEach((function(t,n){e[n]=0})),e[bw]=0,{sequenceSteps:e,layoutSequenceSteps:t,masterSequenceSteps:n,hasChangeStep:!1}}},{key:"resetAnimation",value:function(){var e=this.props,t=e.stateAdapter,n=e.data,r=this.resetAnimationSteps(),i=Ny(Ry({},this.state),a({},this.currentSlideKey,r));t.setState(n.uuid,n.index,i)}},{key:"resetCurrentSlideAnimation",value:function(){var e=this.props,t=e.stateAdapter,n=e.data,r=Ny(Ry({},this.state),a({},this.currentSlideKey,void 0));t.setState(n.uuid,n.index,r)}},{key:"resetCurrentPPTAnimation",value:function(){var e=this,t=this.state,n=t.disableAutoPlay,r=t.pageIndex,i=t.playLastStep,a=t.progressIndex,o=t.uuid;if(t[this.currentSlideKey]){var s=this.props,c=s.data,u=s.stateAdapter,l={disableAutoPlay:n,pageIndex:r,playLastStep:i,progressIndex:a,uuid:o,preSlideIndex:s.pptState.preSlideIndex},h=Object.keys(this.state).filter((function(e){return e.includes(c.uuid)})).map((function(t){var n=e.state[t];return Ry({key:t},n)})),d={};h.forEach((function(e){var t=e.key;d[t]=void 0})),l=Ry(Ry({},l),d),u.setState(c.uuid,c.index,l)}}},{key:"toNextPage",value:function(){var e=this.props.stateAdapter;e.onPageToNext&&e.onPageToNext()}},{key:"toPrevPage",value:function(){var e=this.props.stateAdapter;e.onPageToPrev&&e.onPageToPrev()}},{key:"changeStep",value:function(e){var t,n,r=this.props,i=r.stateAdapter,o=r.data,s=this.getMainStepsFromSequences(),c=l(this.getCurrentSequences(null!=s?s:1,void 0,e<0),2),u=c[0],h=c[1];if(void 0!==u&&void 0!==h){var d=u[bw];if(void 0!==d&&0!==this.mainAnimationManager.mainSeq.length){d<0&&(this.masterAnimationManager.triggerEvent.emit("onEnd",{target:"slide"}),d=this.mainAnimationManager.mainSeq.length);var p=d+e;p<0?this.onPageToPrev():p>this.getCurrentSequenceAnimationCount(h)?this.onPageToNext():1===d&&0===p?i.setState(o.uuid,o.index,Ry({},this.composeSlideStateIntoPPTState((a(t={},h,Ny(Ry({},u),a({},bw,p))),a(t,"hasChangeStep",!0),t),!0))):i.setState(o.uuid,o.index,Ry({},this.composeSlideStateIntoPPTState((a(n={},h,Ny(Ry({},u),a({},bw,p))),a(n,"hasChangeStep",!0),n))))}else e>0?this.onPageToNext():e<0&&this.onPageToPrev()}}},{key:"renderMediaControllerPortal",value:function(e){return 0===this.props.renderMode?cv.default.createElement("div",{id:"netless-media-controller-portal-".concat(e.uuid),style:{position:"absolute",zIndex:1e3}}):null}},{key:"render",value:function(){var e,t,n,r,i,a,o,s=this.props,c=s.disableAnimation,u=s.renderMode,l=s.className,h=s.data,d=s.pausing,p=s.userId,f=s.callbacks,v=s.pptState,m=h.slideXML.childElement("p:sld","p:cSld","p:spTree"),g=h.masterXML.childElement("p:sldMaster","p:cSld","p:spTree"),y=h.layoutXML.childElement("p:sldLayout","p:cSld","p:spTree"),b=h.slideXML.childElement("p:sld","p:cSld"),k={uuid:h.uuid,resourceLoader:h.resourceLoader,slideWidth:h.width,slideHeight:h.height,preSlideIndex:this.preSlideIndex,slideIndex:h.index+1,preload:h.preload,slideCount:h.slidesCount},w=c;void 0!==u&&1===u&&(w=!0);var S=null==(e=null==v?void 0:v.mediaStates)?void 0:e[this.currentSlideKey];return cv.default.createElement(Eb,{className:l,slideContext:k,slideRef:this.slide,cSld:b,resourceLoader:h.resourceLoader},this.renderMediaControllerPortal(h),this.isRenderMaster&&cv.default.createElement(yw,{uuid:h.uuid,logger:h.logger,slideRef:this.slide,slideContext:k,shapeGroupXML:g,resourceType:"master",disableAnimation:w,zIndex:0,wrapResource:null==(t=h.WrapResource)?void 0:t.master,ref:this.shapeGroupRef,pausing:d,userId:p,interactiveSeqsKeys:this.masterInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:S,mediaSlideActionUserIds:null==(n=null==v?void 0:v.mediaActionUserIds)?void 0:n[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:h.rtcClient,animationManager:this.masterAnimationManager}),cv.default.createElement(yw,{uuid:h.uuid,logger:h.logger,slideRef:this.slide,slideContext:k,shapeGroupXML:y,resourceType:"layout",disableAnimation:w,zIndex:1,wrapResource:null==(r=h.WrapResource)?void 0:r.layout,ref:this.shapeGroupRef,pausing:d,userId:p,interactiveSeqsKeys:this.layoutInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:S,mediaSlideActionUserIds:null==(i=null==v?void 0:v.mediaActionUserIds)?void 0:i[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:h.rtcClient,animationManager:this.layoutAnimationManager}),cv.default.createElement(yw,{uuid:h.uuid,ref:this.shapeGroupRef,shapeGroupXML:m,pausing:d,userId:p,logger:h.logger,slideRef:this.slide,slideContext:k,resourceType:"slide",interactiveSeqsKeys:this.slideInteractiveSeqsKeys||[],zIndex:2,onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:S,mediaSlideActionUserIds:null==(a=null==v?void 0:v.mediaActionUserIds)?void 0:a[this.currentSlideKey],disableAnimation:w,onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:f?f.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:h.rtcClient,wrapResource:null==(o=h.WrapResource)?void 0:o.slide,animationManager:this.slideAnimationManager}))}}]),n}(cv.default.Component);function Cw(e,t){var n,r={},i={},a={},o=T(e.elements);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.childElementOptional(new Zy("p:nvSpPr","p:nvCxnSpPr"));if(c){var u=c.childElement("p:cNvPr").attr.getStringOptional("id"),l=c.childElementOptional("p:nvPr","p:ph"),h=l&&l.attr.getStringOptional("idx"),d=l&&l.attr.getStringOptional("type");void 0!==u&&(r[u]=s),void 0!==h?i[h]=s:("title"===d||"ctrTitle"===d)&&(i[0]=s),"title"===d||"ctrTitle"===d?(a.title=s,a.ctrTitle=s):void 0!==d&&(a[d]=s)}}}catch(e){o.e(e)}finally{o.f()}return Object.freeze(t?{idIndex:Object.freeze(r),idxIndex:Object.freeze(i),typeIndex:Object.freeze(a),txStyle:Object.freeze(Iw(t))}:{idIndex:Object.freeze(r),idxIndex:Object.freeze(i),typeIndex:Object.freeze(a)})}function Iw(e){var t={},n=e.elementWithName("p:bodyStyle");n&&(t.body=n);var r=e.elementWithName("p:titleStyle");r&&(t.title=r,t.subTitle=r,t.ctrTitle=r);var i=e.elementWithName("p:otherStyle");return i&&(t.other=i),t}var Pw=function(){function e(t,n){C(this,e),this.resource=t,this.resourceScheme=n}return P(e,[{key:"loadURL",value:function(e,t){var n=this.resource[e]&&this.resource[e][t];return void 0===n||(n=this.replaceProtocolByresourceScheme(n)),n}},{key:"replaceProtocolByresourceScheme",value:function(e){var t=e;return this.resourceScheme&&(t=t.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),t}}]),e}();var Mw=function(e,t,n,r,i){var a,o=function(e,t,n,r){var i=n.bodyPrXMlList;return i||(i=n.bodyPrXMlList=Object.freeze(function(e,t,n){var r,i=[],a=Ok(e.parentElement(new Zy("p:sp","p:graphicFrame")),t,n),o=a.allShape,s=a.hasPlaceHolder,c=T(o);try{for(c.s();!(r=c.n()).done;){var u=r.value.childElementOptional("p:txBody","a:bodyPr");u&&i.push(u)}}catch(e){c.e(e)}finally{c.f()}return{pPrXMLList:i,hasPlaceHolder:s}}(e,t,r))),i}(e,t,r,i),s=T(o.pPrXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value.attr.getOptional(n);if(void 0!==c)return c}}catch(e){s.e(e)}finally{s.f()}};var Tw=function(e,t,n,r,i){var a,o=T(Ow(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.attr.getOptional(n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},Aw=function(e,t){return function(n,r,i,a,o){var s,c=Ow(n,r,a,o),u=c.pPrXMLList,l=c.hasPlaceHolder,h=T(u);try{for(h.s();!(s=h.n()).done;){var d=s.value.attr.getOptional(i);if(void 0!==d)return d}}catch(e){h.e(e)}finally{h.f()}return l?e:t}},Ew=function(e,t,n,r,i){return Ow(e,t,r,i).level};function Ow(e,t,n,r){var i=n.pPrXMlList;return i||(i=n.pPrXMlList=Object.freeze(function(e,t,n){var r=[],i=e.parentElement(new Zy("p:sp","p:graphicFrame")),a=e.childElementOptional("a:pPr"),o=0;a&&(r.push(a),o=a.attr.getNumber("lvl",0));var s,c="a:lvl".concat(o+1,"pPr"),u=Ok(i,t,n),l=u.allShape,h=u.placeHolderType,d=u.masterStyleXML,p=u.hasPlaceHolder,f=T(l);try{for(f.s();!(s=f.n()).done;){var v=s.value.childElementOptional("p:txBody","a:lstStyle",c);v&&r.push(v)}}catch(e){f.e(e)}finally{f.f()}if(d){var m=d.childElementOptional(c);m&&r.push(m)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:p}}(e,t,r))),i}var Rw=function(e,t,n,r,i){var a,o=T(jw(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.attr.getOptional(n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},Nw=function(e,t){var n=e.childElementOptional("a:rPr","a:highlight",m(Zy,fb));if(n)return Sb(n,t)},Lw=function(e,t,n,r,i){var a=Rw(e,t,"sz",r,i),o=Rw(e,t,"kern",r,i);return a||o};function jw(e,t,n,r){var i=n.rangeXMlList;return i||(i=n.rangeXMlList=Object.freeze(function(e,t,n){var r,i=e.elementWithName("a:rPr");r="a:p"===e.name?e:e.parentElement("a:p");var a=function(e,t,n){var r=[],i=e.parentElement(new Zy("p:sp","p:graphicFrame")),a=e.childElementOptional("a:pPr"),o=0;if(a){o=a.attr.getNumber("lvl",0);var s=a.childElementOptional("a:defRPr");s&&r.push(s)}var c,u="a:lvl".concat(o+1,"pPr"),l=Ok(i,t,n),h=l.allShape,d=l.placeHolderType,p=l.masterStyleXML,f=l.hasPlaceHolder,v=T(h);try{for(v.s();!(c=v.n()).done;){var m=c.value,g=m.childElementOptional("p:txBody","a:lstStyle",u,"a:defRPr");g&&r.push(g);var y=m.childElementOptional("p:style");if(y){var b=vb(y,t);r.push(b.font.fontRef),b.font.xml&&r.push(b.font.xml)}}}catch(e){v.e(e)}finally{v.f()}if(p){var k=p.childElementOptional(u,"a:defRPr");k&&r.push(k)}return{pPrXMLList:r,placeHolderType:d,level:o,hasPlaceHolder:f}}(r,t,n),o=a.placeHolderType,s=a.pPrXMLList,c=a.level,u=a.hasPlaceHolder;return i?{placeHolderType:o,pPrXMLList:[e,i].concat(p(s)),level:c,hasPlaceHolder:u}:{placeHolderType:o,pPrXMLList:[e].concat(p(s)),level:c,hasPlaceHolder:u}}(e,t,r))),i}var Dw=function(e,t,n,r,i){var a,o=T(jw(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.childElementOptional(m(Zy,pb));if(c)return(new Ib).read(c,t);var u=s.childElementOptional(m(Zy,fb));if(u)return Sb(u,t)}}catch(e){o.e(e)}finally{o.f()}},Fw=function(e,t,n,r,i){var a,o=jw(e,t,r,i),s=[],c=T(o.pPrXMLList);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=u.childElementOptional("a:latin"),h=u.childElementOptional("a:ea");if(l){var d=l.attr.getOptional("typeface");"string"==typeof d&&s.push(d)}if(h){var p=h.attr.getOptional("typeface");"string"==typeof p&&s.push(p)}}}catch(e){c.e(e)}finally{c.f()}s=function(e){switch(e){case"title":case"ctrTitle":return!0;default:return!1}}(o.placeHolderType)?s.concat(db(cb(t))):s.concat(db(ub(t))),s=s.filter((function(e){return""!==e}));var f=[],v=cb(t),m=ub(t);return s.forEach((function(e){switch(e){case"+mj-lt":f=v.latin?f.concat(v.latin):f;break;case"+mj-ea":f=v.ea?f.concat(v.ea):f;break;case"+mj-cs":case"+mn-cs":f=v.cs?f.concat(v.cs):f;break;case"+mn-lt":f=m.latin?f.concat(m.latin):f;break;case"+mn-ea":f=m.ea?f.concat(m.ea):f;break;default:f.push(e)}})),f.forEach((function(e){rb(e,t.userFonts).then((function(){}),(function(){}))})),f.join(",")},zw=function(e){var t=e.parentElement(new Zy("p:sp","p:graphicFrame")).childElementOptional(new Zy("p:nvSpPr","p:nvCxnSpPr"));return t&&t.childElementOptional("p:nvPr","p:ph")?"true":"false"},Bw=function(e,t,n,r,i){var a,o=T(Ow(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional(new Zy("a:buChar","a:buNone","a:buAutoNum","a:buBlip"));if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},Uw=function(e,t,n,r,i){var a,o=T(Ow(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("a:buClr");if(s)return Sb(s.childElement(m(Zy,fb)),t)}}catch(e){o.e(e)}finally{o.f()}};function Vw(e){var t=e.childElementOptional("a:lnSpc",new Zy("a:spcPct","a:spcPts"));if(t){var n=0,r=e.parentElementOptional("p:txBody");if(r){var i=r.childElementOptional("a:bodyPr","a:normAutofit");i&&(n=zy(i.attr.getNumber("lnSpcReduction",0)))}switch(t.name){case"a:spcPct":return 1.2*zy(t.attr.getString("val"))-n;case"a:spcPts":return"".concat(t.attr.getNumber("val")/100*(1-n),"pt");default:return}}}var Ww=function(e,t,n,r,i){var a,o=T(Ow(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=Vw(a.value);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}return 1},Hw=function(e,t,n,r,i){var a,o=T(Ow(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=_w(a.value,n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}};function _w(e,t){var n=e.childElementOptional(t,new Zy("a:spcPct","a:spcPts"));if(n)switch(n.name){case"a:spcPct":return zy(n.attr.getString("val"));case"a:spcPts":return"".concat(n.attr.getNumber("val")/100,"pt");default:return}}function Gw(e,t,n){var r,i=T(Ok(e,t,n).allShape);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.childElementOptional("p:spPr","a:xfrm","a:off");if(void 0!==o||void 0!==(o=a.childElementOptional("p:xfrm","a:off")))return o}}catch(e){i.e(e)}finally{i.f()}var s=Xw(e,t,n);return s&&s.childElementOptional("a:off")}function Yw(e,t,n){var r,i=T(Ok(e,t,n).allShape);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.childElementOptional("p:spPr","a:xfrm","a:ext");if(void 0!==o||void 0!==(o=a.childElementOptional("p:xfrm","a:ext")))return o}}catch(e){i.e(e)}finally{i.f()}var s=Xw(e,t,n);return s&&s.childElementOptional("a:ext")}function Xw(e,t,n){var r;if("slide"===n){var i=e.childElementOptional("p:spPr","a:xfrm");if(i)return i;var a=null==(r=e.childElementOptional("p:nvPicPr","p:nvPr","p:ph"))?void 0:r.attr.getStringOptional("idx");if(a){var o=t.layoutIndex.idxIndex[a];if(o)return o.childElementOptional("p:spPr","a:xfrm");var s=t.masterIndex.idxIndex[a];return s?s.childElementOptional("p:spPr","a:xfrm"):void 0}}}var Qw=["","styleName","wholeTbl","tcTxStyle","fontRef","minor","idx","scrgbClr","0","r","g","b","schemeClr","tx1","val","","tcStyle","tcBdr","left","ln","12700","w","sng","cmpd","solidFill","right","top","bottom","insideH","insideV"," 1 -  1","tblBg","fillRef","2","accent1","effectRef","1","dk1","lnRef","band1H","fill","alpha","40000","band1V","lastCol","on","firstCol","lastRow","firstRow","lt1"," 1 -  2","accent2"," 1 -  3","accent3"," 1 -  4","accent4"," 1 -  5","accent5"," 1 -  6","accent6"," 2 -  1","3","tint","50000","20000"," 2 -  2"," 2 -  3"," 2 -  4"," 2 -  5"," 2 -  6"," 1"," 1 -  1"," 1 -  2"," 1 -  3"," 1 -  4"," 1 -  5"," 1 -  6"," 2","band2V","50800","dbl","bg1"," 2 -  1"," 2 -  2"," 2 -  3"," 2 -  4"," 2 -  5"," 2 -  6"," 3","25400"," 3 -  1"," 3 -  2"," 3 -  3"," 3 -  4"," 3 -  5"," 3 -  6"," 1"," 1 -  1"," 1 -  2"," 1 -  3"," 1 -  4"," 1 -  5"," 1 -  6"," 2","prstClr","black","38100"," 2 -  1"," 2 -  2"," 2 -  3"," 2 -  4"," 2 -  5"," 2 -  6"," 3","seCell","swCell"," 3 -  1"," 3 -  2"," 3 -  3"," 3 -  4"," 3 -  5"," 3 -  6"," 4"," 4 -  1"," 4 -  2"," 4 -  3"," 4 -  4"," 4 -  5"," 4 -  6"," 1","60000"," 1 -  1","shade"," 1 -  2"," 1 -  3"," 1 -  4"," 1 -  5"," 1 -  6"," 2"," 2 -  1/ 2"," 2 -  3/ 4"," 2 -  5/ 6"],Kw=[{4:{6:5,7:{9:8,10:8,11:8}},12:{14:13}},{19:{21:20,23:22,24:{12:{14:13}}}},{4:{6:5,7:{9:8,10:8,11:8}},12:{14:37}},{38:{6:36,12:{14:34}}},{6:33,12:{14:34}},{6:36,12:{14:34}},{14:42},{11:45},{38:{6:33,12:{14:34}}},{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},{24:{12:{14:34}}},{38:{6:33,12:{14:49}}},{38:{6:36,12:{14:51}}},{6:33,12:{14:51}},{6:36,12:{14:51}},{38:{6:33,12:{14:51}}},{24:{12:{14:51}}},{38:{6:36,12:{14:53}}},{6:33,12:{14:53}},{6:36,12:{14:53}},{38:{6:33,12:{14:53}}},{24:{12:{14:53}}},{38:{6:36,12:{14:55}}},{6:33,12:{14:55}},{6:36,12:{14:55}},{38:{6:33,12:{14:55}}},{24:{12:{14:55}}},{38:{6:36,12:{14:57}}},{6:33,12:{14:57}},{6:36,12:{14:57}},{38:{6:33,12:{14:57}}},{24:{12:{14:57}}},{38:{6:36,12:{14:59}}},{6:33,12:{14:59}},{6:36,12:{14:59}},{38:{6:33,12:{14:59}}},{24:{12:{14:59}}},{16:{40:{24:{12:{14:49,41:{14:64}}}}}},{3:{11:45},16:{17:{18:{38:{6:33,12:{14:49}}}}}},{3:{11:45},16:{17:{25:{38:{6:33,12:{14:49}}}}}},{3:{11:45},16:{17:{26:{38:{6:33,12:{14:49}}}}}},{3:{11:45},16:{17:{27:{38:{6:61,12:{14:49}}}}}},{4:{6:5,7:{9:8,10:8,11:8}},12:{14:49}},{38:{6:36,12:{14:34,62:{14:63}}}},{14:34},{38:{6:36,12:{14:51,62:{14:63}}}},{14:51},{38:{6:36,12:{14:53,62:{14:63}}}},{14:53},{38:{6:36,12:{14:55,62:{14:63}}}},{14:55},{38:{6:36,12:{14:57,62:{14:63}}}},{14:57},{38:{6:36,12:{14:59,62:{14:63}}}},{14:59},{16:{40:{24:{12:{14:13,41:{14:64}}}}}},{3:{11:45}},{16:{40:{24:{12:{14:34,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:34}}}},{16:{40:{24:{12:{14:51,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:51}}}},{16:{40:{24:{12:{14:53,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:53}}}},{16:{40:{24:{12:{14:55,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:55}}}},{16:{40:{24:{12:{14:57,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:57}}}},{16:{40:{24:{12:{14:59,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:59}}}},{38:{6:36,12:{14:13}}},{12:{14:13}},{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:81}},{6:36,12:{14:13}},{26:{19:{21:79,23:80,24:{12:{14:34}}}}},{26:{19:{21:79,23:80,24:{12:{14:51}}}}},{26:{19:{21:79,23:80,24:{12:{14:53}}}}},{26:{19:{21:79,23:80,24:{12:{14:55}}}}},{26:{19:{21:79,23:80,24:{12:{14:57}}}}},{26:{19:{21:79,23:80,24:{12:{14:59}}}}},{12:{14:34}},{12:{14:51}},{12:{14:53}},{12:{14:55}},{12:{14:57}},{12:{14:59}},{16:{40:{24:{12:{14:37,62:{14:64}}}}}},{3:{11:45},16:{17:{26:{19:{21:79,23:80,24:{12:{14:37}}}}},40:{24:{12:{14:49}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:37}}}}},{24:{12:{14:49}}},{19:{21:20,23:22,24:{12:{14:37}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:34}}}}},{40:{24:{12:{14:34,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:51}}}}},{40:{24:{12:{14:51,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:53}}}}},{40:{24:{12:{14:53,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:55}}}}},{40:{24:{12:{14:55,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:57}}}}},{40:{24:{12:{14:57,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:59}}}}},{40:{24:{12:{14:59,62:{14:64}}}}},{16:{40:{24:{12:{14:37,62:{14:42}}}}}},{4:{6:5,104:{14:105}},12:{14:37}},{18:{19:{21:20,23:22,24:{12:{14:49}}}},25:{19:{21:20,23:22,24:{12:{14:49}}}},26:{19:{21:20,23:22,24:{12:{14:49}}}},27:{19:{21:20,23:22,24:{12:{14:49}}}},28:{19:{21:20,23:22,24:{12:{14:49}}}},29:{19:{21:20,23:22,24:{12:{14:49}}}}},{24:{12:{14:37,62:{14:64}}}},{4:{6:5,104:{14:105}},11:45,12:{14:49}},{40:{24:{12:{14:37}}}},{26:{19:{21:106,23:22,24:{12:{14:49}}}}},{24:{12:{14:37}}},{27:{19:{21:106,23:22,24:{12:{14:49}}}}},{16:{40:{24:{12:{14:34,62:{14:42}}}}}},{24:{12:{14:34,62:{14:64}}}},{40:{24:{12:{14:34}}}},{16:{40:{24:{12:{14:51,62:{14:42}}}}}},{24:{12:{14:51,62:{14:64}}}},{40:{24:{12:{14:51}}}},{16:{40:{24:{12:{14:53,62:{14:42}}}}}},{24:{12:{14:53,62:{14:64}}}},{40:{24:{12:{14:53}}}},{16:{40:{24:{12:{14:55,62:{14:42}}}}}},{24:{12:{14:55,62:{14:64}}}},{40:{24:{12:{14:55}}}},{16:{40:{24:{12:{14:57,62:{14:42}}}}}},{24:{12:{14:57,62:{14:64}}}},{40:{24:{12:{14:57}}}},{16:{40:{24:{12:{14:59,62:{14:42}}}}}},{24:{12:{14:59,62:{14:64}}}},{40:{24:{12:{14:59}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:37}}},{17:{26:{19:{21:89,23:22,24:{12:{14:37}}}},27:{19:{21:89,23:22,24:{12:{14:37}}}}},40:{24:{12:{14:49}}}},{14:37},{27:{19:{21:89,23:22,24:{12:{14:37}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},12:{14:37}},16:{17:{26:{19:{21:89,23:22,24:{12:{14:37}}}},27:{19:{21:89,23:22,24:{12:{14:37}}}}},40:{24:{12:{14:49}}}}},{19:{21:89,23:22,24:{12:{14:37}}}},{40:{24:{12:{14:37,62:{14:64}}}}},{3:{11:45},16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:{24:{12:{14:37}}}}},{18:{19:{21:89,23:22,24:{12:{14:49}}}}},{24:{12:{14:37,62:{14:130}}}},{25:{19:{21:89,23:22,24:{12:{14:49}}}}},{26:{19:{21:89,23:22,24:{12:{14:49}}}}},{24:{12:{14:34,132:{14:130}}}},{24:{12:{14:51,132:{14:130}}}},{24:{12:{14:53,132:{14:130}}}},{24:{12:{14:55,132:{14:130}}}},{24:{12:{14:57,132:{14:130}}}},{24:{12:{14:59,132:{14:130}}}},{26:{19:{21:79,23:80,24:{12:{14:37}}}}}],qw={"{2D5ABB26-0587-4C30-8999-92F81FD0307C}":{1:0,2:{3:Kw[0]}},"{5940675A-B579-460E-94D1-54222C63F5DA}":{1:15,2:{3:Kw[0],16:{17:{18:Kw[1],25:Kw[1],26:Kw[1],27:Kw[1],28:Kw[1],29:Kw[1]}}}},"{3C2FFA5D-87B4-456A-9821-1D502468CF0F}":{1:30,2:{3:Kw[2],16:{17:{18:Kw[3],25:Kw[3],26:Kw[3],27:Kw[3],28:Kw[3],29:Kw[3]}}},31:{32:Kw[4],35:Kw[5]},39:{16:{40:{24:{12:{14:34,41:Kw[6]}}}}},43:{16:{17:{26:Kw[3],27:Kw[3]},40:{24:{12:{14:34,41:Kw[6]}}}}},44:{3:Kw[7],16:{17:{18:{38:Kw[4]},25:Kw[3],26:Kw[3],27:Kw[3],28:Kw[3]}}},46:{3:Kw[7],16:{17:{18:Kw[3],25:{38:Kw[4]},26:Kw[3],27:Kw[3],28:Kw[3]}}},47:{3:Kw[7],16:{17:{18:Kw[3],25:Kw[3],26:{38:Kw[4]},27:{38:Kw[4]}}}},48:{3:Kw[9],16:{17:{18:Kw[3],25:Kw[3],26:Kw[3],27:Kw[11]},40:Kw[10]}}},"{284E427A-3D55-4303-BF80-6455036E1DE7}":{1:50,2:{3:Kw[2],16:{17:{18:Kw[12],25:Kw[12],26:Kw[12],27:Kw[12],28:Kw[12],29:Kw[12]}}},31:{32:Kw[13],35:Kw[14]},39:{16:{40:{24:{12:{14:51,41:Kw[6]}}}}},43:{16:{17:{26:Kw[12],27:Kw[12]},40:{24:{12:{14:51,41:Kw[6]}}}}},44:{3:Kw[7],16:{17:{18:{38:Kw[13]},25:Kw[12],26:Kw[12],27:Kw[12],28:Kw[12]}}},46:{3:Kw[7],16:{17:{18:Kw[12],25:{38:Kw[13]},26:Kw[12],27:Kw[12],28:Kw[12]}}},47:{3:Kw[7],16:{17:{18:Kw[12],25:Kw[12],26:{38:Kw[13]},27:{38:Kw[13]}}}},48:{3:Kw[9],16:{17:{18:Kw[12],25:Kw[12],26:Kw[12],27:Kw[11]},40:Kw[16]}}},"{69C7853C-536D-4A76-A0AE-DD22124D55A5}":{1:52,2:{3:Kw[2],16:{17:{18:Kw[17],25:Kw[17],26:Kw[17],27:Kw[17],28:Kw[17],29:Kw[17]}}},31:{32:Kw[18],35:Kw[19]},39:{16:{40:{24:{12:{14:53,41:Kw[6]}}}}},43:{16:{17:{26:Kw[17],27:Kw[17]},40:{24:{12:{14:53,41:Kw[6]}}}}},44:{3:Kw[7],16:{17:{18:{38:Kw[18]},25:Kw[17],26:Kw[17],27:Kw[17],28:Kw[17]}}},46:{3:Kw[7],16:{17:{18:Kw[17],25:{38:Kw[18]},26:Kw[17],27:Kw[17],28:Kw[17]}}},47:{3:Kw[7],16:{17:{18:Kw[17],25:Kw[17],26:{38:Kw[18]},27:{38:Kw[18]}}}},48:{3:Kw[9],16:{17:{18:Kw[17],25:Kw[17],26:Kw[17],27:Kw[11]},40:Kw[21]}}},"{775DCB02-9BB8-47FD-8907-85C794F793BA}":{1:54,2:{3:Kw[2],16:{17:{18:Kw[22],25:Kw[22],26:Kw[22],27:Kw[22],28:Kw[22],29:Kw[22]}}},31:{32:Kw[23],35:Kw[24]},39:{16:{40:{24:{12:{14:55,41:Kw[6]}}}}},43:{16:{17:{26:Kw[22],27:Kw[22]},40:{24:{12:{14:55,41:Kw[6]}}}}},44:{3:Kw[7],16:{17:{18:{38:Kw[23]},25:Kw[22],26:Kw[22],27:Kw[22],28:Kw[22]}}},46:{3:Kw[7],16:{17:{18:Kw[22],25:{38:Kw[23]},26:Kw[22],27:Kw[22],28:Kw[22]}}},47:{3:Kw[7],16:{17:{18:Kw[22],25:Kw[22],26:{38:Kw[23]},27:{38:Kw[23]}}}},48:{3:Kw[9],16:{17:{18:Kw[22],25:Kw[22],26:Kw[22],27:Kw[11]},40:Kw[26]}}},"{35758FB7-9AC5-4552-8A53-C91805E547FA}":{1:56,2:{3:Kw[2],16:{17:{18:Kw[27],25:Kw[27],26:Kw[27],27:Kw[27],28:Kw[27],29:Kw[27]}}},31:{32:Kw[28],35:Kw[29]},39:{16:{40:{24:{12:{14:57,41:Kw[6]}}}}},43:{16:{17:{26:Kw[27],27:Kw[27]},40:{24:{12:{14:57,41:Kw[6]}}}}},44:{3:Kw[7],16:{17:{18:{38:Kw[28]},25:Kw[27],26:Kw[27],27:Kw[27],28:Kw[27]}}},46:{3:Kw[7],16:{17:{18:Kw[27],25:{38:Kw[28]},26:Kw[27],27:Kw[27],28:Kw[27]}}},47:{3:Kw[7],16:{17:{18:Kw[27],25:Kw[27],26:{38:Kw[28]},27:{38:Kw[28]}}}},48:{3:Kw[9],16:{17:{18:Kw[27],25:Kw[27],26:Kw[27],27:Kw[11]},40:Kw[31]}}},"{08FB837D-C827-4EFA-A057-4D05807E0F7C}":{1:58,2:{3:Kw[2],16:{17:{18:Kw[32],25:Kw[32],26:Kw[32],27:Kw[32],28:Kw[32],29:Kw[32]}}},31:{32:Kw[33],35:Kw[34]},39:{16:{40:{24:{12:{14:59,41:Kw[6]}}}}},43:{16:{17:{26:Kw[32],27:Kw[32]},40:{24:{12:{14:59,41:Kw[6]}}}}},44:{3:Kw[7],16:{17:{18:{38:Kw[33]},25:Kw[32],26:Kw[32],27:Kw[32],28:Kw[32]}}},46:{3:Kw[7],16:{17:{18:Kw[32],25:{38:Kw[33]},26:Kw[32],27:Kw[32],28:Kw[32]}}},47:{3:Kw[7],16:{17:{18:Kw[32],25:Kw[32],26:{38:Kw[33]},27:{38:Kw[33]}}}},48:{3:Kw[9],16:{17:{18:Kw[32],25:Kw[32],26:Kw[32],27:Kw[11]},40:Kw[36]}}},"{D113A9D2-9D6B-4929-AA2D-F23B5EE8CBE7}":{1:60,2:{3:Kw[42],16:{17:{18:Kw[43],25:Kw[43],26:Kw[43],27:Kw[43]}}},31:{32:{6:61,12:Kw[44]},35:{6:61,12:Kw[44]}},39:Kw[37],43:Kw[37],44:{3:Kw[7],16:{17:{18:Kw[11]}}},46:{3:Kw[7],16:{17:{25:Kw[11]}}},47:{3:Kw[7],16:{17:{26:Kw[11]}}},48:{3:Kw[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{18603FDC-E32A-4AB5-989C-0864C3EAD2B8}":{1:65,2:{3:Kw[42],16:{17:{18:Kw[45],25:Kw[45],26:Kw[45],27:Kw[45]}}},31:{32:{6:61,12:Kw[46]},35:{6:61,12:Kw[46]}},39:Kw[37],43:Kw[37],44:{3:Kw[7],16:{17:{18:Kw[11]}}},46:{3:Kw[7],16:{17:{25:Kw[11]}}},47:{3:Kw[7],16:{17:{26:Kw[11]}}},48:{3:Kw[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{306799F8-075E-4A3A-A7F6-7FBC6576F1A4}":{1:66,2:{3:Kw[42],16:{17:{18:Kw[47],25:Kw[47],26:Kw[47],27:Kw[47]}}},31:{32:{6:61,12:Kw[48]},35:{6:61,12:Kw[48]}},39:Kw[37],43:Kw[37],44:{3:Kw[7],16:{17:{18:Kw[11]}}},46:{3:Kw[7],16:{17:{25:Kw[11]}}},47:{3:Kw[7],16:{17:{26:Kw[11]}}},48:{3:Kw[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{E269D01E-BC32-4049-B463-5C60D7B0CCD2}":{1:67,2:{3:Kw[42],16:{17:{18:Kw[49],25:Kw[49],26:Kw[49],27:Kw[49]}}},31:{32:{6:61,12:Kw[50]},35:{6:61,12:Kw[50]}},39:Kw[37],43:Kw[37],44:{3:Kw[7],16:{17:{18:Kw[11]}}},46:{3:Kw[7],16:{17:{25:Kw[11]}}},47:{3:Kw[7],16:{17:{26:Kw[11]}}},48:{3:Kw[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{327F97BB-C833-4FB7-BDE5-3F7075034690}":{1:68,2:{3:Kw[42],16:{17:{18:Kw[51],25:Kw[51],26:Kw[51],27:Kw[51]}}},31:{32:{6:61,12:Kw[52]},35:{6:61,12:Kw[52]}},39:Kw[37],43:Kw[37],44:{3:Kw[7],16:{17:{18:Kw[11]}}},46:{3:Kw[7],16:{17:{25:Kw[11]}}},47:{3:Kw[7],16:{17:{26:Kw[11]}}},48:{3:Kw[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{638B1855-1B75-4FBE-930C-398BA8C253C6}":{1:69,2:{3:Kw[42],16:{17:{18:Kw[53],25:Kw[53],26:Kw[53],27:Kw[53]}}},31:{32:{6:61,12:Kw[54]},35:{6:61,12:Kw[54]}},39:Kw[37],43:Kw[37],44:{3:Kw[7],16:{17:{18:Kw[11]}}},46:{3:Kw[7],16:{17:{25:Kw[11]}}},47:{3:Kw[7],16:{17:{26:Kw[11]}}},48:{3:Kw[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{9D7B26C5-4107-4FEC-AEDC-1716B250A1EF}":{1:70,2:{3:Kw[0],16:{17:{26:Kw[1],27:Kw[1]}}},39:Kw[55],43:Kw[55],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:Kw[1]}}},48:{3:Kw[7],16:{17:{27:Kw[1]}}}},"{3B4B98B0-60AC-42C2-AFA5-B58CD77FA1E5}":{1:71,2:{3:Kw[0],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[44]}}},27:{19:{21:20,23:22,24:{12:Kw[44]}}}}}},39:Kw[57],43:Kw[57],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[44]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:20,23:22,24:{12:Kw[44]}}}}}}},"{0E3FDE45-AF77-4B5C-9715-49D594BDF05E}":{1:72,2:{3:Kw[0],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[46]}}},27:{19:{21:20,23:22,24:{12:Kw[46]}}}}}},39:Kw[59],43:Kw[59],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[46]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:20,23:22,24:{12:Kw[46]}}}}}}},"{C083E6E3-FA7D-4D7B-A595-EF9225AFEA82}":{1:73,2:{3:Kw[0],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[48]}}},27:{19:{21:20,23:22,24:{12:Kw[48]}}}}}},39:Kw[61],43:Kw[61],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[48]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:20,23:22,24:{12:Kw[48]}}}}}}},"{D27102A9-8310-4765-A935-A1911B00CA55}":{1:74,2:{3:Kw[0],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[50]}}},27:{19:{21:20,23:22,24:{12:Kw[50]}}}}}},39:Kw[63],43:Kw[63],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[50]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:20,23:22,24:{12:Kw[50]}}}}}}},"{5FD0F851-EC5A-4D38-B0AD-8093EC10F338}":{1:75,2:{3:Kw[0],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[52]}}},27:{19:{21:20,23:22,24:{12:Kw[52]}}}}}},39:Kw[65],43:Kw[65],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[52]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:20,23:22,24:{12:Kw[52]}}}}}}},"{68D230F3-CF80-4859-8CE7-A43EE81993B5}":{1:76,2:{3:Kw[0],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[54]}}},27:{19:{21:20,23:22,24:{12:Kw[54]}}}}}},39:Kw[67],43:Kw[67],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:20,23:22,24:{12:Kw[54]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:20,23:22,24:{12:Kw[54]}}}}}}},"{7E9639D4-E3E2-4D34-9284-5A2195B3D0D7}":{1:77,2:{3:Kw[0],16:{17:{18:Kw[69],25:Kw[69],26:Kw[69],27:Kw[69]}}},39:{16:{17:{26:Kw[69],27:Kw[69]}}},43:{16:{17:{18:Kw[69],25:Kw[69]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:Kw[70]}}}}},48:{3:Kw[71],16:{32:Kw[72]}},78:{16:{17:{18:Kw[69],25:Kw[69]}}}},"{69012ECD-51FC-41F1-AA8D-1B2483CD663E}":{1:82,2:{3:Kw[0],16:{17:{18:Kw[3],25:Kw[3],26:Kw[3],27:Kw[3]}}},39:{16:{17:{26:Kw[3],27:Kw[3]}}},43:{16:{17:{18:Kw[3],25:Kw[3]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[44]}}}}}},48:{3:Kw[71],16:{32:Kw[5]}},78:{16:{17:{18:Kw[3],25:Kw[3]}}}},"{72833802-FEF1-4C79-8D5D-14CF1EAF98D9}":{1:83,2:{3:Kw[0],16:{17:{18:Kw[12],25:Kw[12],26:Kw[12],27:Kw[12]}}},39:{16:{17:{26:Kw[12],27:Kw[12]}}},43:{16:{17:{18:Kw[12],25:Kw[12]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[46]}}}}}},48:{3:Kw[71],16:{32:Kw[14]}},78:{16:{17:{18:Kw[12],25:Kw[12]}}}},"{F2DE63D5-997A-4646-A377-4702673A728D}":{1:84,2:{3:Kw[0],16:{17:{18:Kw[17],25:Kw[17],26:Kw[17],27:Kw[17]}}},39:{16:{17:{26:Kw[17],27:Kw[17]}}},43:{16:{17:{18:Kw[17],25:Kw[17]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[48]}}}}}},48:{3:Kw[71],16:{32:Kw[19]}},78:{16:{17:{18:Kw[17],25:Kw[17]}}}},"{17292A2E-F333-43FB-9621-5CBBE7FDCDCB}":{1:85,2:{3:Kw[0],16:{17:{18:Kw[22],25:Kw[22],26:Kw[22],27:Kw[22]}}},39:{16:{17:{26:Kw[22],27:Kw[22]}}},43:{16:{17:{18:Kw[22],25:Kw[22]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[50]}}}}}},48:{3:Kw[71],16:{32:Kw[24]}},78:{16:{17:{18:Kw[22],25:Kw[22]}}}},"{5A111915-BE36-4E01-A7E5-04B1672EAD32}":{1:86,2:{3:Kw[0],16:{17:{18:Kw[27],25:Kw[27],26:Kw[27],27:Kw[27]}}},39:{16:{17:{26:Kw[27],27:Kw[27]}}},43:{16:{17:{18:Kw[27],25:Kw[27]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[52]}}}}}},48:{3:Kw[71],16:{32:Kw[29]}},78:{16:{17:{18:Kw[27],25:Kw[27]}}}},"{912C8C85-51F0-491E-9774-3900AFEF0FD7}":{1:87,2:{3:Kw[0],16:{17:{18:Kw[32],25:Kw[32],26:Kw[32],27:Kw[32]}}},39:{16:{17:{26:Kw[32],27:Kw[32]}}},43:{16:{17:{18:Kw[32],25:Kw[32]}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[54]}}}}}},48:{3:Kw[71],16:{32:Kw[34]}},78:{16:{17:{18:Kw[32],25:Kw[32]}}}},"{616DA210-FB5B-4158-B5E0-FEB733F419BA}":{1:88,2:{3:Kw[0],16:{17:{18:Kw[1],25:Kw[1],26:Kw[1],27:Kw[1],28:Kw[1],29:Kw[1]}}},39:Kw[55],43:Kw[55],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:Kw[70]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:Kw[70]}}}}}},"{BC89EF96-8CEA-46FF-86C4-4CE0E7609802}":{1:90,2:{3:Kw[0],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[44]}}},25:{19:{21:20,23:22,24:{12:Kw[44]}}},26:{19:{21:20,23:22,24:{12:Kw[44]}}},27:{19:{21:20,23:22,24:{12:Kw[44]}}},28:{19:{21:20,23:22,24:{12:Kw[44]}}},29:{19:{21:20,23:22,24:{12:Kw[44]}}}}}},39:Kw[57],43:Kw[57],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[44]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[44]}}}}}}},"{5DA37D80-6434-44D0-A028-1B22A696006F}":{1:91,2:{3:Kw[0],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[46]}}},25:{19:{21:20,23:22,24:{12:Kw[46]}}},26:{19:{21:20,23:22,24:{12:Kw[46]}}},27:{19:{21:20,23:22,24:{12:Kw[46]}}},28:{19:{21:20,23:22,24:{12:Kw[46]}}},29:{19:{21:20,23:22,24:{12:Kw[46]}}}}}},39:Kw[59],43:Kw[59],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[46]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[46]}}}}}}},"{8799B23B-EC83-4686-B30A-512413B5E67A}":{1:92,2:{3:Kw[0],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[48]}}},25:{19:{21:20,23:22,24:{12:Kw[48]}}},26:{19:{21:20,23:22,24:{12:Kw[48]}}},27:{19:{21:20,23:22,24:{12:Kw[48]}}},28:{19:{21:20,23:22,24:{12:Kw[48]}}},29:{19:{21:20,23:22,24:{12:Kw[48]}}}}}},39:Kw[61],43:Kw[61],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[48]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[48]}}}}}}},"{ED083AE6-46FA-4A59-8FB0-9F97EB10719F}":{1:93,2:{3:Kw[0],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[50]}}},25:{19:{21:20,23:22,24:{12:Kw[50]}}},26:{19:{21:20,23:22,24:{12:Kw[50]}}},27:{19:{21:20,23:22,24:{12:Kw[50]}}},28:{19:{21:20,23:22,24:{12:Kw[50]}}},29:{19:{21:20,23:22,24:{12:Kw[50]}}}}}},39:Kw[63],43:Kw[63],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[50]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[50]}}}}}}},"{BDBED569-4797-4DF1-A0F4-6AAB3CD982D8}":{1:94,2:{3:Kw[0],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[52]}}},25:{19:{21:20,23:22,24:{12:Kw[52]}}},26:{19:{21:20,23:22,24:{12:Kw[52]}}},27:{19:{21:20,23:22,24:{12:Kw[52]}}},28:{19:{21:20,23:22,24:{12:Kw[52]}}},29:{19:{21:20,23:22,24:{12:Kw[52]}}}}}},39:Kw[65],43:Kw[65],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[52]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[52]}}}}}}},"{E8B1032C-EA38-4F05-BA0D-38AFFFC7BED3}":{1:95,2:{3:Kw[0],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[54]}}},25:{19:{21:20,23:22,24:{12:Kw[54]}}},26:{19:{21:20,23:22,24:{12:Kw[54]}}},27:{19:{21:20,23:22,24:{12:Kw[54]}}},28:{19:{21:20,23:22,24:{12:Kw[54]}}},29:{19:{21:20,23:22,24:{12:Kw[54]}}}}}},39:Kw[67],43:Kw[67],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[54]}}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[54]}}}}}}},"{793D81CF-94F2-401A-BA57-92F5A7B2D0C5}":{1:96,2:{3:Kw[2],16:{17:{18:Kw[89],25:Kw[89],26:Kw[89],27:Kw[89],28:Kw[89]},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:Kw[107]}},"{B301B821-A1FF-4177-AEE7-76D212191A09}":{1:97,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[44]}}},25:{19:{21:20,23:22,24:{12:Kw[44]}}},26:{19:{21:20,23:22,24:{12:Kw[44]}}},27:{19:{21:20,23:22,24:{12:Kw[44]}}},28:{19:{21:20,23:22,24:{12:Kw[44]}}}},40:Kw[88]}},39:{16:Kw[91]},43:{16:Kw[91]},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[44]}}}},40:Kw[88]}},48:{3:Kw[9],16:{40:Kw[10]}}},"{9DCAF9ED-07DC-4A11-8D7F-57B35C25682E}":{1:98,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[46]}}},25:{19:{21:20,23:22,24:{12:Kw[46]}}},26:{19:{21:20,23:22,24:{12:Kw[46]}}},27:{19:{21:20,23:22,24:{12:Kw[46]}}},28:{19:{21:20,23:22,24:{12:Kw[46]}}}},40:Kw[88]}},39:{16:Kw[93]},43:{16:Kw[93]},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[46]}}}},40:Kw[88]}},48:{3:Kw[9],16:{40:Kw[16]}}},"{1FECB4D8-DB02-4DC6-A0A2-4F2EBAE1DC90}":{1:99,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[48]}}},25:{19:{21:20,23:22,24:{12:Kw[48]}}},26:{19:{21:20,23:22,24:{12:Kw[48]}}},27:{19:{21:20,23:22,24:{12:Kw[48]}}},28:{19:{21:20,23:22,24:{12:Kw[48]}}}},40:Kw[88]}},39:{16:Kw[95]},43:{16:Kw[95]},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[48]}}}},40:Kw[88]}},48:{3:Kw[9],16:{40:Kw[21]}}},"{1E171933-4619-4E11-9A3F-F7608DF75F80}":{1:100,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[50]}}},25:{19:{21:20,23:22,24:{12:Kw[50]}}},26:{19:{21:20,23:22,24:{12:Kw[50]}}},27:{19:{21:20,23:22,24:{12:Kw[50]}}},28:{19:{21:20,23:22,24:{12:Kw[50]}}}},40:Kw[88]}},39:{16:Kw[97]},43:{16:Kw[97]},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[50]}}}},40:Kw[88]}},48:{3:Kw[9],16:{40:Kw[26]}}},"{FABFCF23-3B69-468F-B69F-88F6DE6A72F2}":{1:101,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[52]}}},25:{19:{21:20,23:22,24:{12:Kw[52]}}},26:{19:{21:20,23:22,24:{12:Kw[52]}}},27:{19:{21:20,23:22,24:{12:Kw[52]}}},28:{19:{21:20,23:22,24:{12:Kw[52]}}}},40:Kw[88]}},39:{16:Kw[99]},43:{16:Kw[99]},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[52]}}}},40:Kw[88]}},48:{3:Kw[9],16:{40:Kw[31]}}},"{10A1B5D5-9B99-4C35-A422-299274C87663}":{1:102,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[54]}}},25:{19:{21:20,23:22,24:{12:Kw[54]}}},26:{19:{21:20,23:22,24:{12:Kw[54]}}},27:{19:{21:20,23:22,24:{12:Kw[54]}}},28:{19:{21:20,23:22,24:{12:Kw[54]}}}},40:Kw[88]}},39:{16:Kw[101]},43:{16:Kw[101]},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[54]}}}},40:Kw[88]}},48:{3:Kw[9],16:{40:Kw[36]}}},"{073A0DAA-6AF3-43AB-8588-CEC1D06C72B9}":{1:103,2:{3:Kw[103],16:{17:Kw[104],40:Kw[105]}},39:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},44:{3:Kw[106],16:Kw[107]},46:{3:Kw[106],16:Kw[107]},47:{3:Kw[106],16:{17:Kw[108],40:Kw[109]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[109]}}},"{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}":{1:107,2:{3:Kw[103],16:{17:Kw[104],40:Kw[112]}},39:{16:{40:{24:{12:{14:34,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:34,62:Kw[6]}}}}},44:{3:Kw[106],16:{40:Kw[10]}},46:{3:Kw[106],16:{40:Kw[10]}},47:{3:Kw[106],16:{17:Kw[108],40:Kw[10]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[10]}}},"{21E4AEA4-8DFA-4A89-87EB-49C32662AFE0}":{1:108,2:{3:Kw[103],16:{17:Kw[104],40:Kw[115]}},39:{16:{40:{24:{12:{14:51,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:51,62:Kw[6]}}}}},44:{3:Kw[106],16:{40:Kw[16]}},46:{3:Kw[106],16:{40:Kw[16]}},47:{3:Kw[106],16:{17:Kw[108],40:Kw[16]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[16]}}},"{F5AB1C69-6EDB-4FF4-983F-18BD219EF322}":{1:109,2:{3:Kw[103],16:{17:Kw[104],40:Kw[118]}},39:{16:{40:{24:{12:{14:53,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:53,62:Kw[6]}}}}},44:{3:Kw[106],16:{40:Kw[21]}},46:{3:Kw[106],16:{40:Kw[21]}},47:{3:Kw[106],16:{17:Kw[108],40:Kw[21]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[21]}}},"{00A15C55-8517-42AA-B614-E9B94910E393}":{1:110,2:{3:Kw[103],16:{17:Kw[104],40:Kw[121]}},39:{16:{40:{24:{12:{14:55,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:55,62:Kw[6]}}}}},44:{3:Kw[106],16:{40:Kw[26]}},46:{3:Kw[106],16:{40:Kw[26]}},47:{3:Kw[106],16:{17:Kw[108],40:Kw[26]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[26]}}},"{7DF18680-E054-41AD-8BC1-D1AEF772440D}":{1:111,2:{3:Kw[103],16:{17:Kw[104],40:Kw[124]}},39:{16:{40:{24:{12:{14:57,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:57,62:Kw[6]}}}}},44:{3:Kw[106],16:{40:Kw[31]}},46:{3:Kw[106],16:{40:Kw[31]}},47:{3:Kw[106],16:{17:Kw[108],40:Kw[31]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[31]}}},"{93296810-A885-4BE3-A3E7-6D5BEEA58F35}":{1:112,2:{3:Kw[103],16:{17:Kw[104],40:Kw[127]}},39:{16:{40:{24:{12:{14:59,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:59,62:Kw[6]}}}}},44:{3:Kw[106],16:{40:Kw[36]}},46:{3:Kw[106],16:{40:Kw[36]}},47:{3:Kw[106],16:{17:Kw[108],40:Kw[36]}},48:{3:Kw[106],16:{17:Kw[110],40:Kw[36]}}},"{8EC20E35-A176-4012-BC5E-935CFFF8708E}":{1:113,2:{3:{4:{6:5},12:Kw[131]},16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:Kw[107]},46:{3:Kw[9],16:Kw[107]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[109]}},114:Kw[129],115:Kw[129]},"{6E25E649-3F16-4E02-A733-19D2CDBF48F0}":{1:116,2:{3:Kw[2],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:{40:Kw[10]}},46:{3:Kw[9],16:{40:Kw[10]}},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[10]}},114:Kw[129],115:Kw[129]},"{85BE263C-DBD7-4A20-BB59-AAB30ACAA65A}":{1:117,2:{3:Kw[2],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:{40:Kw[16]}},46:{3:Kw[9],16:{40:Kw[16]}},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[16]}},114:Kw[129],115:Kw[129]},"{EB344D84-9AFB-497E-A393-DC336BA19D2E}":{1:118,2:{3:Kw[2],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:{40:Kw[21]}},46:{3:Kw[9],16:{40:Kw[21]}},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[21]}},114:Kw[129],115:Kw[129]},"{EB9631B5-78F2-41C9-869B-9F39066F8104}":{1:119,2:{3:Kw[2],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:{40:Kw[26]}},46:{3:Kw[9],16:{40:Kw[26]}},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[26]}},114:Kw[129],115:Kw[129]},"{74C1A8A3-306A-4EB7-A6B1-4F7E0EB9C5D6}":{1:120,2:{3:Kw[2],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:{40:Kw[31]}},46:{3:Kw[9],16:{40:Kw[31]}},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[31]}},114:Kw[129],115:Kw[129]},"{2A488322-F2BA-4B5B-9748-0D474271808F}":{1:121,2:{3:Kw[2],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}},27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[88]}},39:Kw[85],43:Kw[85],44:{3:Kw[9],16:{40:Kw[36]}},46:{3:Kw[9],16:{40:Kw[36]}},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[88]}},48:{3:Kw[9],16:{17:{27:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[36]}},114:Kw[129],115:Kw[129]},"{D7AC3CCA-C797-4891-BE02-D94E43425B78}":{1:122,2:{3:Kw[2],16:{17:{18:Kw[89],25:Kw[89],26:Kw[89],27:Kw[89],28:Kw[89],29:Kw[89]},40:Kw[105]}},39:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[131]}}}},40:Kw[105]}},48:{3:Kw[7],16:{40:Kw[105]}}},"{69CF1AB2-1976-4502-BF36-3FF5EA218861}":{1:123,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[44]}}},25:{19:{21:20,23:22,24:{12:Kw[44]}}},26:{19:{21:20,23:22,24:{12:Kw[44]}}},27:{19:{21:20,23:22,24:{12:Kw[44]}}},28:{19:{21:20,23:22,24:{12:Kw[44]}}},29:{19:{21:20,23:22,24:{12:Kw[44]}}}},40:Kw[112]}},39:{16:{40:{24:{12:{14:34,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:34,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[44]}}}},40:Kw[112]}},48:{3:Kw[7],16:Kw[91]}},"{8A107856-5554-42FB-B03E-39F5DBC370BA}":{1:124,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[46]}}},25:{19:{21:20,23:22,24:{12:Kw[46]}}},26:{19:{21:20,23:22,24:{12:Kw[46]}}},27:{19:{21:20,23:22,24:{12:Kw[46]}}},28:{19:{21:20,23:22,24:{12:Kw[46]}}},29:{19:{21:20,23:22,24:{12:Kw[46]}}}},40:Kw[115]}},39:{16:{40:{24:{12:{14:51,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:51,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[46]}}}},40:Kw[115]}},48:{3:Kw[7],16:Kw[93]}},"{0505E3EF-67EA-436B-97B2-0124C06EBD24}":{1:125,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[48]}}},25:{19:{21:20,23:22,24:{12:Kw[48]}}},26:{19:{21:20,23:22,24:{12:Kw[48]}}},27:{19:{21:20,23:22,24:{12:Kw[48]}}},28:{19:{21:20,23:22,24:{12:Kw[48]}}},29:{19:{21:20,23:22,24:{12:Kw[48]}}}},40:Kw[118]}},39:{16:{40:{24:{12:{14:53,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:53,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[48]}}}},40:Kw[118]}},48:{3:Kw[7],16:Kw[95]}},"{C4B1156A-380E-4F78-BDF5-A606A8083BF9}":{1:126,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[50]}}},25:{19:{21:20,23:22,24:{12:Kw[50]}}},26:{19:{21:20,23:22,24:{12:Kw[50]}}},27:{19:{21:20,23:22,24:{12:Kw[50]}}},28:{19:{21:20,23:22,24:{12:Kw[50]}}},29:{19:{21:20,23:22,24:{12:Kw[50]}}}},40:Kw[121]}},39:{16:{40:{24:{12:{14:55,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:55,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[50]}}}},40:Kw[121]}},48:{3:Kw[7],16:Kw[97]}},"{22838BEF-8BB2-4498-84A7-C5851F593DF1}":{1:127,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[52]}}},25:{19:{21:20,23:22,24:{12:Kw[52]}}},26:{19:{21:20,23:22,24:{12:Kw[52]}}},27:{19:{21:20,23:22,24:{12:Kw[52]}}},28:{19:{21:20,23:22,24:{12:Kw[52]}}},29:{19:{21:20,23:22,24:{12:Kw[52]}}}},40:Kw[124]}},39:{16:{40:{24:{12:{14:57,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:57,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[52]}}}},40:Kw[124]}},48:{3:Kw[7],16:Kw[99]}},"{16D9F66E-5EB9-4882-86FB-DCBF35E3C3E4}":{1:128,2:{3:Kw[2],16:{17:{18:{19:{21:20,23:22,24:{12:Kw[54]}}},25:{19:{21:20,23:22,24:{12:Kw[54]}}},26:{19:{21:20,23:22,24:{12:Kw[54]}}},27:{19:{21:20,23:22,24:{12:Kw[54]}}},28:{19:{21:20,23:22,24:{12:Kw[54]}}},29:{19:{21:20,23:22,24:{12:Kw[54]}}}},40:Kw[127]}},39:{16:{40:{24:{12:{14:59,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:59,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:89,23:22,24:{12:Kw[54]}}}},40:Kw[127]}},48:{3:Kw[7],16:Kw[101]}},"{E8034E78-7F5D-4C2E-B375-FC64B27BC917}":{1:129,2:{3:Kw[42],16:{40:Kw[105]}},39:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[138]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[138]}},47:{3:Kw[7],16:{17:Kw[140],40:Kw[138]}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{125E5076-3810-47DD-B79F-674D7AD40C01}":{1:131,2:{3:Kw[42],16:{40:Kw[10]}},39:{16:{40:Kw[141]}},43:{16:{40:Kw[141]}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[141]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[141]}},47:{3:Kw[7],16:{17:Kw[140],40:{24:{12:{14:34,132:Kw[6]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{37CE84F3-28C3-443E-9E96-99CF82512B78}":{1:133,2:{3:Kw[42],16:{40:Kw[16]}},39:{16:{40:Kw[142]}},43:{16:{40:Kw[142]}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[142]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[142]}},47:{3:Kw[7],16:{17:Kw[140],40:{24:{12:{14:51,132:Kw[6]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{D03447BB-5D67-496B-8E87-E561075AD55C}":{1:134,2:{3:Kw[42],16:{40:Kw[21]}},39:{16:{40:Kw[143]}},43:{16:{40:Kw[143]}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[143]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[143]}},47:{3:Kw[7],16:{17:Kw[140],40:{24:{12:{14:53,132:Kw[6]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{E929F9F4-4A8F-4326-A1B4-22849713DDAB}":{1:135,2:{3:Kw[42],16:{40:Kw[26]}},39:{16:{40:Kw[144]}},43:{16:{40:Kw[144]}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[144]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[144]}},47:{3:Kw[7],16:{17:Kw[140],40:{24:{12:{14:55,132:Kw[6]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{8FD4443E-F989-4FC4-A0C8-D5A2AF1F390B}":{1:136,2:{3:Kw[42],16:{40:Kw[31]}},39:{16:{40:Kw[145]}},43:{16:{40:Kw[145]}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[145]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[145]}},47:{3:Kw[7],16:{17:Kw[140],40:{24:{12:{14:57,132:Kw[6]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{AF606853-7671-496A-8E4F-DF71F8EC918B}":{1:137,2:{3:Kw[42],16:{40:Kw[36]}},39:{16:{40:Kw[146]}},43:{16:{40:Kw[146]}},44:{3:Kw[7],16:{17:Kw[137],40:Kw[146]}},46:{3:Kw[7],16:{17:Kw[139],40:Kw[146]}},47:{3:Kw[7],16:{17:Kw[140],40:{24:{12:{14:59,132:Kw[6]}}}}},48:{3:Kw[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:Kw[109]}}},"{5202B0CA-FC54-4496-8BCA-5EF66A818D29}":{1:138,2:{3:Kw[2],16:{40:Kw[105]}},39:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:37,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[105]}},48:{3:Kw[9],16:Kw[107]}},"{0660B408-B3CF-4A94-85FC-2B1E0A45F4A2}":{1:139,2:{3:Kw[2],16:Kw[91]},39:{16:{40:{24:{12:{14:34,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:34,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[112]}},48:{3:Kw[9],16:{40:Kw[16]}}},"{91EBBBCC-DAD2-459C-BE2E-F6DE35CF9A28}":{1:140,2:{3:Kw[2],16:Kw[95]},39:{16:{40:{24:{12:{14:53,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:53,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[118]}},48:{3:Kw[9],16:{40:Kw[26]}}},"{46F890A9-2807-4EBB-B81D-B2AA78EC7F39}":{1:141,2:{3:Kw[2],16:Kw[99]},39:{16:{40:{24:{12:{14:57,62:Kw[6]}}}}},43:{16:{40:{24:{12:{14:57,62:Kw[6]}}}}},44:{3:Kw[7]},46:{3:Kw[7]},47:{3:Kw[7],16:{17:{26:{19:{21:79,23:80,24:{12:Kw[131]}}}},40:Kw[124]}},48:{3:Kw[9],16:{40:Kw[36]}}}};function Zw(e){var t={};return Object.keys(e).forEach((function(n){"object"==M(e[n])?t[Qw[Number(n)]]=Zw(e[n]):t[Qw[Number(n)]]=Qw[e[n]]})),t}function Jw(e){var t=qw[e];return t?Zw(t):void 0}var $w=function(e,t,n,r,i){var a=function(e,t,n,r,i){var a=r.tableStyleXML;return a||(a=r.tableStyleXML=Object.freeze(function(e,t){var n=e.parentElement("a:tbl").childElementOptional("a:tblPr");return n&&n.hasChildElementWithName("a:tableStyleId")?{tableStyle:Jw(n.childElement("a:tableStyleId").text),bandCol:n.attr.getBoolean("bandCol",!1),bandRow:n.attr.getBoolean("bandRow",!1),firstCol:n.attr.getBoolean("firstCol",!1),firstRow:n.attr.getBoolean("firstRow",!1),lastCol:n.attr.getBoolean("lastCol",!1),lastRow:n.attr.getBoolean("lastRow",!1),rtl:n.attr.getBoolean("rtl",!1)}:{tableStyle:void 0,bandCol:!1,bandRow:!1,firstCol:!1,firstRow:!1,lastCol:!1,lastRow:!1,rtl:!1}}(e))),a}(e,0,0,r),o=n.split("-"),s=parseInt(o[0],10),c=parseInt(o[1],10),u=o[2],l=e.parentElement("a:tbl").childElementOptional("a:tblPr"),h=function(e,t,n,r){switch(n){case"isBold":case"isItalic":case"fontFamily":case"fontColor":default:return;case"fillColor":var i=e.childElementOptional(m(Zy,pb));return i?(new Ib).read(i,t):(new Ib).read(r,t);case"bottomBorderWidth":return new rS(e,"a:lnB").getBorderWidth();case"bottomBorderColor":return new rS(e,"a:lnB").getBorderColor(t);case"bottomBorderStyle":return new rS(e,"a:lnB").getBorderType();case"bottomBorderStrokeDashArray":return new rS(e,"a:lnB").getBorderStrokeDashArray();case"topBorderWidth":return new rS(e,"a:lnT").getBorderWidth();case"topBorderColor":return new rS(e,"a:lnT").getBorderColor(t);case"topBorderStyle":return new rS(e,"a:lnT").getBorderType();case"topBorderStrokeDashArray":return new rS(e,"a:lnT").getBorderStrokeDashArray();case"leftBorderWidth":return new rS(e,"a:lnL").getBorderWidth();case"leftBorderColor":return new rS(e,"a:lnL").getBorderColor(t);case"leftBorderStyle":return new rS(e,"a:lnL").getBorderType();case"leftBorderStrokeDashArray":return new rS(e,"a:lnL").getBorderStrokeDashArray();case"rightBorderWidth":return new rS(e,"a:lnR").getBorderWidth();case"rightBorderColor":return new rS(e,"a:lnR").getBorderColor(t);case"rightBorderStyle":return new rS(e,"a:lnR").getBorderType();case"rightBorderStrokeDashArray":return new rS(e,"a:lnR").getBorderStrokeDashArray()}}(e,t,u,l);if(void 0!==h&&h!==yb)return h;var d=a.tableStyle,p=a.bandRow,f=a.bandCol;if(d){var v=d.band1H,g=d.band2H,y=d.band1V,b=d.band2V,k=d.firstRow,w=d.firstCol,S=d.wholeTbl,x=(s+1)%2==1,C=(c+1)%2==1;return k&&0===s?eS(k,t,u,S,d):w&&0===s?eS(w,t,u,S,d):p?eS(k?x?g:v:x?v:g,t,u,S,d):f?eS(w?C?b:y:C?y:b,t,u,S,d):tS(S,t,u,d)}};function eS(e,t,n,r,i){if(e){var a=tS(e,t,n,i);return void 0===a?tS(r,t,n,i):a}return tS(r,t,n,i)}function tS(e,t,n,r){var i,a,o,s,c,u,l,h,d,p,f,v;switch(n){case"isBold":var m=e&&(null==e?void 0:e.tcTxStyle);return m?null!=(i=m.b)?i:"off":"false";case"isItalic":var g=e&&(null==e?void 0:e.tcTxStyle);return g?null!=(a=g.i)?a:"off":"false";case"fillColor":var y=e&&(null==(c=null==(s=null==(o=e.tcStyle)?void 0:o.fill)?void 0:s.solidFill)?void 0:c.schemeClr);if(y)return xb(y,t);if(y=null==(l=null==(u=r.tblBg)?void 0:u.fillRef)?void 0:l.schemeClr){var b=Number(null==(d=null==(h=r.tblBg)?void 0:h.fillRef)?void 0:d.idx),k=t.theme.childElementOptional("a:theme","a:themeElements","a:fmtScheme","a:fillStyleLst");if(b&&k)return new wb(null==k?void 0:k.elements[b],t,void 0,y.val)}return;case"fontFamily":var w=e&&(null==(p=e.tcTxStyle)?void 0:p.fontRef);return w?function(e,t){return"none"!==e?db(lb(hb(t).childElement("a:".concat(e,"Font")))).filter((function(e){return!e.startsWith("+")&&""!==e})).map((function(e){return rb(e,t.userFonts),e})):[]}(null!=(f=w.idx)?f:"none",t).join(","):void 0;case"fontColor":var S=e&&(null==(v=e.tcTxStyle)?void 0:v.schemeClr);return S?xb(S,t):void 0;case"bottomBorderWidth":return new nS(e,"bottom").getBorderWidth();case"bottomBorderColor":return new nS(e,"bottom").getBorderColor(t);case"bottomBorderStyle":return new nS(e,"bottom").getBorderType();case"topBorderWidth":return new nS(e,"top").getBorderWidth();case"topBorderColor":return new nS(e,"top").getBorderColor(t);case"topBorderStyle":return new nS(e,"top").getBorderType();case"leftBorderWidth":return new nS(e,"left").getBorderWidth();case"leftBorderColor":return new nS(e,"left").getBorderColor(t);case"leftBorderStyle":return new nS(e,"left").getBorderType();case"rightBorderWidth":return new nS(e,"right").getBorderWidth();case"rightBorderColor":return new nS(e,"right").getBorderColor(t);case"rightBorderStyle":return new nS(e,"right").getBorderType();default:return}}var nS=function(){function e(t,n){C(this,e),this.tcStyle=t,this.lnKey=n}return P(e,[{key:"getBorderColor",value:function(e){var t,n,r,i,a,o=this.tcStyle&&(null==(a=null==(i=null==(r=null==(n=null==(t=this.tcStyle.tcStyle)?void 0:t.tcBdr)?void 0:n[this.lnKey])?void 0:r.ln)?void 0:i.solidFill)?void 0:a.schemeClr);if(o)return xb(o,e)}},{key:"getBorderWidth",value:function(){var e,t,n,r=this.tcStyle&&(null==(n=null==(t=null==(e=this.tcStyle.tcStyle)?void 0:e.tcBdr)?void 0:t[this.lnKey])?void 0:n.ln);if(r)return Number(r.w)}},{key:"getBorderType",value:function(){var e,t,n,r=this.tcStyle&&(null==(n=null==(t=null==(e=this.tcStyle.tcStyle)?void 0:e.tcBdr)?void 0:t[this.lnKey])?void 0:n.ln);if(r){var i=r.prstDash;if(i&&i.val)return i.val}return"solid"}}]),e}(),rS=function(){function e(t,n){C(this,e),this.tcPrXMl=t,this.lnKey=n}return P(e,[{key:"getBorderColor",value:function(e){var t=this.tcPrXMl.childElementOptional(this.lnKey);if(t)return(new Ib).read(t.childElement(m(Zy,pb)),e)}},{key:"getBorderWidth",value:function(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e)return e.attr.getNumber("w",0)}},{key:"getBorderType",value:function(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e){var t=e.childElementOptional("a:prstDash");if(t&&t.attr.has("val")){var n=t.attr.getStringOptional("val");return"dot"===n||"sysDot"===n?"dotted":"dash"===n||"sysDash"===n?"dashed":"solid"}}}},{key:"getBorderStrokeDashArray",value:function(){var e=this.getBorderWidth(),t=this.getBorderType();if(void 0!==e&&void 0!==t)switch(t){case"solid":default:return"0";case"dash":return"".concat(5*e);case"dashDot":return" ".concat(5*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"dot":return"".concat(e,",  ").concat(5*e);case"lgDash":return"".concat(2*e,", ").concat(e);case"lgDashDot":return"".concat(10*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDash":return"".concat(5*e,", ").concat(2*e);case"sysDashDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e);case"sysDashDotDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDot":return"".concat(2*e,", ").concat(5*e)}}}]),e}();var iS=function(e,t,n,r,i){var a=uS(e,t,n,r,i);if(a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")){var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx");return t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1]}return a.bgXML.childElementOptional("p:bgPr","a:blipFill")},aS=function(e,t,n,r,i){var a=uS(e,t,n,r,i);if(!a.bgXML||!a.bgXML.hasChildElementWithName("p:bgRef"))return oS(a.bgXML.childElementOptional("p:bgPr","a:blipFill"));var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx"),s=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return"a:blipFill"===s.name?oS(s):void 0};function oS(e){if(e)return e.childElement("a:blip").attr.getStringOptional("r:embed")}var sS=function(e,t,n,r,i){var a=uS(e,t,n,r,i);return a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")?"theme":a.resourceType},cS=function(e,t,n,r,i){var a=uS(e,t,n,r,i);if(a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")){var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx"),s=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return new Ib(a.bgXML.childElement("p:bgRef").childElementOptional("a:schemeClr")).read(s,t)}return(new Ib).read(a.bgXML.childElement("p:bgPr",m(Zy,pb)),t)};function uS(e,t,n,r,i){var a=r.bgXML;return a||(a=r.bgXML=Object.freeze(function(e,t){return e.hasChildElementWithName("p:bg")?{bgXML:e.childElement("p:bg"),resourceType:"slide"}:t.layout.childElementOptional("p:sldLayout","p:cSld","p:bg")?{bgXML:t.layout.childElement("p:sldLayout","p:cSld","p:bg"),resourceType:"layout"}:{bgXML:t.master.childElement("p:sldMaster","p:cSld","p:bg"),resourceType:"master"}}(e,t))),a}var lS=new bk;!function(e){e.bindAttributePicker("a:p","*",Tw),e.bindAttributePicker("a:p","indent",Aw(-342900,0)),e.bindAttributePicker("a:p","marL",Aw(342900,0)),e.bindAttributePicker("a:p","level",Ew),e.bindAttributePicker("a:bodyPr","*",Mw),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld"],"*",Rw),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld","a:p"],"sz",Lw),e.bindAttributePicker(["a:r"],"highlight",Nw),e.bindAttributePicker(["a:r","a:fld"],"color",Dw),e.bindAttributePicker(["a:r","a:fld"],"fontType",Fw),e.bindAttributePicker("a:p","placeHolderType",zw),e.bindChildPicker("a:p","bu",Bw),e.bindAttributePicker("a:p","buClr",Uw),e.bindAttributePicker("a:p","lineHeight",Ww),e.bindAttributePicker("a:p",["a:spcBef","a:spcAft"],Hw)}(lS),function(e){e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:prstGeom",Vk),e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:custGeom",Vk),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"fillColor",Wk),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderWidth",_k),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderType",Gk),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderColor",Hk),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderStrokeDashArray",Yk),e.bindAttributePicker("p:sp","spId",(function(e,t,n,r,i){return Fk(i)+e.childElement("p:nvSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:cxnSp","spId",(function(e,t,n,r,i){return Fk(i)+e.childElement("p:nvCxnSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:pic","spId",(function(e,t,n,r,i){return Fk(i)+e.childElement("p:nvPicPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:grpSp","spId",(function(e,t,n,r,i){return Fk(i)+e.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:spTree","spId",(function(e,t,n,r,i){return Fk(i)+e.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:graphicFrame","spId",(function(e,t,n,r,i){return Fk(i)+e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:graphicFrame","borderWidth",(function(){return 0})),e.bindAttributePicker("p:graphicFrame","borderType",(function(){return"none"})),e.bindAttributePicker("p:graphicFrame","borderColor",(function(){return"black"})),e.bindAttributePicker("p:graphicFrame","borderStrokeDashArray",(function(){return"0"}))}(lS),function(e){e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"x",(function(e,t,n,r,i){var a=Gw(e,t,i);return a?a.attr.getOptional("x"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"y",(function(e,t,n,r,i){var a=Gw(e,t,i);return a?a.attr.getOptional("y"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"width",(function(e,t,n,r,i){var a=Yw(e,t,i);return a?a.attr.getOptional("cx"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"height",(function(e,t,n,r,i){var a=Yw(e,t,i);return a?a.attr.getOptional("cy"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipV",(function(e,t){var n=Xw(e,t,"slide");return void 0===n?"false":n.attr.getOptional("flipV")?n.attr.getOptional("flipV"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipH",(function(e,t){var n=Xw(e,t,"slide");return void 0===n?"false":n.attr.getOptional("flipH")?n.attr.getOptional("flipH"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"hidden",(function(e){var t=e.childElementOptional(new Zy("p:nvGraphicFramePr","p:nvSpPr","p:nvCxnSpPr","p:nvPicPr"),"p:cNvPr");return t?t.attr.get("hidden","false"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp"],"rot",(function(e,t){var n=Xw(e,t,"slide");return n?n.attr.getOptional("rot"):0}))}(lS),function(e){e.bindAttributePicker("a:tcPr","*",$w)}(lS),function(e){e.bindChildPicker(["p:cSld"],"getBackgroundImageFill",iS),e.bindAttributePicker(["p:cSld"],"backgroundResId",aS),e.bindAttributePicker(["p:cSld"],"backgroundImageResourceType",sS),e.bindAttributePicker(["p:cSld"],"backgroundColor",cS)}(lS);var hS=function(){function e(t,n){C(this,e),this.slideXML=t,this.context=n,this.animations=[]}return P(e,[{key:"collect",value:function(){var e=this.slideXML.childElementOptional(new Zy("p:sld","p:sldMaster","p:sldLayout"),"p:timing","p:tnLst","p:par","p:cTn","p:childTnLst");if(e)for(var t=e.elementsWithName("p:seq"),n=0;n<t.length;++n){var r=t[n],i=r.childElement("p:cTn").attr.getString("nodeType","afterEffect");this.searchAndIndexParXMLs(r,i,[n],0,void 0)}return this.animations}},{key:"searchAndIndexParXMLs",value:function(e,t,n,r,i){var a=e.childElementOptional("p:cTn","p:childTnLst"),o=a?a.elementsWithName("p:par"):[],s=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),c=i,u=0;if(s){u=s&&s.attr.getNumberOptional("delay")||0;var l=s.childElementOptional("p:tgtEl","p:spTgt");if(l&&(c=Fk(this.context.resourceType)+l.attr.getString("spid"),this.context.shapeParamsIndex[c].hidden))return}if(0===o.length)this.handleLeafParXML(e,t,n,r,c);else for(var h=0;h<o.length;++h)this.searchAndIndexParXMLs(o[h],t,[].concat(p(n),[h]),r+u,c)}},{key:"handleLeafParXML",value:function(e,t,n,r,i){var a,o,s,c,u,l=e.childElementOptional("p:cTn","p:iterate"),h=null==(a=null==l?void 0:l.attr)?void 0:a.getStringOptional("type"),d=null==l?void 0:l.childElementOptional("p:tmPct");if(d&&(u=zy(d.attr.getString("val"))),null==u){var p=null==l?void 0:l.childElementOptional("p:tmAbs");p&&(c=p.attr.getNumberOptional("val"))}var f=e.childElementOptional("p:cTn","p:childTnLst"),v=f&&f.element.childElementOptional("p:cBhvr","p:tgtEl","p:spTgt"),m=v?Fk(this.context.resourceType)+v.attr.getString("spid"):"",g=null==v?void 0:v.childElementOptional("p:txEl","p:pRg"),y=null==(o=null==g?void 0:g.attr)?void 0:o.getNumberOptional("st"),b=null==(s=null==g?void 0:g.attr)?void 0:s.getNumberOptional("end"),k=!!(null==v?void 0:v.childElementOptional("p:bg")),w=null!=y&&null!=b?{start:y,end:b}:null;if(this.context.shapeParamsIndex[m]&&!this.context.shapeParamsIndex[m].hidden){var S=e.childElement("p:cTn"),x=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),C=f?f.elements:[],I=Number.MIN_SAFE_INTEGER;C.forEach((function(e){var t=0,n=e.childElementOptional("p:cBhvr","p:cTn","p:stCondLst","p:cond");n&&(t=n.attr.getNumberOptional("delay")||0);var r=e.childElement("p:cBhvr","p:cTn").attr.getNumberOptional("dur");void 0===r&&(r=1),r+t>I&&(I=r+t)}));var P,M=S.childElementOptional("p:endCondLst");void 0!==M&&"onNext"===M.childElement("p:cond").attr.getStringOptional("evt")&&(P="onNext");var T=S.attr.get("repeatCount","none");"indefinite"!==T&&"none"!==T&&(0===(T/=1e3)&&(T="none"));var A=S.attr.getStringOptional("presetClass");A||(A="entr");var E=Object.freeze({eventSourceShapeId:i,spId:m,pRg:w,pBg:k,textAnimMode:h,textAnimIterateDelay:function(e){return null!=c?c:null!=u?u*e:0},sequenceType:t,animationXML:f,sequenceIndex:n[1],parallelIndex:n[3],isLoop:S.attr.has("repeatCount"),id:S.attr.getStringOptional("id")||"",presetClass:A,presetID:S.attr.getStringOptional("presetID")||"",presetSubtype:S.attr.getStringOptional("presetSubtype"),repeatCount:T,repeatEndCondition:P,nodeType:S.attr.getStringOptional("nodeType")||"afterEffect",delay:x&&x.attr.getNumberOptional("delay")||0,parentDelay:r,duration:I,autoRev:S.attr.getBoolean("autoRev",!1),soundEffectId:this.parseAnimeSoundEffect(e),dimAfter:this.parseDimAfter(e)});this.animations.push(E)}}},{key:"parseAnimeSoundEffect",value:function(e){var t=e.childElementOptional("p:cTn","p:subTnLst","p:audio");if(void 0!==t)return t.childElement("p:cMediaNode","p:tgtEl","p:sndTgt").attr.getString("r:embed")}},{key:"parseDimAfter",value:function(e){var t,n,r=e.childElementOptional("p:cTn","p:subTnLst","p:set","p:cBhvr");if(r){var i=r.childElementOptional("p:attrNameLst","p:attrName");return i&&String(i.text).includes("visibility")?"nextClick"===(null==(n=null==(t=r.childElementOptional("p:cTn"))?void 0:t.attr)?void 0:n.getStringOptional("masterRel"))?"next":"same":void 0}}}]),e}();function dS(e,t,n){var r=t.input,i=t.output;return(e-r)/(n.input-r)*(n.output-i)+i}var pS=function(){function e(t){C(this,e),this.behaviorNode=t.childElement("p:cBhvr"),this.timingNode=this.behaviorNode.childElement("p:cTn")}return P(e,[{key:"animeId",value:function(){var e;return String(null!=(e=this.timingNode.attr.getNumberOptional("id"))?e:Date.now())}},{key:"duration",value:function(){var e=this.timingNode.attr.getStringOptional("dur");return e?"indefinite"===e?1/0:parseInt(e,10):1}},{key:"delay",value:function(){var e=this.timingNode.childElementOptional("p:stCondLst","p:cond");return e?e.attr.getNumber("delay",0):0}},{key:"ease",value:function(){var e=function(e){if(!e)return $v;var t=e.replace(/\s+/g,"").split(";").map((function(e){var t=l(e.split(","),2),n=t[0],r=t[1];return{input:parseFloat(n),output:parseFloat(r)}}));t[t.length-1].input<1&&t.push({input:1,output:1});var n=t.length-1,r=0,i=0;return function(e){if(e>=r)for(var a=i;a<n;a++){var o=t[a],s=t[a+1];if(e>=o.input&&e<=s.input)return i=a,r=e,dS(e,o,s)}else for(var c=i;c>=0;c--){var u=t[c],l=t[c+1];if(e>=u.input&&e<=l.input)return i=c,r=e,dS(e,u,l)}return i=0,r=0,e}}(this.timingNode.attr.getStringOptional("tmFilter")),t=this.timingNode.attr.getStringOptional("spd");if(t){var n=zy(t);if(!Number.isNaN(n)&&1!==n&&0!==n)return n>0?function(t){return e(t/n)}:function(t){return 1-e(t/-n)}}return e}},{key:"reverse",value:function(){return Boolean(this.timingNode.attr.getBooleanOptional("autoRev"))}},{key:"rewind",value:function(){var e=this.timingNode.attr.getStringOptional("fill");return"transition"===e||"remove"===e}},{key:"repeat",value:function(){var e=this.timingNode.attr.get("repeatCount","");if(!e)return 1;if("indefinite"===e)return 1/0;var t=Number(e)/1e3;return Number.isNaN(t)?1:t}},{key:"attrNames",value:function(){var e=this.behaviorNode.childElementOptional("p:attrNameLst"),t=[];if(e){var n,r=T(e.elementsWithName("p:attrName"));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.mapAttrName(i.text);a&&t.push(a)}}catch(e){r.e(e)}finally{r.f()}}return t}},{key:"mapAttrName",value:function(e){if("string"==typeof e){var t=e.toLowerCase();switch(t){case"ppt_x":case"ppt_y":case"ppt_w":case"ppt_h":case"xshear":case"yshear":case"fillcolor":return t;case"scalex":return"scaleX";case"scaley":return"scaleY";case"style.rotation":case"r":return"rotate";case"style.visibility":return"visible";case"style.opacity":return"opacity"}}}}]),e}();function fS(e){var t,n,r,i,a=function(e){var t,n=[],r=T(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(""!==i)if(1===i.length)n.push(i);else{var a=i[0];/[a-zA-Z]/.test(a)?(n.push(a),n.push(i.substring(1))):n.push(i)}}}catch(e){r.e(e)}finally{r.f()}return n}(e.split(/,|\s/i)),o=[],s=T(a);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(/^[a-zA-Z]$/.test(c)){if(void 0!==r)throw new Error("invalid path: lack of number");void 0!==t&&o.push({sign:t,points:n}),t=c,n=[]}else{var u=parseFloat(c);if(Number.isNaN(u))throw new Error("invalid path: unrecognized number ".concat(JSON.stringify(c)));void 0===r?r=u:(n.push({x:r,y:u}),r=void 0)}}}catch(e){s.e(e)}finally{s.f()}if(void 0!==r)throw new Error("invalid path: lack of number");return void 0!==t&&o.push({sign:t,points:n}),o}var vS=function(){function e(){C(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(0===n.length)throw new Error("expect 1 curve minimum");for(var i=[],a=0,o=0,s=n;o<s.length;o++){var c=s[o];i.push(c.rectangle),a+=c.length}this.curves=Object.freeze(n),this.length=a,this.rectangle=e.unionRectangles(i)}return P(e,[{key:"get",value:function(e){var t,n,r=0,i=0,a=T(this.curves);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(t=o,i=r,e<r+o.length)break;r+=o.length}}catch(e){a.e(e)}finally{a.f()}return t.get(e-i)}}],[{key:"unionRectangles",value:function(e){var t,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,o=T(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.left<n&&(n=s.left),s.right>r&&(r=s.right),s.top<i&&(i=s.top),s.bottom>a&&(a=s.bottom)}}catch(e){o.e(e)}finally{o.f()}return Object.freeze({left:n,right:r,top:i,bottom:a})}}]),e}(),mS=function(){function e(t,n){C(this,e),this.beginX=t.x,this.beginY=t.y,this.deltaX=n.x-t.x,this.deltaY=n.y-t.y,this.length=Math.sqrt(this.deltaX*this.deltaX+this.deltaY*this.deltaY),this.rectangle=Object.freeze({left:Math.min(t.x,n.x),right:Math.max(t.x,n.x),top:Math.min(t.y,n.y),bottom:Math.max(t.y,n.y)})}return P(e,[{key:"get",value:function(e){if(0===this.length)return{x:this.beginX,y:this.beginY};var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),{x:this.beginX+t*this.deltaX,y:this.beginY+t*this.deltaY}}}]),e}(),gS=function(){function e(t,n,r,i){C(this,e),this.bezier=new yy.default([t,n,r,i]),this.length=this.bezier.length(),this.rectangle=this.createRectangle()}return P(e,[{key:"createRectangle",value:function(){var e=this.bezier.bbox();return Object.freeze({left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max})}},{key:"get",value:function(e){var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),this.bezier.get(t)}}]),e}();function yS(e){var t=e.controller,n=e.end,r=n.x-t.x,i=n.y-t.y;return{x:n.x+r,y:n.y+i}}function bS(e,t,n){if(t.length!==n)throw new Error("invalid path: sign ".concat(e," should have ").concat(n," points (").concat(2*n," number)"))}function kS(e){if(!e)throw new Error("invalid path: expect M")}var wS=function(e){var t=e.node,n=e.animation,r=e.animBox,i=new pS(t),a=function(e){var t,n,r,i,a=[],o=T(fS(e));try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.sign,u=s.points;switch(c){case"M":bS(c,u,1),t=u[0],n=u[0],r=void 0;break;case"L":bS(c,u,1),kS(n),a.push(new mS(n,u[0])),n=u[0],r=void 0;break;case"Z":bS(c,u,0),kS(n),a.push(new mS(n,t)),n=t,r=void 0;break;case"C":bS(c,u,3),kS(n),a.push(new gS(n,u[0],u[1],u[2])),r={controller:u[1],end:u[2]},n=u[2];break;case"S":if(!r)throw new Error("invalid path: expect C or S before S");bS(c,u,2),kS(n);var l=yS(r);a.push(new gS(n,l,u[0],u[1])),r={controller:u[0],end:u[1]},n=u[1];break;case"Q":bS(c,u,2),kS(n),a.push(new gS(n,u[0],u[1])),r={controller:u[0],end:u[1]},n=u[1];break;case"T":if(!r)throw new Error("invalid path: expect Q or T before T");bS(c,u,1),kS(n);var h=yS(r);r={controller:h,end:u[0]},r={controller:h,end:u[0]},n=u[0];break;case"E":break;default:throw new Error("invalid path: unrecognized sign ".concat(JSON.stringify(c)))}}}catch(e){o.e(e)}finally{o.f()}return m(vS,a)}(t.attr.getString("path","M 0 0")),o=r.initState,s=o.ppt_x,c=o.ppt_y;return new _m({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),transform:function(e){var t=a.get(e*a.length),n=t.x,r=t.y;return{ppt_x:(n||0)+s,ppt_y:(r||0)+c}}})},SS=function(){function e(t){var n=t.context,r=t.animBox;C(this,e),this.context=n,this.animBox=r}return P(e,[{key:"parse",value:function(e,t){var n=null==e?void 0:e.childElementOptional(new Zy("p:strVal","p:fltVal","p:clrVal","p:intVal"));if(n)switch(n.name){case"p:fltVal":case"p:intVal":var r=parseFloat(n.attr.getString("val"));return Fm(r)?r:void 0;case"p:clrVal":var i=Sb(n.childElement(m(Zy,fb)),this.context.slideContext);if(i){var a=i.rgb().object(),o=a.r,s=a.g,c=a.b;return new Bm({r:o,g:s,b:c,a:1})}return;default:return Fm(this.animBox.initState[t])?new Lm(n.attr.getString("val"),this.formulaScope):"visible"===t?"hidden"!==n.attr.getString("val"):n.attr.getString("val")}}},{key:"formulaScope",get:function(){return this._formulaScope?this._formulaScope:this._formulaScope=new Nm(this.animBox)}}]),e}();function xS(e,t){if(t){var n=t.childElementOptional(new Zy("p:rgb","p:hsl"));if(n)switch(n.name){case"p:rgb":return new Bm({r:n.attr.getNumber("r"),g:n.attr.getNumber("g"),b:n.attr.getNumber("b"),a:1});case"p:hsl":return new Bm({h:n.attr.getNumber("h")/Fy,s:n.attr.getNumber("s")/Dy*100,l:n.attr.getNumber("l")/Dy*100,a:1})}else{var r=Sb(t.childElement(m(Zy,fb)),e);if(r){var i=r.rgb().object(),a=i.r,o=i.g,s=i.b;return new Bm({r:a,g:o,b:s,a:1})}}}}function CS(e){var t=Number(e);if(!Number.isNaN(t))return Uy(t)}function IS(e){if(e)return{scaleX:zy(e.attr.getString("x")),scaleY:zy(e.attr.getString("y"))}}var PS=function(e){var t=e.node,n=e.animation,r=e.animBox,i=new pS(t),a=function(e){var t=/^playFrom\(([^)]+)\)$/.exec(e);return t?{name:"playFrom",value:parseFloat(t[1])}:e.includes("pause")?{name:"pause"}:{name:"stop"}}(t.attr.getString("cmd"));return new Gm({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:1,delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),cmd:a})};function MS(e,t,n){var r=e.node,i=e.context,a=e.animBox;var o=r.childElementOptional("p:tavLst");if(o){var s=new SS({context:i,animBox:a}),c=o.elementsWithName("p:tav").map((function(e){var t=s.parse(e.childElement("p:val"),n);if(null!=t)return{val:t,progress:zy(e.attr.getString("tm")),fmla:function(e){if(e){if(Fm(a.initState[n]))return new Lm(e,s.formulaScope);console.error("Expr ".concat(e," cannot work with targetKey ").concat(n))}}(e.attr.getStringOptional("fmla"))}})).filter((function(e){return Boolean(e)}));if(!(c.length<=0)){if("lin"!==t)return TS(c,n,AS);if(Fm(c[0].val))return TS(c,n,mm);if(c[0].val instanceof Bm)return TS(c,n,Ym)}}}function TS(e,t,n){return function(r){for(var i=1;i<e.length;i++){var o=e[i-1],s=e[i];if(r>=o.progress&&r<=s.progress){var c=n(o.val,s.val,(r-o.progress)/(s.progress-o.progress));return a({},t,o.fmla?o.fmla.evaluate(c):c)}}var u=e[e.length-1],l=u.fmla,h=u.val;return a({},t,l?l.evaluate(h):h)}}function AS(e,t,n){return n<1?e:t}var ES=function(){function e(t,n){C(this,e),this.node=t,this.animBox=n}return P(e,[{key:"parse",value:function(e,t){var n=this.node.attr.getStringOptional(e);if(n){var r=this.animBox.initState[t];if(r instanceof Bm)try{return new Bm(n)}catch(i){return}if(Fm(r)){var i=Number(n);return Fm(i)?i:("by"===e&&("ppt_x"===t||"ppt_y"===t)&&(n+="+#".concat(t)),new Lm(n,this.formulaScope))}return"visible"===t?"hidden"!==n:void 0}}},{key:"formulaScope",get:function(){return this._formulaScope?this._formulaScope:this._formulaScope=new Nm(this.animBox)}}]),e}(),OS=function(e){switch(e.node.name){case"p:animMotion":return wS(e);case"p:set":return function(e){var t,n=e.node,r=e.animation,i=e.context,a=e.animBox,o=new pS(n),s=o.attrNames(),c={},u=new SS({context:i,animBox:a}),l=T(s);try{for(l.s();!(t=l.n()).done;){var h=t.value;switch(h){case"visible":var d=u.parse(n.childElementOptional("p:to"),"visible");null!=d&&(c.visible=d,a.preAnimation()||a.preAnimation({visible:!d}));break;case"opacity":case"xshear":case"yshear":var p=u.parse(n.childElementOptional("p:to"),h);null!=p&&(c[h]=p)}}}catch(e){l.e(e)}finally{l.f()}return new _m({animBox:a,effectType:r.nodeType,playerID:o.animeId(),eventSource:r.eventSourceShapeId,duration:o.duration(),delay:o.delay(),transform:Hm((function(){var e={};for(var t in c)if(Dm(c,t))switch(t){case"visible":e.visible=!c.visible;break;case"opacity":case"xshear":case"yshear":e[t]=a.currentState[t]}return e}),c)})}(e);case"p:animEffect":return function(e){var t=e.animBox,n=e.node,r=e.animation,i=n.attr.getStringOptional("transition");if(i){var a=new pS(n),o=0,s=1;return"out"===i&&(o=1,s=0),new _m({animBox:t,effectType:r.nodeType,playerID:a.animeId(),eventSource:r.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:!0,transform:Wm({opacity:o},{opacity:s})})}}(e);case"p:anim":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=new pS(t),o=t.attr.getString("calcmode","lin"),s=i.attrNames()[0];if(s){var c=new ES(t,r),u=!1,l=MS(e,o,s);if(!l){var h=c.parse("from",s),d=c.parse("to",s);if(d||(u=!0,d=c.parse("by",s)),!d)return;l=Hm((function(){return a({},s,null!=h?h:r.currentState[s])}),a({},s,d))}return new _m({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),by:u,transform:l})}console.error("Missing attrName for p:anim",i.animeId())}(e);case"p:animClr":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=e.context,a=new pS(t);if(a.attrNames().includes("fillcolor")){var o,s=!1;if((o=xS(i.slideContext,t.childElementOptional("p:to")))||(s=!0,o=xS(i.slideContext,t.childElementOptional("p:by"))),o){var c,u=o,l=xS(i.slideContext,t.childElementOptional("p:from"));return new _m({animBox:r,effectType:n.nodeType,playerID:a.animeId(),eventSource:n.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:s,transform:function(e){l||(l=r.currentState.fillcolor,c=l.alpha());var t=Um(l,u,e);return{fillcolor:c>0?t.alpha(c):t}}})}}}(e);case"p:animRot":return function(e){var t=e.node,n=e.animation,r=e.context,i=e.animBox,a=new pS(t),o=!1,s=CS(t.attr.getStringOptional("to"));if(null==s&&(o=!0,s=CS(t.attr.getStringOptional("by"))),null==s){var c=new SS({context:r,animBox:i}).parse(t.childElementOptional("p:by"),"rotate");Fm(c)&&(s=Uy(Number(c)))}if(null!=s){var u=s,l=CS(t.attr.getStringOptional("from"));return new _m({animBox:i,effectType:n.nodeType,playerID:a.animeId(),eventSource:n.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:o,transform:Hm((function(){var e;return{rotate:null!=l?l:o?0:null!=(e=i.currentState.rotate)?e:0}}),{rotate:u})})}}(e);case"p:animScale":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=new pS(t),a=!1,o=IS(t.childElementOptional("p:to"));if(null==o&&(a=!0,o=IS(t.childElementOptional("p:by"))),null!=o){var s=o,c=IS(t.childElementOptional("p:from"));return new _m({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),by:a,transform:Hm((function(){var e,t;return null!=c?c:a?{scaleX:1,scaleY:1}:{scaleX:null!=(e=r.currentState.scaleX)?e:1,scaleY:null!=(t=r.currentState.scaleY)?t:1}}),s)})}}(e);case"p:cmd":return PS(e);default:console.error("failed parsing ".concat(e.node.name," animation node"))}};function RS(e,t,n){return new _m({animBox:e,effectType:t,playerID:"Dim".concat(String(Date.now())),duration:1,delay:n,transform:Hm((function(){return{visible:e.currentState.visible}}),{visible:!1})})}var NS=function(){function e(t,n){var r,i,a,o=this;C(this,e),this.animations=t,this.context=n,this.mainPlayerSeq=[],this.interactivePlayerSeqs=new Map,this.subNextPlayerAnimBoxes=new Map,this.textAnimSpIds=new Set,this.triggerEvent=new Zg,this.animBoxes=new Map,this.textCount=0,this.type=n.resourceType;for(var s=0;s<this.animations.length;s+=1){var c=this.animations[s],u=this.getAnimationSeq(c);if(u){var l=this.getAnimBox(c.spId,null==(r=c.pRg)?void 0:r.start),h=void 0;if("lt"!==c.textAnimMode&&"wd"!==c.textAnimMode||c.pBg){if((h=this.getAnimationPlayer(c,l))&&c.parentDelay>0){var d=c.parentDelay-u.reduce((function(e,t){return e+t.duration}),0);d>0&&(h=new fm({players:[h],effectType:h.effectType,delay:d}))}}else this.textAnimSpIds.add(c.spId),h=this.getTextAnimationPlayer(c,l);if(h){h=this.joinSubSamePlayers(h,c,l);var p=this.getSubNextPlayerAnimBoxes(this.getSeqId(c));u.length>0&&h.effectType!==u[u.length-1].effectType&&this.squashLastSeqPlayers(u),"withEffect"!==h.effectType&&this.joinLastSubNextIntoPlayers(this.getSeqId(c),u),("withEffect"!==h.effectType||0===s)&&p.push([]),"next"===c.dimAfter&&p[p.length-1].push(l),u.push(h)}}}this.squashLastSeqPlayers(this.mainPlayerSeq),this.joinLastSubNextIntoPlayers("mainSeq",this.mainPlayerSeq),this.interactivePlayerSeqs.forEach((function(e,t){o.squashLastSeqPlayers(e),o.joinLastSubNextIntoPlayers(t,e)})),this.mainSeq=new vm({playerID:"mainSeq",players:this.mainPlayerSeq,effectType:null!=(a=null==(i=this.mainPlayerSeq[0])?void 0:i.effectType)?a:"clickEffect"}),this.interactiveSeqs=new Map,this.interactivePlayerSeqs.forEach((function(e,t){var n,r;o.interactiveSeqs.set(t,new vm({playerID:"interactiveSeq"+t,players:e,effectType:null!=(r=null==(n=e[0])?void 0:n.effectType)?r:"clickEffect"}))}))}return P(e,[{key:"withTextAnimation",value:function(e){return this.textAnimSpIds.has(e)}},{key:"end",value:function(){console.log("[animation manager]: end"),this.mainSeq.seek(this.mainSeq.duration+1)}},{key:"pause",value:function(){console.log("[animation manager]: pause");var e,t=T(this.mainSeq.players);try{for(t.s();!(e=t.n()).done;){e.value.pause()}}catch(e){t.e(e)}finally{t.f()}this.interactiveSeqs.forEach((function(e){var t,n=T(e.players);try{for(n.s();!(t=n.n()).done;){t.value.pause()}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"reset",value:function(){var e=this;console.log("[animation manager]: reset"),this.mainSeq.reset(),this.interactiveSeqs.forEach((function(e){return e.reset()})),um.render((function(){e.animBoxes.forEach((function(e){return e.clearCache()}))}),!1,!1)}},{key:"logSeq",value:function(){var e="";function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n instanceof vm?(e+="".concat(r,"seq ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):n instanceof Tv?(e+="".concat(r,"par ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):n instanceof fm?(e+="".concat(r,"par2 ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):e+="".concat(r).concat(n.playerID," ").concat(n.effectType,"\n")}e+="mainSeq\n",t(this.mainSeq,"  "),e+="interactiveSeqs\n",this.interactiveSeqs.forEach((function(e){return t(e,"  ")})),console.log(e)}},{key:"getPlayer",value:function(e,t){var n=t;n||(n=[this.mainSeq].concat(p(Array.from(this.interactiveSeqs.values()))));var r,i=T(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.playerID===e)return a;var o=a.players;if(o){var s=this.getPlayer(e,o);if(s)return s}}}catch(e){i.e(e)}finally{i.f()}}},{key:"getAnimationSeq",value:function(e){switch(e.sequenceType){case"mainSeq":return this.mainPlayerSeq;case"interactiveSeq":if(void 0!==e.eventSourceShapeId)return this.getInteractiveSeq(pw(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId));console.error("interactiveSeq animation ".concat(e.id," does not have eventSourceShapeId"),e);break;default:console.error('not support sequenceType: "'.concat(e.sequenceType,'"'),e)}}},{key:"getInteractiveSeq",value:function(e){var t=this.interactivePlayerSeqs.get(e);return t||(t=[],this.interactivePlayerSeqs.set(e,t)),t}},{key:"getTextScale",value:function(e){var t=1/0;return e.forEach((function(e){e.prop.size<t&&(t=e.prop.size)})),t>=12?1:t/12}},{key:"getTextRect",value:function(e,t){var n,r,i,a,o,s,c,u=0;if(e){var l,h=T(e.paragraphs);try{for(h.s();!(l=h.n()).done;){var d,p=T(l.value.lines);try{for(p.s();!(d=p.n()).done;){var f,v=d.value,m=this.getTextScale(v),g=T(v);try{for(g.s();!(f=g.n()).done;){var y=f.value;if(u<=t&&u+(null!=(r=null==(n=y.text)?void 0:n.length)?r:0)>t){var b=Number(y.prop.width)/m/(null!=(a=null==(i=y.text)?void 0:i.length)?a:1);return{height:null!=(o=y.prop.height)?o:y.prop.size,width:b,textScale:m}}u+=null!=(c=null==(s=y.text)?void 0:s.length)?c:0}}catch(e){g.e(e)}finally{g.f()}}}catch(e){p.e(e)}finally{p.f()}}}catch(e){h.e(e)}finally{h.f()}}}},{key:"getParagraphRect",value:function(e,t){var n=null==e?void 0:e.paragraphs[t],r=null==e?void 0:e.prop.width,i=null==n?void 0:n.lines.map((function(e){return Math.max.apply(Math,p(e.map((function(e){var t;return null!=(t=e.prop.height)?t:e.prop.size}))))})).reduce((function(e,t){return e+t}),0);if(r&&i)return{height:i,width:r,textScale:1}}},{key:"getTextWrapper",value:function(e){var t,n,r,i,a,o,s,c,u,l,h,d,p,f,v;return e.includes("m")?null==(a=null==(i=null==(r=null==(n=null==(t=this.context.wrapResource)?void 0:t.master)?void 0:n.shapes)?void 0:r[e.replace("m","")])?void 0:i.textBodyMap)?void 0:a[0]:e.includes("l")?null==(l=null==(u=null==(c=null==(s=null==(o=this.context.wrapResource)?void 0:o.layout)?void 0:s.shapes)?void 0:c[e.replace("l","")])?void 0:u.textBodyMap)?void 0:l[0]:null==(v=null==(f=null==(p=null==(d=null==(h=this.context.wrapResource)?void 0:h.slide)?void 0:d.shapes)?void 0:p[e])?void 0:f.textBodyMap)?void 0:v[0]}},{key:"getAnimBox",value:function(e,t,n){var r,i,a,o=e,s=null!=n,c=null!=t;c?(o+=",".concat(t),s&&(o+=",".concat(n))):s&&(o+=",,".concat(n));var u=this.animBoxes.get(o);if(!u){var l=this.context.shapeParamsIndex[e],h=Qm;if(l.fillColor){var d=l.fillColor.rgb().object(),p=d.r,f=d.g,v=d.b,m=d.alpha;h=new Bm({r:p,g:f,b:v,a:null!=m?m:1})}var g,y=pw(this.context.pptUUID,this.context.slideIndex,e),b=l.rotate?Uy(l.rotate):0;if(s||c){b=0;var k=this.getTextWrapper(e);s?(g=this.getTextRect(k,this.textCount),this.textCount+=1):c&&(g=this.getParagraphRect(k,t))}u=new Kg({target:y,pIndex:g?t:void 0,tIndex:g?n:void 0,constants:{x:l.rectangle.x,y:l.rectangle.y,width:g?g.width*jy:l.rectangle.width||1,height:g?g.height*jy:l.rectangle.height||1,slideWidth:this.context.slideWidth/(null!=(r=null==g?void 0:g.textScale)?r:1),slideHeight:this.context.slideHeight/(null!=(i=null==g?void 0:g.textScale)?i:1),flipH:l.flipH,flipV:l.flipV},initState:{opacity:null!=(a=l.opacity)?a:1,fillcolor:h,rotate:b}}),this.animBoxes.set(o,u)}return u}},{key:"squashLastSeqPlayers",value:function(e,t){var n,r;if(!(e.length<=1)){var i=e[e.length-1].effectType;if("withEffect"===i){for(var a=e.length-1;a>0&&e[a].effectType===i;)a-=1;var o=e.splice(a,e.length-a);e.push(new Tv({players:o,effectType:null!=(r=null!=t?t:null==(n=o[0])?void 0:n.effectType)?r:"clickEffect"}))}}}},{key:"getAnimationPlayer",value:function(e,t){if(e.animationXML){var n,r=[],i=T(e.animationXML.elements);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=OS({node:a,animation:e,context:this.context,triggerEvent:this.triggerEvent,animBox:t});!o||(t.preAnimation()||t.preAnimation({}),r.push(o))}}catch(e){i.e(e)}finally{i.f()}if(!(r.length<=0)){if(e.soundEffectId){var s=function(e,t){if(e.soundEffectId)return new Gm({animBox:t,effectType:e.nodeType,playerID:"SF".concat(String(Date.now())),eventSource:e.eventSourceShapeId,duration:1,delay:0,cmd:{name:"playSF",value:e.soundEffectId}})}(e,t);s&&r.push(s)}var c=function(e){return"number"==typeof e?e:"indefinite"===e?1/0:1}(e.repeatCount);return e.delay>0||c>1||e.autoRev?new fm({playerID:"parr"+e.id,players:r,effectType:e.nodeType,delay:e.delay,repeat:c,reverse:Boolean(e.autoRev)}):r.length>1?new Tv({playerID:"par"+e.id,players:r,effectType:e.nodeType}):r[0]}}}},{key:"getTextAnimationPlayer",value:function(e,t){var n,r=this,i=function(e,t,n){var r,i,a,o,s,c,u,l,h,d,p,f,v,m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=0;return(v=t.includes("m")?null==(o=null==(a=null==(i=null==(r=null==e?void 0:e.master)?void 0:r.shapes)?void 0:i[t.replace("m","")])?void 0:a.textBodyMap)?void 0:o[0]:t.includes("l")?null==(l=null==(u=null==(c=null==(s=null==e?void 0:e.layout)?void 0:s.shapes)?void 0:c[t.replace("l","")])?void 0:u.textBodyMap)?void 0:l[0]:null==(f=null==(p=null==(d=null==(h=null==e?void 0:e.slide)?void 0:h.shapes)?void 0:d[t])?void 0:p.textBodyMap)?void 0:f[0])&&(null==n?v.paragraphs:v.paragraphs.slice(n,n+1)).forEach((function(e){e.runs.forEach((function(e){e.text&&(m&&"en"===e.prop.language?g+=1:g+=e.text.length)}))})),g}(this.context.wrapResource,e.spId,null==(n=e.pRg)?void 0:n.start,"wd"===e.textAnimMode);if(0===i)return this.getAnimationPlayer(e,t);var a=Array(i).fill(0).map((function(t,n){var i,a=r.getAnimBox(e.spId,null==(i=e.pRg)?void 0:i.start,n),o=r.getAnimationPlayer(e,a);return o?new fm({effectType:e.nodeType,delay:e.textAnimIterateDelay(o.duration-o.delay)*n,players:[o]}):null})).filter((function(e){return Boolean(e)}));return a.length<=1?a[0]:new Tv({effectType:e.nodeType,players:a})}},{key:"joinSubSamePlayers",value:function(e,t,n){return"mainSeq"!==t.sequenceType||"same"!==t.dimAfter?e:new Tv({players:[e,RS(n,"withEffect",e.duration+32)],effectType:e.effectType})}},{key:"joinLastSubNextIntoPlayers",value:function(e,t){var n=this.getSubNextPlayerAnimBoxes(e),r=t[t.length-1],i=n[n.length-2];if(r&&i&&!(i.length<=0)){var a,o=[r],s=T(i);try{for(s.s();!(a=s.n()).done;){var c=a.value;o.push(RS(c,"withEffect",r.delay))}}catch(e){s.e(e)}finally{s.f()}t[t.length-1]=new Tv({players:o,effectType:r.effectType})}}},{key:"getSubNextPlayerAnimBoxes",value:function(e){var t=this.subNextPlayerAnimBoxes.get(e);return t||(t=[],this.subNextPlayerAnimBoxes.set(e,t)),t}},{key:"getSeqId",value:function(e){return"interactiveSeq"===e.sequenceType&&void 0!==e.eventSourceShapeId?pw(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId):"mainSeq"}}]),e}();function LS(e,t){var n=new hS(t.slideContext.master,Ny(Ry({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})).collect(),r=new hS(t.slideContext.layout,Ny(Ry({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})).collect(),i=new hS(e,Ny(Ry({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})).collect(),a=new NS(n,Ny(Ry({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})),o=new NS(r,Ny(Ry({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})),s=new NS(i,Ny(Ry({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})),c=new NS(n.concat.apply(n,p(r).concat(p(i))),Ny(Ry({},t),{resourceType:"main",shapeParamsIndex:Ry(Ry(Ry({},t.slideShapeParamsIndex),t.layoutShapeParamsIndex),t.masterShapeParamsIndex)})),u={slide:0,layout:0,master:0};return u.slide=s.mainSeq.length,u.layout=o.mainSeq.length,u.master=a.mainSeq.length,"clickEffect"!==s.mainSeq.effectType&&(u.layout>0?u.layout-=1:u.master>0&&(u.master-=1)),"clickEffect"!==o.mainSeq.effectType&&u.master>0&&(u.master-=1),[s,o,a].forEach((function(e){e.triggerEvent.on("onEnd",(function(e){var t=e.target;"slide"===t?(s.end(),c.end()):"layout"===t?o.end():"master"===t&&a.end()})),e.triggerEvent.on("onUnmount",(function(e){var t=e.target;"slide"===t?(s.reset(),c.reset()):"layout"===t?o.reset():"master"===t&&a.reset()}))})),{masterAnimationManager:a,layoutAnimationManager:o,slideAnimationManager:s,mainAnimationManager:c,animationCount:u,sequenceAnimesCounts:{get"-1"(){return s.mainSeq.length}}}}var jS="masterPartName",DS="layoutPartName";function FS(e,t){return zS.apply(this,arguments)}function zS(){return zS=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sk("".concat(t,"/text/slide/slide").concat(n,".json"));case 2:return r=e.sent,i=r[jS].replace("/ppt/slideMasters/slideMaster","/text/master/master").replace(".xml",".json"),a=r[DS].replace("/ppt/slideLayouts/slideLayout","/text/layout/layout").replace(".xml",".json"),e.next=7,sk("".concat(t).concat(i));case 7:return o=e.sent,e.next=10,sk("".concat(t).concat(a));case 10:return s=e.sent,e.abrupt("return",{slide:r,master:o,layout:s});case 12:case"end":return e.stop()}}),e)}))),zS.apply(this,arguments)}function BS(e,t){return US.apply(this,arguments)}function US(){return US=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,h,d,p,f,v,m,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>2&&void 0!==g[2]&&g[2],g.length>3?g[3]:void 0,i=g.length>4?g[4]:void 0,a=g.length>5?g[5]:void 0,o=g.length>6?g[6]:void 0,a&&a.info("Start load ppt ".concat(n," resource.")),s=t.replace(/\/$/i,""),o&&o.scheme&&(c=o.scheme,s=s.replace(/^[a-zA-z]+[^://]/,c)),u=new Sk(c),e.next=11,Promise.all([sk(s+"/info.json",a),ak(s+"/pptxml/ppt.xml",a)]);case 11:return h=e.sent,d=l(h,2),p=d[0],f=d[1],e.next=17,u.loadLumiaPSD(r,a);case 17:return a&&a.info("load ppt ".concat(n," resource success")),v=(o||{}).useServerWrap,m=void 0===v||v,e.abrupt("return",(m&&tb(s,n,p.fonts),new _S({uuid:n,url:s,width:p.width,height:p.height,slidesCount:p.totalPageSize,mainXMLContent:f,userFonts:i,preload:r,logger:a,resourceScheme:c,rtcClient:null==o?void 0:o.rtcClient,useServerWrap:m})));case 20:case"end":return e.stop()}}),e)}))),US.apply(this,arguments)}var VS,WS,HS,_S=function(){function e(t){C(this,e),this.url=t.url,this.uuid=t.uuid,this.width=t.width*Ly,this.height=t.height*Ly,this.slidesCount=t.slidesCount,this.userFonts=t.userFonts,this.preload=t.preload,this.logger=t.logger,this.resourceScheme=t.resourceScheme,this.mainXMLContent=t.mainXMLContent,this.rtcClient=t.rtcClient,this.useServerWrap=t.useServerWrap}var t,n,r;return P(e,[{key:"loadSlide",value:(r=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,h,d,p,f,v,m,g,y,b,k,w,S,x,C,I,P,M,T=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=this.logger)||n.debug("begin load slide ".concat(t+1)),o=lS.createPickers(),s=new qy("main",o).parse(this.mainXMLContent),!(t<0||t>=this.slidesCount)){e.next=4;break}throw new Error("index should be in 0 ~ ".concat(this.slidesCount-1));case 4:return c=t+1,e.next=7,this.fetchSlideInfo(c);case 7:return u=e.sent,l=u.slideXMLContent,h=u.slideRefXMLContent,d=u.layoutXMLContent,p=u.masterXMLContent,f=u.themeXMLContent,v=u.resource,m=u.wrapResource,!0===this.preload&&(null==(r=this.logger)||r.debug("begin preload slide ".concat(c+1)),this.prefetch(c+1).catch((function(e){var t;null==(t=T.logger)||t.debug("prefetch slide ".concat(c+1," error: "),e)})),null==(i=this.logger)||i.debug("preloaded slide ".concat(c+1))),g=new qy("layout",o).parse(d),y=Cw(g.childElement("p:sldLayout","p:cSld","p:spTree")),b=new qy("master",o).parse(p),k=Cw(b.childElement("p:sldMaster","p:cSld","p:spTree"),b.childElementOptional("p:sldMaster","p:txStyles")),w=new qy("theme",o).parse(f),S=new Pw(v,this.resourceScheme),x=new qy("slide",o).parse(l),C=new qy("slideRef",o).parse(h),I={},void 0!==C.element&&C.element.elements.forEach((function(e){I[e.attr.getString("Id")]=e.attr.getStringOptional("Target")})),P={slide:x,layout:g,layoutIndex:y,master:b,masterIndex:k,masterThemeColorMapping:b.childElement("p:sldMaster","p:clrMap").attr.attributes,theme:w,main:s,userFonts:this.userFonts},o.context=Object.freeze(P),M=LS(x,Object.freeze({pptUUID:this.uuid,slideIndex:c,slideContext:P,slideWidth:this.width,slideHeight:this.height,masterShapeParamsIndex:this.getShapeIndexMap(b.childElement("p:sldMaster","p:cSld","p:spTree")),layoutShapeParamsIndex:this.getShapeIndexMap(g.childElement("p:sldLayout","p:cSld","p:spTree")),slideShapeParamsIndex:this.getShapeIndexMap(x.childElement("p:sld","p:cSld","p:spTree")),wrapResource:m})),e.abrupt("return",(null==(a=this.logger)||a.debug("loaded slide ".concat(c)),this.slideIndex=t,Object.freeze({uuid:this.uuid,url:this.url,index:t,width:this.width,height:this.height,masterXML:b,masterIndex:k,layoutXML:g,layoutIndex:y,mainXML:s,themeXML:w,slideXML:x,slideRefIndex:I,resourceLoader:S,animations:M,slidesCount:this.slidesCount,preload:this.preload,logger:this.logger,rtcClient:this.rtcClient,WrapResource:m,preSlideIndex:this.preSlideIndex})));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchSlideInfo",value:(n=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[ak("".concat(this.url,"/slide/slide").concat(t,".xml"),this.logger),ak("".concat(this.url,"/slideRef/slideRef").concat(t,".xml"),this.logger).catch((function(e){return console.log("error ",e),""})),ak("".concat(this.url,"/layout/layout").concat(t,".xml"),this.logger),ak("".concat(this.url,"/master/master").concat(t,".xml"),this.logger),ak("".concat(this.url,"/theme/theme").concat(t,".xml"),this.logger),sk("".concat(this.url,"/resources/resource").concat(t,".json"),this.logger)],e.next=3,Promise.all(n);case 3:if(r=e.sent,i=l(r,6),a=i[0],o=i[1],s=i[2],c=i[3],u=i[4],h=i[5],!this.useServerWrap){e.next=20;break}return e.prev=12,e.next=15,FS(this.url,t);case 15:d=e.sent,e.next=20;break;case 18:e.prev=18,e.t0=e.catch(12);case 20:return e.abrupt("return",{slideXMLContent:a,slideRefXMLContent:o,layoutXMLContent:s,masterXMLContent:c,themeXMLContent:u,resource:h,wrapResource:d});case 21:case"end":return e.stop()}}),e,this,[[12,18]])}))),function(e){return n.apply(this,arguments)})},{key:"prefetch",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>this.slidesCount)){e.next=3;break}return null==(n=this.logger)||n.debug("no slide need prefetch"),e.abrupt("return");case 3:return i=new Sk(this.resourceScheme),e.next=6,i.fetchPageResource(this.url,t);case 6:a=e.sent,i.prefetchPageResource(a).then((function(){}),(function(){})),null==(r=this.logger)||r.debug("prefetch slide ".concat(t," finish"));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getShapeIndexMap",value:function(e){var t={},n=e.extraAttr.getString("spId"),r=mw(e);return this.getShapeGroupIndexMap(e,t,n,r.transform),t}},{key:"getShapeGroupIndexMap",value:function(e,t,n,r){var i=this,a=e.elementsWithName("p:sp");this.getChildShapesIndexMap(a,t,n,r);var o=e.elementsWithName("p:cxnSp");this.getChildShapesIndexMap(o,t,n,r);var s=e.elementsWithName("p:pic");this.getChildShapesIndexMap(s,t,n,r);var c=e.elementsWithName("p:graphicFrame");this.getChildShapesIndexMap(c,t,n,r);var u=e.elementsWithName("p:grpSp");u.length>0&&u.forEach((function(e){var a=e.extraAttr.getString("spId"),o=mw(e,void 0,n,r);i.getShapeGroupIndexMap(e,t,a,o.transform),t[a]=o}))}},{key:"getChildShapesIndexMap",value:function(e,t,n,r){e.forEach((function(e){var i=e.extraAttr.getString("spId"),a=fw(e,void 0,n,r);t[i]=a}))}}]),e}(),GS=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).state={disableJumpTo:!1},r}return P(n,[{key:"UNSAFE_componentWillMount",value:function(){var e=this.props.emitter;e.on("nextStep",this.onNextStepHandler,this),e.on("preStep",this.onPreStepHandler,this),e.on("nextPage",this.onNextPageHandler,this),e.on("prePage",this.onPrePageHandler,this),e.on("resetSlideAnimation",this.resetCurrentSlideAnimation,this),e.on("resetPPTAnimation",this.resetCurrentPPTAnimation,this),e.on("changePageTo",this.onClickJumpToHandler,this),e.on("displaySidebar",this.displaySidebar,this),e.on("hideSidebar",this.hideSidebar,this),e.on("displayNote",this.displayNote,this),e.on("hideNote",this.hideNote,this)}},{key:"componentWillUnmount",value:function(){this.props.emitter.removeAllListeners()}},{key:"onPrePageHandler",value:function(){var e=this.props,t=e.slideIndex,n=e.changeToPage;t>0&&n(t-1)}},{key:"onNextPageHandler",value:function(){var e=this.props,t=e.slideIndex,n=e.changeToPage;t<e.total-1&&n(t+1)}},{key:"onClickJumpToHandler",value:function(e){var t=this.props,n=t.total,r=t.changeToPage,i=(e||parseInt(this.inputRef.value,10))-1;return Number.isNaN(i)||i<0?(this.inputRef.value="1",void r(0)):i>n-1?(this.inputRef.value="".concat(n),void r(n-1)):(this.inputRef.value=(i+1).toString(),void r(i))}},{key:"onPreStepHandler",value:function(){(0,this.props.changeStep)(-1)}},{key:"onNextStepHandler",value:function(){(0,this.props.changeStep)(1)}},{key:"invalidJumpTo",value:function(){Number.isNaN(parseInt(this.inputRef.value,10))?this.setState({disableJumpTo:!0}):this.setState({disableJumpTo:!1})}},{key:"resetCurrentSlideAnimation",value:function(){(0,this.props.resetCurrentSlideAnimation)()}},{key:"resetCurrentPPTAnimation",value:function(){(0,this.props.resetCurrentPPTAnimation)()}},{key:"displaySidebar",value:function(){(0,this.props.changeIsExtendSidebar)(!0)}},{key:"hideSidebar",value:function(){(0,this.props.changeIsExtendSidebar)(!1)}},{key:"displayNote",value:function(){(0,this.props.changeIsShowNote)(!0)}},{key:"hideNote",value:function(){(0,this.props.changeIsShowNote)(!1)}},{key:"render",value:function(){var e=this,t=this.state.disableJumpTo,n=this.props,r=n.slideIndex,i=n.total,a=n.isExtendSidebar,o=n.isShowNote,s=n.international,c=n.disableSidebar,u=n.disableNote;return Sy.default.createElement("div",{className:"ppt-preview-beauty-scroll-bar ppt-preview-controls"},Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:0===r,onClick:function(){e.onPrePageHandler()}},s&&s.prePage||""),Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onPreStepHandler()}},s&&s.preStep||""),Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onNextStepHandler()}},s&&s.nextStep||""),Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:r===i-1,onClick:function(){e.onNextPageHandler()}},s&&s.nextPage||""),Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.resetCurrentSlideAnimation()}},s&&s.resetCurrentSlideAnimation||""),Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.resetCurrentPPTAnimation()}},s&&s.resetCurrentPPTAnimation||""),Sy.default.createElement("input",{className:"ppt-preview-controls-input",type:"text",onInput:function(){e.invalidJumpTo()},ref:function(t){e.inputRef=t}}),Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onClickJumpToHandler()},disabled:t},s&&s.jumpTo||""),a?Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.hideSidebar()}},s&&s.hideSidebar||""):Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.displaySidebar()},disabled:c},s&&s.displaySidebar||""),o?Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.hideNote()}},s&&s.hideNote||""):Sy.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.displayNote()},disabled:u},s&&s.displayNote||""),Sy.default.createElement("p",{className:"ppt-preview-controls-page"},s&&s.pageNumber||"","",r+1," ","/",i))}}]),n}(Sy.default.Component),YS=function(e){g(n,e);var t=b(n);function n(e){return C(this,n),t.call(this,e)}return P(n,[{key:"render",value:function(){var e=this.props,t=e.isShow,n=e.noteList;return xy.default.createElement("div",{style:{width:"100%",height:"200px",overflow:"auto",position:"absolute",bottom:t?0:"-200px",transition:"1s",zIndex:"2",fontSize:"12px",padding:"12px",boxSizing:"border-box",fontFamily:""},className:"ppt-preview-beauty-scroll-bar ppt-preview-note"},n.map((function(e,t){var n,r={textAlign:Nb(null!=(n=e.align)?n:"l"),marginLeft:e.marginLeft?"".concat(e.marginLeft,"px"):0,marginRight:e.marginRight?"".concat(e.marginRight,"px"):0,textIndent:e.indent?"".concat(e.indent,"px"):0};return xy.default.createElement("div",{key:t,style:r},e.buchar&&xy.default.createElement("span",null,parseInt(e.buchar,10)?e.buchar+".":e.buchar,""),!e.runs&&xy.default.createElement("br",null),e.runs&&e.runs.map((function(e,n){var r,i={letterSpacing:e.wordSpace?"".concat(e.wordSpace,"px"):0,verticalAlign:e.baseline?"".concat(e.baseline,"px"):0,textDecoration:e.underLine?Lb(e.underLine):"none",strikeThrough:e.strikeThrough?"":"none",fontWeight:e.bold?"bolder":"normal",fontStyle:e.italic?"italic":"normal"},a=e.text?e.text:"";if(null==(r=e.text)?void 0:r.includes("\t")){for(var o=[],s=0;s<e.text.length;s+=1)"\t"===e.text[s]?o.push(xy.default.createElement("span",{key:"tab"+s},"\t")):o.push(xy.default.createElement("span",{key:"tab"+s,style:{fontFamily:""}},e.text[s]));return xy.default.createElement("pre",{key:a+t+n,style:{margin:"0",display:"inline"}},o)}return"sngStrike"===e.strikeThrough?xy.default.createElement("span",{key:a+t+n,style:i},xy.default.createElement("s",null,e.text)):"br"===e.runType?xy.default.createElement("br",null):"text"===e.runType?xy.default.createElement("span",{key:a+t+n,style:i},e.text):xy.default.createElement("span",{key:a+t+n})})))})))}}]),n}(xy.default.PureComponent),XS=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"clickHandler",value:function(e){(0,this.props.changeToPage)(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.isExtend,r=t.previewList,i={display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"absolute",right:n?0:"-20%",width:"20%",overflow:"auto",transition:"1s",top:0,bottom:0,zIndex:"3",borderLeft:"1px solid #ccc",backgroundColor:"#eee"},a={display:"flex",flexDirection:"column",justifyContent:"space-around"};return Cy.default.createElement("div",{style:i,className:"ppt-preview-beauty-scroll-bar ppt-preview-sidebar"},r.map((function(t,n){return Cy.default.createElement("div",{className:"ppt-preview-sidebar-item ppt-event-source",key:t,style:a,onClick:function(){e.clickHandler(n)}},Cy.default.createElement("img",{className:"ppt-preview-sidebar-img",src:t,alt:"PPT"}),Cy.default.createElement("span",{className:"ppt-preview-sidebar-span"},n+1))})))}}]),n}(Cy.default.Component);!function(e){e.waiting="Waiting",e.converting="Converting",e.finished="Finished",e.fail="Fail"}(VS||(VS={})),function(e){e.packaging="Packaging",e.extracting="Extracting",e.generatingPreview="GeneratingPreview",e.mediaTranscode="MediaTranscode"}(WS||(WS={})),function(e){e.dynamic="dynamic",e.static="static"}(HS||(HS={}));var QS=function(e){g(a,e);var t,n,r,i=b(a);function a(e){var t,n,r;return C(this,a),(t=i.call(this,e)).previewList=[],t.PPTSliderList=[],t.stateAdapter={disableInteractive:!1,setState:(r=u(regeneratorRuntime.mark((function e(n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({globalPPTState:i});case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)}),onPageToPrev:function(){var e=t.state.slideIndex;t.changePageTo(e-1).then((function(){}),(function(){}))},onPageToNext:function(){var e=t.state.slideIndex;t.changePageTo(e+1).then((function(){}),(function(){}))},onPageJumpTo:(n=u(regeneratorRuntime.mark((function e(n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.changePageTo(r-1).then((function(){}),(function(){}));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)}),setSlideStateAdapterCallbacks:function(e){}},t.clickSidebarHandler=function(e){t.changePageTo(e).then((function(){}),(function(){}))},t.clickControllerHandler=function(e){t.changePageTo(e).then((function(){}),(function(){}))},t.changeIsExtendSidebar=function(e){0!==t.previewList.length&&t.setState({isExtendingSidebar:e})},t.changeIsShowNote=function(e){0!==t.state.noteList.length&&t.setState({isShownNote:e})},t.resetCurrentSlideAnimation=function(){t.slideRef&&t.slideRef.resetCurrentSlideAnimation()},t.resetCurrentPPTAnimation=function(){t.slideRef&&t.slideRef.resetCurrentPPTAnimation()},t.state={slide:void 0,slideIndex:0,globalPPTState:void 0,isExtendingSidebar:!1,isShownNote:!1,noteList:[],isLoading:!0},t.isGotNodeList=!1,e.conversionResponse.status===VS.finished&&(t.uuid=e.conversionResponse.uuid,e.conversionResponse.progress.convertedFileList.forEach((function(e){t.PPTSliderList.push(Ny(Ry({},e),{conversionFileUrl:e.conversionFileUrl.replace(/\d.slide/g,"")})),e.preview&&t.previewList.push(e.preview)})),t.total=t.PPTSliderList.length),t}return P(a,[{key:"UNSAFE_componentWillMount",value:(r=u(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.slideIndex,n=this.props,r=n.preloadProgress,i=n.userFonts,a=n.logger,o=this.PPTSliderList[t],e.next=3,BS(o.conversionFileUrl,this.uuid,!0,r,i,a,{scheme:"https",useServerWrap:!0});case 3:return this.ppt=e.sent,e.next=6,this.ppt.loadSlide(t);case 6:return s=e.sent,e.next=9,this.getNoteList();case 9:this.setState({slide:s,isLoading:!1});case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.props.emitter.removeAllListeners()}},{key:"getNoteList",value:(n=u(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.slideIndex,n=this.PPTSliderList[t],e.prev=1,e.next=4,sk("".concat(n.conversionFileUrl.replace("pptx","https"),"notes/note").concat(t+1,".json"));case 4:r=e.sent,this.setState({noteList:r}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.setState({noteList:[]});case 11:this.isGotNodeList=!0;case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return n.apply(this,arguments)})},{key:"changePageTo",value:(t=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<0||t>=this.total)){e.next=2;break}return e.abrupt("return");case 2:if(!this.state.isLoading){e.next=5;break}return e.abrupt("return");case 5:return this.setState({isLoading:!0}),e.next=8,this.ppt.loadSlide(t);case 8:return n=e.sent,this.setState({slide:n,slideIndex:t,isLoading:!1,isShownNote:!1}),e.next=12,this.getNoteList();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"changeStep",value:function(e){this.state.isLoading||this.slideRef.changeStep(e)}},{key:"emitData",value:function(){var e=this;clearTimeout(this.emitSetTimeout),this.emitSetTimeout=setTimeout((function(){if(e.isGotNodeList){var t=e.total,n=e.state,r=n.slideIndex,i=n.isExtendingSidebar,a=n.isShownNote,o=n.noteList,s=e.props.emitter,c=!e.previewList.length,u=!o.length;s.emit("update",{index:r+1,total:t,disableNote:u,disableSidebar:c,isShowNote:a,isExtendSidebar:i})}}),500)}},{key:"render",value:function(){var e=this,t=this.total,n=this.PPTSliderList,r=this.state,i=r.globalPPTState,a=r.slide,o=r.slideIndex,s=r.isExtendingSidebar,c=r.isShownNote,u=r.noteList,l=r.isLoading,h=this.props,d=h.parentElement,p=h.config,f=h.emitter,v=!this.previewList.length,m=!u.length,g=n[0].width;this.emitData();var y=n[0].height+40,b={width:"".concat(g,"px"),height:"".concat(y,"px"),transform:""},k=Math.min(d.offsetWidth/g,d.offsetHeight/y);return d.style.width&&(b.transform="scale(".concat(k,", ").concat(k,")")),by.default.createElement("div",{style:b,className:"ppt-preview-container"},by.default.createElement(GS,{international:p&&p.international,isShowNote:c,emitter:f,disableNote:m,disableSidebar:v,isExtendSidebar:s,changeStep:function(t){e.changeStep(t)},changeIsShowNote:this.changeIsShowNote,changeIsExtendSidebar:this.changeIsExtendSidebar,total:t,resetCurrentSlideAnimation:this.resetCurrentSlideAnimation,resetCurrentPPTAnimation:this.resetCurrentPPTAnimation,changeToPage:this.clickControllerHandler,slideIndex:o}),by.default.createElement("div",{style:{position:"relative",display:"inline-block",overflow:"hidden",width:"100%",fontSize:"0"},className:"ppt-preview-main-container"},by.default.createElement("div",{style:{display:"inline-block"},className:"ppt-preview-slide-container"},!l&&a&&by.default.createElement(xw,{ref:function(t){e.slideRef=t},stateAdapter:this.stateAdapter,pptState:i,data:a,renderMode:gw.Normal}),l&&by.default.createElement("div",{style:b})),this.previewList.length>0&&by.default.createElement(XS,{isExtend:s,previewList:this.previewList,changeToPage:this.clickSidebarHandler}),u.length>0&&by.default.createElement(YS,{isShow:c,noteList:u})))}}]),a}(by.default.Component);function KS(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center";var c=null!=s?s:new wy.default;return ky.default.render(by.default.createElement(QS,{conversionResponse:e,parentElement:t,preload:r,userFonts:i,logger:a,config:n,pptPrams:o,emitter:c}),t),c}var qS=Y(n(67294)),ZS=Y(n(84564)),JS=Y(n(54911)),$S=Object.defineProperty,ex=Object.getOwnPropertySymbols,tx=Object.prototype.hasOwnProperty,nx=Object.prototype.propertyIsEnumerable,rx=function(e,t,n){return t in e?$S(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var ix=function(){function e(){var t=this;C(this,e),this.libraryMap={},this.paddingMap={},this.freeInterrupters={},this.defineLibrary=function(e,n){if(e.libName in t.libraryMap)throw new Error("found duplicated library ".concat(JSON.stringify(e.libName)));n&&(t.freeInterrupters[e.libName]=n),t.libraryMap[e.libName]=Object.freeze(function(e,t){for(var n in t||(t={}))tx.call(t,n)&&rx(e,n,t[n]);if(ex){var r,i=T(ex(t));try{for(i.s();!(r=i.n()).done;)n=r.value,nx.call(t,n)&&rx(e,n,t[n])}catch(e){i.e(e)}finally{i.f()}}return e}({},e))},this.requireModules=function(e){return new Promise((function(n,r){var i=t.paddingMap[e];i||(i=t.paddingMap[e]=[]),i.push({resolve:n,reject:r})}))},this.loader=function(e,n,r){if(!n&&!r){var i=e;return t.createRequireFunction(i)}var a=e;t.handlePanddingNodes(a,n,r)};var n="__netlessJavaScriptLoader",r=window;if(void 0!==r[n])throw new Error("window.".concat(n," was override"));Object.defineProperty(r,n,{enumerable:!1,configurable:!1,writable:!1,value:this.loader})}return P(e,[{key:"handlePanddingNodes",value:function(e,t,n){var r=this.paddingMap[e];if(r){delete this.paddingMap[e];var i,a=T(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(n)o.reject(n);else try{o.resolve(this.handleModules(t))}catch(c){o.reject(c)}}}catch(e){a.e(e)}finally{a.f()}}else if(!n&&t){var s=function(e){var t=e.split("/");return t.pop(),t.join("/")}(e),c=this.freeInterrupters[s];c&&c(e,t)}else console.warn("find invalid async module ".concat(JSON.stringify(e)))}},{key:"createRequireFunction",value:function(e){var t=this.libraryMap[e];if(!t)throw new Error("undefined library ".concat(JSON.stringify(e)));return function(n){var r=t.dependencies,i=r&&r[n];if(!i)throw new Error("cannot find module ".concat(JSON.stringify(n)," of library ").concat(JSON.stringify(e)));return i}}},{key:"handleModules",value:function(e){for(var t in e){var n=e[t];"__esModule"in n||Object.defineProperty(n,"__esModule",{value:!0})}return Object.freeze(e)}}]),e}(),ax=new ix,ox=ax.requireModules,sx=ax.defineLibrary;function cx(e,t){for(var n=window.atob(e),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return new Blob([r],t)}function ux(e){return new Promise((function(t,n){try{var r=new FileReader;r.onload=function(e){var r,i=null==(r=e.target)?void 0:r.result;"string"==typeof i?t(i):n(new Error("blob load wrong type "+M(i)))},r.readAsDataURL(e)}catch(e){n(e)}}))}var lx="modules";function hx(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var t=new Error(e.error.message);t.name=e.error.name,n(t)}else n(new Error("failed with null Error"))}}))}var dx=function(){function e(t,n,r){C(this,e);var i=new URL(n),a=i.protocol,o=i.host,s=new mn({fetcher:window.fetch.bind(window),retryCount:e.retryCount,retryLoopsCount:0,configmap:{module:{useSSL:"https:"===a,hosts:{"*":o}}}});this.fetcher=s.fetch("module"),this.storeBase64=t,this.findPath=r}var t,n,r,i;return P(e,[{key:"findObjectURL",value:(i=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readBlob(t);case 2:if(n=e.sent,e.t0=n,e.t0){e.next=10;break}return e.next=7,this.fetchBuffer(t);case 7:return n=e.sent,e.next=10,this.writeBlob(t,n);case 10:return e.abrupt("return",URL.createObjectURL(n,{oneTimeOnly:!0}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"readBlob",value:(r=u(regeneratorRuntime.mark((function t(n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return r=t.sent.transaction([lx],"readonly").objectStore(lx).get(n),t.next=5,hx(r);case 5:return"string"==typeof(i=t.sent)&&(a=i.split(/;base64,/im),o=l(a,2),s=o[0],c=o[1],u=s.replace(/^data:/im,""),i=cx(c,{type:u})),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"writeBlob",value:(n=u(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r,t.t0=this.storeBase64,!t.t0){t.next=6;break}return t.next=5,ux(i);case 5:i=t.sent;case 6:return t.next=8,e.dbp;case 8:return a=t.sent.transaction([lx],"readwrite").objectStore(lx).put(i,n),t.next=11,hx(a);case 11:case"end":return t.stop()}}),t,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchBuffer",value:(t=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="http://module"+this.findPath(t),e.next=3,this.fetcher(n,{method:"get",headers:{Accept:"application/javascript"}});case 3:if(200===(r=e.sent).status){e.next=6;break}throw new Error("failed to fetch ".concat(JSON.stringify(n)," with status ").concat(r.status));case 6:return e.next=8,r.blob();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"dbp",get:function(){if(!this._dbp){var e=indexedDB.open("__netlessJavaScriptCache",1);e.onupgradeneeded=function(e){e.target.result.createObjectStore(lx)},this._dbp=hx(e)}return this._dbp}}]),e}(),px=dx;px.retryCount=5;var fx=function(){function e(t){C(this,e),this.params=t,this.completeCallbacks=[]}var t,n;return P(e,[{key:"load",value:(n=u(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],void 0!==this.params.timeout&&t.push(this.startTimeout(this.params.timeout)),t.push(this.loadScript()),e.prev=2,e.next=5,Promise.race(t);case 5:e.prev=5,n=T(this.completeCallbacks);try{for(n.s();!(r=n.n()).done;)(0,r.value)()}catch(e){n.e(e)}finally{n.f()}return e.finish(5);case 9:case"end":return e.stop()}}),e,this,[[2,,5,9]])}))),function(){return n.apply(this,arguments)})},{key:"loadScript",value:(t=u(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.params,n=t.origin,r=t.findPath,i=t.identifier,!(a=t.storage)){e.next=13;break}return e.prev=2,e.next=5,a.findObjectURL(i);case 5:o=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.warn("read from storage failed: ".concat(e.t0.message)),o="".concat(n).concat(r(i));case 11:e.next=14;break;case 13:o="".concat(n).concat(r(i));case 14:return e.next=16,this.loadScriptWithURL(o);case 16:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return t.apply(this,arguments)})},{key:"loadScriptWithURL",value:function(e){var t=this;return new Promise((function(n,r){var i=document.createElement("script");t.completeCallbacks.push((function(){i.onerror=null,i.onload=null,i.remove()})),i.charset="utf-8",i.src=e,i.onload=function(){n()},i.onerror=function(t){var n=t&&("load"===t.type?"missing":t.type);r(new Error("fetch ".concat(JSON.stringify(e)," failed: ").concat(n)))},document.head.appendChild(i)}))}},{key:"startTimeout",value:function(e){var t=this,n=null;return this.completeCallbacks.push((function(){null!==n&&(clearTimeout(n),n=null)})),new Promise((function(r,i){n=setTimeout((function(){n=null,i(new Error("fetch ".concat(t.params.identifier," timeout")))}),e)}))}}]),e}();var vx,mx,gx=function(){function e(t){var n=this;C(this,e),this.modulesMap={},this.taskPromises={},this.onInterruptFreeModules=function(e,t){n.modulesMap[e]||(n.modulesMap[e]=t)};var r={libName:t.libName,dependencies:t.dependencies};sx(r,this.onInterruptFreeModules),this.origin=t.origin,this.findPath=t.findPath,this.timeout=t.timeout,this.storage=t.cache?new px(!!t.storeBase64,t.origin,t.findPath):void 0}var t;return P(e,[{key:"require",value:(t=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.modulesMap[t]){e.next=7;break}return void 0===(i=this.taskPromises[t])&&(i=this.taskPromises[t]=u(regeneratorRuntime.mark((function e(){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={identifier:t,origin:o.origin,findPath:o.findPath,timeout:o.timeout,storage:o.storage},e.next=4,Promise.all([ox(t),new fx(n).load()]);case 4:return r=e.sent,i=l(r,1),a=i[0],e.abrupt("return",a);case 8:return e.prev=8,delete o.taskPromises[t],e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()),e.next=6,i;case 6:r=this.modulesMap[t]=e.sent;case 7:if(a=r[n]){e.next=10;break}throw new Error("can't find module ".concat(JSON.stringify(n)," from ").concat(t));case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),yx=function e(t){if("object"!=M(t)||null===t)return t;if(t.constructor===Object){var n={};for(var r in t)n[r]=e(t[r]);return Object.freeze(n)}if(Array.isArray(t)){for(var i=[],a=0;a<t.length;++a)i[a]=e(t[a]);return Object.freeze(i)}return t}(Q);(mx=vx||(vx={})).DisableCache="disableCache",mx.StoreAsBlob="storeAsBlob",mx.StoreAsBase64="storeAsBase64";var bx=vx.StoreAsBase64,kx=null;function wx(e){if(void 0===bx)throw new Error("cannot set async module load mode after joined or replay any room");bx=e}function Sx(e){return xx.apply(this,arguments)}function xx(){return xx=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kx||(kx=Cx(bx),bx=void 0),e.next=3,Promise.all([kx.require(t,"white-model"),kx.require(t,"white-render")]);case 3:return n=e.sent,e.abrupt("return",Object.freeze({WhiteModel:n[0],WhiteRender:n[1]}));case 5:case"end":return e.stop()}}),e)}))),xx.apply(this,arguments)}function Cx(e){var t,n;switch(e){case vx.DisableCache:t=!1,n=!1;break;case vx.StoreAsBlob:t=!0,n=!1;break;case vx.StoreAsBase64:t=!0,n=!0}return function(e){return new gx(e)}({libName:yx.modules.identifier,timeout:12e4,cache:t,storeBase64:n,origin:yx.modules.origin,findPath:function(e){return"/dynamic-libraries/".concat(e,".js")},dependencies:{akko:K,boundless:tu,mobx:Pp,"mobx-react":Mp,react:qS.default,"netless-ppt":av,"url-parse":ZS.default,"textarea-caret-ts":JS.default}})}!function(e){var t=document.createElement("style"),n=document.createTextNode(e);t.appendChild(n),document.head.appendChild(t)}(".netless-whiteboard div.highlight-box{border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>*.cursor-nwse{cursor:nwse-resize}.netless-whiteboard div.editor-box>*.cursor-nesw{cursor:nesw-resize}.netless-whiteboard div.editor-box>*.cursor-ns{cursor:ns-resize}.netless-whiteboard div.editor-box>*.cursor-ew{cursor:ew-resize}.netless-whiteboard div.editor-box>*.cursor-move{cursor:move}.netless-whiteboard.cursor-move{cursor:move}.netless-whiteboard div.editor-box{pointer-events:none;border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>.lock{pointer-events:none;position:absolute;width:22px;height:22px;top:-11px;left:-11px}.netless-whiteboard div.editor-box>div.operation-point-desktop{width:7px;height:7px;position:absolute;pointer-events:auto}.netless-whiteboard div.editor-box>div.operation-point-touch{width:33px;height:33px;background-color:#fff0;position:absolute;pointer-events:auto;display:flex;align-items:center;justify-content:center}.netless-whiteboard div.editor-box>div.operation-point-touch>*{pointer-events:none;width:7px;height:7px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-top{left:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-top{right:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-bottom{left:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-bottom{right:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.top{top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right{right:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.bottom{bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left{left:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.rotation{cursor:move;display:flex;align-items:center;justify-content:center;width:16px;height:16px;left:-32px;bottom:-32px;border-radius:8px}.netless-whiteboard div.editor-box>.operation-point-desktop.rotation>img{pointer-events:none;width:10;height:10px}.netless-whiteboard div.editor-box>.operation-point-touch.left-top{left:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-top{right:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left-bottom{left:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-bottom{right:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.top{top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right{right:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.bottom{bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left{left:-17px}.netless-whiteboard div.editor-box-others{border:1px solid}.netless-whiteboard textarea{-webkit-appearance:none;-webkit-user-select:text;-moz-user-select:text;user-select:text;padding:0;margin:0;outline:none;border:none;resize:none;overflow:hidden}.netless-whiteboard .textarea-border{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed}.netless-whiteboard .textarea-border>*{position:absolute;pointer-events:auto}.netless-whiteboard .textarea-layout{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed;border-style:solid;border-color:#0000}.netless-whiteboard .textarea-layout>*{position:absolute;pointer-events:auto}.netless-whiteboard textarea.readonly-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.editable-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.my-textarea{pointer-events:auto}.netless-whiteboard div.float-bar{display:flex;flex-direction:row;align-items:center;background:#ffffff;border:1px solid #EFEFEF;box-shadow:0 6px 12px #0000001f;border-radius:4px;color-scheme:light;pointer-events:auto}.netless-whiteboard div.float-bar div,.netless-whiteboard div.float-bar input{pointer-events:auto}.netless-whiteboard div.float-bar img{pointer-events:none}.netless-whiteboard div.float-bar .button{display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar .button:hover{background:#EEF0F6}.netless-whiteboard div.float-bar .button.disable{opacity:.5;cursor:not-allowed;background:transparent}.netless-whiteboard div.float-bar>.decorator{height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar>.normal-button{width:40px;height:40px}.netless-whiteboard div.float-bar>.highlight-button{background:#EEF0F6}.netless-whiteboard div.float-bar img.font-size-icon{width:16px;height:16px;margin-left:12px}.netless-whiteboard div.float-bar>input.font-size-input::-webkit-outer-spin-button,.netless-whiteboard div.float-bar>input.font-size-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.netless-whiteboard div.float-bar>input.middle:focus,.netless-whiteboard div.float-bar>input:focus{outline-width:0}.netless-whiteboard div.float-bar>input.font-size-input{-moz-appearance:textfield;width:29px;height:20px;margin-left:10px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#212324;line-height:14px;border-radius:2px;border:1px solid #e7e7e7;text-align:center}.netless-whiteboard div.float-bar div.font-size-buttons{display:flex;flex-direction:column;flex-wrap:none;justify-content:space-between;align-items:stretch;margin-left:5px;margin-right:7px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button{display:flex;flex-direction:column;flex-wrap:none;align-items:center;width:16px;height:18px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button>img{width:6px;height:3px}.netless-whiteboard div.float-bar div.font-size-buttons>div.up{justify-content:flex-end;padding-bottom:2px}.netless-whiteboard div.float-bar div.font-size-buttons>div.down{justify-content:flex-start;padding-top:2px}.netless-whiteboard div.float-bar div.font-size-menu{position:absolute;display:flex;flex-direction:column;justify-content:center;align-items:stretch;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-size-menu>div.hover{background:#e7e7e7}.netless-whiteboard div.float-bar div.font-size-menu>div.cell{display:flex;flex-direction:row;justify-content:center;align-items:center;width:64px;height:24px}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>span{padding-left:4px;padding-right:4px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#000}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>.check{width:8px;height:8px}.netless-whiteboard div.float-bar div.font-colors-icon{position:relative;width:16px;height:16px}.netless-whiteboard div.float-bar div.font-colors-icon>img{position:absolute;top:0;left:0;width:16px;height:16px;z-index:1}.netless-whiteboard div.float-bar div.font-colors-icon>div.bar{position:absolute;left:2px;right:2px;top:12.5px;height:1.5px;z-index:2}.netless-whiteboard div.float-bar div.font-colors-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:8px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-selected{border-color:#a7a7a7}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-not-selected{border-color:#fff}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button{display:flex;justify-content:center;align-items:center;cursor:pointer;margin:4px;width:20px;height:20px;border-radius:50%;border-width:1px;border-style:solid}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button>.core{width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,.12)}.netless-whiteboard div.float-bar div.image-layer-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:4px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.image-layer-menu>.normal-button{width:32px;height:32px}.netless-whiteboard div.rotation-indicator{pointer-events:auto;display:flex;align-items:center;justify-content:center;border-radius:5px;color:#fff;background-color:#000;opacity:.75;font-size:12px;width:32px;height:20px}.netless-whiteboard *{-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.cursor-selector .ppt-event-source{cursor:pointer;pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.cursor-clicker .ppt-event-source{pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.netless-whiteboard{text-align:start}.netless-whiteboard *{box-sizing:border-box}.netless-whiteboard *>svg{text-align:start}.netless-ppt-last-run:after{content:attr(data-last-word);margin-left:var(--data-last-word-indent);display:inline-block;width:0}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar{width:12px;height:6px}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-track{border-radius:3px;background:rgba(0,0,0,.06);-webkit-box-shadow:inset 0 0 5px rgba(0,0,0,.08);box-shadow:inset 0 0 5px #00000014}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-thumb{border-radius:3px;background:rgba(0,0,0,.12);-webkit-box-shadow:inset 0 0 10px rgba(0,0,0,.2);box-shadow:inset 0 0 10px #0003}.ppt-preview-main-container{border:1px solid #222}.ppt-preview-show-note-svg{width:40px;height:40px}.ppt-preview-show-sidebar-svg{width:40px;height:40px}.ppt-preview-controls{height:40px;width:100%}.ppt-preview-controls-button{margin:0 2px}.ppt-preview-sidebar{border-left:1px solid #ccc;background-color:#eee}.ppt-preview-sidebar-item{margin:14px 14px 16px}.ppt-preview-sidebar-span{font-size:10pt;text-align:center}.ppt-preview-note{background-color:#eee}.ppt-preview-animation-svg{width:20px;height:20px}.ppt-preview-controls-page{float:right;line-height:16px;font-size:16px;padding:0;margin:0}\n");var Ix=Y(n(68949)),Px=Y(n(43295)),Mx=Y(n(67294)),Tx=Y(n(68949)),Ax=Y(n(68949)),Ex=function(){function e(t){C(this,e),this.onChanged=null,this.atoms=[],this.observers={},this.id=t}return P(e,[{key:"addObservedAtom",value:function(e,t){this.observers&&this.atoms&&(this.observers[e.identifier]=e,this.atoms.push(t))}},{key:"takeObservers",value:function(){var e=this.observers;return this.observers=null,e}},{key:"replay",value:function(){if(this.atoms){var e,t=T(this.atoms);try{for(t.s();!(e=t.n()).done;){e.value.reportObserved()}}catch(e){t.e(e)}finally{t.f()}}}},{key:"reportChanged",value:function(){if(this.atoms){var e=this.onChanged;this.atoms=null,this.observers=null,this.onChanged=null,null==e||e()}}}],[{key:"collectObservations",value:function(t,n){var r=new e("".concat(e.nextId));e.nextId+=1,e.hub=r;try{return t()}finally{e.hub=null;try{n(r)}catch(e){console.error(e)}}}},{key:"observedHub",value:function(){return e.hub}}]),e}(),Ox=Ex;Ox.nextId=0;var Rx,Nx,Lx=function(){function e(t,n){C(this,e),this.atoms={},this.keysHubs={},this.iterationAtom=null,this.iterationHubs=null,this.identifier=t,this.debugName=n}return P(e,[{key:"releaseHubs",value:function(){for(var e in this.keysHubs)delete this.keysHubs[e];this.iterationHubs=null}},{key:"reportChanged",value:function(e,t,n){this.reportAtomChanged(e,n),this.disposeHubs(e)}},{key:"reportAtomChanged",value:function(e,t){var n=this.atoms[e];if(n&&n.reportChanged(),this.iterationAtom)switch(t){case bi.Removed:case bi.Inserted:this.iterationAtom.reportChanged()}n&&t===bi.Removed&&delete this.atoms[e]}},{key:"disposeHubs",value:function(e){for(var t in this.iterationHubs)this.iterationHubs[t].reportChanged();this.iterationHubs=null;var n=this.keysHubs[e];if(n){for(var r in n)n[r].reportChanged();delete this.keysHubs[e]}}},{key:"reportObservedIteration",value:function(){var e=this.iterationAtom;e||(e=this.iterationAtom=(0,Ax.createAtom)(this.debugName)),e.reportObserved();var t=Ox.observedHub();if(t){var n=this.iterationHubs;n||(n=this.iterationHubs={}),n[t.id]||(n[t.id]=t,t.addObservedAtom(this,e))}}},{key:"reportObservedKey",value:function(e){var t=this.atoms[e];t||(t=this.atoms[e]=(0,Ax.createAtom)(this.debugName)),t.reportObserved();var n=Ox.observedHub();if(n){var r=this.keysHubs[e];r||(r=this.keysHubs[e]={}),r[n.id]||(r[n.id]=n,n.addObservedAtom(this,t))}}}]),e}(),jx=function(){function e(){C(this,e),this.observers={}}return P(e,[{key:"addObserverHub",value:function(e){var t=e.takeObservers();for(var n in t)this.observers[n]=t[n]}},{key:"clean",value:function(){for(var e in this.observers)this.observers[e].releaseHubs()}}]),e}(),Dx=function(){function e(){C(this,e)}return P(e,[{key:"observeUpdate",value:function(e){(0,Tx.runInAction)(e)}},{key:"create",value:function(e,t){return new Lx(e,t)}},{key:"createObserverCollection",value:function(){return new jx}},{key:"collectObservations",value:function(e,t){return Ox.collectObservations(e,t)}}]),e}(),Fx=function(){function e(){C(this,e),this.listenerNodes=[]}return P(e,[{key:"isOnline",get:function(){return navigator.onLine}},{key:"addListener",value:function(e){var t={origin:e,onOffline:function(){return e.onOffline()},onOnline:function(){return e.onOnline()}};this.listenerNodes.push(t),window.addEventListener("online",t.onOnline),window.addEventListener("offline",t.onOffline)}},{key:"removeListener",value:function(e){var t=this.listenerNodes.findIndex((function(t){return t.origin===e}));if(-1!==t){var n=l(this.listenerNodes.splice(t,1),1)[0];window.removeEventListener("online",n.onOnline),window.removeEventListener("offline",n.onOffline)}}}]),e}(),zx=Y(n(17563)),Bx=new mn({fetcher:window.fetch.bind(window),retryCount:2,retryLoopsCount:0,configmap:{api:{hosts:{"*":yx.shuntApiHosts}},"ppt-api":{hosts:{"*":yx.hosts.pptApi}}}}),Ux=function(){function e(){C(this,e),this.map={}}return P(e,[{key:"values",value:function(e){return this.map[e]}},{key:"has",value:function(e,t){var n=this.map[e];return!!n&&-1!==n.indexOf(t)}},{key:"put",value:function(e,t){var n=this.map[e];n||(n=this.map[e]=[]),-1===n.indexOf(t)&&n.push(t)}},{key:"remove",value:function(e,t){if(e)if(t){var n=this.map[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.map[e])}}else delete this.map[e];else for(var i in this.map)delete this.map[i]}}]),e}(),Vx=function(){function e(t){if(C(this,e),this.listeners=new Ux,this.oncesListeners=new Ux,t)for(var n in t){var r=t[n];r&&this.listeners.put(n,r)}}return P(e,[{key:"dispatch",value:function(e,t){var n=0;return n+=this.dispatchTo(e,this.listeners,t),n+=this.dispatchTo(e,this.oncesListeners,t),this.oncesListeners.remove(e),n}},{key:"dispatchTo",value:function(e,t,n){var r=t.values(e);if(r){var i,a=T(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;try{n(o)}catch(e){console.error(e)}}}catch(e){a.e(e)}finally{a.f()}return r.length}return 0}},{key:"on",value:function(e,t){this.listeners.put(e,t)}},{key:"once",value:function(e,t){this.oncesListeners.put(e,t)}},{key:"off",value:function(e,t){this.listeners.remove(e,t),this.oncesListeners.remove(e,t)}},{key:"forwardTo",value:function(e,t){var n=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.dispatch(e,(function(e){return e.apply(void 0,r)}))};return this.on(e,n),n}}]),e}();function Wx(e){return function(t,n){var r=t.key,i=t.altKey,a=t.ctrlKey,o=t.shiftKey,s=t.nativeEvent;switch(n){case Rx.Mac:return!(r!==e||a||i||o||!(null==s?void 0:s.metaKey));case Rx.Windows:return r===e&&a&&!i&&!o&&"KeyDown"===t.kind;default:return!1}}}(Nx=Rx||(Rx={})).Mac="mac",Nx.Windows="windows";var Hx=Object.freeze({delete:Object.freeze(["Backspace","Delete"]),undo:Wx("z"),redo:Wx("y"),copy:Wx("c"),paste:Wx("v"),lockCenter:function(e,t){var n=e.key,r=e.ctrlKey;switch(t){case Rx.Mac:return"Meta"===n&&!r;case Rx.Windows:return"Control"===n;default:return!1}},pencilPaintCircular:function(e){return"Alt"===e.key},lock:Object.freeze({key:"Shift",altKey:!1,ctrlKey:null,shiftKey:null})}),_x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Hx;C(this,e);var n=[];for(var r in t){var i=t[r];i&&n.push(Object.freeze({kind:r,checker:this.toHotKeyChecker(i)}))}this.nodes=Object.freeze(n)}return P(e,[{key:"checkHotKey",value:function(e){var t,n=this.getKeyboardKind(),r=T(this.nodes);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.checker(e,n))return i.kind}}catch(e){r.e(e)}finally{r.f()}}},{key:"getKeyboardKind",value:function(){return/^Mac/i.test(navigator.platform)?Rx.Mac:Rx.Windows}},{key:"toHotKeyChecker",value:function(e){var t=e;if("function"!=typeof t&&(t instanceof Array||(t=[t]),t instanceof Array)){var n=Object.freeze(t.map((function(e){var t=e;return"string"==typeof t&&(t={key:t,altKey:!1,ctrlKey:!1,shiftKey:!1}),Object.freeze(W({},t))})));t=function(e,t){var r;if(t===Rx.Windows&&"KeyDown"!==e.kind)return!1;var i,a=e.key,o=e.altKey,s=e.shiftKey,c=e.ctrlKey||!!(null==(r=e.nativeEvent)?void 0:r.metaKey),u=T(n);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(!(l.key!==a||null!==l.altKey&&l.altKey!==o||null!==l.ctrlKey&&l.ctrlKey!==c||null!==l.shiftKey&&l.shiftKey!==s))return!0}}catch(e){u.e(e)}finally{u.f()}return!1}}return t}}]),e}(),Gx=Y(n(68949)),Yx=function(){function e(){C(this,e)}return P(e,[{key:"parse",value:function(e){var t=e.split("/");if(""!==t[0])throw new Error("path ".concat(JSON.stringify(e),' should start with "/"'));""===t[t.length-1]&&t.pop();for(var n=[],r=1;r<t.length;++r)n.push(t[r].trim());return n}},{key:"stringify",value:function(e){return"/".concat(e.join("/"))}}]),e}(),Xx=new Yx,Qx=function(){function e(t){C(this,e),this.hub={},this.constr=Object.freeze(W({},t))}return P(e,[{key:"refresh",value:function(e){this.constr=Object.freeze(W({},e));var t=this.constr,n=t.applianceManager,r=t.sceneNodeClass;for(var i in this.hub){var a=Xx.parse(i),o=this.hub[i],s=n.scenes.findSceneOrGroup(a);!s||ms(s,r)?o.zombie():o.setGroup(s)}}},{key:"create",value:function(e,t){var n=this,r=this.constr,i=r.applianceManager,a=r.sceneNodeClass,o=Xx.parse(e),s=i.scenes.findSceneOrGroup(o),c=null;if(s){var u,l;if(ms(s,a)?(o.pop(),u=Xx.stringify(o),l=i.scenes.findSceneOrGroup(o)):(u=e,l=s),u in this.hub)throw new Error("did create scenes callbacks of path ".concat(JSON.stringify(u),". you should call dispose() before create another one"));c=this.hub[u]=new Kx(u,l,(function(){return delete n.hub[u]}),t)}return c}}]),e}(),Kx=function(e){g(n,e);var t=b(n);function n(e,r,i,a){var o;return C(this,n),(o=t.call(this,a))._scenesCount=0,o._sceneGroupsCount=0,o.state=null,o.didZombie=!1,o.didDispose=!1,o.onGroupsUpdate=function(e){var t,n=T(e);try{var r=function(){var e=t.value;switch(e.kind){case bi.Inserted:o.dispatch("onAddSceneGroup",(function(t){return t(w(o),e.key)}));break;case bi.Removed:o.dispatch("onRemoveSceneGroup",(function(t){return t(w(o),e.key)}))}};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}},o.onScenesUpdate=function(e){var t,n=T(e);try{var r=function(){var e=t.value;switch(e.kind){case bi.Inserted:o.dispatch("onAddScene",(function(t){return t(w(o),e.key)}));break;case bi.Removed:o.dispatch("onRemoveScene",(function(t){return t(w(o),e.key)}))}};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}},o.path=e,o.setGroup(r),o.onDispose=i,o}return P(n,[{key:"scenes",get:function(){var e=[];if(this.state){var t,n=T(this.state.group.scenesList);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.push(r.name)}}catch(e){n.e(e)}finally{n.f()}}return e}},{key:"scenesCount",get:function(){return this._scenesCount}},{key:"sceneGroups",get:function(){var e=[];if(this.state){var t,n=T(this.state.group.groupsList);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.push(r.name)}}catch(e){n.e(e)}finally{n.f()}}return e}},{key:"sceneGroupsCount",get:function(){return this._sceneGroupsCount}},{key:"setGroup",value:function(e){var t=this;if(!this.didZombie){this.state&&this.cleanState(this.state);var n=e.groupsMap,r=e.groupsList,i=e.scenesMap,a=e.scenesList;Mo(n,this.onGroupsUpdate),Mo(i,this.onScenesUpdate),this._sceneGroupsCount=r.length,this._scenesCount=a.length;var o=[(0,Gx.reaction)((function(){return r.length}),(function(e){t._sceneGroupsCount=e,t.dispatch("onScenesGroupCountUpdate",(function(n){return n(t,e)}))})),(0,Gx.reaction)((function(){return a.length}),(function(e){t._scenesCount=e,t.dispatch("onScenesCountUpdate",(function(n){return n(t,e)}))}))];this.state={group:e,disposers:o}}}},{key:"zombie",value:function(){this.didZombie||(this.didZombie=!0,this.state&&(this.cleanState(this.state),this.state=null))}},{key:"cleanState",value:function(e){var t,n=e.group,r=T(e.disposers);try{for(r.s();!(t=r.n()).done;){(0,t.value)()}}catch(e){r.e(e)}finally{r.f()}To(n.groupsMap,this.onGroupsUpdate),To(n.scenesMap,this.onScenesUpdate),this._scenesCount=0,this._sceneGroupsCount=0}},{key:"dispose",value:function(){this.didDispose||(this.didDispose=!0,this.zombie(),this.onDispose())}}]),n}(Vx),qx=Y(n(68949)),Zx=Y(n(68949));function Jx(e){var t=M(e);return"object"!==t||null===e?"function"===t?void 0:e:mo(e)?bs(e):e instanceof Array?function(e){for(var t=[],n=e.length,r=0;r<n;++r)t[r]=Jx(e[r]);return t}(e):(0,Zx.isObservable)(e)?function(e){var t,n={},r=T((0,Zx.keys)(e));try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i]=Jx(e[i])}}catch(e){r.e(e)}finally{r.f()}return n}(e):function(e){var t={};for(var n in e)t[n]=Jx(e[n]);return t}(e)}var $x=Y(n(68949));function eC(e,t){return(0,$x.isObservable)(e)?(0,$x.has)(e,t):t in e}function tC(e){return(0,$x.isObservable)(e)?(0,$x.keys)(e):Object.keys(e)}function nC(e,t){if(M(e)!=M(t))return!1;if("object"!=M(e)||null===e)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){var n,r=T(tC(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!eC(t,i))return!1;if(!nC(e[i],t[i]))return!1}}catch(e){r.e(e)}finally{r.f()}var a,o=T(tC(t));try{for(o.s();!(a=o.n()).done;){if(!eC(e,a.value))return!1}}catch(e){o.e(e)}finally{o.f()}return!0}if(e.constructor===Array){var s=e,c=t;if(s.length===c.length){for(var u=0;u<s.length;++u)if(!nC(s[u],c[u]))return!1;return!0}return!1}if("object"==M(e)){for(var l in e){if(!(l in t))return!1;if(!nC(e[l],t[l]))return!1}for(var h in t)if(!(h in e))return!1;return!0}return!0}var rC=function(){function e(t){var n=this,r=t.disableMaskKey,i=t.useMobXMode,a=t.propertyGetters,o=t.onStateChanged;C(this,e),this.didStateReady=!1,this.updatedState={},this.activeUpdateKey=null,this.updateState=function(){var e=n.updatedState;n._state=n.patchState(e),n.updatedState={},n.onStateChanged&&n.onStateChanged(e)},this.disableActiveCallback=r,this.useMobXMode=i,this.updateLimiter=new Ue(0,this.updateState),this.onStateChanged=o,this.disposers=this.createAutoRun(a),(0,qx.makeObservable)(this,{activeUpdate:qx.action,patchState:qx.action})}return P(e,[{key:"state",get:function(){return this._state}},{key:"release",value:function(){var e,t=T(this.disposers);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}}},{key:"activeUpdate",value:function(e,t){try{this.activeUpdateKey=e;var n=t();return this._state=this.setState(e,n),this.onStateChanged&&!this.disableActiveCallback&&this.onStateChanged(a({},e,n)),n}finally{this.activeUpdateKey=null}}},{key:"createAutoRun",value:function(e){var t=this,n=[],r={fireImmediately:!0},i=function(i){var a=e[i];n.push((0,qx.reaction)((function(){return a()}),(function(e){if(t.didStateReady){var n=i in t.updatedState?t.updatedState[i]:t._state[i];t.activeUpdateKey!==i&&!nC(e,n)&&(t.updatedState[i]=e,t.updateLimiter.invoke())}else t.updatedState[i]=e}),r))};for(var a in e)i(a);return this._state=this.createState(this.updatedState),this.updatedState={},this.didStateReady=!0,n}},{key:"createState",value:function(e){return this.useMobXMode?(0,qx.observable)(e):Object.freeze(Jx(e))}},{key:"patchState",value:function(e){if(this.useMobXMode){for(var t in e)this._state[t]=e[t];return this._state}var n=W({},this._state);for(var r in e)n[r]=Jx(e[r]);return Object.freeze(n)}},{key:"setState",value:function(e,t){return this.useMobXMode?(this._state[e]=t,this._state):Object.freeze(H(W({},this._state),a({},e,Jx(t))))}}]),e}();function iC(e){switch(e){case xT.Desktop:case xT.Phone:case xT.Pad:case xT.TV:return 2.42;default:return 1}}var aC={"arrow-down-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","bold-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",bold:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",check:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIG9wYWNpdHk9Ii4wMSIgZD0iTTAgMGg4djhIMHoiLz48cGF0aCBkPSJNNy4xMjUgMS40ODRoLS41NDZhLjI0OS4yNDkgMCAwIDAtLjE5Ni4wOTZMMy4xNjIgNS42NiAxLjYxNyAzLjcwM2EuMjUuMjUgMCAwIDAtLjE5Ni0uMDk1SC44NzVhLjA2Mi4wNjIgMCAwIDAtLjA1LjFsMi4xNCAyLjcxMmEuMjUuMjUgMCAwIDAgLjM5NCAwbDMuODE1LTQuODM2YS4wNjIuMDYyIDAgMCAwLS4wNDktLjF6Ii8+PC9zdmc+",delete:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDZ2NmEyIDIgMCAwIDEtMiAySDZhMiAyIDAgMCAxLTItMlY2aDBtMS0yYTIgMiAwIDAgMSAyLTJoMmEyIDIgMCAwIDEgMiAyaDBNMyA0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",duplicate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSAySDZhMSAxIDAgMCAwLTEgMXY4YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMS0xVjRoMGwtMi0yeiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTExIDJ2MWExIDEgMCAwIDAgMSAxaDFsLTItMnoiLz48cGF0aCBkPSJNOSAxNEg0YTEgMSAwIDAgMS0xLTFWNWgwIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PC9zdmc+","eraser-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANKSURBVHgB1VTdS5NhFD/7iuXa8KNw7SK/IjBYo13soqvEITENtj9AwZiCOCTvQrNWF9rFFPGLrC1iF10Oiy68mBSUF2KB4YabhKKyTfFCc+3Lzb2ds72LsfbxCkZ04Mf7Puc5z/k95+M5AP+R8OAvCW9nZ6cyHo8/SSaTc4RQKKQ+S0JyxFtbW6va39//ZjKZmMbGRkar1TJOp5MhYtwXwBkQkgMROnyXIcmGw+FgYrHY00JkQm4cqYPCaDQ6ZrFY7i4sLPxhMDg4SJ8hTOOWRCJ5jf8npyUiEgE6eGy1Wk12u72gIZHJZDLr4eHhVnl5+YdsslL5pH1+JBIx22y2h9PT01BKpFIpLC4ufhKJRFpcxhEM6fmlSMLh8P35+XlOJCTBYBC2t7dr8fdctv+iRHjI4HK5LAMDA8BVFAoFyOVyH/6KIKsxCtVIgC188+Dg4CV2GJxGpqamYHR09AHklEWQY5d6K/gg67HD3huNRrlKpYLNzU3gIsPDw8Dn84fa29s/4zIK6Rol8xIhSUMikXB2dXXV4AHo6en5KhaLFcvLy0VJent7QaPRzKrV6le4DCEi2UTCnGgE1dXVj3Q6XY1er08drKiosK2urnbjnrFQQxBJU1PTC3y4kyxJGHEMWe2dTUSNIcLZVXl0dAStra3BiYmJOTqgVCqfu91uull3LhlFjbZv6urqiCTIElHaEsC2dq4QqXRlZeUePsrUDFtfX/eZzebbqL+GuIFks1js32OHRtHu7u5H3FMiahFViPNQYuZRO8oQVzY2NibJocFgYAKBgLuzs/M66hsQKuzELx0dHak9rKe3paXlFurrERdZEiGUGARkcAFxmSJAJ/aRkRGGnOKwdPn9/rG9vT0HXaC5uZnxer3+vr4+HdpeRVxClBWLJFuZqhF7gAjL0PGz8fFxvcfjSY0WevVUv5mZmQDWyog1/I52PyBdlxgUqUu+qMSQznVtW1ubBlP3dmlpicnA5/N5+vv770C6bhS9lEu6eHnWFP45NioJS5xxRLdNsrenKH5CusNOWH1BEeTRMTnI6MgZpYYeYhhOmS5eEX0mMhELPktGoBd/zCWSUkTAOs4QZqZ8JsokS8Kp8KWICtlwdv5P5BchBHaEIRURoQAAAABJRU5ErkJggg==","eraser-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAgrSURBVHgB7ZprTBRXFIDP7gIt8lQppTwE5V0KaAn6o1pqNGkDDTEmTUhsgKRp+gNJw68CFkLbVC2QkDS+gD8KJdWmARvbFBNNWpuIRGPFWBXQRMPDqIki+KLATs+ZnTvcvXtnX8w2beJJToaduTP3fHPOPffcOwC8kP+2WCDwIvahGFxTuN8KmNSZmULPNjLeqF9F8rdPkIEGEn+r+vjx46LQ0NA8/Dsader58+e/h4WFDWntFO7ot6fMFAt3JLWi2lCDpqamCux2+2+KROj82NhYGrXT2lu5Z/DP/deFByElA4Pv3LlTiHY/nJ6eVnbv3q1s2bJFyc7OVrZu3arU1dUp4+PjxPUQoT+g9tp9PkMFgpo9kxljHRoaWp2Xl3duYmIiurKyEvDoclNCQgIcPnxYPc7MzHwcGRnZhaft4Ag7O9fUbRhaITCie4lgcnNzT7qDIaHz27dvh+vXr0NEREQneqoCHKFnAR+8ZCaQGGq2CxcurCGYycnJZHcwTNAzUFFRoUJFRUV1IFQ5OKBsXB9uxSwgl0TQ3d29Yt26dccwoyVXV1d7hGEiQmGi2AzOUHx/hob4K2yuYS9G987s7OwPISEh7xPM6dOnwVfBsIMjR45AZmbmo5s3b76Xnp7+J55egMVxBSAZT0v1ED+76yn66dOnLQSzd+9ev2BIyFP0MjBco1JTU/sxfFeDazp3cYgZHmKqdoaGNISHh9fv378fSJcqlPV6e3sBJ+I/goOD34VFL0k95Y+HxPHCYGxmw5DQ2NuzZw8EBQVtunXr1jvgwUP+hhz/QDXMMCNVE8zx48dNg2FCz6QQjI2N/RA8VBFmANnu3btXihnpG8pM9fX1EAi5du0aeWkVOAMBCF7yN+R0z4yOjq6NiYlpp9CgdBtIwXpPH6vgDKWLt0CygtM6MDCwBuUYZSKaOCksAiVY9wFOBePgDOOytPAGSKzNVCCC2bBhw69YdK7ypgpYimzbtk2dl7CM+hFcveOUHDylbTFO1YdhFbByx44dA1QFUP0VSJj4+Hjo6+sDq9U6iEmHKvFZTedQ50GYbN15SITVlwNlZWUnLRZL8s6dOwMOQ9UCTtKTra2ttdppt9V2kMF5cbmsjxuM43bMNrmUzc6fP6+GQiDGDoOJi4ubwb4qm5ubafyIE6nLxGqTPEsGo1cBOGNX0TyDYafC0CyOaxcVziyh53Z2dkJycvLMvn37PmpoaBgFR4jxYSbWdVIgI89Iq4CjR48CZjlYv369+tssqI6ODsjPz4f+/v668vLycxrEHHfkYdwC8SB6mGEV8Cl64cuuri5oa2tTG+EyGjZu3AiXLl1qefDgwV8lJSUFZkDV1tZCcXExXLx4sbWoqKgPFj0zx8GI9ZwO5W4M6ekZYeqpaqbqmaSqqkpNpcPDw4dwzfM9nrLduHEjEs+X0XV/Sx96LnqE1kLtBQUF3eDwCO8dGQyzV5rl+JyuegfXI29jRotiRlKnpFghHMzKyjqotVXS0tLacKPjF3bdHxjSq1evduAkepAD+ZsDYlC8V5w8ZBVg+PPq2MGMlkInqE4joTf45MmT4YyMjAPcA+ltLSQlJX2BafxnX6HI29QeK44TOTk57mCYZ0QoJ8OBM4yB6dkNkwGlSygsLFQvYtYB3BTMxFL+M+0eFgZqp4mJiU2+QKGX1fGIk/QIrn0aYXGsyDxjmAyMhO2jhaCGoUbX1NSkLSwsPMJqV8Fspu6lIZS6OYhjiOLwdU7fQM1HfRPD7wS1obZ0j0xpb4726Z49ezaJf2/S7s9ATUGNR41BjdJseRnke3WGwhrRTS9pD1mOGoeG15BxOOfoxuCkp0Ih6NeaEaSZGlieJyiCoc1FgsGldokGk8nBvAKOrWIGQ5uPsm0tt0BWDiicAaGuGhkZ+YqMw9StGzU4OKhCnT179hNsswY1FTXdE5QEJhc1S3tGogazXLOBwQSBl3tzIhQPtAL1VQJCTcNx8y1vHIUghSKFZE9PT7H2dlM1b+Wgrr1y5Uq77J75+fnplpaWMg2ch4nlYEI5z7hdensDpI4hrYNErcMMXJ32koG4ztf3pultz83NjWG99Ra2WQ0OL2VjZjwgeufUqVOqV8+cOdPIwdBLSNJeHg8TAh5WqJ6EfSmgt7IMNRJ1JThiOlnrOAMHshprmMKdoGSCpb9s3B3SYLIFGIqICJB7xisYi+RvfiypXw40DWGdlJaWRmMd141hk8V2OWm7ieYTXhBc3+BgaZyqAISjOYxSMVvXsBTNlzdiNQDgRao2AtK3pjggpmrqbGpqSsLPIN/dv38/gaBwUjTshMHcvn27JyUlpRmc5xpPMD599LIYnLNyUKKndKjGxsakXbt2deMCLIE8IVvs0YRM1fjdu3d/wrXN5+BcnzEgvor2uN3rjzAYMp5lPEoQlE5fA0fWo8GfhlCbKVFQ1pKNIfzcOHH58mWqaimVUwJI0+6n59D4pIlzmdZPMPiZzXjDjX47Le5g0Uu8x2zgPqWyKpjVe7x3+AUbq9NYjQbgp2dsBud5o8TP7d5kHAWcQchQfoEmLgn8HjOiBIF7o5hI1x6CEbLNP3bdqYAF44JzyWLzcN1i8DcT/o3awbm8Fz3DAy2A62INwPV/E3wWdx5inmBHuwChCBD6R2JwHge80TIQRQLjt7e8DTkGZgfX8cUMZTDAteFDkveaIlzjX9ySQs8X18r2t2VHUURPKoICmDR+eCO9aSdmOIub3/w9RgpgUpiJhvraXpa6jZKHGEqyusw0GLFzX+5RhN/8kYnMSNMMfyH/V/kHST6OYVElTPAAAAAASUVORK5CYII=","font-colors-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-colors":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-size-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","font-size":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","hand-grasp":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTExLjcyIDE0LjM0NEg0Ljk3OGMtLjUxMyAwLS45MzEtLjQ3My0uOTMxLTEuMDU1IDAtLjQ0Mi0uMS0uNzQ0LS4zMzQtMS4wMUwuNDQ2IDguNzQxLjQ0NCA4Ljc0QTEuNzkgMS43OSAwIDAgMSAwIDcuNTU0VjQuODc4QzAgMy45OC42NDUgMy4yNSAxLjQzNyAzLjI1Yy4zOTQgMCAuNzU5LjE3NiAxLjAyOC40OTUuMDkyLjExLjE3LjIzMS4yMzIuMzYzVjIuMjAyYzAtLjg5OC42NDUtMS42MjggMS40MzctMS42MjguNTcgMCAxLjA1NC4zNjcgMS4yODcuOTEzLjA1OC0uMzYuMjEtLjY5Mi40NDMtLjk1NUExLjUwNiAxLjUwNiAwIDAgMSA3IDBhLjguOCAwIDAgMSAuMTc0LjAxNWMuNjMyLjA4IDEuMTQyLjU3OSAxLjM0MSAxLjI1LjItLjYyNi43My0xLjA3NCAxLjM1LTEuMDc0LjEgMCAuMTkzLjAxMy4yOC4wMjdsLjAxNS4wMDNjLjY2Mi4xNTYgMS4xNDMuODQzIDEuMTQzIDEuNjM1di4zM2MuMjQ0LS41MDQuNzE3LS44NDggMS4yNi0uODQ4LjM5NCAwIC43NTkuMTc2IDEuMDI4LjQ5NC4yNjQuMzEyLjQwOS43MjguNDA5IDEuMTd2Mi45NGMwIC4zNTItLjAzOC42ODYtLjExNC45OTNsLTEuMTM4IDUuMjEtLjAwMS4wMDRhMy41MyAzLjUzIDAgMCAwLS4wOTYuODQxdi4yOTljMCAuNTgyLS40MTcgMS4wNTUtLjkzIDEuMDU1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Im0xLjAyNCA4LjM5OSAzLjE1MiAzLjQxMi4wMDIuMDAyYy4zMi4zNjMuNDY4LjguNDY4IDEuMzc0IDAgLjI0OC4xODUuNDU3LjQwNC40NTdoNi41MDdjLjIxOCAwIC40MDMtLjIxLjQwMy0uNDU3VjEyLjljMC0uMzQuMDM3LS42NjIuMTEtLjk1OWwxLjA5OC01LjAyNlY2LjkxYTMuMzcgMy4zNyAwIDAgMCAuMDkzLS44MTJWMy4yNjJjMC0uNTg2LS4zOTEtMS4wNDUtLjg5MS0xLjA0NS0uNDkyIDAtLjg5MS40NTMtLjg5MSAxLjAxdi42NWgtLjgyVjIuMTU1YzAtLjQ5Ni0uMjk1LS45MjYtLjcwMS0xLjAyNS0uMDY2LS4wMS0uMTMtLjAyLS4xOTEtLjAyLS40OTEgMC0uODkxLjQ1My0uODkxIDEuMDF2MS43NTdoLS44MlYyLjE5YzAtLjY1MS0uNDA4LTEuMTktLjk0OC0xLjI1NEw3LjA5Ni45MzQgNy4wODUuOTMyYy0uMDI3LS4wMDYtLjA1LS4wMDYtLjA4My0uMDA2LS41ODEgMC0xLjA1NC41MzYtMS4wNTQgMS4xOTV2MS43NTZoLS44MlYyLjUyNGMwLS41ODYtLjM5Mi0xLjA0NC0uODkxLTEuMDQ0LS40OTIgMC0uODkyLjQ1My0uODkyIDEuMDF2NS41OTJsLS44Mi0uODcyVjUuMTA2YzAtLjU4Ni0uMzkxLTEuMDQ1LS44OS0xLjA0NS0uNDkzIDAtLjg5Mi40NTMtLjg5MiAxLjAxdjIuNTgzYzAgLjI3NC4xLjUzOC4yOC43NDV6IiBmaWxsPSIjRkZGIi8+PHBhdGggZD0iTTUuNTY2IDYuMDgydjQuNjM2YzAgLjE5LjIyMy4zNDQuNS4zNDQuMjc2IDAgLjUtLjE1NC41LS4zNDRWNi4wODJjMC0uMTktLjIyNC0uMzQ0LS41LS4zNDQtLjI3NyAwLS41LjE1NC0uNS4zNDR6bTIuMTggMHY0LjYzNmMwIC4xOS4yMjQuMzQ0LjUuMzQ0cy41LS4xNTQuNS0uMzQ0VjYuMDgyYzAtLjE5LS4yMjQtLjM0NC0uNS0uMzQ0cy0uNS4xNTQtLjUuMzQ0em0yLjE4IDB2NC42MzZjMCAuMTkuMjI0LjM0NC41LjM0NHMuNS0uMTU0LjUtLjM0NFY2LjA4MmMwLS4xOS0uMjI0LS4zNDQtLjUtLjM0NHMtLjUuMTU0LS41LjM0NHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","hand-loosen":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTkuMTU0IDBBMS4yMjYgMS4yMjYgMCAwIDAgOC4xMS42MDdjLS4yMDguMzQ4LS4yOTUuNzY4LS4zNDUgMS4yMzItLjEuOTI5LS4wMjUgMi4wNTgtLjAxNCAzLjA0Ni4wMDcuNTEyLjAwNCAxLjA0MS0uMDAxIDEuNTQ3YTYzLjMxIDYzLjMxIDAgMCAxLS4zNS0uOXYtLjAwM2wtLjAwMS0uMDAxYy0uMzU5LS45MjYtLjY5Mi0xLjg3LTEuMTUtMi41NjItLjIzLS4zNDYtLjQ5Ni0uNjQtLjg1LS44MDctLjM1Ni0uMTY2LS43OTItLjE2NS0xLjIwNC4wMmwtLjAwMy4wMDEtLjAwNC4wMDJjLS40LjE4Ny0uNjUuNTYzLS43MjIuOTU4LS4wNzQuMzk0LS4wMTkuODEyLjA4MiAxLjI2Mi4yMDMuOS42MTMgMS45NC44OTIgMi45Ny4yMi44MTMuNDM0IDEuNjMyLjYxMyAyLjMyMmExMy44NTUgMTMuODU1IDAgMCAwLS44NzQtLjgxNmMtLjU0My0uNDYyLTEuMTQtLjg4OS0xLjc1Ny0xLjExOS0uNjE2LS4yMy0xLjMyMy0uMjQ0LTEuODQ1LjIxOGwtLjAwNC4wMDQtLjAwNC4wMDRjLS40MS4zODQtLjYxNC44Ni0uNTYgMS4zMjMuMDUzLjQ2NC4zMDcuODcxLjY0MiAxLjI5LjY2OS44MzYgMS43MiAxLjc1MSAyLjczNCAyLjk2OCAxLjEzNSAxLjM2MiAyLjM3MiAzLjUzOCAzLjI1MSA0LjY4MWwuMTE4LjE1M2g3LjcwNGwuMDg2LS4yNzRjLjE1LS40ODIuMzE4LTEuNDQyLjU4Ny0yLjY0Mi4yNjgtMS4yLjYyNy0yLjYxIDEuMTA0LTMuODQ3LjYzNS0xLjY0NiAxLjI4NS0zLjE5NCAxLjU3Ny00LjQyMy4xNDctLjYxNC4yMTQtMS4xNTEuMDk1LTEuNjI2YTEuMzA2IDEuMzA2IDAgMCAwLTEuMDQ4LS45NmMtLjQ2Ny0uMDg4LS45MS4xMi0xLjIyLjQzNC0uMzEuMzE2LS41NDYuNzM2LS43NjUgMS4yMDctLjE3LjM2NS0uMzI3Ljc2NS0uNDgxIDEuMTY2bC0uMDEtMS43MzRjLS4wMDQtMS4wMDcuMDU5LTIuMTM2LS4wMTctMy4wNDQtLjAzOC0uNDU1LS4xMDMtLjg1NS0uMjcyLTEuMTkxLS4xNjUtLjMyNy0uNTI0LS42LS45MjUtLjU4NWExLjE4IDEuMTggMCAwIDAtLjk2OS40NmMtLjIyMy4yODUtLjM1NC42MzYtLjQ1OSAxLjAyMy0uMjEuNzczLS4zMDIgMS43MDktLjQ0MyAyLjQ4bC0uMTk1IDEuMDkyYTQ1Ljg3NCA0NS44NzQgMCAwIDEtLjEzNi0xLjE4N2MtLjA5NC0uOTM3LS4xNi0yLjA1NS0uMzU2LTIuOTctLjA5Ny0uNDU3LS4yMjItLjg2Ni0uNDM1LTEuMTk5LS4yMTQtLjMzMi0uNTgyLS41OTctMS4wMS0uNTc5aC4wM0w5LjE1NSAweiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik05LjE1Ljc4NGguMDQ5Yy4xMzItLjAwNS4xOTUuMDMuMzE3LjIyLjEyMy4xOTIuMjQxLjUyOC4zMjkuOTM5LjE3NS44Mi4yNDUgMS45MjQuMzQyIDIuODg0LjIxMiAyLjEwOC41MTQgMy42MzUuNTE0IDMuNjM1bC43Ny0uMDEzcy4yODctMS43NjMuNTk4LTMuNDYzYy4xNS0uODIuMjQ3LTEuNzQ2LjQyOS0yLjQxNy4wOS0uMzM1LjIwNy0uNi4zMTktLjc0My4xMTItLjE0Mi4xNjktLjE3NC4zMTktLjE2M2wuMDMuMDAyLjAyOC0uMDAyYy4xMi0uMDA5LjExNi0uMDEuMi4xNTYuMDg0LjE2Ny4xNTcuNDk1LjE5MS45MDMuMDY4LjgxNS4wMSAxLjk0Mi4wMTUgMi45ODNsLjAxOSAzLjcwNS43NDUuMTY4Yy40NTUtLjk0OC44MTktMi4xMTIgMS4yMjEtMi45NzguMjAxLS40MzMuNDE1LS43ODcuNjEzLS45ODguMTk3LS4yLjMyMy0uMjUuNTE2LS4yMTNoLjAwNGwuMDA1LjAwMmMuMjk5LjA1MS4zNi4xMjcuNDI0LjM3OC4wNjMuMjUuMDM1LjY5Ny0uMDk3IDEuMjU0LS4yNjUgMS4xMTUtLjkwNyAyLjY2NC0xLjU0NiA0LjMyMi0uNTAyIDEuMy0uODY2IDIuNzQtMS4xMzggMy45NTctLjIyLjk4My0uMzg3IDEuODM0LS40OTkgMi4zMDRINy4xNDRjLS44MDItMS4wOS0xLjk5Ny0zLjE2LTMuMTU3LTQuNTUyLTEuMDYtMS4yNzEtMi4xMzYtMi4yMi0yLjcyNC0yLjk1Ni0uMjk0LS4zNjgtLjQ1LS42NzMtLjQ3Ni0uODktLjAyNS0uMjE1LjAyNi0uMzg2LjMxMi0uNjU2LjI3LS4yMzcuNTgyLS4yNDMgMS4wNDktLjA2OS40NjcuMTc1IDEuMDE4LjU1MiAxLjUyNC45ODJhMTUuODggMTUuODggMCAwIDEgMS44NDcgMS45MDRsLjY4Ny0uMzRzLS41MDQtMi4wMS0xLjAxLTMuODcyQzQuOTAzIDYuMDggNC40OTQgNS4wMyA0LjMxNCA0LjIzYy0uMDktLjQtLjExNi0uNzMzLS4wNzctLjk0Ny4wNC0uMjEzLjA5Ny0uMzAyLjI4My0uMzkuMjQ4LS4xMS4zODgtLjA5OC41NDctLjAyNC4xNTkuMDc0LjM0NC4yNTEuNTI5LjUzLjM2OC41NTcuNzEgMS40NzYgMS4wNzMgMi40MTJsLS4wMDItLjAwNGMuMzcuOTgzIDEuMDc4IDIuNzE0IDEuMDc4IDIuNzE0bC43NTUtLjEzN3MuMDU1LTEuOTEuMDM2LTMuNTA5Yy0uMDEyLTEuMDE4LS4wNzgtMi4xMzYuMDEtMi45NTIuMDQzLS40MDguMTMxLS43MzUuMjM4LS45MTUuMTA3LS4xNzkuMTctLjIyNS4zNjctLjIyNHoiIGZpbGw9IiNGRkYiLz48cGF0aCBkPSJNNy43MjMgMTAuOHY0LjY5MmMwIC4xOTIuMjIzLjM0OC41LjM0OC4yNzYgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OC0uMjc3IDAtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OHMuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OHMtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OC4yNzcgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjIzLS4zNDgtLjUtLjM0OC0uMjc2IDAtLjUuMTU2LS41LjM0OHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","italic-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",italic:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","laser-pointer-cursor":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGZpbHRlciB4PSItMTIwJSIgeT0iLTEyMCUiIHdpZHRoPSIzNDAlIiBoZWlnaHQ9IjM0MCUiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgaWQ9ImEiPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQiIGluPSJTb3VyY2VHcmFwaGljIi8+PC9maWx0ZXI+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkgOSkiIGZpbGw9IiNGRjAxMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGNpcmNsZSBmaWx0ZXI9InVybCgjYSkiIGN4PSI1IiBjeT0iNSIgcj0iNSIvPjxwYXRoIGQ9Ik01IDhhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2em0wLTEuNzE0YTEuMjg2IDEuMjg2IDAgMSAxIDAtMi41NzIgMS4yODYgMS4yODYgMCAwIDEgMCAyLjU3MnoiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4=","layer-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",layer:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","line-through-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","lock-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM3RDdEN0QiLz48L2c+PC9zdmc+","lock-new-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM1QjkwOEUiLz48L2c+PC9zdmc+",lock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiLz48L3N2Zz4=","pencil-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJ2SURBVHgB7ZXPqxJRFMfvjI4F+cqkTcrjge9B+B+0LJQ27lq4ijZprly6DaF1COKPjYRrVy0CF/aof6Baa6ChOPkLFcdMm1+dM93RafzxZuptgnfgC3ecO+dzz497JOTKNsZMp9OAoihvZFku4xp/I5dsbL/fP221Wl/D4bCKwnWn0znDd+SSDE/N6ZBgMKjJBNuKzC4dHTgQ5PF4bququn7R7XZJPB4/kSTpHcBOiQlmJ6cMpCvAcdz5ZDJhF4tF1u12v4jFYkc8z683+f1+Uq1W38K+x/AogVQ7ETF4SnB+Ho1GTxKJxDFC2u32q1KpJPh8vvVGjHK5XM4xahv+tYgRcranJrNarfay2WwKoVBIRTUajW42m70P390EOYmFrOEGdhfECEMIwur1Og+p5VOp1CP47piCOB3EXBBJAIuLRcZi7zKsSaVSEbxe70N4FEEL0AyE6VuBZEJD2wmyAkHDmoxGIwGW36ljBP2gUEXf5/wXCDZBsVjky+XyUwpCyBL0k0ai7gNp3WUVUigUvgHoWSaTaRoi2YJojk1r52q1eh2JRJ5YgUB3Pc/n83WyXRPV/A1rWrtgSAZsQL6Q3ynTI1F2QdCMqXNQEGsDMqMgrMt6ChwCaXcGYdBFjA3InELkQxBCtkcEI4riHyPFCMnlcnEKMbYzQhRi0TCKa6A76XT6wWAweD8ejz8Oh8PPcEc+9Xq9D8lkMgLv74Hugo5ALmJzlumG4+IG6BZ1dJ06wtPqN14gmza2FYljD1SljrCTsAaYpjnZFP7CmpADEel/ai4qffLiqSUKFSlEP8xfgYwwlmzyr1KYHoUtgBU4Y9D/Y78AxCeE/aWoyrkAAAAASUVORK5CYII=","pencil-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYISURBVHgB7ZpNSCtXFIBPEuvz+dMGpYUKD/sWFX+Qti6kK7Hqpm6e9q0rIoIUFUShPLV10VZx4+JZqa9v20LBhdq9fyBUCtKNPH8qYl2IOw3G38Rkek4y15y5uTOZJDOWggcOSSYzN/ebc+45554JwIM8iBCPyTEP+86T4vyMfsRN4b+nQTKIJp0vzuGvlpID7os8EQNEIBD4oKio6Bm9DwaDv/v9/n/076JgbtWUYPchwrW8qD7UnOvr6wFNkpubm+/wu7f0c7y6mrnlvQufxB0Iau7V1dX3BDA/P6/V1dVpzc3N2uLiIofK1c8VYHys/wRKBUN3/hGHqaysNOjc3FwMis6hc0FtLTHuvYLxCCZgci8uLn4wg5Gh6Fy8Jk+/NkcCAlAAuUkoW4g0B+d5tLS05O/r67O8eGxsDNra2uDy8nKsoKCAwCIQDxQa0yTxgrvCYXyTk5Ml+Orf2dlJeeHIyAigFSE/P38ELfUNqNdSkjgF5FF89jL1TU1NlQwODl5gZPujp6cHWltbUw7Koc7Pz8mkZpHPFeFrJuZeqLnoMoPoZqe0JjDP/IZgnyLUG/o8NDRkuo5Ua2pjY6MC4oFCFf1cA0oKzRSOp6enRfTaGh0d/QxBt+1CUVgnOTs7+xrHfQzGyOcKkK3QTJMnQffZ6e/v/xwttmsHqqmpKXbdycnJCxy7ABLh3FEgVZ6hZJhnFZoFFMF0d3c/w7v+dyookXBnZ2c/xvHfhriVcvXfdBRItsxjnOhYqjwjoAimq6vrCysoGofk+Ph4Esd/F/UdiFtJAGUd2DygTpp5dmBUUJ2dnc9VUALm8PDwJY7/BPU9VD8k3M4RC6kskxZMKigKIMLN9vf3p3H8DyWgfEhEOwOQD9IXOTz7EObbwsLC4YWFBRgeHrY9ECXYo6MjaGlpKWlsbPxkYGDgRW1tbSEWquVlZWXBzc3Nl1VVVa8hXiXc6ioqBqGaPDk7AACJTRZ3NS9lcUp86cJwoSQ7Pj4Op6enfxUXF3/V0NCQv7q6GsCvwrqGUG/01xAD4+VQTOxaSF43d5bBOisrGBJRCtXX17+/trb268rKSgASFgmz97KFkmo6OztWuVyPweiWGc4WRkhFRQVEIpHg8vJyQAIQVlLBROVxvBYQHsXnO8tk62ZcyN0wecLBwcEvYHSzEPscBqOLCRhLC4n9uqaA8UAWAcAKhtbQ3t7eTHl5+Y9gtAp3twhT056CDMQ7MRzIFTeTYKb1yYYVQFH9VdzsqNmYKpfTJBDX3Ixgdnd3XyHMT2AMALJlBBSPaMpNngrIsTyTCgaj288YDGakictrxizvKFNOjgSSBLS+vv6UYHDb7DgMVgsChjTEgCIKGG4ZU+EWkgNBzN1qamq+pAMTExPgFMzW1tZrhHkFyWE5KxgSszx0527RaDRmOSpRshEOU11dPQPG8CwHARHJlMnTSrwSRFIlfXt7m3V5ngJGuJtqzaQtZkFBVNJezN5ZAdmwjKo2k9tVtrcI3OXk4tPgcg7ChCDZ1URgMOu72Xa5VFHOkymQhWVU60YVmjN6wiC7k6p+S1syCACOwJBYFaexV+yhBekNPsMBO6KAEeE4BMaCU67RsoYhSbXgaT//ht709vZCaWmp6YkEbLFmVJWzas04+iBL7EKpm0J7duqu0B7+CTUpNJuyvb1NCfMj1CqI9wLKUOlOUMeG+gGFkHii4HizUF4z/KFUrPsJ8WbEIyx7nnZ0dDynME6BAuce09iFHo+GrnmGltltb2//E4wVAN82y7vOjKOZXSBhJdHNiT3TYWD8OY2PTUJkdd7MkJMnT5wZVQF2RFX6yBMUdzPMvvfqxz3sXHF+GNT9ANXit/10O1sgHkZvdQAOKvs9B5L7ARELGAAXLSTvM8QExTE+YbHe+HURhZp1aRyF4CJXClbbWwGketgkW9VsY+YaiBCVhfgE+XvxRwgZSM4jUVCDZFQ9pytmXR8hUTB2gnidx4XffVWydN0yQjwmx/jkAZJBrIBI5J7ZvQGZWUgVSuU/EqmOAzicKNMVu816DdRWUV1/7xAP8n+SfwF3Du3NF2sYhwAAAABJRU5ErkJggg==","pencil-eraser-1":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMjYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMTciIGhlaWdodD0iMjUiIHJ4PSIzLjUiIGZpbGw9IiMwMDAiIGZpbGwtb3BhY2l0eT0iLjM1IiBzdHJva2U9IiNmZmYiLz48L3N2Zz4=","pencil-eraser-2":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMzQiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMjUiIGhlaWdodD0iMzMiIHJ4PSIzLjUiIGZpbGw9IiMwMDAiIGZpbGwtb3BhY2l0eT0iLjM1IiBzdHJva2U9IiNmZmYiLz48L3N2Zz4=","pencil-eraser-3":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzQiIGhlaWdodD0iNTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iLjUiIHk9Ii41IiB3aWR0aD0iMzMiIGhlaWdodD0iNDkiIHJ4PSIzLjUiIGZpbGw9IiMwMDAiIGZpbGwtb3BhY2l0eT0iLjM1IiBzdHJva2U9IiNmZmYiLz48L3N2Zz4=",rotate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDZhNiA2IDAgMSAxLTMuNzA5IDEuMjgzIi8+PHBhdGggZD0ibTEzIDYgMS40MTQgMi40NUwxMyA2bDIuNDUtMS40MTQiLz48L2c+PC9zdmc+","rotation-button":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0ZGRiIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBvcGFjaXR5PSIuMDEiIGQ9Ik0wIDI0VjBoMjR2MjR6Ii8+PHBhdGggZD0iTTUuNzI0IDUuNzI0QTguODQ3IDguODQ3IDAgMCAxIDEyIDMuMTI1YzIuMjcxIDAgNC41NDMuODY2IDYuMjc2IDIuNmE4Ljg0NiA4Ljg0NiAwIDAgMSAyLjU5OCA2LjE0IDguODQ5IDguODQ5IDAgMCAxLTIuNTU5IDYuMzdsLTEuNS0uOTgzQTcuMTA1IDcuMTA1IDAgMCAwIDE5LjEyNSAxMmE3LjEwMyA3LjEwMyAwIDAgMC0yLjA4Ny01LjAzOEE3LjEwMyA3LjEwMyAwIDAgMCAxMiA0Ljg3NWE3LjEwMyA3LjEwMyAwIDAgMC01LjAzOCAyLjA4NyA3LjEwMSA3LjEwMSAwIDAgMC0yLjA4NiA0LjkyIDcuMTAzIDcuMTAzIDAgMCAwIDEuNzY2IDQuODE1bDEuOTQ1LTEuNTg0IDIuMzk0IDcuMTgyLTcuMjIyLTIuNDA4IDEuNzkxLTEuNzlBOC44NDYgOC44NDYgMCAwIDEgMy4xMjUgMTJjMC0yLjI3MS44NjYtNC41NDMgMi42LTYuMjc2eiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9Ii41IiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+",rotation:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBmaWxsPSIjRkZGIiBvcGFjaXR5PSIuMDEiIGQ9Ik0wIDI0VjBoMjR2MjR6Ii8+PHBhdGggZD0iTTUuNzI0IDUuNzI0QTguODQ3IDguODQ3IDAgMCAxIDEyIDMuMTI1YzIuMjcxIDAgNC41NDMuODY2IDYuMjc2IDIuNmE4Ljg0NiA4Ljg0NiAwIDAgMSAyLjU5OCA2LjE0IDguODQ5IDguODQ5IDAgMCAxLTIuNTU5IDYuMzdsLTEuNS0uOTgzQTcuMTA1IDcuMTA1IDAgMCAwIDE5LjEyNSAxMmE3LjEwMyA3LjEwMyAwIDAgMC0yLjA4Ny01LjAzOEE3LjEwMyA3LjEwMyAwIDAgMCAxMiA0Ljg3NWE3LjEwMyA3LjEwMyAwIDAgMC01LjAzOCAyLjA4NyA3LjEwMSA3LjEwMSAwIDAgMC0yLjA4NiA0LjkyIDcuMTAzIDcuMTAzIDAgMCAwIDEuNzY2IDQuODE1bDEuOTQ1LTEuNTg0IDIuMzk0IDcuMTgyLTcuMjIyLTIuNDA4IDEuNzkxLTEuNzlBOC44NDYgOC44NDYgMCAwIDEgMy4xMjUgMTJjMC0yLjI3MS44NjYtNC41NDMgMi42LTYuMjc2eiIgc3Ryb2tlPSIjRkZGIiBzdHJva2Utd2lkdGg9Ii41IiBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L2c+PC9zdmc+","selector-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKeSURBVHgB3VTLi1JhFD86zlQ4ysxSXAy1GWYZzMxmYAhHagRB/QN8FLqPFq4FIQhXkS6kTQ4t2ilIKEWgSS0SmVpIm0BdaBJSaOP78XU+PXey6+saburAD+73uL/feX0H4H81GQdj7D7ilrCGFRonk3c6nXvhcJiFQiGWy+Xy/X7/WbPZ1K1KkBOsl0qlO36/n+3t7Q1hs9kYF+WC3W73MTpxc1lBmej7KuJaoVDInZ6eqsWXDw4OwGKxwPHx8Se1Wn1Wr9cjW1tbOTxi9D9bJCJHXEFslsvlR263+246nYZZptPpQK/Xg8lkSvZ6vbNGo5EgQRCLiSPhIqpoNHobo3keCARgkalUKjg5ORlGuL+/n8T6PVAqlefjYmKRdYQSsZ3P5z8aDAYVLGFarRbi8fhbhUKhx2VPEJGP3eEbfTrs4MUwr4EU49FYrVbweDy1SqXyipy95FaI7g8QXS6SyWReHx4e2ubVBc+HtTk6OjqvVqtvvF7vi0gkUiSByyyJ21BGwpswJ2Vmsxlw/0Kj0bxMJBJJl8vFPWkhGogLQoeyMhEJo2jGUzYRjcPh+Op0Oq2pVOoHkXE0SahF/w+E+3KYNEaX2pSyiSiKxeJTFPiGyyriO6FKEUgSESLp4ht4bzQaf4pFYrHYO/ysEXGNyJtjKRqM/zNNhFuf0B7vst3dXdjZ2Yn4fL4vRFwn8jaMGqYPU179LBEGf3bZcNNutwPOtScwKnCLPJ9KLMWEh7mNuIFdVsNXzbBNP+D6Ou1vwAqm8hqMWlmbzWYf4mz6HAwGzbjWwGgqrEklmucJT+UGCfG3wiPjueeNwGvB0zkAid7OMmF8CyOck/I6NJcR4KZYcM6J2vCbUGhvyQIA0gonzCEZkQud9Fcd9W/bL57cJu3lkjuNAAAAAElFTkSuQmCC","selector-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAZoSURBVHgB7VlLSCRXFL3ljNEhEXTGhMQJmOjCz8ZNVLKICz9xIYhCNi7UgINkGEk2En8hW5cBUQNxo05GAoKikuCAmvGzGMdPcCUGjDPxD/4Vv/3JvWW97luvq7ur+hMZ8MKlqrteNfe8e965970GuLVbC5kpJr53+hjHx9yY3TUxJgLMAQG4ITARfp5T4Mri4uL9q6urnxwOxz/oY5eXl1/Pzs7e195X2FX4jZsIhAK7gx5ps9m6nGj9/f3OtbU1pzAE0318fPwVjYHrrN7R3AjU/wpOBwA9Cmf/9ejoqDMtLU31iooKGdA+ATo4OMiXAEWAHhBAGEApXj4rPAik0vPt7e0vCgoKPH4gMzMTSktLIS8vD2JiYgABvcHMTZyennbHxsaOg3udOJmLzwqEYB0ZgRCZENm4u7e39yQuLq65srISZmZmvP5Ybm4u5OfnQ0lJyXWUCAgzNLS+vt6SnJz8WgvYwV5xSlcRgyVg3ha2Dkxzc3MvfZmVlQW+bGxsDBobGyE7O1u94uJPjIqKqklKSvrbbrfPnp+ff7e8vJwMnlSTKWfJjDKhywJo6wLp0YcZ+dyIUr7s4cOHLsrRlQwBTSBFuzc2NiZYhjjVAIyzZBqEwgCQv0OOM/gNzuiP/ijlDxBRjgClpqa6AF1cXDydmpoaLCws3JcAGYHyC4JMzoKaibKysvienp6FtrY2IA/WCFB5ebkqCHSvARo8Ozt7igIxwIJ2gJ+seFMnDoIyEUV+dHT0G3qWVUr5M043DdAB0m2IKZwAYpgZX+qkywR6NFbuR0iDxmAoZRUQKRxSLTMnJ8eIaqqSeVMnIYUOdu+sq6vrp4f+VCoYo8khZaNs01VRlERUu2/BrWAA7sl2Anink1Ao18JGjyY/PDx8hq1GZqgp5c2mp6chMjLy2b179x7hRzvoqeUUwXIzqq4O5nZsNUaEbIbLqPLTou/s7FTvT05OpsA9sXJG1AVsZDwjutqBIN6gUlWjxod8XRBNKXgsrqpqYZfwEqX9h8TExD7wbFm8LmzxHQ0QHSlXKZVSqFC/hkqlaKapTaGgCQTK7PHW1lb/wsLC86KiokkccoV+qV1tcE0pO7AWxmhTxBszDzqRr66ujqanp2cRpQLNBgUsCh8BwQ54bn5+/s+mpqa+4eHhfS1gb52vwuP0trPjhSZCBtLQ0NA3MDDQQIFYAUHBYhuvzjpVbJr1lZWVP3p7e19UVVXNgHumXYrI4uBx6Yqevz02b0FcRQ8CoBQF3dXVpQLZ3d39C7n+ora29vfJyclDYFnWgFyxK3cxhss/+KoT/N6DVkQpKypFGUCp3Ozo6HgSHx//GLW/BwHsg57zl5pzADajwLn52mPL1ZHPloMoRYPMFL6EhAR18e7s7MxVV1fPsAAp4Avteq7dC/c1+wKI4g+EfGzDM+EYHBw8RDrNiA2QL6upqVGvKJ2/gHu2L1nA5wwEB2YDfSYMO1x/px0cgEc2zBY+eo67u6H29vZ/wU2VC8l58JxKNjDOgojNEp08aFVfX++3l6JMEdDx8fEB0FNIBsDXBc8ArwuW1EkeI1RKdLWmCx+1DhkZGRvR0dFfSsHKxYtnW0iqvJAN9xNm6MR/QO5sfapUSkqKmqW5ubmfwVgyZdpw/vPZl2kUEAinBMSUStG+gwra0NDQSynQKyloIxnlewafjDFLJzLRBJqiFMnqyMgIbG5uDuD996Dnv8iAPOMAPmbcm5lVJwA/vZRMKZGZlpaWVtAvUL4GZMqE1fjRJrUd76LHoX+InlhcXPwZnWW2tra6jjrpiBM3UK/weQr6J+gfodMh9HtwncG7YLA3CMSsLmxx5WuDCt8B7vZeicInTjCWlpb6wc15mfey7oc9E8LElpVmMgb9AXoC+qcTExOPKRu4NlTHs6Q10GfhgfYOvRsJQZ76BWMKuDtaolQs+gfoH6Mn436gDg+e+5BKXUQx/C5Je/a+NpbeiQJPKgUdlNXx/BCBKxVdxW5Q0I3XBqFKRhU4KLtjYawi3csuTKdc4FnIXNvKUJkVEGRG20QZAAUpA5DbaYAQLmQzfzxyk/ffdnCD4NWVnGdE7kQBQvQHC5lVEDxgMaM29lkxGCNLKrDnIbFAMkFmBIaDkHstU41coGZ1TZD5UjReCGUAYbNgdNqoXZB/T67yYbFAMiGML3BhYeH8rb0t9h/zgcTBcTNGiQAAAABJRU5ErkJggg==","to-bottom-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-bottom":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-top":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDIydi04bTAgMC0yIDJtMi0yIDIgMm0tNC02aDEybS02IDRoNm0tNiA0aDZtLTYgNGg2IiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","underline-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",underline:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","unlock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiMzMzgxRkYiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0xYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDN2MyIgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+",unlock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSI4IiBjeT0iOSIgcj0iMSIvPjxyZWN0IHN0cm9rZT0iIzQ0NEU2MCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB4PSIzIiB5PSI2IiB3aWR0aD0iMTAiIGhlaWdodD0iOCIgcng9IjIiLz48cGF0aCBkPSJtNS4yMDQgNC40NDcuMjYtLjk2NmEzIDMgMCAxIDEgNS43OTUgMS41NTNMMTEgNmgwTTggOXYzIiBzdHJva2U9IiM0NDRFNjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4="},oC=aC["eraser-cursor"],sC=Object.freeze({x:8,y:18}),cC=Object.freeze({width:26,height:26}),uC=function(){function e(t){var n=this;C(this,e),this.cursors=Object.freeze([]);var r=new Image;r.onload=function(){for(var e=[],t=0;t<1;++t)e[t]=null;for(var i=1;i<=36;++i)e[i]=n.createCursor(i,r);n.cursors=Object.freeze(e)},r.onerror=function(e){t.error(e)},r.src=oC}return P(e,[{key:"cursorStyle",value:function(e){var t=this.cursors[Math.min(Math.ceil(e),36)];if(t)return"url(".concat(t.url,") ").concat(t.centerX," ").concat(t.centerY,", auto")}},{key:"release",value:function(){var e,t=T(this.cursors);try{for(t.s();!(e=t.n()).done;){var n=e.value;n&&URL.revokeObjectURL(n.url)}}catch(e){t.e(e)}finally{t.f()}this.cursors=Object.freeze([])}},{key:"createCursor",value:function(e,t){var n=-e,r=-e,i=-sC.x,a=-sC.y,o=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;Number.MIN_SAFE_INTEGER;o=Math.min(o,n),o=Math.min(o,i),s=Math.min(s,r),s=Math.min(s,a),c=Math.max(c,n)+2*e,c=Math.max(c,i)+2*cC.width,Math.max(s,r);var u=-o,l=-s,h=c-o,d=Math.max(s,a)+2*cC.height-s;i+=u,a+=l;var p=document.createElement("canvas"),f=p.getContext("2d");return p.width=h,p.height=d,f.fillStyle="rgba(216,216,216,146)",f.beginPath(),f.ellipse(u,l,e,e,0,0,2*Math.PI),f.fill(),f.drawImage(t,i,a),Object.freeze({centerX:u,centerY:l,url:p.toDataURL("mycanvas")})}}]),e}(),lC=function(){function e(t){C(this,e),this.stackMap=new Map,this.stackIndexMap=new Map,this.currentScenePath="/",this.index=0,this.textareaExtraStep=0,this.execute=t.execute,this.onCanUndoStepsUpdate=t.onCanUndoStepsUpdate,this.onCanRedoStepsUpdate=t.onCanRedoStepsUpdate}return P(e,[{key:"canUndoSteps",get:function(){return this.stack.length-this.index+this.textareaExtraStep}},{key:"canRedoSteps",get:function(){return this.index}},{key:"stack",get:function(){var e=this.stackMap.get(this.currentScenePath);return e||(e=[],this.stackMap.set(this.currentScenePath,e)),e}},{key:"commit",value:function(e){var t=this.stack,n=this.canUndoSteps,r=this.canRedoSteps;for(t.splice(0,this.index,bs(e)),this.index=0;t.length>20;)t.pop();var i=this.canUndoSteps,a=this.canRedoSteps;i!==n&&this.onCanUndoStepsUpdate(i),a!==r&&this.onCanRedoStepsUpdate(a)}},{key:"undo",value:function(e,t){var n=this.stack[this.index];n&&(this.index+=1,this.textareaExtraStep=0,this.execute(this.replacePath(n.undo,e),t),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"redo",value:function(e,t){this.index>0&&(this.index-=1,this.textareaExtraStep=0,this.execute(this.replacePath(this.stack[this.index].redo,e),t),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"onTextareaUpdate",value:function(e){this.textareaExtraStep=e?1:0,this.onCanUndoStepsUpdate(this.canUndoSteps)}},{key:"replacePath",value:function(e,t){var n=e;if(t){var r=Xx.parse(t);for(var i in n=bs(n)){var a=n[i];void 0!==a.path&&(a.path=r)}}return n}}]),e}(),hC=function(){function e(t){C(this,e),this.map={},this.savingQueue=[],this.hangQueue=[],this._count=0,this.maxCount=t.maxSavingCount+t.keepCountAfterRelease,this.keepCountAfterRelease=t.keepCountAfterRelease,this.onRelease=t.onRelease}return P(e,[{key:"count",get:function(){return this._count}},{key:"getValue",value:function(e){var t=this.map[e];if(t)return this.pushToTail(this.savingQueue,e),this.pushToTail(this.hangQueue,e),t}},{key:"save",value:function(e,t){this._count>=this.maxCount&&this.removeOne(),this._count+=1,this.map[e]=t,this.savingQueue.push({key:e,target:t})}},{key:"release",value:function(e){var t=this.map[e];if(t){var n=this.savingQueue.findIndex((function(t){return t.key===e}));-1!==n&&(this.savingQueue.splice(n,1),this.hangTarget(e,t))}}},{key:"removeOne",value:function(){if(this.hangQueue.length>0){var e=this.hangQueue.shift().key;this.finalReleaseTarget(e)}else{var t=this.savingQueue.shift().key;this.finalReleaseTarget(t)}}},{key:"hangTarget",value:function(e,t){if(this.keepCountAfterRelease>0){if(this.hangQueue.length>=this.keepCountAfterRelease){var n=this.hangQueue.shift().key;this.finalReleaseTarget(n)}this.hangQueue.push({key:e,target:t})}else this.finalReleaseTarget(e)}},{key:"finalReleaseTarget",value:function(e){var t,n=this.map[e];delete this.map[e],this._count-=1,null==(t=this.onRelease)||t.call(this,n)}},{key:"pushToTail",value:function(e,t){var n=e.findIndex((function(e){return e.key===t}));if(-1!==n&&n!==e.length-1){var r=l(e.splice(n,1),1)[0];e.push(r)}}}]),e}(),dC=function(){function e(t,n){var r=this;C(this,e),this.getNode=function(e){var t=r.nodes.getValue(e);return t||(t=r.createNode(e),r.nodes.save(e,t)),t},this.releaseNode=function(e){e.refsCount<=0&&r.nodes.release(e.identifier)},this.execute=n,this.nodes=new hC({maxSavingCount:4,keepCountAfterRelease:Math.max(0,t),onRelease:function(e){for(var t=0,n=p(e.watcherDisposers);t<n.length;t++){(0,n[t])()}}})}return P(e,[{key:"createWatcher",value:function(e,t){return new pC(this.getNode(e),this.getNode,this.releaseNode,t)}},{key:"createNode",value:function(e){var t=[],n=[];return{identifier:e,stack:new lC({execute:this.execute,onCanRedoStepsUpdate:function(e){var n,r=T(t);try{for(r.s();!(n=r.n()).done;){(0,n.value)(e)}}catch(e){r.e(e)}finally{r.f()}},onCanUndoStepsUpdate:function(e){var t,r=T(n);try{for(r.s();!(t=r.n()).done;){(0,t.value)(e)}}catch(e){r.e(e)}finally{r.f()}}}),redoUpdaters:t,undoUpdaters:n,watcherDisposers:[],refsCount:0}}}]),e}();dC.watchMaxCount=15;var pC=function(e){g(n,e);var t=b(n);function n(e,r,i,a){var o;return C(this,n),(o=t.call(this,a)).didStop=!1,o.stop=function(){o.didStop||(o.didStop=!0,o.unlink())},o.onCanUndoStepsUpdate=function(e){o.dispatch("onCanUndoStepsUpdate",(function(t){return t(e)}))},o.onCanRedoStepsUpdate=function(e){o.dispatch("onCanRedoStepsUpdate",(function(t){return t(e)}))},o.link(e),o.getNode=r,o.releaseNode=i,o}return P(n,[{key:"watch",value:function(e){if(this.didStop)throw new Error("watcher did stop");if(this.identifier!==e){var t=this.canRedoSteps,n=this.canUndoSteps;this.unlink(),this.link(this.getNode(e));var r=this.canRedoSteps,i=this.canUndoSteps;t!==r&&this.dispatch("onCanRedoStepsUpdate",(function(e){return e(r)})),n!==i&&this.dispatch("onCanUndoStepsUpdate",(function(e){return e(i)}))}}},{key:"identifier",get:function(){return this.node.identifier}},{key:"canRedoSteps",get:function(){return this.node.stack.canRedoSteps}},{key:"canUndoSteps",get:function(){return this.node.stack.canUndoSteps}},{key:"stack",get:function(){return this.node.stack}},{key:"link",value:function(e){this.node=e,e.refsCount+=1,e.watcherDisposers.push(this.stop),e.undoUpdaters.push(this.onCanUndoStepsUpdate),e.redoUpdaters.push(this.onCanRedoStepsUpdate)}},{key:"unlink",value:function(){n.arrayRemove(this.node.watcherDisposers,this.stop),n.arrayRemove(this.node.undoUpdaters,this.onCanUndoStepsUpdate),n.arrayRemove(this.node.redoUpdaters,this.onCanRedoStepsUpdate),this.node.refsCount-=1,this.releaseNode(this.node)}}],[{key:"arrayRemove",value:function(e,t){var n=e.indexOf(t);return-1!==n&&(e.splice(n,1),!0)}}]),n}(Vx),fC=function(){function e(){C(this,e),this.creators={},this.waitingTouchCount=0}return P(e,[{key:"reportState",value:function(t,n,r){var i,a=e.shadowRefs[t];if(a){var o,s=n&&!r,c=null,u=T(a);try{for(u.s();!(o=u.n()).done;){var l=o.value;l.isWaitingTouch!==s&&(s?(this.waitingTouchCount+=1,c=l.ref):this.waitingTouchCount-=1,l.isWaitingTouch=s)}}catch(e){u.e(e)}finally{u.f()}null==(i=this.onWaitingTouchRefChanged)||i.call(this,c,this.waitingTouchCount)}}},{key:"registerShadowRef",value:function(t,n){var r=e.shadowRefs[t];r?-1===r.findIndex((function(e){return e.ref===n}))&&r.push({ref:n,isWaitingTouch:!1}):e.shadowRefs[t]=[{ref:n,isWaitingTouch:!1}]}},{key:"unregisterShadowRef",value:function(t,n){var r=e.shadowRefs[t];if(r){var i=r.findIndex((function(e){return e.ref===n}));if(-1!==i)l(r.splice(i,1),1)[0].isWaitingTouch&&(this.waitingTouchCount-=1),0===r.length&&delete e.shadowRefs[t]}}},{key:"addTextareaRectGetter",value:function(e,t){this.creators[e]=t}},{key:"removeTextareaRectGetter",value:function(e){delete this.creators[e]}},{key:"getTextareaSizeMap",value:function(e){var t={};for(var n in this.creators){var r=this.creators[n](e,!0);r&&(t[n]=r)}return t}},{key:"getTextareaRect",value:function(e,t,n){var r=null,i=this.creators[e];return i&&(r=i(t,!1,n)),r}},{key:"forEachShadowRefs",value:function(t,n){var r=e.shadowRefs[t];if(r){var i,a=T(r);try{for(a.s();!(i=a.n()).done;){n(i.value.ref)}}catch(e){a.e(e)}finally{a.f()}}}}]),e}(),vC=fC;vC.shadowRefs={};var mC,gC,yC,bC,kC=Y(n(68949)),wC=function(){function e(){var t=this;C(this,e),this.mainView=null,this._cameraState={centerX:0,centerY:0,scale:1,width:0,height:0},this.onSizeUpdated=function(e){(e.width!==t._cameraState.width||e.height!==t._cameraState.height)&&(t._cameraState=Object.freeze(W(W({},t._cameraState),e)))},this.onCameraUpdated=function(e){(e.centerX!==t._cameraState.centerX||e.centerY!==t._cameraState.centerY||e.scale!==t._cameraState.scale)&&(t._cameraState=Object.freeze(W(W({},t._cameraState),e)))},(0,kC.makeObservable)(this,{_cameraState:kC.observable,onSizeUpdated:kC.action,onCameraUpdated:kC.action})}return P(e,[{key:"cameraState",get:function(){return this._cameraState}},{key:"setupMainView",value:function(e){this.releaseMainView(),this.mainView=e,e.callbacks.on("onSizeUpdated",this.onSizeUpdated),e.callbacks.on("onCameraUpdated",this.onCameraUpdated)}},{key:"releaseMainView",value:function(){this.mainView&&(this.mainView.callbacks.off("onSizeUpdated",this.onSizeUpdated),this.mainView.callbacks.off("onCameraUpdated",this.onCameraUpdated),this.mainView=null)}},{key:"dispose",value:function(){this.releaseMainView()}}]),e}();function SC(e){return new CC(e)}!function(e){e.Dynamic="dynamic",e.Static="static"}(mC||(mC={})),function(e){e.Waiting="Waiting",e.Converting="Converting"}(gC||(gC={})),(bC=yC||(yC={})).Extracting="Extracting",bC.Packaging="Packaging",bC.GeneratingPreview="GeneratingPreview",bC.MediaTranscode="MediaTranscode";var xC=function(){function e(t){C(this,e),this.pptPromise=null,this.uuid=t.uuid,this.region=t.region||yx.defaultRegion,this.kind=t.kind,this.taskToken=t.taskToken,this.checkProgressInterval=t.checkProgressInterval||e.defaultCheckProgressInterval,this.checkProgressTimeout=t.checkProgressTimeout||e.defaultCheckProgressTimeout,this.callbacks=new Vx(t.callbacks)}var t,n;return P(e,[{key:"checkUtilGet",value:function(){var e=this;return this.pptPromise||(this.pptPromise=this.getPPTResult(),this.pptPromise.then((function(t){e.callbacks.dispatch("onTaskSuccess",(function(e){return e(t)}))})).catch((function(t){e.callbacks.dispatch("onTaskFail",(function(e){return e(t)}))}))),this.pptPromise}},{key:"getPPTResult",value:(n=u(regeneratorRuntime.mark((function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=Date.now(),r=regeneratorRuntime.mark((function e(){var r,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),e.next=3,a.fetchProgress(a.uuid,a.kind,a.taskToken);case 3:i=e.sent,e.t0=i.status,e.next="Waiting"===e.t0||"Converting"===e.t0?7:"Finished"===e.t0?9:"Fail"===e.t0?10:11;break;case 7:return a.updateProgress(i),e.abrupt("break",11);case 9:return e.abrupt("return",{v:(t||a.updateProgress(i),a.toPPT(i))});case 10:throw new Error(i.failedReason);case 11:if(!((o=r+a.checkProgressInterval)>=n+a.checkProgressTimeout)){e.next=14;break}throw new Error("timeout");case 14:if(100===i.progress.convertedPercentage&&(t=!0),s=o-Date.now(),e.t1=s>0,!e.t1){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,s)}));case 20:case"end":return e.stop()}}),e)}));case 2:return e.delegateYield(r(),"t0",3);case 3:if("object"!==M(i=e.t0)){e.next=6;break}return e.abrupt("return",i.v);case 6:e.next=2;break;case 8:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"updateProgress",value:function(e){var t=Object.freeze({status:e.status,currentStep:e.progress.currentStep,totalPageSize:e.progress.totalPageSize,convertedPageSize:e.progress.convertedPageSize,convertedPercentage:e.progress.convertedPercentage});this.callbacks.dispatch("onProgressUpdated",(function(e){return e(t)}))}},{key:"toPPT",value:function(e){for(var t=e.progress.convertedFileList,n=[],r=0,i=0,a=0;a<t.length;++a){var o=t[a],s={name:"".concat(a+1),ppt:{src:o.conversionFileUrl,previewURL:o.preview,width:o.width,height:o.height}};r=Math.max(r,o.width),i=Math.max(i,o.height),n.push(s)}return{uuid:this.uuid,kind:this.kind,width:r,height:i,scenes:n}}},{key:"fetchProgress",value:(t=u(regeneratorRuntime.mark((function t(n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a="http://ppt-api/v5/services/conversion/tasks/".concat(n),o=(0,zx.stringify)({type:r}),t.next=4,e.apiFetch(a+"?"+o,{method:"get",headers:{"content-type":"application/json",token:i,region:this.region}});case 4:if(200===(s=t.sent).status){t.next=10;break}return t.next=8,s.json();case 8:throw c=t.sent,new Error(c.error.title);case 10:return t.next=12,s.json();case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),CC=xC;CC.apiFetch=Bx.fetch("api"),CC.defaultCheckProgressInterval=1500,CC.defaultCheckProgressTimeout=3e5;var IC=Y(n(17563)),PC=function(){function e(t){C(this,e),this.roomToken=t}var t,n,r,i;return P(e,[{key:"convert",value:(i=u(regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.createPPTTask(n);case 2:return r=t.sent,t.next=5,this.checkUtilHasResult(r,n);case 5:return i=t.sent,t.abrupt("return",e.wrapPPTDescriptions(r,n.kind,i));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"createPPTTask",value:(r=u(regeneratorRuntime.mark((function t(n){var r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.prefix+"/services/conversion/tasks",i=(0,IC.stringify)({roomToken:this.roomToken}),t.next=4,fetch(r+"?"+i,{method:"post",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({sourceUrl:n.url,serviceType:e.convertPPTKindToServiceType(n.kind)})});case 4:if(200===(a=t.sent).status){t.next=13;break}return t.t0=Error,t.t1="failed to convert ".concat(JSON.stringify(n.url)," with status ").concat(a.status," message:"),t.next=10,a.text();case 10:throw t.t2=t.sent,t.t3=t.t1.concat.call(t.t1,t.t2),new t.t0(t.t3);case 13:return t.next=15,a.json();case 15:if(o=t.sent,s=o.msg,c=s.succeed,u=s.reason,l=s.taskUUID,c){t.next=22;break}throw new Error("create ppt task failed: "+u);case 22:return t.abrupt("return",l);case 23:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"checkUtilHasResult",value:(n=u(regeneratorRuntime.mark((function t(n,r){var i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=!1,a=Date.now(),o=r.checkProgressInterval||e.defaultCheckProgressInterval,s=r.checkProgressTimeout||e.defaultCheckProgressTimeout,c=regeneratorRuntime.mark((function e(){var t,c,u,h,d,p,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),e.next=3,l.fetchProgress(n,r.kind);case 3:c=e.sent,e.t0=c.convertStatus,e.next="Finished"===e.t0?7:"Fail"===e.t0||"NotFound"===e.t0?8:9;break;case 7:return e.abrupt("return",{v:(r.onProgressUpdated&&!i&&r.onProgressUpdated(1),c.convertedFileList.map((function(e){return{width:e.width,height:e.height,src:c.prefix+e.conversionFileUrl}})))});case 8:throw new Error("failed to convert ".concat(JSON.stringify(r.url),": ").concat(c.reason));case 9:if(u=c.totalPageSize,h=c.convertedPercentage,d=0===u?0:h/100,!((p=t+o)>=a+s)){e.next=12;break}throw new Error("failed to convert ".concat(JSON.stringify(r.url),": timeout"));case 12:if(r.onProgressUpdated&&r.onProgressUpdated(d),1===d&&(i=!0),f=p-Date.now(),e.t1=f>0,!e.t1){e.next=18;break}return e.next=18,new Promise((function(e){return setTimeout(e,f)}));case 18:case"end":return e.stop()}}),e)}));case 2:return t.delegateYield(c(),"t0",3);case 3:if("object"!==M(u=t.t0)){t.next=6;break}return t.abrupt("return",u.v);case 6:t.next=2;break;case 8:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchProgress",value:(t=u(regeneratorRuntime.mark((function t(n,r){var i,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i="".concat(e.prefix,"/services/conversion/tasks/").concat(n,"/progress"),a=(0,IC.stringify)({roomToken:this.roomToken,serviceType:e.convertPPTKindToServiceType(r)}),t.next=4,fetch(i+"?"+a,{headers:{"content-type":"application/json",Accept:"application/json"}});case 4:if(200===(o=t.sent).status){t.next=7;break}throw new Error("failed to fetch progress of ".concat(JSON.stringify(i)));case 7:return t.next=9,o.json();case 9:return t.abrupt("return",t.sent.msg.task);case 10:case"end":return t.stop()}}),t,this)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"wrapPPTDescriptions",value:function(e,t,n){for(var r=[],i=[],a=0,o=0,s=0;s<n.length;++s){var c=n[s],u=c.src,l=c.width,h=c.height;r[s]=u,i[s]={name:"".concat(s+1),ppt:{src:u,width:l,height:h}},a=l,o=h}return{uuid:e,kind:t,width:a,height:o,slideURLs:r,scenes:i}}},{key:"convertPPTKindToServiceType",value:function(e){switch(e){case mC.Dynamic:return"dynamic_conversion";case mC.Static:return"static_conversion";default:throw new Error("invalid kind ".concat(JSON.stringify(e)))}}}]),e}(),MC=PC;MC.prefix="https://console-api.netless.link",MC.defaultCheckProgressInterval=1500,MC.defaultCheckProgressTimeout=3e5;var TC=Y(n(67294)),AC=Y(n(67294)),EC=Y(n(68949)),OC=Y(n(67294)),RC=Y(n(67294));function NC(e){return aC[e]}var LC=Y(n(67294)),jC=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).didUnmount=!1,r.onMouseDown=function(e){if(0===e.button){r.setState({isPressed:!0});document.body.addEventListener("mouseup",(function e(t){0===t.button&&(document.body.removeEventListener("mouseup",e),r.didUnmount||r.setState({isPressed:!1}))}))}},r.state={isHover:!1,isPressed:!1},r}return P(n,[{key:"componentWillUnmount",value:function(){this.didUnmount=!0}},{key:"render",value:function(){var e=this,t=this.props.className;t=void 0!==t?"button "+t:"button",this.props.disable&&(t+=" disable");var n=this.props.refObject;return LC.createElement("div",{className:t,ref:n,onMouseEnter:function(){return e.setState({isHover:!0})},onMouseLeave:function(){return e.setState({isHover:!1})},onMouseDown:this.onMouseDown,onTouchEnd:this.props.onClick,onClick:this.props.onClick},this.props.children)}}]),n}(LC.Component),DC=Y(n(67294)),FC=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).divRef=DC.createRef(),r.onMouseDown=function(e){var t=r.divRef.current,i=e.target;t&&!n.isEventFiredOnElement(i,t)&&(0,r.props.onShouldBecomeHide)(i)},document.body.addEventListener("mousedown",r.onMouseDown),r}return P(n,[{key:"componentWillUnmount",value:function(){document.body.removeEventListener("mousedown",this.onMouseDown)}},{key:"render",value:function(){var e=H(W({},this.props),{ref:this.divRef});delete e.onShouldBecomeHide;var t=e.children;return DC.createElement("div",W({},e),t)}}],[{key:"isEventFiredOnElement",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}}]),n}(DC.Component);function zC(e){var t=Math.floor(e);return e>=t+.5&&(t+=1),t}var BC=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).inputRef=RC.createRef(),r.upArrowButton=Object.freeze({iconName:"arrow-up",isUp:!0,ref:RC.createRef()}),r.downArrowButton=Object.freeze({iconName:"arrow-down",isUp:!1,ref:RC.createRef()}),r.onFocusInput=function(){var e=r.inputRef.current;e&&(e.type="text",e.setSelectionRange(0,e.value.length),e.type="number",r.setState({isFocusInput:!0}))},r.onShouldBecomeHide=function(e){var t=r.inputRef.current,n=r.upArrowButton.ref.current,i=r.downArrowButton.ref.current;t&&n&&i&&!FC.isEventFiredOnElement(e,n)&&!FC.isEventFiredOnElement(e,i)&&r.commitFontSizeWithString(t.value)},r.onPressKeyInput=function(e){"Enter"===e.key&&r.commitFontSizeWithString(e.target.value)},r.state={overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1},r}return P(n,[{key:"onSelectFontSize",value:function(e){this.commitFontSizeWithInt(e),this.setState({overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1})}},{key:"getFontSize",value:function(){var e,t,n=T(this.props.components);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=zC(r.currentScale*r.textSize);if(void 0===e)e=i;else if(e!==i){e=void 0;break}}}catch(e){n.e(e)}finally{n.f()}return e}},{key:"shouldUpdateFontSize",value:function(e){var t,n=T(this.props.components);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.currentScale*r.textSize!==e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"commitFontSizeWithString",value:function(e){var t,n=Number.parseFloat(e);Number.isNaN(n)||(n=zC(n),n=Math.max(n,BC.minFontSize),n=Math.min(n,BC.maxFontSize),this.commitFontSizeWithInt(n),null==(t=this.inputRef.current)||t.blur(),this.setState({overrideFontSize:void 0,isFocusInput:!1,hoverIndex:void 0}))}},{key:"commitFontSizeWithInt",value:function(e){if(this.shouldUpdateFontSize(e)){var t=this.props,n=t.viewMovingState,r=t.delegate;n.maskHideFloatBarSometime(),r.updateTextareaFontSize(e)}}},{key:"renderMenu",value:function(e){var t=this,n=this.inputRef.current;if(!n)return null;var r,i=BC,a=i.menuMargin,o=i.menuSize,s=o.width,c=o.height,u=this.props.isMenuToDown,l=n.offsetLeft+(n.offsetWidth-s)/2;return r=u?n.offsetTop+n.offsetHeight+a:n.offsetTop-a-c,RC.createElement(FC,{className:"font-size-menu",style:{left:l,top:r,width:s,height:c},onMouseLeave:function(){return t.setState({hoverIndex:void 0})},onShouldBecomeHide:this.onShouldBecomeHide},this.renderFontSizeList(e))}},{key:"renderFontSizeList",value:function(e){for(var t=this,n=parseInt(e,10),r=BC.fontSizeList,i=[],a=function(e){var a=r[e],o=null,s="cell";n===a&&(o=RC.createElement("img",{className:"check",alt:"check",src:NC("check")}));var c=t.state.hoverIndex;e===c&&(s+=" hover"),i.push(RC.createElement("div",{key:"".concat(e),className:s,onMouseEnter:function(){return t.setState({hoverIndex:e})},onClick:function(){return t.onSelectFontSize(a)}},o&&RC.createElement("div",{className:"check"}),RC.createElement("span",null,a),o))},o=0;o<r.length;++o)a(o);return i}},{key:"renderArrowButton",value:function(e,t){var n,r=this,i=Number.parseFloat(e),a=BC.fontSizeList;if(!Number.isNaN(i))if(t.isUp)for(var o=0;o<a.length;++o){var s=a[o];if(s>i){n=s;break}}else for(var c=a.length-1;c>=0;--c){var u=a[c];if(u<i){n=u;break}}var l=t.iconName;return RC.createElement(jC,{className:"arrow-button "+(t.isUp?"up":"down"),disable:void 0===n,refObject:t.ref,onClick:function(){void 0!==n&&(r.props.viewMovingState.maskHideFloatBarSometime(),r.commitFontSizeWithInt(n),r.setState({overrideFontSize:void 0,hoverIndex:void 0}))}},RC.createElement("img",{alt:"icon",src:NC(l)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.overrideFontSize,r=t.isFocusInput,i=n;if(void 0===i){var a=this.getFontSize();i=void 0===a?"":"".concat(a)}return RC.createElement(RC.Fragment,{key:"font-size"},RC.createElement("div",{className:"decorator"},RC.createElement("img",{className:"font-size-icon",alt:"icon",src:NC(r?"font-size-active":"font-size")})),RC.createElement("input",{className:"font-size-input",type:"number",value:i,ref:this.inputRef,onFocus:this.onFocusInput,onKeyUp:this.onPressKeyInput,onChange:function(t){return e.setState({overrideFontSize:t.target.value})}}),r&&this.renderMenu(i),RC.createElement("div",{className:"decorator"},RC.createElement("div",{className:"font-size-buttons"},this.renderArrowButton(i,this.upArrowButton),this.renderArrowButton(i,this.downArrowButton))))}}]),n}(RC.Component);BC.minFontSize=1,BC.maxFontSize=999,BC.fontSizeList=Object.freeze([12,14,18,24,36,48,64,80,144,288]),BC.menuMargin=21,BC.menuSize=Object.freeze({width:64,height:248}),BC=X([Hf],BC);var UC=Y(n(67294));function VC(e,t){var n=e.viewMovingState,r=e.components,i=e.colors;return{width:40,height:40,node:function(e,a,o,s,c,u){var l=a+s/2<=u/2;return UC.createElement(HC,{key:"font-colors",viewMovingState:n,colors:i,components:r,parentWidth:o,parentHeight:s,isMenuToDown:l,onUpdateColor:t})}}}function WC(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}var HC=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).onClickDisplayButton=function(){r.state.isDisplayMenu||r.setState({isDisplayMenu:!0})},r.state={isDisplayMenu:!1},r}return P(n,[{key:"onClickColorButton",value:function(e){var t=p(e);(0,this.props.onUpdateColor)(t),this.setState({isDisplayMenu:!1})}},{key:"getSelectedColor",value:function(){var e,t=null,n=T(this.props.components);try{for(n.s();!(e=n.n()).done;){var r=e.value.color;if(r)if(t){if(!WC(t,r)){t=null;break}}else t=r}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"renderMenu",value:function(e){var t,n=this,r=this.props,i=r.isMenuToDown,a=r.colors,o=r.parentWidth,s=r.parentHeight,c=Math.ceil(a.length/HC.menuLineCellsCount),u=Math.min(a.length,HC.menuLineCellsCount)*HC.menuCellSize.width+2*HC.menuPadding,l=c*HC.menuCellSize.height+2*HC.menuPadding,h=HC.menuMargin,d=o-u;return t=i?s+h:-(h+l),UC.createElement(FC,{className:"font-colors-menu",style:{left:d,top:t,width:u,height:l},onShouldBecomeHide:function(){return n.setState({isDisplayMenu:!1})}},this.renderColorButtons(e))}},{key:"renderColorButtons",value:function(e){for(var t=this,n=this.props.colors,r=[],i=function(i){var a=n[i],o="rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"),s="font-color-button";e&&WC(e,a)?s+=" font-color-selected":s+=" font-color-not-selected",r.push(UC.createElement("div",{key:"".concat(i),className:s,onTouchEnd:function(){return t.onClickColorButton(a)},onClick:function(){return t.onClickColorButton(a)}},UC.createElement("div",{className:"core",style:{backgroundColor:o}})))},a=0;a<n.length;++a)i(a);return r}},{key:"render",value:function(){var e=this.getSelectedColor(),t=e&&UC.createElement("div",{className:"bar",style:{backgroundColor:"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")")}}),n=this.state.isDisplayMenu,r=n?"font-colors-active":"font-colors";return UC.createElement(UC.Fragment,null,UC.createElement(jC,{className:"normal-button",onClick:this.onClickDisplayButton},UC.createElement("div",{className:"font-colors-icon"},UC.createElement("img",{alt:"icon",src:NC(r)}),t)),n&&this.renderMenu(e))}}]),n}(UC.Component);HC.menuMargin=8,HC.menuPadding=8,HC.menuLineCellsCount=4,HC.menuCellSize=Object.freeze({width:28,height:28}),HC=X([Hf],HC);var _C=Y(n(67294));function GC(e){var t=e.delegate;return{width:40,height:40,node:function(e,n,r,i,a,o){var s=n+i/2<=o/2;return _C.createElement(YC,{key:"image-layer-button",isMenuToDown:s,delegate:t})}}}var YC=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).buttonRef=_C.createRef(),r.state={isDisplayMenu:!1},r}return P(n,[{key:"renderMenu",value:function(){var e=this,t=this.buttonRef.current;if(!t)return null;var n,r=YC.menuSize,i=r.width,a=r.height,o=YC.menuMargin,s=this.props,c=s.isMenuToDown,u=s.delegate,l=t.offsetLeft+(t.offsetWidth-i)/2;return n=c?t.offsetTop+t.offsetHeight+o:t.offsetTop-o-a,_C.createElement(FC,{className:"image-layer-menu",style:{left:l,top:n,width:i,height:a},onShouldBecomeHide:function(){return e.setState({isDisplayMenu:!1})}},_C.createElement(jC,{key:"layer-unlock",className:"normal-button",onClick:function(){return u.moveSelectedComponentsToTop()}},_C.createElement("img",{alt:"icon",src:NC("to-top")})),_C.createElement(jC,{key:"layer-lock",className:"normal-button",onClick:function(){return u.moveSelectedComponentsToBottom()}},_C.createElement("img",{alt:"icon",src:NC("to-bottom")})))}},{key:"render",value:function(){var e=this,t=this.state.isDisplayMenu,n=t?"layer-pressed":"layer";return _C.createElement(_C.Fragment,null,_C.createElement(jC,{key:"layer",className:"normal-button ".concat(t?"highlight-button":""),refObject:this.buttonRef,onClick:function(){return e.setState({isDisplayMenu:!t})}},_C.createElement("img",{alt:"icon",src:NC(n)})),t&&this.renderMenu())}}]),n}(_C.Component);YC.menuMargin=21,YC.menuSize=Object.freeze({width:72,height:40}),YC=X([Hf],YC);var XC=Object.freeze({top:12,bottom:24,left:12,right:12}),QC=Object.freeze({top:1,bottom:1,left:1,right:1});function KC(e){var t=e.whiteModel,n=t.BezierCurveShape,r=t.ImageShape,i=t.TextareaShape,a=[],o=e.components;if(0===o.length)return a;var s,c=0,u=0,l=0,h=!0,d=!0,p=!0,f=!0,v=!0,m=T(o);try{for(m.s();!(s=m.n()).done;){var g=s.value;if(ms(g,n))c+=1;else if(ms(g,r))u+=1;else if(ms(g,i)){var y=g.format;y.bold||(d=!1),y.italic||(p=!1),y.underline||(f=!1),y.lineThrough||(v=!1),l+=1}g.locked||(h=!1)}}catch(e){m.e(e)}finally{m.f()}var b=40,k=40;if(c===o.length){var w=e.delegate;a.push({width:b,height:k,node:function(){return qC(e)}}),a.push(GC(e)),a.push({width:b,height:k,node:function(){return ZC(e)}}),a.push(VC(e,(function(e){return w.updatePencilColor(e)})))}else if(u===o.length)a.push({width:b,height:k,node:function(){return qC(e)}}),a.push({width:b,height:k,node:function(){return function(e,t){var n=e.delegate,r=!t;return OC.createElement(jC,{key:"lock",className:"normal-button",onClick:function(){return n.lockImages(r)}},OC.createElement("img",{alt:"lock",src:NC(t?"unlock-new":"lock-new")}))}(e,h)}}),h||a.push(GC(e)),a.push({width:b,height:k,node:function(){return ZC(e)}});else if(l===o.length){var S=e.delegate;a.push({width:b,height:k,node:function(){return qC(e)}}),a.push({width:b,height:k,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return OC.createElement(jC,{key:"text-blob",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({bold:i})}},OC.createElement("img",{alt:"text-blob",src:NC(t?"bold-active":"bold")}))}(e,d)}}),a.push({width:b,height:k,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return OC.createElement(jC,{key:"text-italic",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({italic:i})}},OC.createElement("img",{alt:"text-italic",src:NC(t?"italic-active":"italic")}))}(e,p)}}),a.push({width:b,height:k,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return OC.createElement(jC,{key:"text-line-through",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({lineThrough:i})}},OC.createElement("img",{alt:"text-line-through",src:NC(t?"line-through-active":"line-through")}))}(e,v)}}),a.push({width:b,height:k,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return OC.createElement(jC,{key:"text-underline",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({underline:i})}},OC.createElement("img",{alt:"text-underline",src:NC(t?"underline-active":"underline")}))}(e,f)}}),a.push(function(e){var t=e.viewMovingState,n=e.delegate,r=e.components;return{width:95,height:40,node:function(e,i,a,o,s,c){var u=i+o/2<=c/2;return RC.createElement(BC,{key:"font-size",delegate:n,viewMovingState:t,components:r,isMenuToDown:u})}}}(e)),a.push(VC(e,(function(e){return S.updateTextareaFormat({color:e})})))}return a}function qC(e){var t=e.delegate,n=e.isEditTextarea;return OC.createElement(jC,{key:"delete",className:"normal-button",onClick:function(){return t.delete()},disable:n},OC.createElement("img",{alt:"delete",src:NC("delete")}))}function ZC(e){var t=e.delegate;return OC.createElement(jC,{key:"duplicate",className:"normal-button",onClick:function(){return t.duplicate()}},OC.createElement("img",{alt:"duplicate",src:NC("duplicate")}))}var JC=Y(n(68949));function $C(e,t){return Math.abs(e-t)<=.01}var eI,tI,nI=function(){function e(t){var n=this;C(this,e),this.latestCallMaskTimestamp=0,this.timer=null,this._shouldHideFloatBar=!1,this.onAfterMoving=function(){n._shouldHideFloatBar&&(n._shouldHideFloatBar=!1),n.timer=null},this.rectangle=t,(0,JC.makeObservable)(this,{_shouldHideFloatBar:JC.observable,setState:JC.action,release:JC.action})}return P(e,[{key:"shouldHideFloatBar",get:function(){return this._shouldHideFloatBar}},{key:"setState",value:function(t,n){var r=this,i=this.rectangle,a=!$C(i.originX,t.originX)||!$C(i.originY,t.originY),o=!$C(i.width,t.width)||!$C(i.height,t.height);(a||!n&&o)&&(!this._shouldHideFloatBar&&Date.now()>=this.latestCallMaskTimestamp+e.maskDuration&&(this._shouldHideFloatBar=!0),null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){return(0,JC.runInAction)(r.onAfterMoving)}),e.cameraTouchInterval)),(a||o)&&(this.rectangle=t)}},{key:"maskHideFloatBarSometime",value:function(){this.latestCallMaskTimestamp=Date.now()}},{key:"release",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null,this._shouldHideFloatBar=!1)}}]),e}(),rI=nI;rI.cameraTouchInterval=300,rI.maskDuration=100,(tI=eI||(eI={}))[tI.Top=0]="Top",tI[tI.Bottom=1]="Bottom",tI[tI.Left=2]="Left",tI[tI.Right=3]="Right",tI[tI.Center=4]="Center";var iI=function(e){g(n,e);var t=b(n);function n(e){var r;return C(this,n),(r=t.call(this,e)).lockView=function(e){r.setState({lockedPosition:e})},r.state={lockedPosition:void 0},r.viewMovingState=new rI(e.rectangle),r}return P(n,[{key:"componentDidMount",value:function(){var e=this,t=!0;this.disposer=(0,EC.autorun)((function(){e.viewMovingState.shouldHideFloatBar?t||(e.unlockView(),t=!0):t=!1}))}},{key:"componentDidUpdate",value:function(){var e=this.props.rectangle;this.viewMovingState.setState(e,this.isEditTextarea())}},{key:"componentWillUnmount",value:function(){var e;this.viewMovingState.release(),null==(e=this.disposer)||e.call(this)}},{key:"isEditTextarea",value:function(){var e,t=this.props,n=t.components,r=t.whiteModel.TextareaShape,i=T(n);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(ms(a,r)&&void 0!==a.editedBy)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"position",value:function(e,t){var n,r=e.originX,i=e.originY,a=r+e.width,o=i+e.height,s=QC.left+QC.right,c=QC.top+QC.bottom,u=0,l=T(t);try{for(l.s();!(n=l.n()).done;){var h=n.value,d=h.width,p=h.height;s+=d,u=Math.max(u,p)}}catch(e){l.e(e)}finally{l.f()}c+=u;var f=s+XC.left+XC.right,v=c+XC.top+XC.bottom,m=this.props.screenSize,g=m.width,y=m.height;return{left:r,right:a,top:i,bottom:o,position:i>=v?0:y-o>=v?1:r>=f?2:g-a>=f?3:4,boxWidth:s,boxHeight:c,width:f,height:v}}},{key:"centerXWithTopOrBottom",value:function(e,t){var n=Math.max(e.left,0),r=Math.min(e.right,t),i=e.width/2,a=(n+r)/2;return a-i<0?a=i:a+i>t&&(a=t-i),a}},{key:"unlockView",value:function(){this.setState({lockedPosition:void 0})}},{key:"render",value:function(){var e,t=this,n=this.props,r=n.whiteModel,i=n.components,a=n.screenSize,o=n.rectangle,s=n.view,c=n.cnode,u=n.room;if(!u||this.viewMovingState.shouldHideFloatBar)return null;e=s?s.floatBarDelegate:u.getMainViewIfExits().floatBarDelegate;var l=this.state.lockedPosition,h=KC({viewMovingState:this.viewMovingState,isEditTextarea:this.isEditTextarea(),whiteModel:r,components:i,delegate:e,colors:u.floatBarOptions.colors});if(h.length<=0)return null;var d,p,f=l||this.position(o,h),v=a.width,m=a.height;switch(f.position){case 0:d=this.centerXWithTopOrBottom(f,v),p=f.top-f.height/2;break;case 1:d=this.centerXWithTopOrBottom(f,v),p=f.bottom+f.height/2;break;case 2:d=f.left-f.width/2,p=Math.max(f.top,0)+f.height/2;break;case 3:d=f.right+f.width/2,p=Math.max(f.top,0)+f.height/2;break;case 4:d=(Math.max(f.left,0)+Math.min(f.right,v))/2,p=Math.max(f.top,0)+f.height/2}var g,y=d-f.width/2,b=p-f.height/2,k="translate(".concat(y,"px,").concat(b,"px)"),w=[],S=y,x=T(h);try{for(x.s();!(g=x.n()).done;){var C=g.value,I=C.width,P=(0,C.node)(S,b,f.boxWidth,f.boxHeight,v,m);w.push(P),S+=I}}catch(e){x.e(e)}finally{x.f()}return AC.createElement(Sh,{context:c,className:"float-bar",onMouseEnter:function(){return t.lockView(f)},style:{WebkitTransform:k,transform:k,width:f.boxWidth,height:f.boxHeight,padding:0,marginLeft:XC.left,marginRight:XC.right,marginTop:XC.top,marginBottom:XC.bottom}},w)}}],[{key:"willInterruptEvent",value:function(){return!0}}]),n}(AC.Component);function aI(e){return function(){return e}}function oI(){return sI(1)}function sI(e){return function(t,n){var r=t.width/n.width,i=t.height/n.height,a=Math.max(r,i)*e;return Number.isNaN(a)?1:a}}function cI(){return hI(1,0)}function uI(e){return hI(1,e)}function lI(e){return hI(e,0)}function hI(e,t){return function(n,r){var i=n.width/(r.width+2*t),a=n.height/(r.height+2*t),o=Math.min(i,a)*e;return Number.isNaN(o)||o===1/0?0:o}}iI=X([Hf],iI);var dI,pI=function(){function e(t,n){C(this,e),this._cameraBound=n,this.cameraman=t.bindCameraman(this.toCameraBorder(n),"device")}return P(e,[{key:"cameraBound",get:function(){return this._cameraBound}},{key:"setScreenSize",value:function(e){(!this.screenSize||this.screenSize.width!==e.width||this.screenSize.height!==e.height)&&(this.screenSize=e,this.setCameraBound({maxContentMode:this.maxContentMode,minContentMode:this.minContentMode}))}},{key:"setCameraBound",value:function(e){this._cameraBound=e,this.cameraman.setCameraBorder(this.toCameraBorder(e))}},{key:"toCameraBorder",value:function(e){var t=e.damping,n=e.centerX,r=e.centerY,i=e.width,a=e.height,o=this.boundSize(i,a);this.maxContentMode=e.maxContentMode,this.minContentMode=e.minContentMode;var s=1/0,c=0;return this.screenSize&&(this.maxContentMode&&(s=this.maxContentMode(this.screenSize,o)),this.minContentMode&&(c=this.minContentMode(this.screenSize,o))),function(e){for(var t in e)void 0===e[t]&&delete e[t];return e}({damping:t,centerX:n,centerY:r,width:i,height:a,maxScale:s,minScale:c})}},{key:"boundSize",value:function(e,t){return this.cameraman?{width:void 0===e?this.cameraman.cameraBorder.width:e,height:void 0===t?this.cameraman.cameraBorder.height:t}:{width:void 0===e?1/0:e,height:void 0===t?1/0:t}}}]),e}();!function(e){e.Triangle="triangle",e.Rhombus="rhombus",e.Pentagram="pentagram",e.SpeechBalloon="speechBalloon"}(dI||(dI={}));var fI,vI,mI,gI=Object.freeze(["currentApplianceName","strokeColor","strokeWidth","textColor","textSize","pencilEraserSize","bold","italic","underline","lineThrough","dottedLine","shapeType","textCanSelectText"]);(vI=fI||(fI={})).selector="selector",vI.clicker="clicker",vI.laserPointer="laserPointer",vI.pencil="pencil",vI.rectangle="rectangle",vI.ellipse="ellipse",vI.shape="shape",vI.eraser="eraser",vI.pencilEraser="pencilEraser",vI.text="text",vI.straight="straight",vI.arrow="arrow",vI.hand="hand",function(e){e.None="none",e.Dir="dir",e.Page="page",e.Conflict="conflict"}(mI||(mI={}));var yI=function(){function e(t,n){C(this,e),this.enableDrawPoint=t,this.disableNewPencil=n}return P(e,[{key:"becomeWritable",value:function(e){if(this.disableNewPencil){var t=e.getMemberState();if(t){var n=t.pencilOptions;n=n?H(W({},n),{disableBezier:!0}):{disableBezier:!0,enableDrawPoint:!1,sparseHump:3,sparseWidth:4},e.setMemberStateWithCommitter({pencilOptions:n})}}}},{key:"shouldUseNewPencil",value:function(e){return!this.disableNewPencil&&e===fI.pencil}}]),e}(),bI=function(){function e(t){var n=this;C(this,e),this.onLimiterInvoke=function(){if(n.nextInvoker)try{n.nextInvoker()}finally{n.nextInvoker=void 0}},this.limiter=new Ue(t,this.onLimiterInvoke)}return P(e,[{key:"limitDuration",get:function(){return this.limiter.limitDuration},set:function(e){this.limiter.limitDuration=e}},{key:"invoke",value:function(e){this.nextInvoker=e,this.limiter.invoke()}},{key:"flush",value:function(){this.nextInvoker&&this.onLimiterInvoke(),this.cancel()}},{key:"cancel",value:function(){this.nextInvoker=void 0,this.limiter.cancel()}}]),e}(),kI={};G(kI,{bezierMaxSegments:function(){return SI},bezierRenderGranularity:function(){return wI},fitCurveMaxError:function(){return xI}});var wI=4.5,SI=30,xI=1,CI=Object.freeze({x:0,y:0});function II(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function PI(e){return Math.pow(e.x,2)+Math.pow(e.y,2)}function MI(e,t){return{x:e.x+t.x,y:e.y+t.y}}function TI(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{x:t.reduce((function(e,t){return e+t.x}),0),y:t.reduce((function(e,t){return e+t.y}),0)}}function AI(e,t){return{x:e.x-t.x,y:e.y-t.y}}function EI(e,t){return{x:e.x*t,y:e.y*t}}function OI(e){var t=II(e);return 0===t?e:function(e,t){return{x:e.x/t,y:e.y/t}}(e,t)}function RI(e,t){return e.x*t.x+e.y*t.y}function NI(e,t){if(e.length<2)return[];var n=e.length;return LI(e,zI(e[1],e[0]),zI(e[n-2],e[n-1]),t)}function LI(e,t,n,r){if(2===e.length){var i=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}(e[0],e[1])/3;return[{curve:[e[0],MI(e[0],EI(t,i)),MI(e[1],EI(n,i)),e[1]],beginIndex:0,count:e.length}]}var a=function(e){var t,n,r,i=[];return e.forEach((function(e,a){t=a>0?n+II(AI(e,r)):0,i.push(t),n=t,r=e})),i=i.map((function(e){return 0===n?0:e/n})),i}(e),o=l(jI(e,a,a,t,n),3),s=o[0],c=o[1],u=o[2];if(0===c||c<r)return[{curve:s,beginIndex:0,count:e.length}];if(c<r*r)for(var h=a,d=c,f=u,v=0;v<20;v++){var m;if(s=(m=l(jI(e,a,h=DI(s,e,h),t,n),3))[0],c=m[1],u=m[2],c<r)return[{curve:s,beginIndex:0,count:e.length}];if(u===f){var g=c/d;if(g>.9999&&g<1.0001)break}d=c,f=u}var y=AI(e[u-1],e[u+1]);if(0===y.x&&0===y.y){var b=AI(e[u-1],e[u]),k=b.x;y={x:-b.y,y:k}}var w,S=OI(y),x=EI(S,-1),C=LI(e.slice(0,u+1),t,S,r),I=LI(e.slice(u),x,n,r),P=T(I);try{for(P.s();!(w=P.n()).done;){w.value.beginIndex+=u}}catch(e){P.e(e)}finally{P.f()}return[].concat(p(C),p(I))}function jI(e,t,n,r,i){var a=function(e,t,n,r){for(var i=e[0],a=e[e.length-1],o=[i,CI,CI,a],s=t.map((function(e){var t=1-e;return[EI(n,3*e*(t*t)),EI(r,3*t*(e*e))]})),c=[[0,0],[0,0]],u=[0,0],h=0,d=Array.from(t.entries());h<d.length;h++){var p=l(d[h],2),f=p[0],v=p[1],m=l(s[f],2),g=m[0],y=m[1];c[0][0]+=RI(g,g),c[0][1]+=RI(g,y),c[1][0]+=RI(g,y),c[1][1]+=RI(y,y);var b=AI(e[f],BI([i,i,a,a],v));u[0]+=RI(g,b),u[1]+=RI(y,b)}var k=c[0][0]*c[1][1]-c[1][0]*c[0][1],w=c[0][0]*u[1]-c[1][0]*u[0],S=u[0]*c[1][1]-u[1]*c[0][1],x=0===k?0:S/k,C=0===k?0:w/k,I=II(AI(i,a)),P=1e-6*I;return x<P||C<P?(o[1]=MI(i,EI(n,I/3)),o[2]=MI(a,EI(r,I/3))):(o[1]=MI(i,EI(n,x)),o[2]=MI(a,EI(r,C))),o}(e,n,r,i),o=function(e,t,n){for(var r=0,i=Math.floor(e.length/2),a=function(e,t){for(var n=[0],r=e[0],i=0,a=1;a<=t;a++){var o=BI(e,a/t);i+=II(AI(o,r)),n.push(i),r=o}return n=n.map((function(e){return e/i})),n}(t,10),o=1;o<e.length-1;o++){var s=e[o],c=PI(AI(BI(t,FI(t,n[o],a,10)),s));c>r&&(r=c,i=o)}return[r,i]}(e,a,t),s=l(o,2);return[a,s[0],s[1]]}function DI(e,t,n){return n.map((function(n,r){return function(e,t,n){var r=AI(BI(e,n),t),i=function(e,t){var n=1-t,r=EI(AI(e[1],e[0]),3*Math.pow(n,2)),i=EI(AI(e[2],e[1]),6*n*t),a=EI(AI(e[3],e[2]),3*Math.pow(t,2));return TI(r,i,a)}(e,n),a=RI(r,i),o=PI(i)+2*RI(r,function(e,t){return MI(EI(MI(AI(e[2],EI(e[1],2)),e[0]),6*(1-t)),EI(MI(AI(e[3],EI(e[2],2)),e[1]),6*t))}(e,n));return 0===o?n:n-a/o}(e,t[r],n)}))}function FI(e,t,n,r){if(t<0)return 0;if(t>1)return 1;for(var i=1;i<=r;i++)if(t<=n[i]){var a=(i-1)/r,o=i/r,s=n[i-1];return(t-s)/(n[i]-s)*(o-a)+a}return Number.NaN}function zI(e,t){return OI(AI(e,t))}function BI(e,t){var n=1-t;return TI(EI(e[0],Math.pow(n,3)),EI(e[1],3*Math.pow(n,2)*t),EI(e[2],3*n*Math.pow(t,2)),EI(e[3],Math.pow(t,3)))}var UI=function(){function e(t){C(this,e),this.extraSteups=0,this.straightEnd=null,this.points=null,this.isCurveExits=!1,this.didPushPointsCount=0;var n=t.firstPoint;this.applianceManager=t.applianceManager,this.paintingShape=t.paintingShape,this.bezierCurvePainter=t.bezierCurvePainter,this.invoker=t.invoker,this.beginPoint=n,this.isStraightMode=t.isStraightMode,this.scale=t.scale,this.enableDrawPoint=t.enableDrawPoint,this.zone=Object.seal({top:n.y,bottom:n.y,left:n.x,right:n.x}),this.bezierCurvePainter.pushPoint(n.x,n.y)}return P(e,[{key:"toStraightMode",value:function(){var e;if(null==(e=this.invoker)||e.flush(),this.points){var t=this.points[this.points.length-1];this.beginPoint={x:t.x,y:t.y},this.points=null}this.isStraightMode=!0}},{key:"toPencilMode",value:function(){if(this.straightEnd){var e=this.straightEnd,t=e.x,n=e.y;this.receiveIntoZone(t,n),this.beginPoint={x:t,y:n},this.straightEnd=null}this.bezierCurvePainter.completeMoveBrokenPoint(),this.isStraightMode=!1,this.isCurveExits=!1}},{key:"addExtraSteups",value:function(){return this.extraSteups+=1}},{key:"moveTo",value:function(e,t){this.isStraightMode?this.moveStraightEnd(e,t):this.pushPencilPoint(e,t)}},{key:"complete",value:function(e,t){return this.isStraightMode&&this.receiveIntoZone(e,t),!this.shouldCancelPaintingPencil()}},{key:"shouldCancelPaintingPencil",value:function(){if(this.enableDrawPoint)return!1;var e=this.paintingShape.hitTestingBoxMargin/5,t=this.zone.right-this.zone.left,n=this.zone.bottom-this.zone.top;return t<=e&&n<=e}},{key:"moveStraightEnd",value:function(t,n){var r=WI.curveConvergenceSteps.length,i=this.extraSteups-r;this.extraSteups=r,this.straightEnd?(this.straightEnd.x=t,this.straightEnd.y=n,this.applianceManager.updateBezierCurveTail(this.createStraightLine(t,n),i)):(this.straightEnd={x:t,y:n},this.didPushPointsCount+=1,this.applianceManager.appendBezierCurveTail([this.createStraightLine(t,n)],i)),this.didPushPointsCount<e.maxSegmentsPointsCount?this.bezierCurvePainter.moveBrokenPoint(t,n):this.bezierCurvePainter.touchPoint(t,n)}},{key:"createStraightLine",value:function(e,t){var n=this.beginPoint.x-e,r=this.beginPoint.y-t;return{point1:W({},this.beginPoint),point2:{x:e,y:t},point3:{x:e,y:t},hiddenPoints:0,cubic:[0,1],distance:Math.sqrt(n*n+r*r)}}},{key:"pushPencilPoint",value:function(t,n){var r=this;this.points||(this.points=[H(W({},this.beginPoint),{distance:0})]);var i=this.createStrokePoint(this.points,t,n);this.points.push(i),this.didPushPointsCount<e.maxSegmentsPointsCount?(this.bezierCurvePainter.pushPoint(t,n),this.didPushPointsCount+=1):this.bezierCurvePainter.touchPoint(t,n),this.invoker&&this.points.length<e.maxSegmentsPointsCount?this.invoker.invoke((function(){return r.syncCurve()})):this.syncCurve(),this.receiveIntoZone(t,n)}},{key:"syncCurve",value:function(){var e=this.points,t=xI/this.scale,n=NI(e,Math.pow(t,2)),r=this.subtractExtraSteps();if(1===n.length){var i=n[0].curve,a=this.createBezierCurve(e,i,0,e.length);this.isCurveExits?this.applianceManager.updateBezierCurveTail(a,r):this.applianceManager.appendBezierCurveTail([a],r)}else{var o,s=0,c=[],u=T(n);try{for(u.s();!(o=u.n()).done;){var l=o.value,h=l.curve,d=l.beginIndex,p=l.count;c.push(this.createBezierCurve(e,h,d,p)),s=Math.max(s,d)}}catch(e){u.e(e)}finally{u.f()}e.splice(0,s),this.isCurveExits?this.applianceManager.splitBezierCurveTail(c,r):this.applianceManager.appendBezierCurveTail(c,r)}this.isCurveExits=!0}},{key:"createStrokePoint",value:function(e,t,n){var r=e[e.length-1],i=t-r.x,a=n-r.y;return{x:t,y:n,distance:r.distance+Math.sqrt(i*i+a*a)}}},{key:"createBezierCurve",value:function(e,t,n,r){var i=r-2,a=e[n],o=e[n+r-1];return{point1:t[1],point2:t[2],point3:t[3],hiddenPoints:i,cubic:this.fitCubic(e,n,r),distance:o.distance-a.distance}}},{key:"fitCubic",value:function(t,n,r){var i=null,a=t[n].distance,o=t[n+r-1].distance-a;if(r>=3&&o>0){for(var s=[],c=[],u=0;u<r;++u){var l=t[n+u].distance;s[u]=(l-a)/o,c[u]=u/(r-1)}i=e.getLinearRegression(s,c)}return i||(i=p(e.defaultCubic)),i}},{key:"receiveIntoZone",value:function(e,t){this.zone.left=Math.min(this.zone.left,e),this.zone.right=Math.max(this.zone.right,e),this.zone.top=Math.min(this.zone.top,t),this.zone.bottom=Math.max(this.zone.bottom,t)}},{key:"subtractExtraSteps",value:function(){var e=0;return this.extraSteups>0&&(this.extraSteups-=1,e=1),e}}],[{key:"getLinearRegression",value:function(e,t){for(var n=null,r=0,i=0,a=0,o=0,s=0,c=1;c<e.length;++c){var u=e[c],l=t[c];if(0!==u){var h=u*u,d=l/h;r+=d,i+=u,a+=h,o+=d*u,s+=1}}if(s>2){var p=i/s,f=r/s,v=(o-f*p)/(a-i*i/s),m=f-v*p,g=m+v;n=[m/g,v/g,0,0]}return n}}]),e}(),VI=UI;VI.maxSegmentsPointsCount=350,VI.defaultCubic=Object.freeze(UI.getLinearRegression([0,.2,.4,.6,.8,1],[0,.2,.4,.6,.8,1]));var WI=function(){function e(t,n,r,i,a,o){var s=this;C(this,e),this.isShiftPress=!1,this.isCtrlKeyPress=!1,this.isAltPress=!1,this.isPaintCircularMode=!1,this.curve=null,this.commiter=null,this.onAddExtraSteups=function(){var e;s.curve&&(null==(e=s.invoker)||e.flush(),s.applianceManager.addBezierCurveExtraSteups(),s.curve.addExtraSteups()>=s.bezierCurvePainter.maxExtraSteups&&s.fountain.stop())},this.view=t,this.applianceManager=n,this.cameraObserver=r,this.pencilOptions=i,this.bezierCurvePainter=a,this.fountain=new _I(this.onAddExtraSteups),this.invoker=o?null:new bI(41)}return P(e,[{key:"notifyShiftPress",value:function(e){var t,n;this.isShiftPress!==e&&(this.isShiftPress=e,e?null==(t=this.curve)||t.toStraightMode():null==(n=this.curve)||n.toPencilMode())}},{key:"notifiyCtrlPress",value:function(e){this.isCtrlKeyPress=e}},{key:"notifiyAltPress",value:function(e){this.isAltPress=e}},{key:"pushBoundlessMouseEvent",value:function(e,t){switch(this.commiter=null,e){case wu.MouseDown:case wu.SortedTouchStart:this.onMouseDown(t);break;case wu.MouseMove:case wu.SortedTouchMove:this.onMouseMove(t);break;case wu.MouseUp:case wu.SortedTouchEnd:case wu.SortedTouchCancel:this.onMouseUp(t);break;case wu.MouseLeave:this.onMouseLeave(t)}return this.commiter}},{key:"onMouseDown",value:function(e){var t=e.x,n=e.y;!this.curve&&!this.isPaintCircularMode&&(this.isAltPress?(this.isPaintCircularMode=!0,this.applianceManager.beginPencilCircular(t,n,this.isCtrlKeyPress)):(this.curve=new VI({applianceManager:this.applianceManager,paintingShape:this.createCurveShape(t,n),bezierCurvePainter:this.bezierCurvePainter,invoker:this.invoker,firstPoint:{x:t,y:n},isStraightMode:this.isShiftPress,enableDrawPoint:this.pencilOptions.enableDrawPoint,scale:this.cameraObserver.cameraState.scale}),this.fountain.touch()))}},{key:"onMouseMove",value:function(e){this.curve?(this.curve.moveTo(e.x,e.y),this.fountain.touch()):this.isPaintCircularMode?this.applianceManager.movePencilCircular(e.x,e.y):this.applianceManager.onMouseMove(e,this.view.focusSceneId)}},{key:"onMouseUp",value:function(e){var t,n=e.x,r=e.y;this.curve?(null==(t=this.invoker)||t.flush(),this.fountain.stop(),this.curve.complete(n,r)?this.commiter=this.applianceManager.completePencilPainting(n,r):this.applianceManager.cancelPencilPainting(n,r,this.view.focusSceneId),this.bezierCurvePainter.completePainting(this.curve.paintingShape),this.curve=null):this.isPaintCircularMode&&(this.isPaintCircularMode=!1,this.commiter=this.applianceManager.completePencilCircular(n,r))}},{key:"onMouseLeave",value:function(e){this.curve||(this.commiter=this.applianceManager.onMouseLeave(e,this.view.focusSceneId))}},{key:"createCurveShape",value:function(e,t){var n=this.applianceManager.createBezierCurve({x:e,y:t},this.view.focusSceneId),r=Bo(n);return this.bezierCurvePainter.startPainting(r),n}}]),e}();WI.curveConvergenceSteps=Object.freeze([.1,.3,.5,.7,.9,1]);var HI,_I=function(){function e(t){var n=this;C(this,e),this.onGush=t,this.sleepTimer=null,this.gushInterval=null,this.onTick=function(){n.sleepTimer=null,n.gushInterval=setTimeout(n.onTick,e.GushInterval),n.onGush()}}return P(e,[{key:"touch",value:function(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&clearTimeout(this.sleepTimer),this.sleepTimer=setTimeout(this.onTick,e.SleepDuration)}},{key:"stop",value:function(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&(clearTimeout(this.sleepTimer),this.sleepTimer=null)}}]),e}();_I.SleepDuration=68,_I.GushInterval=17,function(e){e[e.Down=0]="Down",e[e.Move=1]="Move",e[e.Up=2]="Up",e[e.Leave=3]="Leave"}(HI||(HI={}));var GI=function(){function e(t,n){var r=this;C(this,e),this.invoker=new bI(100),this.latestHitTestIdentifies=[],this.isPressed=!1,this.onStart=function(e,t){var n=r.getProxyEventKind(e),i=r.createProxyEvent(e,t,0);if(i&&(r.pushProxyEvent(i,t),2===n)){var a=r.createProxyEvent(e,t,2);a&&r.pushProxyEvent(a,t)}},this.onEvent=function(e,t){var n=r.createProxyEvent(e,t);n&&r.pushProxyEvent(n,t)},this.onCancel=function(e,t){var n,i=0,a=0;e&&(i=e.pointOnScreen.x,a=e.pointOnScreen.y);var o=[],s={x:i,y:a,targetsMap:{},hitTestIdentifies:o};r.invoker.cancel(),r.latestHitTestIdentifies=o,null==(n=r.onReceviedMouseEvent)||n.call(r,2,0,s,t)},this.radiusSelector=t,this.delegate=n}return P(e,[{key:"cleanWaitingEvents",value:function(){this.invoker.cancel()}},{key:"pushProxyEvent",value:function(e,t){var n=this;switch(e.boundlessEvent.kind){case wu.MouseDown:this.invoker.limitDuration=17,this.isPressed=!0;break;case wu.MouseUp:this.invoker.limitDuration=100,this.isPressed=!1}switch(e.kind){case 0:this.invoker.limitDuration=17;break;case 2:this.invoker.limitDuration=100}var r=e.mouseEvent.hitTestIdentifies;e.boundlessEvent.kind!==wu.MouseMove||this.isHitTestIdentifiesDifferent(r)?(this.invoker.cancel(),this.callbackReceiveMouseEvent(e,t)):this.invoker.invoke((function(){return n.callbackReceiveMouseEvent(e,t)})),this.latestHitTestIdentifies=r}},{key:"callbackReceiveMouseEvent",value:function(e,t){var n,r=e.kind,i=e.eraserRadius,a=e.mouseEvent;null==(n=this.onReceviedMouseEvent)||n.call(this,r,i,a,t)}},{key:"createProxyEvent",value:function(e,t,n){var r,i=this.delegate.getScreen(t),a=0,o=this.delegate.getCurrentApplianceName(),s=e.pointOnScreen,c=null!=n?n:this.getProxyEventKind(e);if(o===fI.selector||o===fI.eraser||o===fI.text){var u=this.radiusSelector.radius(o,s,this.isPressed);this.isPressed&&o===fI.eraser&&(a=u),r=i.hitTest(s.x,s.y,u)}else r=[];return{kind:c,eraserRadius:a,applianceName:o,mouseEvent:this.createMouseEvent(i,e,t,r),boundlessEvent:e}}},{key:"createMouseEvent",value:function(e,t,n,r){var i,a=t.nativeEvent;if(a&&a.target){var o=e.findComponentWithTarget(a.target);o&&(i=this.delegate.getTargetsMap(o,n,a))}return i||(i={}),{x:t.pointOnScene.x,y:t.pointOnScene.y,targetsMap:i,hitTestIdentifies:r}}},{key:"getProxyEventKind",value:function(e){switch(e.kind){case wu.MouseDown:case wu.SortedTouchStart:return 0;case wu.MouseMove:case wu.SortedTouchMove:return 1;case wu.MouseUp:case wu.SortedTouchEnd:case wu.SortedTouchCancel:return 2;case wu.MouseLeave:return 3;default:throw new Error("invalid kind ".concat(e.kind))}}},{key:"isHitTestIdentifiesDifferent",value:function(e){var t=this.latestHitTestIdentifies.length!==e.length;if(!t)for(var n=0;n<e.length;++n){if(t=e[n]!==this.latestHitTestIdentifies[n])break}return t}}]),e}(),YI=function(){function e(){C(this,e),this.catchPress=!1,this.catchTarget=null,this.shadowTextarea=null}return P(e,[{key:"receivePreEndTouch",value:function(e){var t=!1;this.catchTarget&&!this.isParent(this.catchTarget,e.target)&&(t=!0),this.catchPress&&!t&&this.getShadowTextarea().focus()}},{key:"isParent",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}},{key:"release",value:function(){this.shadowTextarea&&(this.shadowTextarea.remove(),this.shadowTextarea=null)}},{key:"getShadowTextarea",value:function(){return this.shadowTextarea||(this.shadowTextarea=this.createShadowTextarea()),this.shadowTextarea}},{key:"createShadowTextarea",value:function(){var e=document.createElement("textarea");return e.style.flex="fixed",e.style.opacity="0.0",e.style.width="0px",e.style.height="0px",e.addEventListener("onchange",(function(){e.value="",e.blur(),console.warn("")})),document.body.append(e),e}}]),e}(),XI=function(){function e(t){C(this,e),this.bezierRenderGranularity=t.bezierRenderGranularity,this.bezierMaxSegments=t.bezierMaxSegments,this.fitCurveMaxError=t.fitCurveMaxError}return P(e,[{key:"erase",value:function(e,t,n){var r,i=this,a={},o=[],s=T(e);try{var c=function(){var e=r.value,s=e.getCurves(),c=i.splitAndKeepErasedRanges(e,t,s,n).map((function(n){return i.toBezierCurveShapeUpdater(n,t,e,s)}));a[e.identifier]=c,o.push(e.protoKey)};for(s.s();!(r=s.n()).done;)c()}catch(e){s.e(e)}finally{s.f()}return{updaters:a,touchProtoKeys:o}}},{key:"splitAndKeepErasedRanges",value:function(t,n,r,i){var a=this,o=t.getInitializedSize(),s=t.getHeadPoint(),c=this.bezierRenderGranularity/n,u=e.scale(t.width,o.width),l=e.scale(t.height,o.height),h=Math.sqrt(u*u+l*l)/Math.sqrt(2),d=i.transform(t.originX,t.originY,u,l),p=[],f=null,v=s.x*u,m=s.y*l;d.includes(v,m)||(f={headPoint:W({},s),begin:{index:0,d:0,points:null,cubic:[0,0,0,0]},end:{index:0,d:0,points:null,cubic:[0,0,0,0]}});for(var g=function(e){var t=Math.ceil(e*h/c);return Math.max(2,Math.min(t,a.bezierMaxSegments))},y=function(e){var t=r[e],n=t.point1,i=t.point2,o=t.point3,s=t.distance,c=t.cubic;a.forEachCurvePoints(v,m,n,i,o,!0,g(s),(function(t,n,r){var i=d.includes(t,n);f&&!i?(f.end.index=e,f.end.d=r,f.end.cubic=c):f&&i?(p.push(f),f=null):!f&&!i&&(f={headPoint:{x:t,y:n},begin:{index:e,d:r,points:null,cubic:c},end:{index:e,d:r,points:null,cubic:c}})})),v=o.x,m=o.y},b=0;b<r.length;++b)y(b);f&&p.push(f);for(var k=0,w=p;k<w.length;k++){var S=w[k];S.begin.index===S.end.index?this.collectPointsOnTheSameCurve(S,r,g):(this.collectPointsOnBeginSideCurve(S,r,g),this.collectPointsOnEndSideCurve(S,r,g))}return p}},{key:"collectPointsOnTheSameCurve",value:function(e,t,n){var r=e.begin,i=e.end;if(r.d>0||i.d<1){var a=t[r.index],o=a.point1,s=a.point2,c=a.point3,u=a.distance,l=e.headPoint,h=l.x,d=l.y,p=[];this.forEachCurvePoints(h,d,o,s,c,!0,n(u),(function(e,t,n){return n>i.d||(n>=r.d&&p.push({x:e,y:t}),!1)})),e.begin.points=p,e.end.points=p}}},{key:"collectPointsOnBeginSideCurve",value:function(e,t,n){var r=e.begin;if(r.d>0){var i=t[r.index],a=i.point1,o=i.point2,s=i.point3,c=i.distance,u=e.headPoint,l=u.x,h=u.y,d=[];this.forEachCurvePoints(l,h,a,o,s,!1,n(c),(function(e,t,n){return d.push({x:e,y:t}),n<r.d})),e.begin.points=d.reverse()}}},{key:"collectPointsOnEndSideCurve",value:function(e,t,n){var r=e.end;if(r.d<1){var i=t[r.index],a=i.point1,o=i.point2,s=i.point3,c=i.distance,u=t[r.index-1].point3||e.headPoint,l=u.x,h=u.y,d=[];this.forEachCurvePoints(l,h,a,o,s,!0,n(c),(function(e,t,n){return d.push({x:e,y:t}),n>r.d})),e.end.points=d}}},{key:"forEachCurvePoints",value:function(e,t,n,r,i,a,o,s){var c,u,l,h=n.x,d=n.y,p=r.x,f=r.y,v=i.x,m=i.y;for(a?(c=0,u=o-1,l=1):(c=o-1,u=0,l=-1);;){var g=c/(o-1),y=Math.pow(1-g,3),b=3*g*Math.pow(1-g,2),k=3*Math.pow(g,2)*(1-g),w=Math.pow(g,3);if(s(y*e+b*h+k*p+w*v,y*t+b*d+k*f+w*m,g)||c===u)break;c+=l}}},{key:"toBezierCurveShapeUpdater",value:function(e,t,n,r){var i,a=e.headPoint,o=e.begin,s=e.end,c=Math.pow(this.fitCurveMaxError/t,2),u=null,l=null,h=-1,d=o.index;if(o.points){var p=1;o.index===s.index&&(p=s.d),u=this.collectBezierCurve(o.points,o.cubic,c,o.d,p)}if(o.index<s.index){if(s.points){var f=0;o.index===s.index&&(f=o.d),l=this.collectBezierCurve(s.points,s.cubic,c,f,s.d)}h=s.index,d=s.index}return i=d===r.length-1?n.getExtraSteups():this.bezierMaxSegments,{firstPoint:a,first:u,last:l,firstIndex:o.index,lastIndex:h,extraSteups:i}}},{key:"collectBezierCurve",value:function(e,t,n,r,i){var a,o=[],s=NI(e,Math.pow(n,2)),c=e.length,u=this.calculateDistance(e),l=i-r,h=0,d=T(s);try{for(d.s();!(a=d.n()).done;){var p=a.value,f=p.curve,v=p.count,m=v-2,g=v/c*u,y=r+h/c*l,b=r+(h+v)/c*l;o.push({point1:f[1],point2:f[2],point3:f[3],cubic:this.cutOffCubic(t,y,b),hiddenPoints:m,distance:g}),h+=v}}catch(e){d.e(e)}finally{d.f()}return o}},{key:"calculateDistance",value:function(e){for(var t=0,n=e[0],r=1;r<e.length;++r){var i=e[r],a=i.x-n.x,o=i.y-n.y;t+=Math.sqrt(Math.pow(a,2)+Math.pow(o,2)),n=i}return t}},{key:"cutOffCubic",value:function(e,t,n){var r=e;if(t>0||n<1){var i=n-t,a=t,o=l(r,4),s=o[0],c=o[1],u=o[2],h=o[3];r=[s*Math.pow(i,3),3*s*Math.pow(i,2)*a+c*Math.pow(i,2),3*s*Math.pow(a,2)+2*c*a+u*i,s*Math.pow(a,3)+c*Math.pow(a,2),u*Math.pow(a,2)+h]}return r}}],[{key:"isRectIncludes",value:function(e,t,n,r,i,a){return e>=n&&e<=r&&t>=i&&t<=a}},{key:"scale",value:function(e,t){return 0===t?1:e/t}}]),e}(),QI=function(){function e(){C(this,e),this.points=[]}return P(e,[{key:"pushPoint",value:function(e,t){return this.points.push({x:e,y:t}),this}},{key:"complete",value:function(){return this.points.push(this.points[0]),this}},{key:"transform",value:function(t,n,r,i){var a,o=new e,s=T(this.points);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=c.x,l=c.y,h=(u-t)/r,d=(l-n)/i;o.points.push({x:h,y:d})}}catch(e){s.e(e)}finally{s.f()}return o}},{key:"externalRectangle",value:function(){var e,t=Number.MAX_VALUE,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=-Number.MAX_VALUE,a=T(this.points);try{for(a.s();!(e=a.n()).done;){var o=e.value,s=o.x,c=o.y;t>s&&(t=s),n>c&&(n=c),r<s&&(r=s),i<c&&(i=c)}}catch(e){a.e(e)}finally{a.f()}return{originX:t,originY:n,width:r-t,height:i-n}}},{key:"includes",value:function(e,t){for(var n=1;n<this.points.length;++n){var r=this.points[n-1],i=this.points[n],a=i.x-r.x,o=i.y-r.y,s=e-r.x;if(a*(t-r.y)-o*s>0)return!1}return!0}}]),e}(),KI=function(){function e(t){C(this,e),this.prePoint=null,this.commiterState=null,this.isPressed=!1,this.applianceManager=t,this.eraser=new XI(kI)}return P(e,[{key:"fireMouseDown",value:function(e,t,n,r){this.isPressed||(this.commiterState={snapshots:{},modify:{added:{},removed:{},updated:{}}},this.isPressed=!0,this.erase(e,t,n,!1,r),this.prePoint={x:e,y:t})}},{key:"fireMouseMove",value:function(e,t,n,r){this.isPressed&&(this.erase(e,t,n,!1,r),this.prePoint={x:e,y:t})}},{key:"fireMouseUp",value:function(e,t,n,r){var i=null;return this.isPressed&&(this.isPressed=!1,this.erase(e,t,n,!0,r),this.commiterState&&(i=this.createCommiter(this.commiterState),this.commiterState=null),this.prePoint=null),i}},{key:"erase",value:function(e,t,n,r,i){var a=this.createPolygon(e,t,n),o=a.externalRectangle(),s=o.originX,c=o.originY,u=o.width,l=o.height,h=this.applianceManager.collectNewPencilCurves(s,c,u,l,i),d=this.eraser.erase(h,n,a),p=d.updaters,f=d.touchProtoKeys;this.searchSnapshotsBeforeUpdate(f,i);var v=this.applianceManager.updateNewPencilCurves(p,e,t,r,i);this.commitModify(v)}},{key:"getEraserSizeIndex",value:function(e){var t=1;return e&&"number"==typeof e.pencilEraserSize&&(t=e.pencilEraserSize),(t=Math.min(3,Math.max(1,Math.floor(t))))-1}},{key:"createPolygon",value:function(t,n,r){var i,a,o=new QI,s=this.applianceManager.getMemberState(),c=this.getEraserSizeIndex(s),u=e.eraserSizes[c],l=u.width/r,h=u.height/r,d=t-l/2,p=n-h/2;this.prePoint?(i=this.prePoint.x-l/2,a=this.prePoint.y-h/2):(i=d,a=p);var f=d-i,v=p-a;return f>0?v>0?o.pushPoint(i,a).pushPoint(i,a+h).pushPoint(d,p+h).pushPoint(d+l,p+h).pushPoint(d+l,p).pushPoint(i+l,a):v<0?o.pushPoint(i,a).pushPoint(i,a+h).pushPoint(d+l,p+h).pushPoint(d+l,p):o.pushPoint(i,a).pushPoint(i,a+h).pushPoint(i+l,a+h).pushPoint(d+l,p+h).pushPoint(d+l,p).pushPoint(d,p):f<0?v>0?o.pushPoint(i,a).pushPoint(d,p).pushPoint(d,p+h).pushPoint(d+l,p+h).pushPoint(i+l,p+h).pushPoint(i+l,a):v<0?o.pushPoint(i+l,a).pushPoint(d+l,p).pushPoint(d,p).pushPoint(d,p+h).pushPoint(i,a+h).pushPoint(i+h,a+h):o.pushPoint(i,a+h).pushPoint(d,p).pushPoint(d,p+h).pushPoint(i+l,a+h):v>0?o.pushPoint(i,a).pushPoint(d,p+h).pushPoint(d+l,p+h).pushPoint(i+l,a):v<0?o.pushPoint(i,a+h).pushPoint(d,p).pushPoint(d+l,p).pushPoint(i+l,a+h):o.pushPoint(i,a).pushPoint(i,a+h).pushPoint(i+l,a+h).pushPoint(i+l,a),o.complete()}},{key:"searchSnapshotsBeforeUpdate",value:function(e,t){var n,r=[],i=this.commiterState,a=i.snapshots,o=i.modify,s=o.added,c=o.removed,u=o.updated,l=T(e);try{for(l.s();!(n=l.n()).done;){var h=n.value;!a[h]&&!s[h]&&!c[h]&&!u[h]&&r.push(h)}}catch(e){l.e(e)}finally{l.f()}r.length>0&&this.applianceManager.searchPencilCurves(r,t).forEach((function(e,t){e&&(a[r[t]]=e.snapshotUndo())}))}},{key:"commitModify",value:function(e){var t=this.commiterState.modify,n=t.added,r=t.removed,i=t.updated;for(var a in e.added)n[a]=!0;for(var o in e.removed)n[o]?delete n[o]:(r[o]=!0,delete i[o]);for(var s in e.updated)n[s]||(i[s]=!0)}},{key:"createCommiter",value:function(e){var t=e.modify,n=e.snapshots,r={},i={},a=this.collectAfterSnapshots(t);for(var o in t.added)r[o]={delete:!0},i[o]={createCurve:a[o]};for(var s in t.updated)r[s]={updateCurve:n[s]},i[s]={updateCurve:a[s]};for(var c in t.removed)r[c]={createCurve:n[c]},i[c]={delete:!0};return{redo:i,undo:r}}},{key:"collectAfterSnapshots",value:function(e){var t=[];for(var n in e.added)t.push(n);for(var r in e.updated)t.push(r);var i={};return this.applianceManager.searchPencilCurves(t).forEach((function(e,n){e&&(i[t[n]]=e.snapshotUndo())})),i}}]),e}(),qI=KI;qI.eraserSizes=Object.freeze([Object.freeze({width:18,height:26}),Object.freeze({width:26,height:34}),Object.freeze({width:34,height:50})]);var ZI,JI=function(){function e(t,n,r,i,a,o,s){var c=this;C(this,e),this._disableKey=!1,this.onReceviedPencilMouseEvent=function(e,t,n){var r;switch(e){case HI.Down:r=wu.MouseDown;break;case HI.Move:r=wu.MouseMove;break;case HI.Up:r=wu.MouseUp;break;case HI.Leave:r=wu.MouseLeave}var i=c.bezierPencilAppliance.pushBoundlessMouseEvent(r,n);i&&c.undoWatcher&&c.undoWatcher.stack.commit(i)},this.onReceivedPencilEraserMouseEvent=function(e,t,n){var r=n.x,i=n.y;switch(e){case HI.Down:c.pencilEraserAppliance.fireMouseDown(r,i,c.view.camera.scale,c.view.focusSceneId);break;case HI.Move:c.pencilEraserAppliance.fireMouseMove(r,i,c.view.camera.scale,c.view.focusSceneId);break;case HI.Up:var a=c.pencilEraserAppliance.fireMouseUp(r,i,c.view.camera.scale,c.view.focusSceneId);a&&c.undoWatcher&&c.undoWatcher.stack.commit(a)}},this.onReceviedOthersMouseEvent=function(e,t,n){var r=null;switch(e){case HI.Down:r=c.magix.trigger.onMouseDown(n,c.view.focusSceneId);break;case HI.Move:r=c.magix.trigger.onMouseMove(n,c.view.focusSceneId);break;case HI.Up:r=c.magix.trigger.onMouseUp(n,c.view.focusSceneId);break;case HI.Leave:r=c.magix.trigger.onMouseLeave(n,c.view.focusSceneId)}c.viewsHub.putState({cursorStyle:c.getCursorStyleWithRadius(t)}),r&&c.undoWatcher&&c.undoWatcher.stack.commit(r)},this.magix=t.magix,this.viewInputsHub=t.viewInputsHub,this.view=t.view,this.viewsHub=t.viewsHub,this.mouseFollower=i,this.pencilKeyInterrupter=r,this.undoWatcher=n,this.getCursorStyleWithRadius=t.getCursorStyleWithRadius,this.onKeyPressed=a,this.onMetaKeyUp=o,this.onTouchPressUpdate=s,this._virtualKeyboardHelper=new YI,this.bezierPencilAppliance=new WI(this.view,this.magix.trigger,t.cameraObserver,t.pencilOptions,t.bezierCurvePainter,t.disablePencilWrittingLimitFrequency),this.pencilEraserAppliance=new qI(this.magix.trigger),this.pencilKeyInterrupter.setAppliance(this.bezierPencilAppliance),this.input=this.viewInputsHub.bindView(this.view,{onReceviedPencilMouseEvent:this.onReceviedPencilMouseEvent,onReceivedPencilEraserMouseEvent:this.onReceivedPencilEraserMouseEvent,onReceviedOthersMouseEvent:this.onReceviedOthersMouseEvent})}return P(e,[{key:"disableKey",get:function(){return this._disableKey},set:function(e){this._disableKey!==e&&(this._disableKey=e)}},{key:"virtualKeyboardHelper",get:function(){return this._virtualKeyboardHelper}},{key:"pushEvent",value:function(e){this.syncStateOfMouseFollower(e),e.kind===wu.SortedTouchStart&&this.onTouchPressUpdate(!0),this.pushAndCallback(e),e.kind===wu.SortedTouchEnd&&this.onTouchPressUpdate(!1)}},{key:"syncStateOfMouseFollower",value:function(e){switch(e.kind){case wu.MouseDown:var t=e.pointOnScreen,n=t.x,r=t.y;this.mouseFollower.moveMouse(n,r);break;case wu.MouseMove:var i=e.pointOnScreen,a=i.x,o=i.y;this.mouseFollower.moveMouse(a,o);break;case wu.MouseUp:this.mouseFollower.releaseMouse()}}},{key:"pushAndCallback",value:function(e){switch(e.kind){case wu.MouseDown:case wu.MouseMove:case wu.MouseUp:case wu.MouseLeave:case wu.SortedTouchStart:case wu.SortedTouchMove:case wu.SortedTouchEnd:case wu.SortedTouchCancel:this.input.pushEvent(e);break;case wu.KeyDown:case wu.KeyUp:this._disableKey||this.onKeyPressed(e);break;case wu.MetaKeyUp:this._disableKey||this.onMetaKeyUp(e.nativeEvent)}}},{key:"pushPreEndTouchEvent",value:function(e){var t=e.nativeEvent;t&&this._virtualKeyboardHelper.receivePreEndTouch(t)}},{key:"fireSceneUpdate",value:function(){this.input=this.viewInputsHub.swapInput(this.view)}},{key:"release",value:function(){this.pencilKeyInterrupter.setAppliance(null),this.viewInputsHub.unbindView(this.view),this._virtualKeyboardHelper.release(),this.mouseFollower.releaseMouse()}}]),e}(),$I=function(){function e(t){C(this,e),this.inputs={},this.outputs={},this.previousId=0,this.pressedInputId="",this.isPressed=!1,this.output=void 0,this.outputSwitch=t}return P(e,[{key:"createInput",value:function(){var e=this,t="".concat(this.previousId+=1),n=Object.freeze({id:t,pushEvent:function(n){return e.pushEventByInput(t,n)},dispose:function(){return e.removeInput(n)}});return this.inputs[t]={input:n,isPressed:!1},n}},{key:"removeInput",value:function(e){var t,n=this.inputs[e.id];if((null==n?void 0:n.input)===e&&(delete this.inputs[e.id],this.pressedInputId===e.id)){this.pressedInputId="",this.isPressed=!1;var r=this.outputSwitch(e),i=this.outputs[r];null==(t=null==i?void 0:i.onCancel)||t.call(i,null,e)}}},{key:"putOutput",value:function(e,t){this.outputs[e]=t}},{key:"pushEventByInput",value:function(e,t){var n=this.inputs[e];switch(t.kind){case wu.MouseDown:case wu.SortedTouchStart:n.isPressed=!0,this.isPressed=!0,""===this.pressedInputId&&(this.pressedInputId=e,this.pushEvent(n.input,t));break;case wu.MouseMove:case wu.MouseLeave:case wu.SortedTouchMove:(""===this.pressedInputId&&!n.isPressed||this.pressedInputId===e)&&this.pushEvent(n.input,t);break;case wu.MouseUp:case wu.SortedTouchEnd:case wu.SortedTouchCancel:this.pressedInputId===e&&(this.pressedInputId="",this.pushEvent(n.input,t)),n.isPressed=!1,this.isPressed=!1}}},{key:"pushEvent",value:function(e,t){var n,r=this.outputSwitch(e),i=this.outputs[r];if(void 0===this.output||this.output!==r){var a=void 0!==this.output?this.outputs[this.output]:void 0;this.output=r,this.isPressed&&(null==(n=null==a?void 0:a.onCancel)||n.call(a,t,e),null==i||i.onEvent(t,e))}else null==i||i.onEvent(t,e)}}]),e}(),eP=.45,tP=4.35,nP=function(){function e(t,n){C(this,e),this.deviceType=t,this.screenType=n,this.previousPoint={x:0,y:0},this.previousTimestamp=0,this.currentSpeed=0,this.isPressed=!1}return P(e,[{key:"radius",value:function(e,t,n){return this.updatePressed(t,n),this.deviceType===up.Touch?36/iC(this.screenType):e===fI.eraser?this.getSpeedRaidus():0}},{key:"updatePressed",value:function(e,t){if(this.isPressed!==t&&(this.isPressed=t,t?(this.previousPoint.x=0,this.previousPoint.y=0,this.previousTimestamp=Date.now(),this.currentSpeed=0):this.currentSpeed=0),t){var n=Date.now(),r=e.x-this.previousPoint.x,i=e.y-this.previousPoint.y,a=n-this.previousTimestamp,o=0===a?0:Math.sqrt(r*r+i*i)/a;this.previousPoint.x=e.x,this.previousPoint.y=e.y,this.previousTimestamp=n,this.currentSpeed=(o+this.currentSpeed)/2}}},{key:"getSpeedRaidus",value:function(){var e=this.currentSpeed;e>tP?e=tP:e<eP&&(e=eP);return 90*(e-eP)/3.8999999999999995/iC(this.screenType)}}]),e}();!function(e){e[e.Hand=0]="Hand",e[e.NewPencil=1]="NewPencil",e[e.PencilEraser=2]="PencilEraser",e[e.Others=3]="Others"}(ZI||(ZI={}));var rP,iP,aP=function(){function e(t){var n=this;C(this,e),this.view2input={},this.input2view={},this.onReceviedPencilMouseEvent=function(e,t,r,i){var a=n.input2view[i.id];a&&a.callbacks.onReceviedPencilMouseEvent(e,t,r)},this.onReceivedPencilEraserMouseEvent=function(e,t,r,i){var a=n.input2view[i.id];a&&a.callbacks.onReceivedPencilEraserMouseEvent(e,t,r)},this.onReceviedOthersMouseEvent=function(e,t,r,i){var a=n.input2view[i.id];a&&a.callbacks.onReceviedOthersMouseEvent(e,t,r)};var r=t.magix,i=t.pencilOptions,a=t.onReceivedHandMouseEvent,o=t.onHandMouseEventCompleted,s=new nP(t.deviceType,t.screenType),c={isWorking:function(){return r.phase===Dc.Connected},getScreen:function(e){return n.viewWithInput(e).screen},getCurrentApplianceName:function(){return r.trigger.getMemberState().currentApplianceName},getTargetsMap:function(e,t,r){return n.viewWithInput(t).getTargetsMap(e,r)}};this.channel=new $I((function(){var e=r.trigger.getMemberState().currentApplianceName;return e===fI.hand?0:i.shouldUseNewPencil(e)?1:e===fI.pencilEraser?2:3})),this.pencilChannel=new GI(s,c),this.eraserChannel=new GI(s,c),this.othersChannel=new GI(s,c),this.pencilChannel.onReceviedMouseEvent=this.onReceviedPencilMouseEvent,this.eraserChannel.onReceviedMouseEvent=this.onReceivedPencilEraserMouseEvent,this.othersChannel.onReceviedMouseEvent=this.onReceviedOthersMouseEvent,this.channel.putOutput(1,this.pencilChannel),this.channel.putOutput(2,this.eraserChannel),this.channel.putOutput(3,this.othersChannel),this.channel.putOutput(0,{onEvent:function(e,t){return a(n.viewWithInput(t),e,t)},onCancel:function(e,t){return o(n.viewWithInput(t))}})}return P(e,[{key:"bindView",value:function(e,t){var n=this.view2input[e.id];return n||(this.view2input[e.id]=n=this.channel.createInput(),this.input2view[n.id]=Object.freeze({view:e,callbacks:Object.freeze(W({},t))})),n}},{key:"unbindView",value:function(e){var t=this.view2input[e.id];t&&(delete this.view2input[e.id],delete this.input2view[t.id],t.dispose())}},{key:"swapInput",value:function(e){var t=this.view2input[e.id];if(!t)throw new Error("unbinded view id=".concat(e.id));var n=this.channel.createInput();return this.input2view[n.id]=this.input2view[t.id],this.view2input[e.id]=n,t.dispose(),delete this.input2view[t.id],n}},{key:"cleanWaitingEvents",value:function(){this.pencilChannel.cleanWaitingEvents(),this.othersChannel.cleanWaitingEvents()}},{key:"viewWithInput",value:function(e){return this.input2view[e.id].view}}]),e}(),oP=Y(n(68949));!function(e){e.SVG="svg",e.Canvas="canvas"}(rP||(rP={})),function(e){e.Freedom="freedom",e.Follower="follower",e.Broadcaster="broadcaster"}(iP||(iP={}));var sP=Y(n(68949));function cP(e){return e instanceof FM}function uP(e){return e instanceof UM}function lP(e,t){var n=W({},e),r=!1;for(var i in t){var a=t[i];e[i]!==a&&(n[i]=a,r=!0)}return r?n:null}var hP=function(){function e(t){C(this,e),this._state=Object.freeze(W({},t))}return P(e,[{key:"state",get:function(){return this._state}},{key:"putState",value:function(e){var t=lP(this._state,e),n=!1;if(t){var r=this._state;this._state=Object.freeze(t),this.onStateUpdate(e,r),n=!0}return n}}]),e}(),dP=Y(n(73935)),pP=Y(n(67294));function fP(e){return vP.apply(this,arguments)}function vP(){return vP=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,r=null,i=null,a=0;case 2:if(!(a<n)){e.next=19;break}return e.prev=3,e.next=6,fetch(t);case 6:r=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),i=e.t0,e.abrupt("continue",16);case 13:if(200!==r.status){e.next=15;break}return e.abrupt("break",19);case 15:throw new Error("fetch ".concat(JSON.stringify(t)," failed with status ").concat(r.status));case 16:++a,e.next=2;break;case 19:if(!i){e.next=21;break}throw i;case 21:return e.next=23,r.blob();case 23:return o=e.sent,e.next=26,mP(o);case 26:return e.abrupt("return",e.sent);case 27:case"end":return e.stop()}}),e,null,[[3,9]])}))),vP.apply(this,arguments)}function mP(e){return gP.apply(this,arguments)}function gP(){return gP=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.createImageBitmap?window.createImageBitmap(t):new Promise((function(e,n){var r=URL.createObjectURL(t),i=document.createElement("img");i.addEventListener("load",(function(){URL.revokeObjectURL(i.src),e(i)})),i.src=r})));case 1:case"end":return e.stop()}}),e)}))),gP.apply(this,arguments)}var yP=Y(n(68949)),bP=Y(n(67294)),kP=function(){function e(){C(this,e)}return P(e,[{key:"createCursor",value:function(){return{x:0,y:0,width:0,height:0}}},{key:"onAddedCursor",value:function(e){var t=0,n=0,r=0,i=0,a="";switch(e.cursorMember.appliance){case fI.laserPointer:t=14,n=14,r=28,i=28,a=aC["laser-pointer-cursor"];break;case fI.eraser:t=8,n=18,r=26,i=26,a=aC["eraser-cursor@2x"];break;case fI.pencilEraser:var o=e.eraserSize;switch("number"!=typeof o&&(o=1),o=Math.min(3,Math.max(1,Math.floor(o))),a=aC["pencil-eraser-"+o],o){case 1:t=9,n=13,r=18,i=26;break;case 2:t=13,n=17,r=26,i=34;break;case 3:t=17,n=25,r=34,i=50}}e.setCursorDescription({x:t,y:n,width:r,height:i}),e.setReactNode(bP.createElement("img",{alt:"self-cursor",width:r,height:i,src:a}))}}]),e}(),wP=Y(n(68949)),SP=function(){function e(t){var n=this;C(this,e),this.eraserSize=void 0,this.reactNode=null,this.onCursorComponentChanged=function(e){n.cursorComponent=e,e?n.adapter.onAddedCursor&&n.adapter.onAddedCursor(n):n.adapter.onRemovedCursor&&n.adapter.onRemovedCursor(n)},this.onComponentMoved=function(){if(n.adapter.onMovingCursor){var e=n.component.originX+n._x+n.screen.width/2,t=n.component.originY+n._y+n.screen.height/2;n.adapter.onMovingCursor(n,e,t)}},this.idPrefix=t.idPrefix,this.applianceManager=t.applianceManager,this.adapter=t.adapter,this.screen=t.screen,this.memberId=t.memberId,this._cursorMember=t.cursorMember;var r=this.adapter.createCursor(this.memberId);this._x=r.x,this._y=r.y,this._width=r.width,this._height=r.height,this.reactNode=r.reactNode||null,this.component=this.screen.scene.addComponent({id:this.idPrefix+this.memberId,definition:t.cursorDefinition,originX:t.point.x-this._x,originY:t.point.y-this._y,width:r.width,height:r.height,orderIndex:this.memberId,absoluteCoordinates:!0,payload:{reactNode:this.reactNode,onCursorComponentChanged:this.onCursorComponentChanged}}),this.adapter.onMovingCursor&&this.component.addRectangleUpdatedListener(this.onComponentMoved)}return P(e,[{key:"cursorMember",get:function(){return this._cursorMember}},{key:"setCursorMember",value:function(e){var t;this._cursorMember&&!nC(this._cursorMember,e)&&(this._cursorMember=e,null==(t=this.onCursorMemberChanged)||t.call(this,this._cursorMember))}},{key:"remove",value:function(){this.screen.scene.removeComponent(this.component),this.adapter.onMovingCursor&&this.component.removeRectangleUpdatedListener(this.onComponentMoved)}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"divElement",get:function(){if(!this.cursorComponent)throw new Error("cursor isn't added");return this.cursorComponent.divElement}},{key:"setReactNode",value:function(e){this.reactNode=e,this.component.payload={reactNode:e,onCursorComponentChanged:this.onCursorComponentChanged}}},{key:"setCursorDescription",value:function(e){var t=W({x:this._x,y:this._y,width:this._width,height:this._height},e),n=this._x-t.x,r=this._y-t.y;this.component.setRectangle(this.component.originX+n,this.component.originY+r,t.width,t.height),this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height}}]),e}(),xP=function(){function e(t){var n=this;C(this,e),this.didMouseCursorMoved=!1,this.inactivityTimer=null,this.shouldAppearNextFrame=!0,this.cursor=null,this.disposer=null,this.refreshState=function(){var e=n.getCursorState(n.memberId),t=n.applianceManager.getViewState(n.memberId);e&&t&&n.willShow(n.applianceManager,e)?n.cursor?n.refreshCursorVisibleState(e,t,n.cursor):n.cursor=n.createCursor(e):n.cursor&&(n.removeCursor(n.cursor),n.cursor=null)},this.applianceManager=t.applianceManager,this.cursorDefinition=t.cursorDefinition,this.screen=t.screen,this.engine=t.engine,this.idPrefix=t.idPrefix,this.memberId=t.memberId,this.adapter=t.adapter,this.willShow=t.willShow,this.isFollowerFixedOnScreen=t.isFollowerFixedOnScreen,this.getOverridePoint=t.getOverridePoint,this.refreshAutorun(),this.refreshIsVisible()}return P(e,[{key:"isVisible",get:function(){return this.isCursorInScene&&this.isKeepVisible}},{key:"getCursorState",value:function(e){if(!this.applianceManager.getCursorState)return this.getCursorStateLegacy(e);var t=this.applianceManager.getCursorState(e),n=this.getOverridePoint(e);if(n){var r=this.applianceManager.getViewState(e),i=r.originX,a=r.originY,o=r.width,s=r.height,c=n.x,u=n.y;return c=0===o?.5:(c-i)/o,u=0===s?.5:(u-a)/s,H(W({},t),{cursorX:c,cursorY:u,isPressed:!0,isActivity:!0,isCursorInScene:!0})}return t}},{key:"getCursorStateLegacy",value:function(e){var t,n,r=T(this.applianceManager.getMemberDisplayers());try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.memberId===e){t={deviceType:i.deviceType,isPressed:i.isPressed,isActivity:i.isActivity,isCursorInScene:i.isCursorInScene,currentApplianceName:i.currentApplianceName,color:i.color,cursorX:i.cursorX,cursorY:i.cursorY};break}}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"refreshCursorVisibleState",value:function(e,t,n){this.setPositionProperties(e,t),this.setVisibleProperties(e),this.refreshComponentPosition(),e.currentApplianceName===fI.pencilEraser?n.eraserSize=e.eraserSize:n.eraserSize=void 0,n.setCursorMember({appliance:e.currentApplianceName,color:e.color,information:this.applianceManager.getInformationWithMemberId(this.memberId)})}},{key:"createCursor",value:function(e){return this.isCursorInScene=e.isCursorInScene,this.isPressed=e.isPressed,this.isActivity=e.isActivity,this.isKeepVisible=e.isActivity,this.cursorX=e.cursorX,this.cursorY=e.cursorY,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY,new SP({idPrefix:this.idPrefix,memberId:this.memberId,applianceManager:this.applianceManager,cursorDefinition:this.cursorDefinition,screen:this.screen,adapter:this.adapter,point:this.getCurrentComponentPosition(),cursorMember:{color:e.color,appliance:e.currentApplianceName}})}},{key:"removeCursor",value:function(e){this.cleanInactivityDelayer(),e.remove()}},{key:"updateScreenSize",value:function(){this.refreshComponentPosition()}},{key:"refreshAutorun",value:function(){this.disposer&&this.disposer(),this.disposer=(0,wP.autorun)(this.refreshState)}},{key:"dispose",value:function(){this.disposer&&(this.disposer(),this.disposer=null),this.cursor&&(this.removeCursor(this.cursor),this.cursor=null)}},{key:"setPositionProperties",value:function(e,t){if(this.mode=t.mode,this.originX=t.originX,this.originY=t.originY,this.cursorX=e.cursorX,this.cursorY=e.cursorY,this.width=t.width,this.height=t.height,this.didMouseCursorMoved)this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY;else{var n=0===this.width?1:this.screen.width/this.width,r=0===this.height?1:this.screen.height/this.height,i=(this.cursorX-this.latestCheckedCursorX)*this.width*n,a=(this.cursorY-this.latestCheckedCursorY)*this.height*r;i*i+a*a>=16&&(this.didMouseCursorMoved=!0,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY)}}},{key:"setVisibleProperties",value:function(e){var t=this.isActivity;this.isCursorInScene=e.isCursorInScene,this.isPressed=e.isPressed,this.isActivity=e.isActivity,t&&!this.isActivity?(this.delayInactivity(),this.checkMouseCursorMoved()):!t&&this.isActivity?(this.cleanInactivityDelayer(),this.isKeepVisible=!0):!this.isActivity&&this.checkMouseCursorMoved()&&this.delayInactivity(),this.refreshIsVisible()}},{key:"refreshComponentPosition",value:function(){var e;if(this.isVisible){var t=this.getCurrentComponentPosition(),n=this.getNextAnimationMode();null==(e=this.cursor)||e.component.moveTo(t.x-this.cursor.x,t.y-this.cursor.y,n)}}},{key:"getNextAnimationMode",value:function(){return this.shouldAppearNextFrame?(this.shouldAppearNextFrame=!1,yp.Immediately):this.isPressed?yp.Immediately:yp.Continuous}},{key:"getCurrentComponentPosition",value:function(){var e,t;if(this.isFollowerFixedOnScreen(this.applianceManager)&&this.mode!==iP.Freedom){var n=0===this.width?1:this.screen.width/this.width,r=0===this.height?1:this.screen.height/this.height,i=Math.min(n,r),a=(this.screen.width-i*this.width)/2,o=(this.screen.height-i*this.height)/2;e=this.cursorX*this.width*i+a-this.screen.width/2,t=this.cursorY*this.height*i+o-this.screen.height/2}else{var s=this.screen.camera,c=s.centerX,u=s.centerY,l=s.scale;e=((e=this.cursorX*this.width+this.originX)-c)*l,t=((t=this.cursorY*this.height+this.originY)-u)*l}return{x:e,y:t}}},{key:"checkMouseCursorMoved",value:function(){return!!this.didMouseCursorMoved&&(this.didMouseCursorMoved=!1,!0)}},{key:"cleanInactivityDelayer",value:function(){null!==this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)}},{key:"delayInactivity",value:function(){var e=this;null!==this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),this.isActivity||(this.isKeepVisible=!0,this.refreshIsVisible(),this.inactivityTimer=setTimeout((function(){e.isKeepVisible=!1,e.inactivityTimer=null,e.refreshIsVisible()}),5600))}},{key:"refreshIsVisible",value:function(){var e,t=this.isVisible;t||(this.shouldAppearNextFrame=!0),null==(e=this.cursor)||e.component.setVisible(this.engine,t)}}]),e}(),CP=Y(n(67294)),IP=function(e){g(n,e);var t=b(n);function n(){var e;return C(this,n),(e=t.apply(this,arguments)).onRef=function(t){var n=e.props.payload;if(!e._divElement&&t)e._divElement=t,n.onCursorComponentChanged(w(e));else if(e._divElement&&!t)try{n.onCursorComponentChanged(null)}finally{e._divElement=t}},e}return P(n,[{key:"divElement",get:function(){return this._divElement}},{key:"render",value:function(){var e=this.props,t=e.cnode,n=e.size,r=e.payload;return CP.createElement(Sh,{context:t,onRef:this.onRef,style:n},r.reactNode)}}]),n}(CP.Component);IP.isVisible=!1;var PP=function(){function e(t){var n=this;C(this,e),this.nodes={},this._isHidden=!1,this._showBuiltin=!1,this.getOverridePoint=function(e){return n.overrideCurves.get("".concat(e))},this.onAddedMember=function(e,t){var r,i=new xP({memberId:t,idPrefix:"laser-pointer-",adapter:n.builtinPointerCursorAdapter,applianceManager:e,cursorDefinition:n.cursorDefinition,engine:n.engine,screen:n.screen,isFollowerFixedOnScreen:n.isFollowerFixedOnScreen,getOverridePoint:n.getOverridePoint,willShow:function(e,r){switch(r.currentApplianceName){case fI.laserPointer:return n.enableLaser&&t!==n.observerId||n._showBuiltin;case fI.eraser:case fI.pencilEraser:return t===n.observerId&&n._showBuiltin;default:return!1}}});n.cursorAdapter&&(r=new xP({memberId:t,idPrefix:"cursor-",adapter:n.cursorAdapter,applianceManager:e,cursorDefinition:n.cursorDefinition,engine:n.engine,screen:n.screen,isFollowerFixedOnScreen:n.isFollowerFixedOnScreen,getOverridePoint:n.getOverridePoint,willShow:function(e,r){return t!==n.observerId&&r.currentApplianceName!==fI.laserPointer}})),n.nodes[t]={builtinPointer:i,cursor:r}},this.onRemovedMember=function(e,t){var r,i=n.nodes[t];i&&(delete n.nodes[t],i.builtinPointer.dispose(),null==(r=i.cursor)||r.dispose())},this.onRefreshed=function(){var e;for(var t in n.nodes){var r=n.nodes[t];r.builtinPointer.refreshAutorun(),null==(e=r.cursor)||e.refreshAutorun()}},this.isFollowerFixedOnScreen=function(e){var t=e.getViewState(n.observerId);return!!t&&(t.mode===iP.Broadcaster||t.mode===iP.Follower)},this.screen=t.screen,this.members=t.members,this.engine=this.getMouseCursorEngine(t.appVersion,t.engine),this.observerId=t.observerId,this.cursorAdapter=t.adapter,this._isHidden=t.isHidden,this.enableLaser=t.enableLaser,this.builtinPointerCursorAdapter=new kP,this.overrideCurves=yP.observable.map({}),this.cursorDefinition=Sp({name:"Cursor"}),this.engine.bind(this.cursorDefinition)(IP),this.members.forEach(this.onAddedMember),this.members.callbacks.on("onAdded",this.onAddedMember),this.members.callbacks.on("onRemoved",this.onRemovedMember),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,yP.makeObservable)(this,{observerId:yP.observable,_isHidden:yP.observable,_showBuiltin:yP.observable,setHidden:yP.action,setShowBuiltin:yP.action,updateObserverId:yP.action,putOverrideCursor:yP.action,removeOverrideCursors:yP.action})}return P(e,[{key:"isHidden",get:function(){return this._isHidden}},{key:"setHidden",value:function(e){this._isHidden!==e&&(this._isHidden=e)}},{key:"showBuiltin",get:function(){return this._showBuiltin}},{key:"setShowBuiltin",value:function(e){this._showBuiltin!==e&&(this._showBuiltin=e)}},{key:"updateObserverId",value:function(e){this.observerId=e}},{key:"updateScreenSize",value:function(){var e;for(var t in this.nodes){var n=this.nodes[t];n.builtinPointer.updateScreenSize(),null==(e=n.cursor)||e.updateScreenSize()}}},{key:"putOverrideCursor",value:function(e,t,n){this.overrideCurves.set("".concat(e),{x:t,y:n})}},{key:"removeOverrideCursors",value:function(e){this.overrideCurves.delete("".concat(e))}},{key:"release",value:function(){var e,t;for(var n in this.members.callbacks.off("onAdded",this.onAddedMember),this.members.callbacks.off("onRemoved",this.onRemovedMember),this.members.callbacks.off("onRefreshed",this.onRefreshed),this.nodes){var r=this.nodes[n];null==(e=r.builtinPointer)||e.dispose(),null==(t=r.cursor)||t.dispose(),delete this.nodes[n]}}},{key:"getMouseCursorEngine",value:function(e,t){if(t)return t;switch(e){case"2.0.0":return this.screen.scene.getEngineWithLegacyLayout(4);case"2.1.0":return this.screen.scene.getEngineWithLegacyLayout(5);default:throw new Error("invalid app version "+e)}}}]),e}();function MP(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.toDataURL("screenshot")}var TP,AP=function(){function e(t,n,r,i,a,o){var s,c=this;C(this,e),this.screenshotEngines={},this._maskScreenObserverId=!0,this.onScreenSizeUpdated=function(e){c.cameraBoundState.setScreenSize(e),c._cursors&&c._cursors.updateScreenSize(),c.render.refreshSceneComponents(),c._onScreenSizeUpdated&&c._onScreenSizeUpdated(e)},this.updateCursorClassBySelector=function(e){if(c.applianceManager){var t=c.applianceManager.getMemberState();t&&t.currentApplianceName===fI.selector&&c.updateCursorClass(e)}},this.reportCurveTailUpdate=function(e,t,n){var r;null==(r=c._cursors)||r.putOverrideCursor(e,t,n)},this.reportCurveComplete=function(e){var t;null==(t=c._cursors)||t.removeOverrideCursors(e)},this.interruptEvent=function(e){var t=!1;return c.eventInterrupter&&(t=c.eventInterrupter(e)),c.view.handleNativeEvent(e),t};var u=r.modules,l=u.WhiteRender,h=l.cleanCurveAnimes,d=l.WhiteboardRender;this.engines=r.engines,this.modules=r.modules,this.pluginManager=r.pluginManager,this.applianceManager=r.applianceManager,this.enableAssignScene=!!this.applianceManager.enableAssignScene,this.members=r.members,this.dynamicPpt=r.dynamicPpt,this.bezierCurvePainter=r.bezierCurvePainter,this.view=t,this._isCursorsHidden=a,this.observerId=n.observerId,this.mouseFollower=i.mouseFollowerHub.createMouseFollower();var p=this.applianceManager.getViewState(),f=this.createScene(i.boundless,i.logger,i.renderEngine,u),v=Object.freeze(H(W({},n),{view:t,icons:aC,observerId:this.screenObserverId(n),deviceType:i.boundless.deviceType,dynamicPpt:this.dynamicPpt,disalbeImageHit:!1,disableOthersSelectingBox:!1,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,mouseFollower:this.mouseFollower,fontFamily:i.fontFamily,convertIdToUrl:i.urlInterrupter,updateTextarea:t.updateTextarea,updateCursorClass:this.updateCursorClassBySelector,enableSelfCurveAnime:i.enableSelfCurveAnime,enableCurveAnimes:!i.disableCurveAnimes,enableRotation:!i.disableRotation,enableVectorOperator:!0,disableNewPencilStroke:i.disableNewPencilStroke,reportCurveTailUpdate:this.reportCurveTailUpdate,reportCurveComplete:this.reportCurveComplete,floatBarClass:i.floatBarClass,textareaHub:t.textareaHub}));if(this.screen=f.createScreen({className:"netless-whiteboard",context:v,engines:null==(s=this.engines)?void 0:s.enginesList,autoResize:i.autoResize,eventInterrupter:this.interruptEvent,wrappedComponents:i.wrappedComponents,onRenderDuration:function(e){return c.view.fireRenderDuration(e)}}),this.mouseFollower.initScreen(this.screen),this.eventInterrupter=i.eventInterrupter,this.onCatchErrorWhenRender=i.onCatchErrorWhenRender,this._onScreenSizeUpdated=i.onScreenSizeUpdated,i.onCatchErrorWhenRender&&this.screen.addRenderErrorCatchedListener(i.onCatchErrorWhenRender),this.screen.addSizeUpdatedListener(this.onScreenSizeUpdated),o){var m=o.cameraBoundState;this.cameraBoundState=new pI(this.screen,m.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=m.cameraman.disableBoundlessEvent,this.cameraBoundState.cameraman.disableCameraTransform=m.cameraman.disableCameraTransform,this.cameraBoundState.cameraman.handToolKey=m.cameraman.handToolKey}else this.cameraBoundState=new pI(this.screen,i.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=i.disableOperations,this.cameraBoundState.cameraman.handToolKey=i.handToolKey;this.cameraBoundState.cameraman.adaptRectangle({originX:p.originX,originY:p.originY,width:p.width,height:p.height,adapterMode:pp.Centering,animationMode:yp.Immediately}),this.cleanCurveAnimes=h,this.render=new d(this.screen,this.pluginManager,this.applianceManager,this.engines),this.setupViewContextState(t.state),setTimeout((function(){var e;c._cursors=new PP({appVersion:r.appVersion,members:c.members,screen:c.screen,engine:null==(e=c.engines)?void 0:e.engines.mouseCurosrEngine,observerId:c.observerId,isHidden:c._isCursorsHidden,enableLaser:i.enableLaser,adapter:i.cursorAdapter})}),0)}var t,n;return P(e,[{key:"isCursorsHidden",get:function(){return this._isCursorsHidden},set:function(e){this._isCursorsHidden!==e&&(this._isCursorsHidden=e,this._cursors&&this._cursors.setHidden(this._isCursorsHidden))}},{key:"maskFloatBar",get:function(){return this.render.maskFloatBar},set:function(e){this.render.maskFloatBar=e}},{key:"cursors",get:function(){return this._cursors}},{key:"updateState",value:function(e){"cameraBound"in e&&this.cameraBoundState.setCameraBound(e.cameraBound),this.syncCameraMoving(e.cameraMoving),"disableCameraTransform"in e&&(this.cameraman.disableCameraTransform=e.disableCameraTransform),"handToolActive"in e&&(this.cameraman.handToolActive=e.handToolActive),"handToolKey"in e&&(this.cameraman.handToolKey=e.handToolKey),"divElement"in e&&(this.screen.divElement=e.divElement)}},{key:"syncCameraMoving",value:function(e){if(e){var t=e.camera,n=e.toContaint;if(t){var r=t.animationMode||yp.Continuous;this.cameraman.transformCamera(H(W({},t),{animationMode:r}))}else if(n){var i=n.animationMode||yp.Continuous;this.cameraman.adaptRectangle(H(W({},n),{animationMode:i,adapterMode:pp.Centering}))}}}},{key:"setupViewContextState",value:function(e){this.cameraBoundState.setCameraBound(e.cameraBound),this.syncCameraMoving(e.cameraMoving),this.cameraman.transformCamera(H(W({},e.cameraMoving),{animationMode:yp.Immediately})),this.cameraman.disableCameraTransform=e.disableCameraTransform,this.cameraman.handToolActive=e.handToolActive,this.cameraman.handToolKey=e.handToolKey,this.screen.divElement=e.divElement}},{key:"createScene",value:function(e,t,n,r){var i=r.WhiteRender;if(i.createLayoutDescriptions){var a=i.createLayoutDescriptions(n);return e.createSceneWithLegacyLayoutDescriptions(a,t)}return e.createScene(t)}},{key:"scenePath",get:function(){return"/"+this.applianceManager.getCurrentScenePath().join("/")}},{key:"foucsScenePath",get:function(){return this.render.foucsScenePath},set:function(e){this.render.foucsScenePath=e}},{key:"cameraman",get:function(){return this.cameraBoundState.cameraman}},{key:"maskScreenObserverId",get:function(){return this._maskScreenObserverId},set:function(e){this._maskScreenObserverId!==e&&(this._maskScreenObserverId=e,this.screen.context=Object.freeze(H(W({},this.screen.context),{observerId:e?an:this.observerId})))}},{key:"sceneIdentifier",value:function(e){var t=Xx.parse(e),n=this.applianceManager.scenes.getScene(t);return null==n?void 0:n.id}},{key:"setCommonScreenContext",value:function(e){var t,n=this.observerId,r=e.observerId;this.screen.context=Object.freeze(H(W(W({},this.screen.context),e),{observerId:this.screenObserverId(e)})),n!==r&&(this.observerId=r,null==(t=this._cursors)||t.updateObserverId(r))}},{key:"setCameraBound",value:function(e){this.cameraBoundState.setCameraBound(e)}},{key:"resizeScreen",value:function(){this.screen.resize()}},{key:"refreshRender",value:function(){this.render.refreshSceneComponents()}},{key:"fireReloadLibrary",value:function(){this.render.rebuildSceneRender&&this.render.rebuildSceneRender(),this.stopCurveAnimesAndRemoveOverrideCursors()}},{key:"refreshCameraToFocus",value:function(){var e=this.applianceManager.getViewState(),t={originX:e.originX,originY:e.originY,width:e.width,height:e.height};this.screen.adaptRectangle(H(W({},t),{animationMode:yp.Continuous,adapterMode:pp.Centering}))}},{key:"getTargetsMap",value:function(e,t){var n,r=e.component,i=e.engine,a=this.modules.WhiteModel.ApplianceComponent;return ms(r.payload,a)&&(n=this.render.getTargetsMap?this.render.getTargetsMap(r,t):this.render.findTargetsMap(r.id,i.orderIndex,t)),n}},{key:"cleanScreen",value:function(){var e;null==(e=this.render)||e.clean()}},{key:"release",value:function(){var e;this.onCatchErrorWhenRender&&this.screen.removeRenderErrorCatchedListener(this.onCatchErrorWhenRender),this.screen.removeSizeUpdatedListener(this.onScreenSizeUpdated),null==(e=this._cursors)||e.release(),this.render.release(),this.cameraBoundState.cameraman.release(),this.mouseFollower.release()}},{key:"scenePreview",value:function(e,t,n,r,i){var a=this.modules.WhiteRender,o=a.screenshot,s=a.EnginesHub;if(o){var c=i||rP.SVG;this.screenshotEngines[c]||(this.screenshotEngines[c]=s&&new s(c));var u=Xx.parse(e),l=this.screen,h=n,d=r;h="number"!=typeof h?t.clientWidth:h,d="number"!=typeof d?t.clientHeight:d;var p=1;0!==l.width&&0!==l.height&&(p=Math.min(h/l.width,d/l.height)*l.camera.scale);var f={centerX:l.camera.centerX,centerY:l.camera.centerY,scale:p},v=o({applianceManager:this.applianceManager,engines:this.screenshotEngines[c],pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:h,height:d,path:u,camera:f});if(!(0,pP.isValidElement)(v))throw new Error("scene preview must render ReactElement");dP.render(v,t)}}},{key:"fillSceneSnapshot",value:function(e,t,n,r,i){var a=this.modules.WhiteRender,o=a.screenshot,s=a.EnginesHub;if(o){var c=i||rP.SVG;this.screenshotEngines[c]||(this.screenshotEngines[c]=s&&new s(c));var u=Xx.parse(e),l=n,h=r;l="number"!=typeof l?t.clientWidth:l,h="number"!=typeof h?t.clientHeight:h;var d=o({applianceManager:this.applianceManager,engines:this.screenshotEngines[c],pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:l,height:h,path:u});if(!(0,pP.isValidElement)(d))throw new Error("scene preview must render ReactElement");dP.render(d,t)}}},{key:"generateScreenshot",value:(n=u(regeneratorRuntime.mark((function e(t,n,r){var i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t?(a=Xx.parse(t),i=this.applianceManager.scenes.getScene(a)):i=this.applianceManager.scene,i){e.next=3;break}throw new Error("cannot find scene with path ".concat(JSON.stringify(t)));case 3:if(!(o=this.findBackgroundImage(i))){e.next=10;break}return e.next=7,this.generateImage(o,n,r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=MP(1,1);case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"findBackgroundImage",value:function(e){for(var t=this.modules.WhiteModel.BackgroundImage,n=0;n<e.componentsLength;++n){var r=e.componentAt(n);if(ms(r,t))return r}return null}},{key:"generateImage",value:(t=u(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,h,d,p,f,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),o=r,void 0===(a=n)&&(a=t.width),void 0===o&&(o=t.height),i.width=a,i.height=o,!(s=t.previewURL)&&/^https?:\/\//im.test(t.src)&&(s=t.src),!s){e.next=14;break}return e.next=6,fP(s);case 6:c=e.sent,u=i.getContext("2d"),l=Math.min(a/t.width,o/t.height),h=t.width*l,d=t.height*l,p=(a-h)/2,f=(o-d)/2,u.drawImage(c,p,f,h,d);case 14:return e.next=16,new Promise((function(e){return i.toBlob((function(t){return e(t)}))}));case 16:return v=e.sent,e.abrupt("return",URL.createObjectURL(v));case 18:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"stopCurveAnimesAndRemoveOverrideCursors",value:function(){if(this.cleanCurveAnimes){var e=this.cleanCurveAnimes();if(this._cursors){var t,n=T(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this._cursors.removeOverrideCursors(r)}}catch(e){n.e(e)}finally{n.f()}}}}},{key:"updateCursorClass",value:function(e){this.screen.className=null!==e?"netless-whiteboard "+e:"netless-whiteboard"}},{key:"updateCursorStyle",value:function(e){this.screen.style=null===e?void 0:{cursor:e}}},{key:"screenObserverId",value:function(e){var t=e.observerId;return this._maskScreenObserverId?an:t}}]),e}(),EP=Y(n(68949)),OP=function(){function e(t,n,r,i){var a,o=this;C(this,e),this.scenePath=t,this.applianceManager=n,this.isWritable=r,this.disposer=(0,EP.autorun)((function(){var e=o.applianceManager.scenes,n=Xx.parse(t),r=e.getScene(n);a?o.onSceneUpdate(r):a=r})),a||this.disposer(),this.onBecomeInvlaid=i,this.focusScene=a}return P(e,[{key:"isValid",get:function(){return!!this.focusScene}},{key:"identifier",get:function(){var e;return null==(e=this.focusScene)?void 0:e.id}},{key:"dispose",value:function(){if(this.focusScene&&(this.focusScene=void 0,this.disposer(),this.isWritable())){var e=Xx.parse(this.scenePath);this.applianceManager.notifyThatSceneChanged(e)}}},{key:"onSceneUpdate",value:function(e){this.focusScene&&this.focusScene!==e&&(this.focusScene=void 0,this.disposer(),this.onBecomeInvlaid())}}]),e}(),RP=function(){function e(){C(this,e),this.appliance=null,this.pencilOptions=null,this.applianceName=null,this.shouldInterrupt=!1,this.isShiftKeyPressed=!1,this.isCtrlKeyPress=!1,this.isAltKeyPress=!1}return P(e,[{key:"interruptKeyEvent",value:function(e,t){var n,r,i,a=this.isShiftKeyPressed,o=this.isCtrlKeyPress,s=this.isAltKeyPress,c=!1;if(this.shouldInterrupt)switch(t){case wu.KeyDown:switch(e){case"lock":a=!0,c=!0;break;case"lockCenter":o=!0,c=!0;break;case"pencilPaintCircular":s=!0,c=!0}break;case wu.KeyUp:switch(e){case"lock":a=!1,c=!0;break;case"lockCenter":o=!1,c=!0;break;case"pencilPaintCircular":s=!1,c=!0}}return c&&(this.isShiftKeyPressed!==a&&(this.isShiftKeyPressed=a,null==(n=this.appliance)||n.notifyShiftPress(a)),this.isCtrlKeyPress!==o&&(this.isCtrlKeyPress=o,null==(r=this.appliance)||r.notifiyCtrlPress(o)),this.isAltKeyPress!==s&&(this.isAltKeyPress=s,null==(i=this.appliance)||i.notifiyAltPress(s))),c}},{key:"setAppliance",value:function(e){var t,n,r;this.appliance!==e&&(this.appliance=e,null==(t=this.appliance)||t.notifyShiftPress(this.isShiftKeyPressed),null==(n=this.appliance)||n.notifiyCtrlPress(this.isCtrlKeyPress),null==(r=this.appliance)||r.notifiyAltPress(this.isAltKeyPress))}},{key:"setApplianceName",value:function(e){var t=e||null;this.applianceName!==t&&(this.applianceName=t,this.refreshShouldIterrupt())}},{key:"setPencilOptions",value:function(e){this.pencilOptions!==e&&(this.pencilOptions=e,this.refreshShouldIterrupt())}},{key:"refreshShouldIterrupt",value:function(){var e,t;t=!(!this.pencilOptions||null===this.applianceName)&&this.pencilOptions.shouldUseNewPencil(this.applianceName),this.shouldInterrupt!==t&&(this.shouldInterrupt=t,t||(this.isShiftKeyPressed=!1),null==(e=this.appliance)||e.notifyShiftPress(this.isShiftKeyPressed))}}]),e}();function NP(e){for(var t in e)return!0;return!1}!function(e){e[e.FollowSceneAndCamera=0]="FollowSceneAndCamera",e[e.FollowScene=1]="FollowScene",e[e.Freedom=2]="Freedom"}(TP||(TP={}));var LP=function(e){g(n,e);var t=b(n);function n(e,r,i,a,o,s,c){var u;return C(this,n),(u=t.call(this,o)).extraWrappedComponents=Object.freeze([]),u.didRelease=!1,u.wannaFocusScenePath=void 0,u.input=null,u._mode=2,u.updateTextarea=function(e,t,n){var r;u.params.displayer.isEnableModify()&&(u.node.applianceManager.updateTextarea(e,t,u.focusSceneId),null==(r=u.undoWatcher)||r.stack.onTextareaUpdate(!!n))},u.isDisplayerWritable=function(){var e=u.params.displayer;return!!cP(e)&&e.isWritable},u.onSizeUpdated=function(e){var t=e.width,n=e.height;u._size=Object.freeze({width:t,height:n}),u._callbacks.dispatch("onSizeUpdated",(function(e){return e(u._size)}))},u.onCameraUpdated=function(e){u._camera=Object.freeze({centerX:e.centerX,centerY:e.centerY,scale:e.scale}),"string"==typeof e.operatorId&&u._callbacks.dispatch("onCameraUpdatedByDevice",(function(e){return e(u._camera)})),u._callbacks.dispatch("onCameraUpdated",(function(e){return e(u._camera)}))},u.onKeyPressed=function(e){var t,n=u.params,r=n.hotKeys;if(n.displayer.isEnableModify()){if(r){var i=e,a=r.checkHotKey(i);a&&!u.pencilKeyInterrupter.interruptKeyEvent(a,i.kind)&&(u.handleHotKey(a,e),null==(t=e.nativeEvent)||t.preventDefault())}switch(e.kind){case wu.KeyDown:u._callbacks.dispatch("onKeyDown",(function(t){return t(e.nativeEvent)}));break;case wu.KeyUp:u._callbacks.dispatch("onKeyUp",(function(t){return t(e.nativeEvent)}))}}},u.onMetaKeyUp=function(e){var t,n=u.params,r=n.hotKeys;if(n.displayer.isEnableModify()&&r){var i={nativeEvent:e,kind:wu.KeyUp,key:"Meta",altKey:!1,ctrlKey:!1,shiftKey:!1},a=r.checkHotKey(i);a&&!u.pencilKeyInterrupter.interruptKeyEvent(a,"KeyUp")&&(u.handleHotKey(a,i),null==(t=i.nativeEvent)||t.preventDefault())}},u.onTouchPressUpdate=function(e){var t=u.node.cursors;if(t&&!u.params.willHideSelfCursor)if(e){var n=u.node.applianceManager.getMemberState();(null==n?void 0:n.currentApplianceName)&&t.setShowBuiltin(!0)}else t.setShowBuiltin(!1)},u.onBoundlessEvent=function(e){var t;null==(t=u.input)||t.pushEvent(e)},u.onPreEndTouchEvent=function(e){var t;null==(t=u.input)||t.pushPreEndTouchEvent(e)},u.onHandToolActive=function(e){u._callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))},u.onCameraTransformation=function(e){u._callbacks.dispatch("onCameraTransform",(function(t){return t(e)}))},u.updateScenePath=function(e){if(!u.latestSceneInfo||e!==u.latestSceneInfo.path){var t=u.node.sceneIdentifier(e);u.latestSceneInfo={id:t,path:e},u.undoWatcher&&!u.focusScene&&u.undoWatcher.watch(t)}},u.id=e,u.textareaHub=i.enableTextareHub?new vC:void 0,u.floatBarDelegate=u.createFloatBarDelegate(),u.commonScreenContext=r,u.params=i,u.node=new AP(w(u),r,a,i,u.shouldHideCursors(a)),u.node.maskScreenObserverId=!1,u.node.maskFloatBar=!1,u.mobxDisposer=u.startWatchScenePath(),u.pencilKeyInterrupter=new RP,u.delegate=s,u._callbacks=new Vx(c),u.undoWatcher=u.createUndoStackWatcher(i.undoStacksHub),u.registerScreenAndCameraman(u.node.screen,u.node.cameraman),u}return P(n,[{key:"scenePath",get:function(){return this.latestSceneInfo.path}},{key:"focusScenePath",get:function(){return this.wannaFocusScenePath},set:function(e){var t=this;this.wannaFocusScenePath!==e&&(this.node.foucsScenePath!==e&&!this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate((function(){var n,r,i,a;if(null==(n=t.focusScene)||n.dispose(),t.focusScene=void 0,e){var o=new OP(e,t.node.applianceManager,t.isDisplayerWritable,(function(){var e,n;t.didRelease||(t.focusScene=void 0,t.node.foucsScenePath=void 0,t.wannaFocusScenePath=void 0,null==(e=t.input)||e.fireSceneUpdate(),null==(n=t.undoWatcher)||n.watch(t.latestSceneInfo.id))}));o.isValid&&(t.focusScene=o)}t.focusScene?(t.node.foucsScenePath=e,null==(r=t.undoWatcher)||r.watch(t.focusScene.identifier)):(t.node.foucsScenePath=void 0,null==(i=t.undoWatcher)||i.watch(t.latestSceneInfo.id)),null==(a=t.input)||a.fireSceneUpdate()})),this.wannaFocusScenePath=this.node.foucsScenePath)}},{key:"focusSceneIndex",get:function(){if(void 0!==this.wannaFocusScenePath)for(var e=Xx.parse(this.wannaFocusScenePath),t=e.pop(),n=this.node.applianceManager.getSceneNames(e),r=0;r<n.length;++r)if(n[r]===t)return r},set:function(e){if(void 0===e)this.focusScenePath=void 0;else if(this.wannaFocusScenePath){var t=Xx.parse(this.wannaFocusScenePath),n=t.pop(),r=this.node.applianceManager.getSceneNames(t)[e];void 0!==r&&r!==n&&(t.push(r),this.focusScenePath=Xx.stringify(t))}}},{key:"focusSceneId",get:function(){var e;return null==(e=this.focusScene)?void 0:e.identifier}},{key:"disableCameraTransform",get:function(){return this.state.disableCameraTransform},set:function(e){this.putState({disableCameraTransform:e})}},{key:"disableKey",get:function(){return!this.input||this.input.disableKey},set:function(e){if(!this.input)throw new Error("cannot modify disableKey");this.input.disableKey=e}},{key:"callbacks",get:function(){return this._callbacks}},{key:"mode",get:function(){return this._mode},set:function(e){var t=this;this.assertNotRelease(),this._mode!==e&&this.watchScenePathUpdate((function(){var n;t.shouldFollowCamera(e)&&!t.shouldFollowCamera(t._mode)&&t.node.refreshCameraToFocus(),t.shouldFollowScene(e)&&!t.shouldFollowScene(t._mode)?t.node.foucsScenePath=void 0:!t.shouldFollowScene(e)&&t.shouldFollowScene(t._mode)&&(t.node.foucsScenePath=t.wannaFocusScenePath),null==(n=t.input)||n.fireSceneUpdate(),t._mode=e}))}},{key:"wrappedComponents",get:function(){return this.extraWrappedComponents},set:function(e){this.extraWrappedComponents=Object.freeze(p(e)),this.node.screen.wrappedComponents=[].concat(p(e),p(this.params.wrappedComponents))}},{key:"fireReloadLibrary",value:function(){this.node.fireReloadLibrary()}},{key:"setupViewInput",value:function(e){var t;this.input=new JI(e,this.undoWatcher,this.pencilKeyInterrupter,this.node.mouseFollower,this.onKeyPressed,this.onMetaKeyUp,this.onTouchPressUpdate),this.pencilKeyInterrupter.setApplianceName(null==(t=e.magix.trigger.getMemberState())?void 0:t.currentApplianceName),this.pencilKeyInterrupter.setPencilOptions(e.pencilOptions)}},{key:"releaseViewInput",value:function(){this.input&&(this.input.release(),this.input=null)}},{key:"createUndoStackWatcher",value:function(e){var t;return e&&((t=e.createWatcher(this.latestSceneInfo.id)).forwardTo("onCanRedoStepsUpdate",this._callbacks),t.forwardTo("onCanUndoStepsUpdate",this._callbacks)),t}},{key:"shouldFollowCamera",value:function(e){return 0===e}},{key:"shouldHideCursors",value:function(e){var t="/"+e.applianceManager.getCurrentScenePath().join("/");return!(!this.wannaFocusScenePath||this.shouldFollowScene(this._mode)||t===this.wannaFocusScenePath)}},{key:"shouldFollowScene",value:function(e){switch(e){case 0:case 1:return!0;default:return!1}}},{key:"canUndoSteps",get:function(){return this.undoWatcher?this.undoWatcher.stack.canUndoSteps:0}},{key:"canRedoSteps",get:function(){return this.undoWatcher?this.undoWatcher.stack.canRedoSteps:0}},{key:"undoStack",get:function(){var e;return null==(e=this.undoWatcher)?void 0:e.stack}},{key:"camera",get:function(){return this._camera}},{key:"size",get:function(){return this._size}},{key:"screen",get:function(){return this.node.screen}},{key:"cameraman",get:function(){return this.node.cameraman}},{key:"divElement",get:function(){return this.state.divElement},set:function(e){this.putState({divElement:e})}},{key:"getTargetsMap",value:function(e,t){return this.node.getTargetsMap(e,t)}},{key:"cancelCurrentContinuityEvent",value:function(){this.cameraman.cancelCurrentContinuityEvent()}},{key:"setCommonScreenContext",value:function(e){this.assertNotRelease(),this.commonScreenContext=e,this.node.setCommonScreenContext(e)}},{key:"updateContext",value:function(e){var t=this,n=this.node.maskFloatBar;this.assertNotRelease(),this.node.cleanScreen(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.node=new AP(this,this.commonScreenContext,e,this.handleUpdatedParams(this.params),this.shouldHideCursors(e),this.node),this.node.maskScreenObserverId=!1,this.node.maskFloatBar=n,this.input&&(this.input.mouseFollower=this.node.mouseFollower),this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate((function(){var e;t.node.foucsScenePath=t.wannaFocusScenePath,null==(e=t.input)||e.fireSceneUpdate()})),this.registerScreenAndCameraman(this.node.screen,this.node.cameraman)}},{key:"handleUpdatedParams",value:function(e){return 0===this.extraWrappedComponents.length?e:H(W({},e),{wrappedComponents:[].concat(p(this.extraWrappedComponents),p(e.wrappedComponents))})}},{key:"setMemberState",value:function(e){var t=this;return this.params.setMemberStateWrapper(e,this,(function(e){var n,r=t.node.applianceManager,i=null==(n=r.getMemberState())?void 0:n.currentApplianceName,a=r.setMemberStateWithCommitter(e),o=a.memberState,s=a.committer;if(t.undoWatcher&&s&&t.undoWatcher.stack.commit(s),"currentApplianceName"in o){var c=o.currentApplianceName;c!==i&&(t.pencilKeyInterrupter.setApplianceName(c),t.checkApplianceNameUpdate(c),t.refreshCursorHideObserverIdNeed(c))}return o}))}},{key:"checkApplianceNameUpdate",value:function(e){var t,n=null==(t=this.input)?void 0:t.virtualKeyboardHelper;if(n)switch(e){case fI.text:n.catchPress=!0,n.catchTarget=null,this.textareaHub&&(this.textareaHub.onWaitingTouchRefChanged=void 0);break;case fI.selector:n.catchPress=!1,n.catchTarget=null,this.textareaHub&&(this.textareaHub.onWaitingTouchRefChanged=function(e,t){e&&1===t?(n.catchPress=!0,n.catchTarget=e):(n.catchPress=!1,n.catchTarget=null)});break;default:n.catchPress=!1,n.catchTarget=null,this.textareaHub&&(this.textareaHub.onWaitingTouchRefChanged=void 0)}}},{key:"setCameraBound",value:function(e){this.putState({cameraBound:e})}},{key:"moveCamera",value:function(e){this.putState({cameraMoving:{camera:e}})}},{key:"moveCameraToContain",value:function(e){this.putState({cameraMoving:{toContaint:e}})}},{key:"insertImage",value:function(e){this.params.displayer.isEnableModify()&&this.node.applianceManager.insertImage(e,this.focusSceneId)}},{key:"lockImage",value:function(e,t){this.params.displayer.isEnableModify()&&this.node.applianceManager.lockImage(e,t,this.focusSceneId)}},{key:"lockImages",value:function(e){this.params.displayer.isEnableModify()&&this.node.applianceManager.lockImages(e,this.focusSceneId)}},{key:"updatePencilColor",value:function(e){this.params.displayer.isEnableModify()&&this.node.applianceManager.updatePencilColor(e,this.focusSceneId)}},{key:"completeImageUpload",value:function(e,t){if(this.params.displayer.isEnableModify()){var n=this.node.applianceManager.completeImageUpload(e,t,this.focusSceneId);this.undoWatcher&&n&&this.undoWatcher.stack.commit(n)}}},{key:"insertText",value:function(e,t,n){var r=this;if(this.textareaHub&&this.params.displayer.isEnableModify()){var i=this.node.applianceManager.insertTextarea(e,t,this.focusSceneId);if(n){var a=this.node.applianceManager.getMemberState();if(a){var o={bold:a.bold,italic:a.italic,underline:a.underline,lineThrough:a.lineThrough};setTimeout((function(){var e,t=r.textareaHub.getTextareaRect(i,o,n);if(t){var a={width:t.width,height:t.height,scale:t.scale,textLines:[],originalText:n};r.node.applianceManager.updateTextarea(a,i,r.focusSceneId),null==(e=r.undoWatcher)||e.stack.onTextareaUpdate(n.length>0)}}),100)}}return i}return mt}},{key:"updateText",value:function(e,t){var n;if(0===t.length)throw new Error("make text blank");if(this.textareaHub&&this.params.displayer.isEnableModify()){var r=this.node.applianceManager.getMemberState(),i={bold:r.bold,italic:r.italic,underline:r.underline,lineThrough:r.lineThrough},a=this.textareaHub.getTextareaRect(e,i,t);if(!a)throw new Error("text ".concat(e," not exits or invisible"));var o={width:a.width,height:a.height,scale:a.scale,textLines:[],originalText:t};this.node.applianceManager.updateTextarea(o,e,this.focusSceneId),null==(n=this.undoWatcher)||n.stack.onTextareaUpdate(!0)}}},{key:"updateSelectedText",value:function(e){var t;if(this.params.displayer.isEnableModify()){var n=this.getTextMemberState(e);if(this.textareaHub&&NP(n)){var r=this.textareaHub.getTextareaSizeMap(e),i=this.node.applianceManager.updateTextareaFormat(e,r,this.focusSceneId);this.undoWatcher&&i&&this.undoWatcher.stack.commit(i)}if(void 0!==e.fontSize){var a=this.node.applianceManager.updateTextareaFontSize(e.fontSize,this.focusSceneId);this.undoWatcher&&a&&this.undoWatcher.stack.commit(a),n.textSize=e.fontSize}NP(n)&&(null==(t=this.params.memberStateStorage)||t.setMemberState(n),this.node.applianceManager.setMemberState(n))}}},{key:"updateTextFormat",value:function(e){var t;if(this.textareaHub){var n=this.getTextMemberState(e);null==(t=this.params.memberStateStorage)||t.setMemberState(n),this.node.applianceManager.setMemberState(n);var r=this.textareaHub.getTextareaSizeMap(e),i=this.node.applianceManager.updateTextareaFormat(e,r,this.focusSceneId);this.undoWatcher&&i&&this.undoWatcher.stack.commit(i)}}},{key:"getTextMemberState",value:function(e){var t={};return"bold"in e&&(t.bold=e.bold),"italic"in e&&(t.italic=e.italic),"underline"in e&&(t.underline=e.underline),"lineThrough"in e&&(t.lineThrough=e.lineThrough),"color"in e&&(t.textColor=e.color),t}},{key:"delete",value:function(){if(this.params.displayer.isEnableModify()){var e=this.node.applianceManager.delete(null,this.focusSceneId);this.undoWatcher&&e&&this.undoWatcher.stack.commit(e)}}},{key:"duplicate",value:function(){var e=this.params,t=e.displayer,n=e.copyOperator;if(n&&t.isEnableModify()){var r=n.duplicate(this.node.applianceManager,this.focusSceneId);this.undoWatcher&&r&&this.undoWatcher.stack.commit(r)}}},{key:"redo",value:function(){var e,t;return null==(e=this.undoWatcher)||e.stack.redo(this.focusScenePath,this.focusSceneId),(null==(t=this.undoWatcher)?void 0:t.stack.canRedoSteps)||0}},{key:"undo",value:function(){var e,t;return null==(e=this.undoWatcher)||e.stack.undo(this.focusScenePath,this.focusSceneId),(null==(t=this.undoWatcher)?void 0:t.stack.canUndoSteps)||0}},{key:"copy",value:function(){var e=this.params,t=e.displayer,n=e.copyOperator;n&&t.isEnableModify()&&n.copy(this.node.applianceManager,this.focusSceneId)}},{key:"paste",value:function(){var e=this.params,t=e.displayer,n=e.copyOperator;if(n&&t.isEnableModify()){var r=n.paste(this.node.applianceManager,this.focusSceneId);this.undoWatcher&&r&&this.undoWatcher.stack.commit(r)}}},{key:"cleanCurrentScene",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.params.displayer.isEnableModify()){var t=this.node.applianceManager.cleanCurrentScene(e,this.focusSceneId);this.undoWatcher&&t&&this.undoWatcher.stack.commit(t)}}},{key:"moveSelectedComponentsToTop",value:function(){this.params.displayer.isEnableModify()&&this.node.applianceManager.moveSelectedComponentsToTop(null)}},{key:"moveSelectedComponentsToBottom",value:function(){this.params.displayer.isEnableModify()&&this.node.applianceManager.moveSelectedComponentsToBottom(null)}},{key:"updateDisableBoundlessEvent",value:function(e){this.node.cameraman.disableBoundlessEvent=e}},{key:"updateCursorClass",value:function(e){this.node.updateCursorClass(e)}},{key:"updateCursorStyle",value:function(e){this.node.updateCursorStyle(e)}},{key:"resizeScreen",value:function(){this.node.resizeScreen()}},{key:"refreshRender",value:function(){var e=this;this.watchScenePathUpdate((function(){return e.node.refreshRender()}))}},{key:"scenePreview",value:function(e,t,n,r,i){return this.node.scenePreview(e,t,n,r,i)}},{key:"generateScreenshot",value:function(e,t,n){return this.node.generateScreenshot(e,t,n)}},{key:"fillSceneSnapshot",value:function(e,t,n,r,i){this.node.fillSceneSnapshot(e,t,n,r,i)}},{key:"convertToPointInWorld",value:function(e){var t=e.x,n=e.y;return this.node.screen.convertPointToScene(t,n)}},{key:"convertToPointOnScreen",value:function(e,t){return this.node.screen.convertPointToScreen(e,t)}},{key:"fireRenderDuration",value:function(e){this._callbacks.dispatch("onRenderDuration",(function(t){return t(e)}))}},{key:"handleNativeEvent",value:function(e){if("Escape"===e.code){var t=this.node.applianceManager.releaseAllTextarea(null,this.focusSceneId);this.undoWatcher&&t&&this.undoWatcher.stack.commit(t)}}},{key:"release",value:function(){var e;this.assertNotRelease(),this.node.release(),null==(e=this.undoWatcher)||e.stop(),this.mobxDisposer(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.didRelease=!0,this.delegate.onRelease()}},{key:"onStateUpdate",value:function(e){this.node.updateState(e)}},{key:"registerScreenAndCameraman",value:function(e,t){var n=this,r=e.width,i=e.height,a=e.camera;(!this._size||this._size.width!==r||this._size.height!==i)&&(this._size=Object.freeze({width:r,height:i}),this._callbacks.dispatch("onSizeUpdated",(function(e){return e(n._size)}))),(!this._camera||!nC(this._camera,a))&&(this._camera=Object.freeze(W({},a)),this._callbacks.dispatch("onCameraUpdated",(function(e){return e(n._camera)}))),e.addSizeUpdatedListener(this.onSizeUpdated),e.addCameraUpdatedListener(this.onCameraUpdated),t.addBoundlessEventListener(this.onBoundlessEvent),t.addPreTouchEventListener(this.onPreEndTouchEvent),t.addHandToolActiveListener(this.onHandToolActive),t.addCameraTransformationListener(this.onCameraTransformation)}},{key:"unregisterScreenAndCameraman",value:function(e,t){e.removeSizeUpdatedListener(this.onSizeUpdated),e.removeCameraUpdatedListener(this.onCameraUpdated),t.removeBoundlessEventListener(this.onBoundlessEvent),t.removePreTouchEventListener(this.onPreEndTouchEvent),t.removeHandToolActiveListener(this.onHandToolActive),t.removeCameraTransformationListener(this.onCameraTransformation)}},{key:"refreshCursorHideObserverIdNeed",value:function(e){var t=this.node.cursors;t&&!this.params.willHideSelfCursor&&t.setShowBuiltin(!1)}},{key:"assertNotRelease",value:function(){if(this.didRelease)throw new Error("view did release")}},{key:"handleHotKey",value:function(e,t){switch(e){case"duplicate":this.duplicate();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"delete":this.delete();break;case"lock":var n=this.sendToApplianceManager(e,t);this.undoWatcher&&n&&this.undoWatcher.stack.commit(n);break;case"lockCenter":var r=this.sendToApplianceManager(e,t);this.undoWatcher&&r&&this.undoWatcher.stack.commit(r);break;case"changeToSelector":this.updateAppliance(fI.selector);break;case"changeToClick":this.updateAppliance(fI.clicker);break;case"changeToLaserPointer":this.updateAppliance(fI.laserPointer);break;case"changeToPencil":this.updateAppliance(fI.pencil);break;case"changeToRectangle":this.updateAppliance(fI.rectangle);break;case"changeToEllipse":this.updateAppliance(fI.ellipse);break;case"changeToEraser":this.updateAppliance(fI.eraser);break;case"changeToPencilEraser":this.updateAppliance(fI.pencilEraser);break;case"changeToText":this.updateAppliance(fI.text);break;case"changeToStraight":this.updateAppliance(fI.straight);break;case"changeToArrow":this.updateAppliance(fI.arrow);break;case"changeToHand":this.updateAppliance(fI.hand)}}},{key:"sendToApplianceManager",value:function(e,t){var n=null,r={kind:e};switch(t.kind){case wu.KeyDown:n=this.node.applianceManager.onKeyDown(r,this.focusSceneId);break;case wu.KeyUp:n=this.node.applianceManager.onKeyUp(r,this.focusSceneId)}return n}},{key:"updateAppliance",value:function(e){this.setMemberState({currentApplianceName:e})}},{key:"createFloatBarDelegate",value:function(){var e=this;return Object.freeze({delete:function(){return e.delete()},lockImages:function(t){return e.lockImages(t)},updatePencilColor:function(t){return e.updatePencilColor(t)},moveSelectedComponentsToTop:function(){return e.moveSelectedComponentsToTop()},moveSelectedComponentsToBottom:function(){return e.moveSelectedComponentsToBottom()},duplicate:function(){return e.duplicate()},updateTextareaFontSize:function(t){return e.updateSelectedText({fontSize:t})},updateTextareaFormat:function(t){return e.updateTextFormat(t)}})}},{key:"watchScenePathUpdate",value:function(e){try{return e()}finally{var t=this.latestSceneInfo.path,n=this.node.scenePath;this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&n!==this.wannaFocusScenePath?this.node.isCursorsHidden=!0:this.node.isCursorsHidden=!1,t!==n&&(this.updateScenePath(n),this._callbacks.dispatch("onScenePathUpdated",(function(e){return e(n)})))}}},{key:"startWatchScenePath",value:function(){var e=this,t={equals:sP.comparer.default};return this.updateScenePath(this.node.scenePath),(0,sP.reaction)((function(){return e.node.scenePath}),this.updateScenePath,t)}}]),n}(hP),jP=function(e){g(n,e);var t=b(n);function n(e,r,i){var a;return C(this,n),(a=t.call(this,r)).viewsMap={},a.previousViewId=0,a.viewInputParams=null,a.params=e,a.context=Object.freeze(W({},i)),a._dynamicPpt=i.dynamicPpt,a._callbacks=new Vx,a.commonScreenContext=Object.freeze({observerId:r.observerId,forcePPTLandscape:r.forcePPTLandscape,disalbeImageHit:r.disalbeImageHit,disableOthersSelectingBox:r.disableOthersSelectingBox}),a}return P(n,[{key:"dynamicPpt",get:function(){return this._dynamicPpt}},{key:"callbacks",get:function(){return this._callbacks}},{key:"setupViewInput",value:function(e){this.viewInputParams||(this.viewInputParams=Object.freeze(W({},e)),this.forEach((function(t){return t.setupViewInput(H(W({},e),{view:t}))})))}},{key:"releaseViewInput",value:function(){this.viewInputParams&&(this.viewInputParams=null,this.forEach((function(e){return e.release()})))}},{key:"onStateUpdate",value:function(e,t){if("observerId"in e&&this.updateCommonScreenContext("observerId",e.observerId),"forcePPTLandscape"in e&&this.updateCommonScreenContext("forcePPTLandscape",e.forcePPTLandscape),"disalbeImageHit"in e&&this.updateCommonScreenContext("disalbeImageHit",e.disalbeImageHit),"disableOthersSelectingBox"in e&&this.updateCommonScreenContext("disableOthersSelectingBox",e.disableOthersSelectingBox),"disableBoundlessEvent"in e&&this.forEach((function(t){return t.updateDisableBoundlessEvent(e.disableBoundlessEvent)})),"cursorClass"in e&&this.forEach((function(t){return t.updateCursorClass(e.cursorClass)})),"cursorStyle"in e&&this.forEach((function(t){return t.updateCursorStyle(e.cursorStyle)})),"playerState"in e){var n=e.playerState,r=this.context.pluginManager;r.setPlayerState?r.setPlayerState(n):void 0!==n.isPlaying&&r.setPlayingState(n.isPlaying)}}},{key:"setupViewContext",value:function(e){e.updateDisableBoundlessEvent(this.state.disableBoundlessEvent),e.updateCursorClass(this.state.cursorClass),e.updateCursorStyle(this.state.cursorStyle)}},{key:"updateCommonScreenContext",value:function(e,t){for(var n in this.commonScreenContext=Object.freeze(H(W({},this.commonScreenContext),a({},e,t))),this.viewsMap)this.viewsMap[n].setCommonScreenContext(this.commonScreenContext)}},{key:"forEach",value:function(e){for(var t in this.viewsMap)e(this.viewsMap[t])}},{key:"createView",value:function(e,t){var n=this,r="".concat(this.previousViewId+=1),i=Object.freeze({onRelease:function(){return n.releaseView(a)}}),a=new LP(r,this.commonScreenContext,this.params,this.context,e,i,t);return this.viewsMap[a.id]=a,this.setupViewContext(a),this.viewInputParams&&a.setupViewInput(H(W({},this.viewInputParams),{view:a})),this._callbacks.dispatch("onCreatedView",(function(e){return e(a)})),a}},{key:"updateContext",value:function(e){for(var t in this.viewsMap){var n=this.viewsMap[t];n.updateContext(e),this.setupViewContext(n)}this._dynamicPpt=e.dynamicPpt}},{key:"fireReloadLibrary",value:function(){var e,t;for(var n in null==(t=(e=this.context.pluginManager).refreshPluginInstances)||t.call(e),this.viewsMap)this.viewsMap[n].fireReloadLibrary()}},{key:"releaseView",value:function(e){delete this.viewsMap[e.id],this._callbacks.dispatch("onReleasedView",(function(t){return t(e)}))}}]),n}(hP),DP=function(){function e(t){C(this,e),this.viewsHub=t}return P(e,[{key:"createView",value:function(e){return this.viewsHub.createView({cameraBound:{},handToolActive:!1,divElement:null,disableCameraTransform:!1},e)}},{key:"forEach",value:function(e){this.viewsHub.forEach(e)}}]),e}(),FP=function(){function e(t){C(this,e),this._owner=void 0,this._state=Object.freeze(W({},t))}return P(e,[{key:"owner",get:function(){return this._owner}},{key:"state",get:function(){return this._state||this._owner.state}},{key:"putState",value:function(e){var t;if(this._state){var n=lP(this._state,e);n&&(this._state=Object.freeze(n)),t=!!n}else t=this._owner.putState(e);return t}},{key:"updateOwner",value:function(e){this._owner=e,this._state=null}}]),e}(),zP=function(){function e(t,n){var r=this;C(this,e),this.isReadonlyMode=!1,this.isOverrideWithFreedom=!1,this.overrideDisposer=null,this.previousRectangle=null,this.onCreatedView=function(e){r.previousRectangle&&r.refreshScreenRectangle(e,r.previousRectangle)},this.viewsHub=t,this.applianceManager=n,this.followerCheckingDisposer=(0,oP.reaction)((function(){return r.getCurrentMode()===iP.Follower}),(function(e){e?r.refreshCameraRectangle():r.previousRectangle=null})),t.callbacks.on("onCreatedView",this.onCreatedView),(0,oP.makeObservable)(this,{isReadonlyMode:oP.observable,isOverrideWithFreedom:oP.observable,setReadonlyMode:oP.action,overrideWithFreedom:oP.action})}return P(e,[{key:"release",value:function(){this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.followerCheckingDisposer()}},{key:"setReadonlyMode",value:function(e){this.isReadonlyMode!==e&&(this.isReadonlyMode=e,this.overrideDisposer&&!e&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"overrideWithFreedom",value:function(e){var t=this;this.isReadonlyMode&&this.isOverrideWithFreedom!==e&&(this.isOverrideWithFreedom=e,e?this.overrideDisposer=(0,oP.when)((function(){return t.applianceManager.getViewState().mode===iP.Freedom}),(function(){t.isReadonlyMode&&t.isOverrideWithFreedom&&(t.isOverrideWithFreedom=!1),t.overrideDisposer=null})):this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"getBroadcastState",value:function(){var e=this.applianceManager.getBroadcasterId();return{mode:this.getCurrentMode(),broadcasterId:e}}},{key:"getCurrentMode",value:function(){return this.isReadonlyMode&&this.isOverrideWithFreedom?iP.Freedom:this.applianceManager.getViewState().mode}},{key:"refreshCameraRectangle",value:function(){var e=this,t=this.applianceManager.getViewState(),n=t.originX,r=t.originY,i=t.width,a=t.height,o={originX:n,originY:r,width:i,height:a};(!this.previousRectangle||this.previousRectangle.originX!==n||this.previousRectangle.originY!==r||this.previousRectangle.width!==i||this.previousRectangle.height!==a)&&(this.viewsHub.forEach((function(t){return e.refreshScreenRectangle(t,o)})),this.previousRectangle=o)}},{key:"refreshScreenRectangle",value:function(e,t){e.mode===TP.FollowSceneAndCamera&&e.screen.adaptRectangle(H(W({},t),{animationMode:yp.Continuous,adapterMode:pp.Centering}))}}]),e}();var BP=function(){function e(){C(this,e),this.listeners={},this.eventsMergers={},this.waitingNodes=[]}return P(e,[{key:"dispatchEvent",value:function(e,t,n){var r=this.listeners[e.event];if(r){var i,a=T(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(!n||o.isAfterCommit===t)try{o.invoke(e)}catch(e){console.error(e)}}}catch(e){a.e(e)}finally{a.f()}}var s=this.waitingNodes.findIndex((function(t){return!!t.filter(e)&&(t.resolve(e),!0)}));-1!==s&&this.waitingNodes.splice(s,1)}},{key:"addMagixEventsListener",value:function(e,t,n,r){var i=function(e,t){var n=[],r=new Ue(t,(function(){n.length>0&&e(n.splice(0,n.length))}));function i(e){n.push(e),r.invoke()}return Object.defineProperty(i,"proxyListener",{writable:!1,value:e}),i}(t,n),a=this.eventsMergers[e];a||(a=[],this.eventsMergers[e]=a),a.push(i),this.addMagixEventListener(e,i,r)}},{key:"addMagixEventListener",value:function(e,t,n){var r=this.listeners[e];r||(r=[],this.listeners[e]=r),r.push({invoke:t,isAfterCommit:n})}},{key:"removeMagixEventListener",value:function(e,t){if(t){var n=this.removeFromEventMerges(e,t);n?this.removeFromListeners(e,n):this.removeFromListeners(e,t)}else delete this.listeners[e],delete this.eventsMergers[e]}},{key:"removeFromEventMerges",value:function(e,t){var n=this.eventsMergers[e];if(n){for(var r=-1,i=0;i<n.length;++i)if(n[i].proxyListener===t){r=i;break}if(-1!==r){var a=n[r];return n.splice(r,1),0===n.length&&delete this.eventsMergers[e],a}}}},{key:"removeFromListeners",value:function(e,t){var n=this.listeners[e];if(n){var r=n.findIndex((function(e){return e.invoke===t}));-1!==r&&(n.splice(r,1),0===n.length&&delete this.listeners[e])}}},{key:"waitMagixEvent",value:function(e){var t=this;return new Promise((function(n){t.waitingNodes.push({resolve:n,filter:e})}))}}]),e}(),UP=Y(n(67294)),VP=UP.createContext(void 0),WP=UP.createContext(void 0),HP=UP.createContext(void 0),_P=function(){function e(){C(this,e),this.contents={},this.nextId=0}return P(e,[{key:"createWrappedComponent",value:function(e,t){var n=this,r="".concat(this.nextId);return this.nextId+=1,this.contents[r]=Object.freeze({value:t,provider:e.Provider}),function(e){var t=e.children;if(n.contents){var i=n.contents[r],a=i.value,o=i.provider;return UP.createElement(o,{value:a},t)}return null}}},{key:"dispose",value:function(){this.contents=null}}]),e}(),GP=VP.Consumer,YP=WP.Consumer,XP=HP.Consumer;function QP(e){return new KP(e)}var KP=function(){function e(t){C(this,e),this.cacheContextMap={},this.manager=null,this.plugins=this.copyAndFreezePlugins(t)}return P(e,[{key:"copyAndFreezePlugins",value:function(e){var t={};for(var n in e){var r=e[n];if(void 0!==r.kind&&n!==r.kind)throw new Error("plugin's kind ".concat(JSON.stringify(r.kind)," is not equals key ").concat(JSON.stringify(n)));var i=r.defaultAttributes;"object"==M(i)&&null!==i&&(i=Object.freeze(W({},i))),t[n]=Object.freeze({kind:n,render:r.render,defaultAttributes:i,hitTest:r.hitTest,willInterruptEvent:r.willInterruptEvent})}return Object.freeze(t)}},{key:"setPluginContext",value:function(e,t){this.manager?this.manager.setPluginContext(e,t):this.cacheContextMap&&e in this.plugins&&(this.cacheContextMap[e]=t)}},{key:"getPluginContext",value:function(e){return this.manager?this.manager.getPluginContext(e):this.cacheContextMap?this.cacheContextMap[e]:void 0}},{key:"setPluginManager",value:function(e){if(this.cacheContextMap){for(var t in this.cacheContextMap)e.setPluginContext(t,this.cacheContextMap[t]);this.cacheContextMap=null}else if(this.manager)for(var n in this.plugins){var r=this.manager.getPluginContext(n);e.setPluginContext(n,r)}this.manager=e}}]),e}(),qP=Y(n(68949)),ZP=function(){function e(t){C(this,e),this.enableCallbackUpdate=!0,this.disposers=null,this.copiedAttributes=null,this.copiedMemberAttributes=null,this.kind=t.kind,this._displayer=t.displayer,this._callbacks=new Vx,this.onAttributesUpdate&&this._callbacks.on("onAttributesUpdate",this.onAttributesUpdate.bind(this)),this.onDestroy&&this._callbacks.on("onDestroy",this.onDestroy.bind(this)),this.autorunAttributesUpdate(),(0,qP.makeObservable)(this,{attributes:qP.computed})}return P(e,[{key:"autorunAttributesUpdate",value:function(){var e=this;this._displayer.useMobXState||(this.disposers=[this.bindAutorunAttributes((function(){return e.copiedAttributes=bs(e.attributes)}),(function(){return e._callbacks.dispatch("onAttributesUpdate",(function(t){return t(e.copiedAttributes)}))})),this.bindAutorunAttributes((function(){return e.copiedMemberAttributes=bs(e.memberAttributes)}),(function(){return e._callbacks.dispatch("onMemberAttributesUpdate",(function(t){return t(e.copiedMemberAttributes)}))}))])}},{key:"bindAutorunAttributes",value:function(e,t){var n=this,r=!1;return(0,qP.autorun)((function(){n._displayer.applianceManager.hasInvisibilePluginKind(n.kind)&&(e(),r&&n.enableCallbackUpdate&&t(),r=!0)}))}},{key:"displayer",get:function(){return this._displayer}},{key:"callbacks",get:function(){return this._callbacks}},{key:"attributes",get:function(){var e;if(this._displayer.useMobXState)e=this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind);else{if(!this.copiedAttributes)throw new Error('invisible plugin "'.concat(this.kind,'" not exits'));e=this.copiedAttributes}return e}},{key:"memberAttributes",get:function(){var e;if(this._displayer.useMobXState)e=this._displayer.applianceManager.getMemberAttributes(this.kind);else{if(!this.copiedMemberAttributes)throw new Error('invisible plugin "'.concat(this.kind,'" not exits'));e=this.copiedMemberAttributes}return e}},{key:"getMemberAttributes",value:function(e){return this._displayer.applianceManager.getMemberAttributes(this.kind,[],e)}},{key:"getAttributesValue",value:function(e){return this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind,e)}},{key:"getMemberAttributesValue",value:function(e){return this._displayer.applianceManager.getMemberAttributes(this.kind,e)}},{key:"setAttributes",value:function(e){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var t=this._displayer,n=t.applianceManager,r=t.parametersFilter,i=r?r.filter(e):e;n.updateAttributesInvisiblePlugin(this.kind,i)}finally{this.resetEnableCallbackUpdate()}}},{key:"setMemberAttributes",value:function(e){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var t=this._displayer,n=t.applianceManager,r=t.parametersFilter,i=r?r.filter(e):e;n.updateMemberAttributes(this.kind,i)}finally{this.resetEnableCallbackUpdate()}}},{key:"updateAttributes",value:function(e,t){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var n=this._displayer,r=n.applianceManager,i=n.parametersFilter,a=i?i.filter(t):t;r.updateAttributesInvisiblePluginWithKeys(this.kind,e,a)}finally{this.resetEnableCallbackUpdate()}}},{key:"updateMemberAttributes",value:function(e,t){if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var n=this._displayer,r=n.applianceManager,i=n.parametersFilter,a=i?i.filter(t):t;r.updateMemberAttrubtesWithKeys(this.kind,e,a)}finally{this.resetEnableCallbackUpdate()}}},{key:"destroy",value:function(){try{this.enableCallbackUpdate=!1,this._displayer.applianceManager.removeInvisiblePlugin(this.kind)}finally{this.resetEnableCallbackUpdate()}}},{key:"_dispose",value:function(e){this.disposers&&(this.disposers.forEach((function(e){return e()})),this.disposers=null),e&&this.enableCallbackUpdate&&this._callbacks.dispatch("onDestroy",(function(e){return e()}))}},{key:"resetEnableCallbackUpdate",value:function(){var e=this;Promise.resolve().then((function(){e.enableCallbackUpdate=!0}))}},{key:"isEnableUpdateAttributes",value:function(){if(this._displayer instanceof FM)return this._displayer.isEnableModify();throw new Error("cannot update attributes when displayer is player")}}]),e}(),JP=function(){function e(t,n,r){C(this,e),this.pluginClasses={},this.plugins={},this.paddingCreators={},this.disposer=null,this._isWatching=!1,this.logger=t,this.displayer=n,this.pluginClasses=this.createPluginClasses(r)}return P(e,[{key:"createPluginClasses",value:function(e){var t,n={},r=T(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.kind in n)throw new Error("duplicated kind from invisible plugin ".concat(JSON.stringify(i.kind)));n[i.kind]=i}}catch(e){r.e(e)}finally{r.f()}return Object.freeze(n)}},{key:"isWatching",get:function(){return this._isWatching},set:function(e){var t=this;this._isWatching!==e&&(this._isWatching=e,e&&!this.disposer?this.disposer=(0,qP.autorun)((function(){for(var e in t.pluginClasses)t.refreshPlugin(t.pluginClasses[e])})):!e&&this.disposer&&(this.disposer(),this.disposer=null))}},{key:"get",value:function(e){return this.plugins[e]||null}},{key:"create",value:function(e,t){var n=this;return new Promise((function(r,i){var a=e.kind,o=n.displayer.applianceManager;try{if(n.addPaddingCreator(a,r),e!==n.pluginClasses[a])throw new Error("unregister invisible plugin class");o.putInvisiblePlugin(a,t)}catch(e){i(e),n.removePaddingCreator(a,r)}}))}},{key:"dispose",value:function(){this.disposer&&(this.disposer(),this.disposer=null);for(var e in this.plugins){try{this.plugins[e]._dispose(false)}catch(e){this.logger.error(e)}delete this.plugins[e]}}},{key:"refreshPlugin",value:function(e){var t=this.displayer.applianceManager,n=e.kind;if(t.hasInvisibilePluginKind(n)){if(!this.plugins[n]){var r={kind:n,displayer:this.displayer},i=e,a=this.plugins[n]=new i(r);if(e.onCreate)try{e.onCreate(a)}catch(e){this.logger.error(e)}}var o=this.paddingCreators[n];if(o){delete this.paddingCreators[n];var s,c=T(o);try{for(c.s();!(s=c.n()).done;){(0,s.value)(this.plugins[n])}}catch(e){c.e(e)}finally{c.f()}}}else{var u=this.plugins[n];if(u){delete this.plugins[n];try{u._dispose(!0)}catch(i){this.logger.error(i)}if(e.onDestroy)try{e.onDestroy(u)}catch(i){this.logger.error(i)}}}}},{key:"addPaddingCreator",value:function(e,t){var n=this.paddingCreators[e];n||(n=this.paddingCreators[e]=[]),n.push(t)}},{key:"removePaddingCreator",value:function(e,t){var n=this.paddingCreators[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.paddingCreators[e])}}}]),e}(),$P=Y(n(68949)),eM=function(){function e(t){var n=this;C(this,e),this._callbacks=new Vx,this.set={},this.autoUpdateMembers=function(){var e,t=n.applianceManager,r={},i=T(n.getMemberIds(t));try{for(i.s();!(e=i.n()).done;){var a=e.value;a in n.set?delete n.set[a]:n.dispatchEvent("onAdded",t,a),r[a]=a}}catch(e){i.e(e)}finally{i.f()}for(var o in n.set){var s=n.set[o];n.dispatchEvent("onRemoved",t,s)}n.set=r},this.applianceManager=t,this.disposer=(0,$P.autorun)(this.autoUpdateMembers),(0,$P.makeObservable)(this,{refresh:$P.action})}return P(e,[{key:"callbacks",get:function(){return this._callbacks}},{key:"forEach",value:function(e){for(var t in this.set)e(this.applianceManager,this.set[t])}},{key:"refresh",value:function(){var e=this.applianceManager;this.disposer(),this.disposer=(0,$P.autorun)(this.autoUpdateMembers),this._callbacks.dispatch("onRefreshed",(function(t){return t(e)}))}},{key:"createMapper",value:function(e){return new tM(this,e)}},{key:"dispose",value:function(){this.disposer()}},{key:"dispatchEvent",value:function(e,t,n){var r=this;setTimeout((function(){r._callbacks.dispatch(e,(function(e){return(0,$P.runInAction)((function(){e(t,n)}))}))}),0)}},{key:"getMemberIds",value:function(e){if(e.getMemberIds)return e.getMemberIds();var t,n=[],r=T(e.getMemberDisplayers());try{for(r.s();!(t=r.n()).done;){var i=t.value.memberId;n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}}]),e}(),tM=function(){function e(t,n){var r=this;C(this,e),this._nodes=[],this.memberIds={},this.onAdded=function(e,t){t in r.memberIds||(r.memberIds[t]=!0,r._nodes.push(new nM(e,t,r.mapper)))},this.onRemoved=function(e,t){var n=r._nodes.findIndex((function(e){return e.memberId===t}));-1!==n&&(r._nodes.splice(n,1),delete r.memberIds[t])},this.onRefreshed=function(){r._nodes.splice(0,r._nodes.length),r.memberIds={},r.members.forEach((function(e,t){r.memberIds[t]=!0,r._nodes.push(new nM(e,t,r.mapper))}))},this.members=t,this.mapper=n,this.members.forEach((function(e,t){r.memberIds[t]=!0,r._nodes.push(new nM(e,t,n))})),this.members.callbacks.on("onAdded",this.onAdded),this.members.callbacks.on("onRemoved",this.onRemoved),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,$P.makeObservable)(this,{_nodes:$P.observable,targets:$P.computed})}return P(e,[{key:"targets",get:function(){var e,t=[],n=T(this._nodes);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.target)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"dispose",value:function(){this.members.callbacks.off("onAdded",this.onAdded),this.members.callbacks.off("onRemoved",this.onRemoved),this.members.callbacks.off("onRefreshed",this.onRefreshed)}}]),e}(),nM=function(){function e(t,n,r){C(this,e),this.applianceManager=t,this.memberId=n,this.mapper=r,(0,$P.makeObservable)(this,{target:$P.computed})}return P(e,[{key:"target",get:function(){return this.mapper(this.applianceManager,this.memberId)}}]),e}();var rM=Y(n(67294)),iM=function(){function e(t,n,r){C(this,e),this.mousePoint=null,this.follower=null,this.component=null,this.id=t,this.description=n,this.onRelease=r}return P(e,[{key:"initScreen",value:function(e){this._screen=e}},{key:"release",value:function(){this.component&&(this._screen.scene.removeComponent(this.component),this.component=null),this.onRelease(this.id)}},{key:"moveMouse",value:function(t,n){var r=this._screen,i=r.width,a=r.height,o=e.mouseOffset,s=t-i/2+o.x,c=n-a/2+o.y;this.mousePoint?(this.mousePoint.x=s,this.mousePoint.y=c,this.follower&&this.moveFollower(this.follower,s,c)):(this.mousePoint={x:s,y:c},this.follower&&this.updateFollowerBecomeVisible(this.follower,this.mousePoint.x,this.mousePoint.y))}},{key:"releaseMouse",value:function(){this.mousePoint&&this.follower&&this.updateFoolowerBecomeHidden(),this.mousePoint=null}},{key:"setFollower",value:function(e){this.follower?e?(this.follower=e,this.mousePoint&&this.updateFollowerDescription(e)):(this.follower=null,this.mousePoint&&this.updateFoolowerBecomeHidden()):e&&(this.follower=e,this.mousePoint&&this.updateFollowerBecomeVisible(e,this.mousePoint.x,this.mousePoint.y))}},{key:"updateFollowerBecomeVisible",value:function(e,t,n){this.component=this._screen.scene.addComponent({id:this.id,definition:this.description,originX:t-e.width/2,originY:n-e.height/2,width:e.width,height:e.height,absoluteCoordinates:!0,payload:{reactNode:e.reactNode}})}},{key:"updateFollowerDescription",value:function(e){this.component.payload={reactNode:e.reactNode}}},{key:"moveFollower",value:function(e,t,n){this.component.moveTo(t-e.width/2,n-e.height/2,yp.Immediately)}},{key:"updateFoolowerBecomeHidden",value:function(){this._screen.scene.removeComponent(this.component)}}]),e}(),aM=iM;aM.mouseOffset=Object.freeze({x:-12,y:-19});var oM=function(){function e(){C(this,e),this.previousId=0,this.followers={},this.follower=null,this.description=Sp({name:"MouseFollower"})}return P(e,[{key:"refreshEngine",value:function(e){e.bind(this.description)(sM)}},{key:"createMouseFollower",value:function(){var e=this,t="follower-".concat(this.previousId+=1),n=new aM(t,this.description,(function(t){delete e.followers[t]}));return this.follower&&n.setFollower(this.follower),this.followers[t]=n,n}},{key:"setFollower",value:function(e){for(var t in this.follower=e,this.follower)this.followers[t].setFollower(e)}}]),e}(),sM=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"render",value:function(){var e=this.props,t=e.cnode,n=e.size,r=e.payload;return rM.createElement(Sh,{context:t,style:n},r.reactNode)}}]),n}(rM.Component);sM.isVisible=!0;var cM=500,uM="/";function lM(e){return"object"==M(e)&&null!==e}var hM,dM,pM=function(){function e(t){var n=this,r=t.logger,i=t.region,a=t.boundless,o=t.useMobXState,s=t.preloadDynamicPPT,c=t.userFonts,l=t.pptHandler,h=t.globalStateUpdater,d=t.screenType,f=t.cameraBound,v=t.renderEngine,m=t.undoStacksHub,g=t.autoResize,y=t.plugins,b=t.wrappedComponents,k=t.floatBarClass,w=t.useMultiViews,S=t.willHideSelfCursor,x=t.disableCameraTransform,I=t.memberStateStorage,P=t.onlyCallbackRemoteStateModify,M=t.invisiblePlugins,T=t.handToolKey,A=t.fontFamily,E=t.disableOperations,O=t.disableOthersSelectingBox,R=t.cursorAdapter,N=t.eraserRadiusCursor,L=t.enableTextareHub,j=t.enableSelfCurveAnime,D=t.disableCurveAnimes,F=t.disableRotation,z=t.disableNewPencilStroke,B=t.hotKeys,U=t.copyOperator,V=t.eventInterrupter,W=t.callbacks,H=t.urlInterrupter,_=t.userPayload,G=t.pptParams;C(this,e),this.magixEventsManager=new BP,this.preloadDynamicPPT=!1,this.mainViewProxy=null,this.membersMapper=null,this.context=null,this._views=null,this.libraryNodeFetcher=function(){var e=u(regeneratorRuntime.mark((function e(t){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(yx.modules.identifier,"/").concat(t.libIdentifier),e.next=3,Sx(r);case 3:return i=e.sent,a=i.WhiteModel.default,e.abrupt("return",(n.logger.info("load modules ",r),Object.freeze({modules:i,libraryClass:a,appVersion:t.appVersion})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.covertMemberDisplayerToMember=function(e,t){var r=n.getMemberInformation(e,t),i=r?r.session:"",a=r&&r.payload,o=n.memberState(t);return o||(o=n.getDefaultMemberState()),{memberId:t,memberState:o,session:i,payload:a}},this.logger=r,this.region=i,this.useMobXState=o,this.boundless=a,this.screenType=d,this.eraserRadiusCursor=N,this.pluginOperator=this.createPluginOperator(),this.plugins=y,this.autoResize=g,this.cameraObserver=new wC,this.copyOperator=U,this.reactContext=new _P,this.wrappedComponents=Object.freeze(p(b)),this.onlyCallbackRemoteStateModify=P,this.pptHandler=l,this.invisiblePluginNode=new JP(r,this,M),this.callbacks=new Vx(W),this.preloadDynamicPPT=s,this.mouseFollowerHub=new oM,this.viewsParams={logger:r,displayer:this,renderEngine:v,undoStacksHub:m,boundless:a,cameraBound:f,fontFamily:A,cursorAdapter:R,autoResize:g,floatBarClass:k,memberStateStorage:I,enableSelfCurveAnime:j,disableCurveAnimes:D,disableRotation:F,disableNewPencilStroke:z,mouseFollowerHub:this.mouseFollowerHub,wrappedComponents:this.createWrappedComponents(),disableOperations:E,willHideSelfCursor:S,handToolKey:T,eventInterrupter:V,urlInterrupter:H,enableTextareHub:L,userPayload:_,pptParams:G,hotKeys:B,copyOperator:U,enableLaser:!w,setMemberStateWrapper:this.wrapSetMemberState.bind(this),onScreenSizeUpdated:function(e){return n.onScreenSizeUpdated(e)}},this.dynamicPptParams={globalStateUpdater:h,observerId:an,userFonts:c,preload:s,pptHandler:l,logger:r,pptParams:G,userPayload:_,pptAssetsOrigin:"https://convertcdn.netless.link/dynamicConvert",onPPTLoadProgress:function(e,t){return n.callbacks.dispatch("onPPTLoadProgress",(function(n){return n(e,t)}))},onPPTMediaPause:function(e,t){return n.callbacks.dispatch("onPPTMediaPause",(function(n){return n(e,t)}))},onPPTMediaPlay:function(e,t){return n.callbacks.dispatch("onPPTMediaPlay",(function(n){return n(e,t)}))},onPPTMediaPlayError:function(e,t,r){n.callbacks.dispatch("onPPTMediaPlayError",(function(n){return n(e,t,r)}))}},this.viewsHubProxy=new FP({observerId:an,forcePPTLandscape:!1,disalbeImageHit:!1,disableBoundlessEvent:!0,disableOthersSelectingBox:O,cursorClass:null,cursorStyle:null,playerState:Object.freeze({isPlaying:!0,timestamp:0,playbackSpeed:1})}),w||(this.mainViewProxy=new FP({cameraBound:f,handToolActive:!1,divElement:null,disableCameraTransform:!!x}))}var t;return P(e,[{key:"getMainViewIfExits",value:function(){var e;return null==(e=this.mainViewProxy)?void 0:e.owner}},{key:"enableWriteNow",get:function(){return!1}},{key:"deviceType",get:function(){return this.boundless.deviceType}},{key:"observerId",get:function(){return this.viewsHubProxy.state.observerId}},{key:"version",get:function(){return yx.sdkVersion}},{key:"viewsHub",get:function(){return this.viewsHubProxy.owner}},{key:"useMultiViews",get:function(){return!this.mainViewProxy}},{key:"mainView",get:function(){var e=this.mainViewProxy;if(e){var t=e.owner;if(t)return t}return null}},{key:"memberStateStorage",get:function(){return this.viewsParams.memberStateStorage}},{key:"onScreenSizeUpdated",value:function(e){}},{key:"createWrappedComponents",value:function(){return[].concat(p(this.wrappedComponents),[this.reactContext.createWrappedComponent(VP,this)])}},{key:"createPluginOperator",value:function(){return Object.freeze({remove:function(){throw new Error("it is not a writable room")},update:function(){throw new Error("it is not a writable room")},getPlugin:function(){throw new Error("it is not a writable room")}})}},{key:"scalePptToFit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:yp.Continuous,t=this.state.sceneState.scenes[this.state.sceneState.index];t.ppt&&this.moveCameraToContain({originX:-t.ppt.width/2,originY:-t.ppt.height/2,width:t.ppt.width,height:t.ppt.height,animationMode:e})}},{key:"scenePathType",value:function(e){var t=e.replace(/\/$/g,"").split(uM);t.shift();var n=this.applianceManager.scenes.findSceneOrGroup(t),r=this.context.modules.WhiteModel.SceneNode;if(n&&ms(n,r))return mI.Page;if(n)return mI.Dir;for(;t.length>1;){t.pop();var i=this.applianceManager.scenes.findSceneOrGroup(t);if(i&&ms(i,r))return mI.Conflict}return mI.None}},{key:"entireScenes",value:function(){var e,t=this.applianceManager,n={},r=T(t.getAllScenePaths());try{for(r.s();!(e=r.n()).done;){var i=e.value,a=t.getScene(Jx(i)),o=i.slice(0,-1),s="".concat(uM).concat(o.join(uM));n[s]=n[s]||[],a&&n[s].push(a)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"getScene",value:function(e){var t=Xx.parse(e);return Jx(this.applianceManager.getScene(t))}},{key:"refreshViewSize",value:function(){var e;this.autoResize||null==(e=this.viewsHubProxy.owner)||e.forEach((function(e){return e.resizeScreen()}))}},{key:"getCurrentSceneState",value:function(){for(var e=this.applianceManager,t=bs(e.getCurrentScenePath()),n=Xx.stringify(t),r=t.pop(),i=e.getSceneNames(t),a=Xx.stringify(t),o=[],s=Number.NaN,c=0;c<i.length;++c){var u=i[c],l=e.getScene([].concat(p(t),[u]));(null==l?void 0:l.name)===r&&(s=c),o[c]=Jx(l)}return{sceneName:r,scenePath:n,contextPath:a,scenes:o,index:s}}},{key:"assignAttributes",value:function(e,t){if(this.context){var n=t;if(void 0===n||lM(n)){var r=this.context.pluginManager.findPlugin(e);r&&lM(r.defaultAttributes)&&(n=W(W({},r.defaultAttributes),n))}return n}}},{key:"hasLibraryNode",get:function(){return!!this.context}},{key:"isEnableModify",value:function(){return!1}},{key:"getDefaultMemberState",value:function(){return{currentApplianceName:fI.pencil,strokeColor:[0,0,0],strokeWidth:4,textSize:16,bold:!1,italic:!1,underline:!1,lineThrough:!1}}},{key:"bezierCurvePainter",get:function(){return this.context?this.context.bezierCurvePainter:null}},{key:"getCursorStyleWithRadius",value:function(e){return 0===e?void 0:this.eraserRadiusCursor.cursorStyle(e)}},{key:"putPlayerState",value:function(e){var t=Object.freeze(W(W({},this.viewsHubProxy.state.playerState),e));this.viewsHubProxy.putState({playerState:t})}},{key:"updateLibraryNode",value:function(e){var t;this.members=new eM(this.applianceManager),this.membersMapper=null!=(t=this.membersMapper)?t:this.members.createMapper(this.covertMemberDisplayerToMember);var n=e.modules,r=n.WhiteRender,i=r.createDynamicPpt,a=r.EnginesHub,o=r.BezierCurvePainter,s=this.createPluginManager(n,this.pluginOperator,this.plugins),c=this.createBezierCurvePainter(o),u=i(H(W({},this.dynamicPptParams),{observerId:this.viewsHubProxy.state.observerId})),l=a&&new a(this.viewsParams.renderEngine),h=Object.freeze({appVersion:e.appVersion,applianceManager:this.applianceManager,members:this.members,pluginManager:s,dynamicPpt:u,bezierCurvePainter:c,engines:l,modules:n});if(this.mouseFollowerHub.refreshEngine(l.engines.mouseCurosrEngine),this.viewsHubProxy.owner)this.viewsHubProxy.owner.updateContext(h);else{var d=this.viewsHubProxy.state,p=new jP(this.viewsParams,d,h);if(this.viewsHubProxy.updateOwner(p),this._views=new DP(p),this.mainViewProxy){var f=this.mainViewProxy.state,v=p.createView(f);v.mode=TP.FollowSceneAndCamera,this.mainViewProxy.updateOwner(v),this.cameraObserver.setupMainView(v),v.callbacks.forwardTo("onHandToolActive",this.callbacks),v.callbacks.forwardTo("onRenderDuration",this.callbacks)}}var m=new Qx({applianceManager:this.applianceManager,sceneNodeClass:n.WhiteModel.SceneNode});this.context=Object.freeze({modules:n,pluginManager:s,bezierCurvePainter:c,scenesCallbacksHub:m}),this.refreshViewSize()}},{key:"fireTriggerRebuild",value:function(){if(this.viewsHub.fireReloadLibrary(),this.members.refresh(),this.context){var e=this.context,t=e.scenesCallbacksHub,n=e.modules;t.refresh({applianceManager:this.applianceManager,sceneNodeClass:n.WhiteModel.SceneNode})}}},{key:"createPluginManager",value:function(e,t,n){var r=new(0,e.WhiteRender.PluginManager)(n?n.plugins:{},t);return n&&n.setPluginManager(r),r}},{key:"createBezierCurvePainter",value:function(e){var t=null;if(e){var n=e;this.disablePencilWrittingLimitFrequency||(n=function(e){var t;return"getRectangle"in e.prototype?(t=function(e){g(r,e);var n=b(r);function r(){var e;return C(this,r),(e=n.apply(this,arguments)).cacheSegments={},e.cacheIdentifiers=[],e.isWrapped=!0,e}return P(r,[{key:"getPrecisionSegments",value:function(e){var t=s(x(r.prototype),"getPrecisionSegments",this).call(this,e);return t||(t=this.cacheSegments[e]||null),t}},{key:"completePainting",value:function(e){var t,n,i=s(x(r.prototype),"completePainting",this).call(this);return i&&(e?(t=e.originX,n=e.originY):(t=i.left,n=i.top),this.cachePrecisionSegments(i.identifier,{points:i.points,beginIndex:i.beginIndex,left:t,top:n})),i}},{key:"fireRemoveComponent",value:function(e){delete this.cacheSegments[e],s(x(r.prototype),"fireRemoveComponent",this).call(this,e)}},{key:"cachePrecisionSegments",value:function(e,n){if(!this.cacheSegments[e]){this.cacheSegments[e]=n,this.cacheIdentifiers.push(e);var r=t.maxCacheCount;if(this.cacheIdentifiers.length>r){var i=this.cacheIdentifiers.shift();delete this.cacheSegments[i]}}}}]),r}(e),t.maxCacheCount=3,t):e}(e)),(t=new n(WI.curveConvergenceSteps)).bezierRenderGranularity=wI,t.bezierMaxSegments=SI}return t}},{key:"refreshRender",value:function(){var e;null==(e=this.viewsHubProxy.owner)||e.forEach((function(e){return e.refreshRender()}))}},{key:"disableOthersSelectingBox",get:function(){return this.viewsHubProxy.state.disableOthersSelectingBox},set:function(e){this.viewsHubProxy.putState({disableOthersSelectingBox:e})}},{key:"views",get:function(){if(this.mainViewProxy)throw new Error("you can only read views when useMultiViews is true");if(!this._views)throw new Error("views is not ready");return this._views}},{key:"dispose",value:function(){var e,t,n,r;null==(e=this.viewsHubProxy.owner)||e.forEach((function(e){return e.release()})),this.eraserRadiusCursor.release(),this.invisiblePluginNode.dispose(),this.cameraObserver.dispose(),null==(t=this.membersMapper)||t.dispose(),null==(n=this.members)||n.dispose(),null==(r=this.memberStateStorage)||r.dispose(),this.reactContext.dispose()}},{key:"setObserverId",value:function(e){var t;(null==(t=this.viewsHubProxy.owner)?void 0:t.putState({observerId:e}))&&this.dynamicPpt.updateObserverId&&this.dynamicPpt.updateObserverId(e)}},{key:"dynamicPpt",get:function(){return this.viewsHubProxy.owner.dynamicPpt}},{key:"fetchNextPptSlideIfNeeded",value:function(e){var t;if(this.preloadDynamicPPT&&e.index+1<e.scenes.length){var n=null==(t=e.scenes[e.index+1].ppt)?void 0:t.src;this.dynamicPpt.getPptSildeDefinition(n||"")}}},{key:"getRoomMembers",value:function(){return this.membersMapper.targets}},{key:"getInvisiblePlugin",value:function(e){return this.invisiblePluginNode.get(e)}},{key:"dispatchMagixEventWithObject",value:function(e,t,n){var r=e;ke(r.payload)&&(r=H(W({},r),{payload:r.payload.primitiveBuffer})),this.magixEventsManager.dispatchEvent(r,t,n)}},{key:"addMagixEventListener",value:function(e,t,n){var r=this.standardizeOptions(n),i=!!r.fireSelfEventAfterCommit,a=r.fireInterval;void 0===a?this.magixEventsManager.addMagixEventListener(e,t,i):(a<cM&&(this.logger.warn("fireInterval ".concat(a,"ms of event ").concat(JSON.stringify(e)," can't less than ").concat(cM,"ms, it's will be reset as ").concat(cM,"ms")),a=cM),this.magixEventsManager.addMagixEventsListener(e,t,a,i))}},{key:"standardizeOptions",value:function(e){return void 0===e?{}:"number"==typeof e?{fireInterval:e}:e}},{key:"removeMagixEventListener",value:function(e,t){this.magixEventsManager.removeMagixEventListener(e,t)}},{key:"waitMagixEvent",value:function(e){return this.magixEventsManager.waitMagixEvent(e)}},{key:"createScenesCallback",value:function(e,t){return this.context&&this.context.scenesCallbacksHub.create(e,t)}},{key:"memberState",value:function(e){return Jx(this.applianceManager.getMemberState(e))}},{key:"getMemberInformation",value:function(e,t){if(e.getMemberInformation)return e.getMemberInformation(t);var n,r=T(e.getMemberDisplayers());try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.memberId===t)return i.information}}catch(e){r.e(e)}finally{r.f()}}},{key:"assertMainViewProxy",value:function(){var e=this.mainViewProxy;if(!e)throw new Error("can not use these methods or properties. you should pass useMultiViews: false");return e}},{key:"scenePreview",value:function(e,t,n,r,i){var a=this.assertMainViewProxy().owner;a&&a.scenePreview(e,t,n,r,i)}},{key:"generateScreenshot",value:(t=u(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.assertMainViewProxy().owner.generateScreenshot(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"fillSceneSnapshot",value:function(e,t,n,r,i){var a;null==(a=this.assertMainViewProxy().owner)||a.fillSceneSnapshot(e,t,n,r,i)}},{key:"convertToPointInWorld",value:function(e){var t=this.assertMainViewProxy().owner;return t?t.convertToPointInWorld(e):{x:e.x,y:e.y}}},{key:"handToolActive",get:function(){return this.assertMainViewProxy().state.handToolActive},set:function(e){this.assertMainViewProxy().putState({handToolActive:e})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))}},{key:"handToolKey",get:function(){return this.assertMainViewProxy().state.handToolKey}},{key:"disableCameraTransform",get:function(){return this.assertMainViewProxy().state.disableCameraTransform},set:function(e){this.assertMainViewProxy().putState({disableCameraTransform:e})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))}},{key:"bindHtmlElement",value:function(e){this.assertMainViewProxy().putState({divElement:e})}},{key:"setCameraBound",value:function(e){this.assertMainViewProxy().putState({cameraBound:e})}},{key:"moveCamera",value:function(e){this.assertMainViewProxy().putState({cameraMoving:{camera:e}})}},{key:"moveCameraToContain",value:function(e){this.assertMainViewProxy().putState({cameraMoving:{toContaint:e}})}}]),e}();!function(e){e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(hM||(hM={})),function(e){e.ThrowError="throwError",e.Warn="warn",e.Ignore="ignore"}(dM||(dM={}));var fM,vM,mM=Y(n(90646)),gM=function(){function e(t){C(this,e),this.lastCommitValues={},this.sumNodes={},this.maxValues={},this.minValues={},this.lastCommitTimestamp=Date.now(),this.backgroundValues=Object.freeze(W({},t))}return P(e,[{key:"report",value:function(){var e={},t={},n={};for(var r in this.backgroundValues){var i=this.backgroundValues[r],a=this.sumNodes[r],o=this.maxValues[r],s=this.minValues[r];if(void 0===a)e[r]=i;else if(void 0===a.otherValueSum)e[r]=a.firstValue;else{var c=this.lastCommitTimestamp-a.beginAt,u=c/a.count,l=a.firstValue*u+a.otherValueSum,h=u+c;e[r]=h>0?l/h:i}t[r]=void 0===o?i:o,n[r]=void 0===s?i:s}return this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},{averageValues:e,maxValues:t,minValues:n}}},{key:"clean",value:function(){for(var e in this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},this.lastCommitValues)delete this.lastCommitValues[e]}},{key:"commit",value:function(e){var t=Date.now();this.commitSumValues(t,e),this.commitMaxAndMinValues(e),this.lastCommitTimestamp=t}},{key:"commitSumValues",value:function(e,t){for(var n in t)void 0!==t[n]&&(this.lastCommitValues[n]=t[n]);for(var r in this.lastCommitValues){var i=this.lastCommitValues[r],a=this.sumNodes[r];void 0===a?this.sumNodes[r]={beginAt:e,firstValue:i,count:1,otherValueSum:i}:(a.count+=1,void 0===a.otherValueSum?a.otherValueSum=i*(e-a.beginAt):a.otherValueSum+=i*(e-this.lastCommitTimestamp))}}},{key:"commitMaxAndMinValues",value:function(e){for(var t in e){var n=e[t],r=this.maxValues[t],i=this.minValues[t];this.maxValues[t]=void 0===r?n:Math.max(r,n),this.minValues[t]=void 0===i?n:Math.min(i,n)}}}]),e}(),yM=function(){function e(t){var n=this,r=t.connection,i=t.disconnection,a=t.sample;C(this,e),this.statisticsTimer=null,this.onReportStatistics=function(){n.statisticsTimer=null,n.latestReportAt=Date.now();var e=n.statistics.report(),t=e.maxValues,r=e.minValues,i=e.averageValues;n.sampleCommitter.commit({maxRTT:t.rtt,minRTT:r.rtt,averageRTT:i.rtt,maxQueue:t.illusionQueueLength,minQueue:r.illusionQueueLength,averageQueue:i.illusionQueueLength,maxInterval:t.frameReceivedInterval,minInterval:r.frameReceivedInterval,averageInterval:i.frameReceivedInterval})},this.connectionCommitter=r,this.disconnectionCommitter=i,this.sampleCommitter=a,this.statistics=new gM({rtt:0,frameReceivedInterval:0,illusionQueueLength:0})}return P(e,[{key:"commitConnection",value:function(e){this.connectionCommitter.commit(e)}},{key:"commitDisconnection",value:function(e){this.disconnectionCommitter.commit(e)}},{key:"commitStatistics",value:function(t){if(void 0===this.latestReportAt&&(this.latestReportAt=Date.now()),null===this.statisticsTimer){var n=this.latestReportAt+e.reportStatisticsInterval-Date.now();n<0&&(n=e.reportStatisticsInterval,this.statistics.clean()),this.statisticsTimer=setTimeout(this.onReportStatistics,n)}this.statistics.commit(t)}},{key:"stop",value:function(){null!==this.statisticsTimer&&(clearTimeout(this.statisticsTimer),this.statisticsTimer=null)}}]),e}(),bM=yM;bM.reportStatisticsInterval=6e4,(vM=fM||(fM={})).Hand="cursor-hand",vM.HandGrasp="cursor-hand-grasp",vM.LaserPointer="cursor-laserPointer",vM.Selector="cursor-selector",vM.Pencil="cursor-pencil",vM.Eraser="cursor-eraser",vM.PencilEraser1="cursor-pencil-eraser-1",vM.PencilEraser2="cursor-pencil-eraser-2",vM.PencilEraser3="cursor-pencil-eraser-3",vM.Rectangle="cursor-rectangle",vM.Ellipse="cursor-ellipse",vM.Shape="cursor-shape",vM.Straight="cursor-straight",vM.Arrow="cursor-arrow",vM.Text="cursor-text",vM.Nwse="cursor-nwse",vM.Nesw="cursor-nesw",vM.Ns="cursor-ns",vM.Ew="cursor-ew",vM.Rotation="cursor-rotation",vM.Ban="cursor-ban";var kM=Object.freeze((a(r={},fM.Hand,Object.freeze(["url(".concat(aC["hand-loosen"],") 7 7, auto;"),"-webkit-image-set(url(".concat(aC["hand-loosen"],") 7 7, auto);")])),a(r,fM.HandGrasp,Object.freeze(["url(".concat(aC["hand-grasp"],") 6 6, auto;"),"-webkit-image-set(url(".concat(aC["hand-grasp"],") 6 6, auto);")])),a(r,fM.LaserPointer,Object.freeze(["url(".concat(aC["laser-pointer-cursor"],") 14 14, auto;"),"-webkit-image-set(url(".concat(aC["laser-pointer-cursor"],") 14 14, auto);")])),a(r,fM.Rotation,Object.freeze(["url(".concat(aC.rotation,") 12 12, auto;"),"-webkit-image-set(url(".concat(aC.rotation,") 12 12, auto);")])),a(r,fM.Selector,Object.freeze(["url(".concat(aC["selector-cursor"],") 5 4, auto;"),"-webkit-image-set(\n            url(".concat(aC["selector-cursor"],") 1x,\n            url(").concat(aC["selector-cursor@2x"],") 2x) 5 4, auto;")])),a(r,fM.Pencil,Object.freeze(["url(".concat(aC["pencil-cursor"],") 2 22, auto;"),"-webkit-image-set(\n            url(".concat(aC["pencil-cursor"],") 1x,\n            url(").concat(aC["pencil-cursor@2x"],") 2x) 2 22, auto;")])),a(r,fM.Eraser,Object.freeze(["url(".concat(aC["eraser-cursor"],") 8 18, auto;"),"-webkit-image-set(\n            url(".concat(aC["eraser-cursor"],") 1x,\n            url(").concat(aC["eraser-cursor@2x"],") 2x) 8 18, auto;")])),a(r,fM.PencilEraser1,Object.freeze(["url(".concat(aC["pencil-eraser-1"],") 9 13, auto;"),"-webkit-image-set(url(".concat(aC["pencil-eraser-1"],") 9 13, auto);")])),a(r,fM.PencilEraser2,Object.freeze(["url(".concat(aC["pencil-eraser-2"],") 13 17, auto;"),"-webkit-image-set(url(".concat(aC["pencil-eraser-2"],") 13 17, auto);")])),a(r,fM.PencilEraser3,Object.freeze(["url(".concat(aC["pencil-eraser-3"],") 17 25, auto;"),"-webkit-image-set(url(".concat(aC["pencil-eraser-3"],") 17 25, auto);")])),a(r,fM.Rectangle,Object.freeze(["crosshair;"])),a(r,fM.Ellipse,Object.freeze(["crosshair;"])),a(r,fM.Shape,Object.freeze(["crosshair;"])),a(r,fM.Straight,Object.freeze(["crosshair;"])),a(r,fM.Arrow,Object.freeze(["crosshair;"])),a(r,fM.Text,Object.freeze(["text;"])),a(r,fM.Nwse,Object.freeze(["nwse-resize;"])),a(r,fM.Nesw,Object.freeze(["nesw-resize;"])),a(r,fM.Ns,Object.freeze(["ns-resize;"])),a(r,fM.Ew,Object.freeze(["ew-resize;"])),a(r,fM.Ban,Object.freeze(["not-allowed"])),r)),wM=function(){function e(){C(this,e),this.isInjected=!1}return P(e,[{key:"injectDefaultStyleIfNotInjectBefore",value:function(){this.isInjected||(this.injectToDom(kM),this.isInjected=!0)}},{key:"injectCustomStyle",value:function(e){if(this.isInjected)throw new Error("cannot be called repeatedly, or after new WhiteWebSdk().");var t=W(W({},kM),e);this.injectToDom(t),this.isInjected=!0}},{key:"injectToDom",value:function(e){if(Object.keys(e).length>0){var t=document.createElement("style"),n=[];for(var r in e){var i=e[r];if(i){var a=".netless-whiteboard.".concat(r," {\n                        ").concat(i.map((function(e){return"cursor: ".concat(e)})).join(""),"\n                    }");n.push(a)}}t.appendChild(document.createTextNode(n.join("")));var o=document.head;o&&o.appendChild(t)}}}]),e}(),SM=new wM;function xM(e){SM.injectCustomStyle(e)}var CM=Y(n(68949)),IM=function(){function e(t){C(this,e),this.useMobX=t}return P(e,[{key:"filter",value:function(e){return this.useMobX?this.copyValue(e):e}},{key:"copyValue",value:function(e){return"object"!=M(e)||null===e?e:(0,CM.isObservableObject)(e)?this.copyObservableObject(e):(0,CM.isObservableArray)(e)||e instanceof Array?this.copyArray(e):this.copyObject(e)}},{key:"copyObservableObject",value:function(e){var t,n={},r=T((0,CM.keys)(e));try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i]=this.copyValue(e[i])}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"copyArray",value:function(e){for(var t=[],n=e.length,r=0;r<n;++r)t[r]=this.copyValue(e[r]);return t}},{key:"copyObject",value:function(e){var t={};for(var n in e)t[n]=this.copyValue(e[n]);return t}}]),e}(),PM=function(){function e(t,n,r){var i=this;C(this,e),this.queue=[],this.limiter=new Ue(n,(function(){var e=i.queue.shift();if(e){try{r(e.event,e.payload)}catch(e){t.error(e)}i.queue.length>0&&i.limiter.invoke()}}))}return P(e,[{key:"dispatch",value:function(e,t){this.queue.push({event:e,payload:t}),this.limiter.invoke()}}]),e}(),MM=function(){function e(){C(this,e),this.copyBuffer=null}return P(e,[{key:"cleanBuffer",value:function(){this.copyBuffer=null}},{key:"duplicate",value:function(e,t){return e.duplicate(this.createDelta(),this.createDelta(),t)}},{key:"copy",value:function(e,t){this.copyBuffer=e.copy(null,t)}},{key:"paste",value:function(e,t){var n=null;return this.copyBuffer&&(n=e.paste(this.copyBuffer,this.createDelta(),this.createDelta(),t)),n}},{key:"createDelta",value:function(){return e.maxDeltaDistance*(2*Math.random()-1)}}]),e}(),TM=MM;TM.maxDeltaDistance=12;var AM=function e(){var t=this;C(this,e),this.onPageJumpTo=function(e,n){var r="".concat(e,"/").concat(n,".slide"),i=t.room.state.sceneState.scenes.findIndex((function(e){return!!e.ppt&&e.ppt.src.endsWith(r)}));i>=0&&t.room.setSceneIndex(i)},this.onPageToNext=function(){var e=t.room.state.sceneState,n=e.scenes,r=e.index;r<n.length-1&&t.room.setSceneIndex(r+1)},this.onPageToPrev=function(){var e=t.room.state.sceneState.index;e>=1&&t.room.setSceneIndex(e-1)}},EM="modules",OM=function(){function e(t){var n=this;C(this,e),this.writingBuffer=null,this.invoker=function(){var e=n.writingBuffer;e&&u(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.limiter.freeze(),t.prev=1,r={uid:n.uid,timestamp:Date.now(),memberState:e},t.next=5,n.write(n.uuid,JSON.stringify(r));case 5:return t.prev=5,n.limiter.unfreeze(),t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[1,,5,8]])})))().catch((function(e){return console.error(e)}))},this.uid=t,this.limiter=new Ue(500,this.invoker)}var t,n,r;return P(e,[{key:"getMemberState",value:(r=u(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read(t);case 2:if(!(r=e.sent)){e.next=7;break}if((i=JSON.parse(r)).uid!==n){e.next=7;break}return e.abrupt("return",this.writingBuffer=i.memberState);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setMemberState",value:function(e){var t,n={},r=T(gI);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=e[i];void 0!==a&&(n[i]=a)}}catch(e){r.e(e)}finally{r.f()}this.limiter.invoke(),this.writingBuffer=W(W({},this.writingBuffer),Jx(n))}},{key:"dispose",value:function(){this.limiter.cancel(),this.writingBuffer=null}},{key:"read",value:(n=u(regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return r=t.sent.transaction([EM],"readonly").objectStore(EM).get(n),t.next=5,RM(r);case 5:return i=t.sent,t.abrupt("return",("string"!=typeof i&&(i=void 0),i));case 7:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"write",value:(t=u(regeneratorRuntime.mark((function t(n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return i=t.sent.transaction([EM],"readwrite").objectStore(EM).put(r,n),t.next=5,RM(i);case 5:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"dbp",get:function(){if(!this._dbp){var e=indexedDB.open("__netlessMemberState",1);e.onupgradeneeded=function(e){e.target.result.createObjectStore(EM)},this._dbp=RM(e)}return this._dbp}}]),e}();function RM(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var t=new Error(e.error.message);t.name=e.error.name,n(t)}else n(new Error("failed with null Error"))}}))}var NM,LM,jM,DM,FM=function(e){g(h,e);var t,n,r,i,a,o,c,l=b(h);function h(e){var t;return C(this,h),t=l.call(this,{logger:e.whiteLogger,region:e.region,useMobXState:e.useMobXState,screenType:e.screenType,renderEngine:e.renderEngine,boundless:e.boundless,cameraBound:e.cameraBound,autoResize:e.autoResize,plugins:e.plugins,invisiblePlugins:e.invisiblePlugins,wrappedComponents:e.wrappedComponents,preloadDynamicPPT:e.preloadDynamicPPT,disableCameraTransform:e.disableCameraTransform,useMultiViews:e.useMultiViews,userFonts:e.userFonts,handToolKey:e.handToolKey,fontFamily:e.fontFamily,pptHandler:e.useMultiViews?void 0:new AM,memberStateStorage:e.disableKeepMemberState?void 0:new OM(e.userPayload.uid),onlyCallbackRemoteStateModify:e.onlyCallbackRemoteStateModify,enableTextareHub:e.enableTextareHub,floatBarClass:e.floatBarOptions&&VM,globalStateUpdater:function(e){return t.setGlobalState(e)},disableOperations:!1,disableOthersSelectingBox:e.disableOthersSelectingBox,disableCurveAnimes:e.disableCurveAnimes,disableRotation:e.disableRotation,disableNewPencilStroke:e.disableNewPencilStroke,willHideSelfCursor:!1,cursorAdapter:e.cursorAdapter,eraserRadiusCursor:e.eraserRadiusCursor,eventInterrupter:function(e){return t.willInterruptEvent(e)},urlInterrupter:e.urlInterrupter,callbacks:e.callbacks,pptParams:e.pptParams,userPayload:e.userPayload,hotKeys:new _x(e.hotKeys),copyOperator:new TM,enableSelfCurveAnime:!1,undoStacksHub:new dC(e.undoCacheScenesCount,(function(e,n){t.applianceManager.execute(e,n)}))}),t.apiFetch=Bx.fetch("api"),t._phase=hM.Connecting,t._isWritable=!1,t._enableWriteNow=!1,t.isEraser=!1,t.disableSerializationCache=!0,t.didConnected=!1,t.viewInputsHub=null,t.viewStateObserver=null,t.beginReconnectAt=0,t.isHandGrasp=!1,t.onRoomStateChanged=function(e){e.globalState&&t.dynamicPpt.setGlobalState(Jx(e.globalState)),e.memberState&&(t.isEraser=h.checkIsEraser(e.memberState.currentApplianceName),t.refreshShouldDisableImageHit(),t.refreshCursorClass()),e.sceneState&&t.fetchNextPptSlideIfNeeded(e.sceneState),t.callbacks.dispatch("onRoomStateChanged",(function(t){return t(e)}))},t.onReceivedHandMouseEvent=function(e,n,r){if(t.magix.phase===Dc.Connected)switch(n.kind){case wu.MouseDown:case wu.SortedTouchStart:t.isHandGrasp=!0,e.putState({handToolActive:!0}),t.refreshCursorClass();break;case wu.MouseUp:case wu.SortedTouchEnd:case wu.SortedTouchCancel:t.isHandGrasp=!1,e.putState({handToolActive:!1}),t.refreshCursorClass()}},t.onHandMouseEventCompleted=function(e){t.isHandGrasp=!1,e.putState({handToolActive:!1}),t.refreshCursorClass()},t.onModified=function(){if(t._phase===hM.Connected){var e=t.viewStateObserver;iP.Follower===e.getCurrentMode()&&e.refreshCameraRectangle()}},t.onReconnected=function(e){var n;null==(n=t.statistics)||n.commitConnection(H(W({},e),{isReconnection:!0})),t.fireTriggerRebuild(),t.syncCameraToRemote(),t.magix.isWritable&&(t.receoverDisableSerialization(),t.recoverMemberState().catch((function(e){return console.error(e)})),t.refreshPptState())},t.onDisconnectWithError=function(e){var n;0!==t.beginReconnectAt&&(null==(n=t.statistics)||n.commitDisconnection({isReconnection:!0,duration:Date.now()-t.beginReconnectAt})),t.callbacks.dispatch("onDisconnectWithError",(function(t){return t(e)})),t.logger.error("onDisconnectWithError",e)},t.updateSelfUserId=function(e){void 0===e?(t.setObserverId(an),t._isWritable=!1):(t.setObserverId(e),t._isWritable=!0),t.refreshSyncOperations(),t.refreshCursorClass()},t.onCameraTransform=function(e){hM.Connected===t._phase&&gp.Begin===e&&iP.Follower===t.stateTrigger.state.broadcastState.mode&&(t._isWritable?t.applianceManager.setViewState({mode:iP.Freedom}):t.viewStateObserver.overrideWithFreedom(!0))},t.onCameraUpdated=function(){if(t._isWritable)switch(t.stateTrigger.state.broadcastState.mode){case iP.Broadcaster:case iP.Freedom:t.syncCameraToRemoteLimiter.invoke()}},t.syncCameraToRemote=function(){var e=w(t).mainView;if(t._isWritable&&e&&t.phase===hM.Connected){var n=e.screen,r=n.visionRectangle,i=n.camera.scale*iC(t.screenType);t.applianceManager.setViewState({originX:r.originX,originY:r.originY,width:r.width,height:r.height,pixelWidth:i})}},t.updateSession=function(e){t.logger.context=H(W({},t.logger.context),{session:e})},t.onPhaseChanged=function(e){t.logger.info("change room phase to "+e),e===Dc.Disconnected&&t.dispose();var n=hM.Connecting;switch(e){case Dc.Ready:case Dc.Connecting:n=hM.Connecting;break;case Dc.Connected:n=hM.Connected;break;case Dc.Reconnecting:n=hM.Reconnecting;break;case Dc.Disconnecting:n=hM.Disconnecting;break;case Dc.Disconnected:n=hM.Disconnected}switch(n){case hM.Reconnecting:t.beginReconnectAt=Date.now();break;case hM.Connected:t.beginReconnectAt=0}var r=t._phase!==n;t._phase=n,t.refreshSyncOperations(),t.didConnected&&t.refreshCursorClass(),r&&t.callbacks.dispatch("onPhaseChanged",(function(e){return e(n)}))},t.dispatchEvent=function(e,n){var r=n;r instanceof ArrayBuffer&&(r=be(r)),t.magix.dispatch(e,r)},t.uid=e.userPayload.uid,t.statistics=e.qualityComitters&&new bM(e.qualityComitters),t.rejectWhenReadonlyErrorLevel=e.rejectWhenReadonlyErrorLevel||dM.ThrowError,t.disablePencilWrittingLimitFrequency=e.disablePencilWrittingLimitFrequency,t.magix=e.akkoApp.createMagix({logger:t.logger,userPayload:e.userPayload,libraryNodeFetcher:t.libraryNodeFetcher,callbacks:{onPhaseChanged:t.onPhaseChanged,onDisconnectWithError:t.onDisconnectWithError,onModified:t.onModified,onSelfUserIdUpdate:t.updateSelfUserId,onSessionChanged:t.updateSession,onEventFire:function(e){return t.dispatchMagixEventWithObject(e,!1,e.authorId===t.observerId)},onEventFireACK:function(e){return t.dispatchMagixEventWithObject(e,!0,e.authorId===t.observerId)},onReconnected:t.onReconnected,onKickedWithReason:function(e){return t.callbacks.dispatch("onKickedWithReason",(function(t){return t(e)}))},onCatchErrorWhenAppendFrame:function(e,n){t.callbacks.dispatch("onCatchErrorWhenAppendFrame",(function(t){return t(e,n)}))},onSliceChanged:function(e){return t.callbacks.dispatch("onSliceChanged",(function(t){return t(e)}))},onReceivedRttReport:t.statistics&&function(e){return t.statistics.commitStatistics({rtt:e})},onIllusionQueueLengthChanged:t.statistics&&function(e){t.statistics.commitStatistics({illusionQueueLength:e})},onFrameReceivedInterval:t.statistics&&function(e){t.statistics.commitStatistics({frameReceivedInterval:e})}}}),t.eventsQueue=e.disableMagixEventDispatchLimit?null:new PM(t.logger,75,t.dispatchEvent),t._disableDeviceInputs=e.disableDeviceInputs,t._disableEraseImage=e.disableEraseImage,t.syncCameraToRemoteLimiter=new Ue(100,t.syncCameraToRemote),t.parametersFilter=new IM(e.useMobXState),t.floatBarOptions=e.floatBarOptions,t.pptHandler&&(t.pptHandler.room=w(t)),t}return P(h,[{key:"applianceManager",get:function(){return this.magix.trigger}},{key:"isWritable",get:function(){return this.magix.isWritable}},{key:"enableWriteNow",get:function(){return this._enableWriteNow}},{key:"setWritable",value:(c=u(regeneratorRuntime.mark((function e(t){var n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("set writable "+t),n=this.viewStateObserver,!t){e.next=14;break}return e.next=5,this.magix.setWritable(t,this.deviceType);case 5:return this.pencilOptions.becomeWritable(this.applianceManager),(r=this.applianceManager.getViewState().mode)!==iP.Broadcaster&&(i=n.getCurrentMode())!==r&&this.stateTrigger.activeUpdate("broadcastState",(function(){return a.applianceManager.setViewState({mode:i}),n.getBroadcastState()})),e.next=10,this.recoverMemberState();case 10:this.syncCameraToRemote(),n.setReadonlyMode(!1),e.next=17;break;case 14:return n.setReadonlyMode(!0),e.next=17,this.magix.setWritable(t);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"disableDeviceInputs",get:function(){return this._disableDeviceInputs},set:function(e){this._disableDeviceInputs=e,this.refreshSyncOperations(),this.refreshCursorClass()}},{key:"disableEraseImage",get:function(){return this._disableEraseImage},set:function(e){this._disableEraseImage=e,this.refreshShouldDisableImageHit()}},{key:"disableSerialization",get:function(){return this._phase!==hM.Connected||this.disableSerializationCache},set:function(e){this.isEnableModify()&&(e&&this.copyOperator.cleanBuffer(),this.applianceManager.setEnableExecute(!e),this.disableSerializationCache=e)}},{key:"uuid",get:function(){return this._uuid}},{key:"session",get:function(){return this.magix.session}},{key:"slice",get:function(){return this.magix.slice}},{key:"roomToken",get:function(){return this._roomToken}},{key:"phase",get:function(){return this._phase}},{key:"calibrationTimestamp",get:function(){return this.magix.calibrationTimestamp}},{key:"state",get:function(){return this.stateTrigger.state}},{key:"timeDelay",get:function(){return this.magix.timeDelay},set:function(e){this.magix.timeDelay=e}},{key:"setupLibraryNode",value:function(e,t){var n,r=this,i=this.mainView;this.viewInputsHub=new aP({deviceType:e,screenType:this.screenType,magix:this.magix,pencilOptions:this.pencilOptions,onReceivedHandMouseEvent:this.onReceivedHandMouseEvent,onHandMouseEventCompleted:this.onHandMouseEventCompleted}),this.updateLibraryNode(t),this.viewStateObserver=new zP(this.viewsHub,this.magix.trigger),this.viewsHub.setupViewInput({viewInputsHub:this.viewInputsHub,magix:this.magix,viewsHub:this.viewsHub,cameraObserver:this.cameraObserver,pencilOptions:this.pencilOptions,bezierCurvePainter:this.bezierCurvePainter,disablePencilWrittingLimitFrequency:this.disablePencilWrittingLimitFrequency,getCursorStyleWithRadius:function(e){return r.getCursorStyleWithRadius(e)}}),i&&this.unregisterMainView(i),this.mainView&&this.registerMainView(this.mainView);var a=this.cameraObserver,o=this.applianceManager;this.stateTrigger=new rC({useMobXMode:this.useMobXState,disableMaskKey:this.onlyCallbackRemoteStateModify,onStateChanged:this.onRoomStateChanged,propertyGetters:{globalState:function(){return o.getGlobalState()},memberState:function(){return o.getMemberState()||r.getDefaultMemberState()},roomMembers:function(){return r.getRoomMembers()},sceneState:function(){return r.getCurrentSceneState()},broadcastState:function(){return r.viewStateObserver.getBroadcastState()},cameraState:function(){return a.cameraState}}}),this.invisiblePluginNode.isWatching=!0,this.isEraser=h.checkIsEraser(null==(n=this.stateTrigger.state.memberState)?void 0:n.currentApplianceName),this.dynamicPpt.setGlobalState(Jx(o.getGlobalState())),this.refreshSyncOperations(),this.refreshCursorClass(),this.refreshShouldDisableImageHit()}},{key:"registerMainView",value:function(e){var t=this;e.callbacks.on("onKeyDown",(function(e){return t.callbacks.dispatch("onKeyDown",(function(t){return t(e)}))})),e.callbacks.on("onKeyUp",(function(e){return t.callbacks.dispatch("onKeyUp",(function(t){return t(e)}))})),e.callbacks.on("onCanRedoStepsUpdate",(function(e){return t.callbacks.dispatch("onCanRedoStepsUpdate",(function(t){return t(e)}))})),e.callbacks.on("onCanUndoStepsUpdate",(function(e){return t.callbacks.dispatch("onCanUndoStepsUpdate",(function(t){return t(e)}))})),e.cameraman.addCameraTransformationListener(this.onCameraTransform),e.screen.addCameraUpdatedListener(this.onCameraUpdated)}},{key:"unregisterMainView",value:function(e){e.callbacks.off("onKeyDown"),e.callbacks.off("onKeyUp"),e.callbacks.off("onCanRedoStepsUpdate"),e.callbacks.off("onCanUndoStepsUpdate"),e.cameraman.removeCameraTransformationListener(this.onCameraTransform),e.screen.removeCameraUpdatedListener(this.onCameraUpdated)}},{key:"dispose",value:function(){var e;s(x(h.prototype),"dispose",this).call(this),this.didConnected&&this.viewsHub.releaseViewInput(),null==(e=this.viewStateObserver)||e.release(),this.didConnected&&this.stateTrigger.release()}},{key:"willInterruptEvent",value:function(e){if(e instanceof KeyboardEvent){var t=!1;return this.callbacks.dispatch("willInterceptKeyboardEvent",(function(n){n(e)&&(t=!0)})),t}return!1}},{key:"refreshSyncOperations",value:function(){var e=!this._isWritable||this._phase===hM.Reconnecting||this._phase===hM.Disconnecting||this._phase===hM.Disconnected,t=e||this._disableDeviceInputs;this.hasLibraryNode&&(this.viewsHub.putState({disableBoundlessEvent:t}),this.dynamicPpt.setDisableInteractive(t)),this._enableWriteNow!==e&&(this._enableWriteNow=e,this.viewInputsHub&&!e&&this.viewInputsHub.cleanWaitingEvents(),this.callbacks.dispatch("onEnableWriteNowChanged",(function(t){return t(e)})))}},{key:"connect",value:(o=u(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Date.now(),e.prev=1,this._uuid=t.uuid,this._roomToken=t.roomToken,this.pencilOptions=new yI(t.enableDrawPoint,t.disableNewPencil),this.memberStateStorage&&(this.memberStateStorage.uuid=t.uuid),e.next=5,this.magix.connect({uuid:t.uuid,region:t.region||yx.defaultRegion,roomToken:t.roomToken,connectedPayload:t.deviceType,isWritable:t.isWritable});case 5:if(a=e.sent,o=a.libraryNode,s=a.statistics,this.logger.context=H(W({},this.logger.context),{session:this.magix.session}),this.setupLibraryNode(t.deviceType,o),this.magix.isWritable&&this.updateSelfUserId(this.magix.selfUserId),this._isWritable||this.viewStateObserver.setReadonlyMode(!0),e.t0=this._isWritable,!e.t0){e.next=18;break}return this.pencilOptions.becomeWritable(this.applianceManager),e.next=17,this.recoverMemberState();case 17:this.refreshPptState();case 18:null==(n=this.statistics)||n.commitConnection(H(W({},s),{isReconnection:!1})),this.logger.info("join room success"),this.fetchNextPptSlideIfNeeded(this.state.sceneState),this.didConnected=!0,e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(1),null==(r=this.statistics)||r.commitDisconnection({isReconnection:!1,duration:Date.now()-i}),this.logger.error("join room fail"),this.logger.error(e.t1),e.t1;case 27:case"end":return e.stop()}}),e,this,[[1,24]])}))),function(e){return o.apply(this,arguments)})},{key:"recoverMemberState",value:(a=u(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null==(t=this.memberStateStorage)?void 0:t.getMemberState(this._uuid,this.uid);case 2:(n=e.sent)&&this.stateTrigger.activeUpdate("memberState",(function(){return r.applianceManager.setMemberState(n)}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"onScreenSizeUpdated",value:function(){this.stateTrigger.state.broadcastState.mode!==iP.Follower&&this.syncCameraToRemoteLimiter.invoke()}},{key:"syncBlockTimestamp",value:function(e){this.magix.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){this.magix.stopBlockTimestamp()}},{key:"dispatchMagixEvent",value:function(e,t){if(this.isEnableModify())if(this.eventsQueue)this.eventsQueue.dispatch(e,t);else try{this.dispatchEvent(e,t)}catch(e){this.logger.error(e)}}},{key:"disconnect",value:(i=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._phase!==hM.Disconnected){e.next=2;break}throw new Error("room did disconnect");case 2:return e.next=4,this.magix.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setGlobalState",value:function(e){var t=this;return this.isEnableModify()?this.stateTrigger.activeUpdate("globalState",(function(){var n=t.parametersFilter.filter(e),r=t.applianceManager.setGlobalState(n);return t.dynamicPpt.setGlobalState(Jx(r)),r})):this.stateTrigger.state.globalState}},{key:"setMemberState",value:function(e){return this.assertMainViewProxy().owner.setMemberState(e)}},{key:"wrapSetMemberState",value:function(e,t,n){var r;if(this.isEnableModify()){var i=this.parametersFilter.filter(e);i.currentApplianceName&&(t.cancelCurrentContinuityEvent(),this.beforeSceneChangeStoreCommit(t));var a=this.stateTrigger.activeUpdate("memberState",(function(){return n(i)}));return this.refreshCursorClass(),null==(r=this.memberStateStorage)||r.setMemberState(i),Jx(a)}return this.stateTrigger.state.memberState}},{key:"setViewMode",value:function(e){var t=this;this.assertRoomIsConnected();var n=this.viewStateObserver;if(this._isWritable)this.stateTrigger.activeUpdate("broadcastState",(function(){return t.applianceManager.setViewState({mode:e}),n.getBroadcastState()})),e===iP.Follower&&n.refreshCameraRectangle();else switch(e){case iP.Follower:n.overrideWithFreedom(!1),n.refreshCameraRectangle();break;case iP.Freedom:n.overrideWithFreedom(!0);break;case iP.Broadcaster:throw new Error("cannot be broadcaster when room.isWritable is false")}}},{key:"updatePptPageInfo",value:function(){var e=this.stateTrigger.state.sceneState,t=e.scenes[e.index],n=t.ppt&&t.ppt.src,r=n&&this.dynamicPpt.getSlideUrl&&this.dynamicPpt.getSlideUrl(n);r&&this.setGlobalState(Jx(this.dynamicPpt.globalStateWith({uuid:r.uuid,pageIndex:r.index,disableAutoPlay:!1})))}},{key:"setScenePath",value:function(e){var t=this;if(this.isEnableModify()){this.logger.info("change scene path ".concat(e));var n=this.applianceManager,r=this.scenePathType(e),i=e;if(r===mI.Dir){var a=bs(n.getSceneNames(Xx.parse(e))).shift();i=void 0===a?i:[i,a].join(uM)}this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",(function(){return n.changeScene(Xx.parse(i)),t.getCurrentSceneState()})),this.updatePptPageInfo()}}},{key:"setSceneIndex",value:function(e){var t=this;if(this.isEnableModify()){var n=this.stateTrigger.state.sceneState.scenes[e];if(!n)throw new Error("index ".concat(e," is out of range"));var r=this.applianceManager,i=p(r.getCurrentScenePath());i.pop(),i.push(n.name),this.logger.info("change scene index ".concat(e," /").concat(i.join("/"))),this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",(function(){return r.changeScene(i),t.getCurrentSceneState()})),this.updatePptPageInfo()}}},{key:"moveCamera",value:function(e){this.assertRoomIsConnected(),s(x(h.prototype),"moveCamera",this).call(this,e)}},{key:"moveCameraToContain",value:function(e){this.assertRoomIsConnected(),s(x(h.prototype),"moveCameraToContain",this).call(this,e)}},{key:"putScenes",value:function(e,t,n){var r=this;if(this.isEnableModify()){var i,a=[],o=T(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;void 0!==s.name?a.push(this.parametersFilter.filter(s)):a.push({name:(0,mM.v1)().replace(/-/g,""),ppt:s.ppt})}}catch(e){o.e(e)}finally{o.f()}this.stateTrigger.activeUpdate("sceneState",(function(){return r.applianceManager.putScenes(Xx.parse(e),a,n),r.getCurrentSceneState()}))}}},{key:"cleanCurrentScene",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null==(e=this.assertMainViewProxy().owner)||e.cleanCurrentScene(t)}},{key:"removeScenes",value:function(e){var t=this;this.isEnableModify()&&this.stateTrigger.activeUpdate("sceneState",(function(){return t.applianceManager.removeScenes(Xx.parse(e)),t.getCurrentSceneState()}))}},{key:"moveScene",value:function(e,t){var n=this;this.isEnableModify()&&this.stateTrigger.activeUpdate("sceneState",(function(){return n.applianceManager.moveScene(Xx.parse(e),Xx.parse(t)),n.getCurrentSceneState()}))}},{key:"createWrappedComponents",value:function(){return[].concat(p(s(x(h.prototype),"createWrappedComponents",this).call(this)),[this.reactContext.createWrappedComponent(WP,this)])}},{key:"createPluginOperator",value:function(){var e=this;return Object.freeze(H(W({},s(x(h.prototype),"createPluginOperator",this).call(this)),{remove:function(t){return e.removePlugin(t)},update:function(t,n){return e.updatePlugin(t,n)},getPlugin:function(t){return e.applianceManager.getPlugin(t)}}))}},{key:"insertImage",value:function(e){var t;null==(t=this.assertMainViewProxy().owner)||t.insertImage(e)}},{key:"completeImageUpload",value:function(e,t){var n;null==(n=this.assertMainViewProxy().owner)||n.completeImageUpload(e,t)}},{key:"lockImage",value:function(e,t){var n;null==(n=this.assertMainViewProxy().owner)||n.lockImage(e,t)}},{key:"createInvisiblePlugin",value:function(e,t){return this.invisiblePluginNode.create(e,t)}},{key:"insertPlugin",value:function(e,t){if(this.assertMainViewProxy(),this.isEnableModify()){var n=t,r=n&&n.attributes,i=this.assignAttributes(e,r);return i!==r&&(n=H(W({},n),{attributes:i})),this.applianceManager.insertPlugin(e,n).identifier}return mt}},{key:"removePlugin",value:function(e){var t=!1;return this.isEnableModify()&&(t=!!this.applianceManager.removePlugin(e)),t}},{key:"updatePlugin",value:function(e,t){var n=!1;return this.isEnableModify()&&(n=!!this.applianceManager.updatePlugin(e,t)),n}},{key:"getPluginAttributes",value:function(e){this.assertRoomIsConnected();var t=this.applianceManager.getPlugin(e);return t&&t.attributes}},{key:"getPluginRectangle",value:function(e){this.assertRoomIsConnected();var t=this.applianceManager.getPlugin(e);return t&&{originX:t.originX,originY:t.originY,width:t.width,height:t.height}}},{key:"insertText",value:function(e,t,n){var r,i=null==(r=this.assertMainViewProxy().owner)?void 0:r.insertText(e,t,n);return void 0===i&&(i=mt),i}},{key:"updateText",value:function(e,t){var n;null==(n=this.assertMainViewProxy().owner)||n.updateText(e,t)}},{key:"updateSelectedText",value:function(e){var t;null==(t=this.assertMainViewProxy().owner)||t.updateSelectedText(e)}},{key:"duplicate",value:function(){var e;null==(e=this.assertMainViewProxy().owner)||e.duplicate()}},{key:"copy",value:function(){var e;null==(e=this.assertMainViewProxy().owner)||e.copy()}},{key:"paste",value:function(){var e;null==(e=this.assertMainViewProxy().owner)||e.paste()}},{key:"canUndoSteps",get:function(){var e;return(null==(e=this.assertMainViewProxy().owner)?void 0:e.canUndoSteps)||0}},{key:"canRedoSteps",get:function(){var e;return(null==(e=this.assertMainViewProxy().owner)?void 0:e.canUndoSteps)||0}},{key:"undo",value:function(){var e=this.assertMainViewProxy().owner;return e?e.undo():0}},{key:"redo",value:function(){var e=this.assertMainViewProxy().owner;return e?e.redo():0}},{key:"delete",value:function(){var e;null==(e=this.assertMainViewProxy().owner)||e.delete()}},{key:"lockImages",value:function(e){var t;null==(t=this.assertMainViewProxy().owner)||t.lockImages(e)}},{key:"moveSelectedComponentsToTop",value:function(){var e;null==(e=this.assertMainViewProxy().owner)||e.moveSelectedComponentsToTop()}},{key:"moveSelectedComponentsToBottom",value:function(){var e;null==(e=this.assertMainViewProxy().owner)||e.moveSelectedComponentsToBottom()}},{key:"pptNextStep",value:function(){this.isEnableModify()&&this.pptMoveStep(1)}},{key:"pptPreviousStep",value:function(){this.isEnableModify()&&this.pptMoveStep(-1)}},{key:"pptMoveStep",value:function(e){var t=this.stateTrigger.state.sceneState,n=t.scenes,r=t.index,i=n[r],a=i.ppt&&i.ppt.src;if(a&&this.dynamicPpt.getSlideUrl(a))this.dynamicPpt.moveStep(e);else{var o=r+e;o>=0&&o<n.length&&this.setSceneIndex(o)}}},{key:"refreshCursorClass",value:function(){var e;switch(this.phase){case hM.Reconnecting:case hM.Disconnecting:case hM.Disconnected:e=fM.Ban;break;case hM.Connected:if(this.stateTrigger){var t=this.stateTrigger.state.memberState;if(t&&this._isWritable&&!this._disableDeviceInputs)switch(t.currentApplianceName){case fI.hand:e=this.isHandGrasp?fM.HandGrasp:fM.Hand;break;case fI.pencilEraser:var n=t.pencilEraserSize;"number"!=typeof n&&(n=1),e="cursor-pencil-eraser-"+(n=Math.min(3,Math.max(1,Math.floor(n))));break;default:e="cursor-"+t.currentApplianceName}else e=null}}void 0!==e&&this.viewsHub.putState({cursorClass:e})}},{key:"refreshPptState",value:function(){this.updatePptPageInfo()}},{key:"receoverDisableSerialization",value:function(){this.disableSerializationCache||this.applianceManager.setEnableExecute(!0)}},{key:"refreshShouldDisableImageHit",value:function(){this.viewsHub.putState({disalbeImageHit:this._disableEraseImage&&this.isEraser})}},{key:"exportScene",value:(r=u(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.scenePathType(t))===mI.Page){e.next=3;break}throw new Error("can export a page, because of ".concat(t,"'s scene path type is ").concat(n));case 3:return e.next=5,this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-export/"),{method:"POST",headers:{token:this.roomToken,"content-type":"application/json",region:this.region},body:JSON.stringify({path:t})});case 5:if(201!==(r=e.sent).status){e.next=10;break}return e.next=9,r.blob();case 9:return e.abrupt("return",e.sent);case 10:return e.t0=Error,e.t1="export scene fail: ",e.next=14,r.text();case 14:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"importScene",value:(n=u(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.scenePathType(t))!==mI.Page&&r!==mI.Conflict){e.next=4;break}throw i=r===mI.Page?"".concat(t," is a scene page"):"".concat(t," path contains a page"),new Error("can't import a scene in ".concat(t,", because of ").concat(i));case 4:return e.next=6,this.getSceneFromBlob(n);case 6:if(a=e.sent,o=a.name,s=[t,o].join(uM),this.scenePathType(s)!==mI.Dir){e.next=11;break}throw new Error("can't import a scene in ".concat(s," because of ").concat(s," contains scene page"));case 11:return(c=new FormData).append("dir",t),c.append("payload",n),e.next=15,this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-import/"),{method:"POST",headers:{token:this.roomToken,region:this.region},body:c});case 15:if(!((u=e.sent).status>=300)){e.next=24;break}return e.t0=Error,e.t1="import scene fail: ",e.next=21,u.text();case 21:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getSceneFromBlob",value:(t=u(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=new FileReader;i.readAsArrayBuffer(t),i.onloadend=function(){if(i.result instanceof ArrayBuffer)try{var t=be(i.result),r=n.applianceManager.getSceneFromFile(t);e(r)}catch(t){e(t)}else e(new Error("wrong content"))},i.onerror=function(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"isEnableModify",value:function(){if(this.assertRoomIsConnected(),this._isWritable)return!0;switch(this.rejectWhenReadonlyErrorLevel){case dM.ThrowError:throw new Error("you can only call it when room is writable");case dM.Warn:this.logger.warn("you can only call it when room is writable")}return!1}},{key:"assertRoomIsConnected",value:function(){if(this._phase!==hM.Connected)throw new Error("you can only call it when room is connected. the phase of room is "+this._phase)}},{key:"beforeSceneChangeStoreCommit",value:function(e){var t=this.applianceManager.releaseAllTextarea(null,null==e?void 0:e.focusSceneId),n=null==e?void 0:e.undoStack;n&&t&&n.commit(t)}}],[{key:"checkIsEraser",value:function(e){switch(e){case fI.eraser:case fI.pencilEraser:return!0;default:return!1}}}]),h}(pM);(LM=NM||(NM={})).WaitingFirstFrame="waitingFirstFrame",LM.Playing="playing",LM.Pause="pause",LM.Stopped="stop",LM.Ended="ended",LM.Buffering="buffering",function(e){e.Directory="directory",e.Freedom="freedom"}(jM||(jM={})),function(e){e.Success="success",e.SuccessButUnnecessary="successButUnnecessary",e.Override="override",e.Stopped="stopped"}(DM||(DM={}));var zM=Y(n(68949)),BM=new Date("2019-06-23Z00:00:00").getTime(),UM=function(e){g(i,e);var t,n,r=b(i);function i(e){var t;return C(this,i),(t=r.call(this,{logger:e.logger,region:e.region,useMobXState:e.useMobXState,screenType:e.screenType,renderEngine:e.renderEngine,boundless:e.boundless,cameraBound:e.cameraBound,autoResize:e.autoResize,plugins:e.plugins,invisiblePlugins:e.invisiblePlugins,wrappedComponents:e.wrappedComponents,preloadDynamicPPT:e.preloadDynamicPPT,userFonts:e.userFonts,handToolKey:e.handToolKey,fontFamily:e.fontFamily,onlyCallbackRemoteStateModify:e.onlyCallbackRemoteStateModify,disableOthersSelectingBox:e.disableOthersSelectingBox,disableCameraTransform:e.disableCameraTransform,disableNewPencilStroke:e.disableNewPencilStroke,useMultiViews:e.useMultiViews,disableOperations:!0,willHideSelfCursor:!0,cursorAdapter:e.cursorAdapter,eraserRadiusCursor:e.eraserRadiusCursor,urlInterrupter:e.urlInterrupter,pptParams:e.pptParams,disableCurveAnimes:e.disableCurveAnimes,disableRotation:e.disableRotation,enableTextareHub:!1,enableSelfCurveAnime:!0,callbacks:e.callbacks})).didLoadFirstFrame=!1,t.observerMode=jM.Directory,t.onTriggerBuilt=function(){t.hasLibraryNode&&t.fireTriggerRebuild()},t.onLibraryNodeChanged=function(e,n){var r,i=t.hasLibraryNode;if(t.updateLibraryNode(n),!i){var a=w(t),o=a.applianceManager,s=a.cameraObserver;t.viewStateObserver=new zP(t.viewsHub,o),t.stateTrigger=new rC({useMobXMode:t.useMobXState,disableMaskKey:t.onlyCallbackRemoteStateModify,onStateChanged:t.onPlayerStateChanged,propertyGetters:{observerMode:function(){return t.observerMode},globalState:function(){return o.getGlobalState()},roomMembers:function(){return t.getRoomMembers()},sceneState:function(){return t.getCurrentSceneState()},cameraState:function(){return s.cameraState}}}),null==(r=t.mainView)||r.callbacks.on("onCameraTransform",t.onCameraTransform)}},t.onPhaseChanged=function(e){var n=!1;!t.didLoadFirstFrame&&t.hasFrameToDisplay(e)&&(t.didLoadFirstFrame=!0,n=!0,t.fetchNextPptSlideIfNeeded(t.state.sceneState),t.setupAfterLoadFirstFrame()),t.updatePhaseByReconstructorPhase(t.reconstructor.phase)&&(t.logger.info("change player phase to "+t._phase),t.callbacks.dispatch("onPhaseChanged",(function(e){return e(t._phase)})),t.dynamicPpt&&t.dynamicPpt.replayPasue&&t.dynamicPpt.replayPasue(t._phase!==NM.Playing)),n&&t.callbacks.dispatch("onLoadFirstFrame",(function(e){return e()})),t.invisiblePluginNode.isWatching=t._phase===NM.Playing||t._phase===NM.Pause},t.onPlayerStateChanged=function(e){e.globalState&&t.dynamicPpt.setGlobalState(Jx(e.globalState)),e.sceneState&&t.fetchNextPptSlideIfNeeded(e.sceneState),t.callbacks.dispatch("onPlayerStateChanged",(function(t){return t(e)}))},t.onSliceChanged=function(e){t.logger.context=H(W({},t.logger.context),{slice:e&&e.uuid}),t.refreshForcePPTLandscapeWithSlice(e),t.callbacks.dispatch("onSliceChanged",(function(t){return t(e.uuid)}))},t.onCameraTransform=function(e){e===gp.Begin&&t.observerMode===jM.Directory&&(t.observerMode=jM.Freedom)},t.onModified=function(){t.viewStateObserver&&t.observerMode===jM.Directory&&t.viewStateObserver.refreshCameraRectangle(),t.refreshRender()},t.callbacks.on("onProgressTimeChanged",(function(e){return t.putPlayerState({timestamp:e})})),(0,zM.makeObservable)(w(t),{observerMode:zM.observable}),t}return P(i,[{key:"applianceManager",get:function(){return this.reconstructor.trigger}},{key:"parametersFilter",get:function(){}},{key:"playbackSpeed",get:function(){return this.reconstructor.playbackSpeed},set:function(e){this.reconstructor.playbackSpeed=e,this.putPlayerState({playbackSpeed:e})}},{key:"disablePencilWrittingLimitFrequency",get:function(){return!1}},{key:"wrapSetMemberState",value:function(){throw new Error("can only call this method on room")}},{key:"setupReconstructor",value:(n=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.akkoApp.createReconstructor({logger:this.logger,roomToken:t.roomToken,clientVersion:yx.sdkVersion,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:this.createReconstructorCallbacks(),rangeQuery:{region:t.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration}});case 3:this.reconstructor=e.sent,this.updatePhaseByReconstructorPhase(this.reconstructor.phase),this.logger.info("setup player success"),this.logger.context=H(W({},this.logger.context),{uuid:this.reconstructor.roomUUID,slice:this.reconstructor.slice&&this.reconstructor.slice.uuid}),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),this.logger.error("setup player fail"),this.logger.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return n.apply(this,arguments)})},{key:"createReconstructorCallbacks",value:function(){var e=this;return{onEventFire:function(t){return e.dispatchMagixEventWithObject(t,!1,!1)},onSliceChanged:this.onSliceChanged,onTriggerBuilt:this.onTriggerBuilt,onLibraryNodeChanged:this.onLibraryNodeChanged,onPhaseChanged:this.onPhaseChanged,onModified:this.onModified,onIsPlayableChanged:function(t){return e.callbacks.dispatch("onIsPlayableChanged",(function(e){return e(t)}))},onProgressTimeChanged:function(t){return e.callbacks.dispatch("onProgressTimeChanged",(function(e){return e(t)}))},onStoppedWithError:function(t){return e.callbacks.dispatch("onStoppedWithError",(function(e){return e(t)}))},onCatchErrorWhenAppendFrame:function(t,n){e.callbacks.dispatch("onCatchErrorWhenAppendFrame",(function(e){return e(t,n)}))}}}},{key:"hasFrameToDisplay",value:function(e){switch(e){case Xc.Playing:case Xc.Pause:case Xc.Buffering:case Xc.Ended:return!0;default:return!1}}},{key:"setupAfterLoadFirstFrame",value:function(){this.reconstructor.slice&&this.refreshForcePPTLandscapeWithSlice(this.reconstructor.slice),this.dynamicPpt.setGlobalState(Jx(this.applianceManager.getGlobalState()))}},{key:"dispose",value:function(){var e;s(x(i.prototype),"dispose",this).call(this),this.viewStateObserver&&this.viewStateObserver.release(),this.stateTrigger&&this.stateTrigger.release(),null==(e=this.mainView)||e.callbacks.on("onCameraTransform",this.onCameraTransform)}},{key:"createWrappedComponents",value:function(){return[].concat(p(s(x(i.prototype),"createWrappedComponents",this).call(this)),[this.reactContext.createWrappedComponent(HP,this)])}},{key:"refreshForcePPTLandscapeWithSlice",value:function(e){e.beginTimestamp<=BM?this.viewsHub.putState({forcePPTLandscape:!0}):this.viewsHub.putState({forcePPTLandscape:!1})}},{key:"setObserverMode",value:function(e){var t=this;this.stateTrigger.activeUpdate("observerMode",(function(){return t.observerMode=e})),this.viewStateObserver&&e===jM.Directory&&this.viewStateObserver.refreshCameraRectangle()}},{key:"state",get:function(){if(!this.hasLibraryNode)throw new Error("can't read state before load first frame");return this.stateTrigger.state}},{key:"roomUUID",get:function(){return this.reconstructor.roomUUID}},{key:"slice",get:function(){return this.reconstructor.slice&&this.reconstructor.slice.uuid}},{key:"isPlayable",get:function(){return this.reconstructor.isPlayable}},{key:"phase",get:function(){return this._phase}},{key:"progressTime",get:function(){return this.reconstructor.progressTime}},{key:"timeDuration",get:function(){return this.reconstructor.duration}},{key:"framesCount",get:function(){return this.reconstructor.framesCount}},{key:"beginTimestamp",get:function(){return this.reconstructor.beginTimestamp}},{key:"play",value:function(){this.assertRoomIsConnected(),this.reconstructor.play()}},{key:"pause",value:function(){this.assertRoomIsConnected(),this.reconstructor.pause()}},{key:"stop",value:function(){if(this._phase===NM.Stopped)throw new Error("player did stop");this.reconstructor.stop(),this.dispose()}},{key:"seekToProgressTime",value:(t=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertRoomIsConnected(),e.next=3,this.reconstructor.seekToProgressTime(t);case 3:e.t0=e.sent,e.next=e.t0===Qc.Success?6:e.t0===Qc.SuccessButUnnecessary?7:e.t0===Qc.Override?8:e.t0===Qc.Stopped?9:10;break;case 6:return e.abrupt("return",DM.Success);case 7:return e.abrupt("return",DM.SuccessButUnnecessary);case 8:return e.abrupt("return",DM.Override);case 9:return e.abrupt("return",DM.Stopped);case 10:throw new Error("invalid result");case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updatePhaseByReconstructorPhase",value:function(e){var t=i.covertPhase(e),n=this._phase!==t;return n&&(this._phase=t,this.putPlayerState({isPlaying:t===NM.Playing})),n}},{key:"assertRoomIsConnected",value:function(){if(this._phase===NM.Stopped)throw new Error("you cannot call it when phase of player is stopped")}}],[{key:"covertPhase",value:function(e){switch(e){case Xc.WaitingFirstFrame:return NM.WaitingFirstFrame;case Xc.Playing:return NM.Playing;case Xc.Pause:return NM.Pause;case Xc.Stopped:return NM.Stopped;case Xc.Ended:return NM.Ended;case Xc.Buffering:case Xc.Seeking:return NM.Buffering;default:throw new Error("invalid phase ".concat(e))}}}]),i}(pM),VM=function(e){g(n,e);var t=b(n);function n(){return C(this,n),t.apply(this,arguments)}return P(n,[{key:"render",value:function(){var e=this;return TC.createElement(YP,null,(function(t){return TC.createElement(iI,H(W({},e.props),{room:t}))}))}}],[{key:"willInterruptEvent",value:function(){return iI.willInterruptEvent()}}]),n}(TC.Component);function WM(e){var t;return"boolean"==typeof e?t=e?Object.freeze({colors:HM()}):void 0:e&&(t=Object.freeze({colors:HM(e.colors)})),t}function HM(e){return e?Object.freeze(e.map((function(e){return Object.freeze(p(e))}))):_M}var _M=Object.freeze([Object.freeze([224,32,32]),Object.freeze([250,100,0]),Object.freeze([247,181,0]),Object.freeze([109,212,0]),Object.freeze([68,215,182]),Object.freeze([50,197,255]),Object.freeze([0,145,255]),Object.freeze([98,54,255]),Object.freeze([182,32,224]),Object.freeze([109,114,120]),Object.freeze([0,0,0]),Object.freeze([255,255,255])]),GM=Object.defineProperty,YM=Object.defineProperties,XM=Object.getOwnPropertyDescriptors,QM=Object.getOwnPropertySymbols,KM=Object.prototype.hasOwnProperty,qM=Object.prototype.propertyIsEnumerable,ZM=function(e,t,n){return t in e?GM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},JM=function(e,t){for(var n in t||(t={}))KM.call(t,n)&&ZM(e,n,t[n]);if(QM){var r,i=T(QM(t));try{for(i.s();!(r=i.n()).done;){n=r.value;qM.call(t,n)&&ZM(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},$M=function(e,t){return YM(e,XM(t))},eT=function(){var e=u(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(n,{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("report log failed, request status code: ".concat(r.status,", statusText: ").concat(r.statusText));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),tT=function(){function e(t,n,r){C(this,e),this.argusEncoder=t,this.timestampKey=r,this.reportQueueManage=new Pu(e.logQueue,n,eT,console.warn)}return P(e,[{key:"report",value:function(e,t){var n=this.convertToBody(e),r=this.argusEncoder.encode(t,n);this.reportQueueManage.report(r).catch((function(){}))}},{key:"convertToBody",value:function(e){var t=e.timestamp,n=e.logObject,r={};for(var i in void 0!==this.timestampKey&&(r[this.timestampKey]="".concat(t)),n)r[i]="".concat(n[i]);return r}}]),e}(),nT=tT;nT.logQueue=new Cu;var rT,iT=function(){function e(t){C(this,e),this.events=t.events,this.argusEncoder=new xu(t.events,t.vid),this.reporter=new nT(this.argusEncoder,t.reportResourceURL,t.timestampKey),this.logger=new du({prefix:t.prefix,levelMask:t.printLevelMask}),this.reportLevelMaskIndex=hu[t.reportLevelMask||"info"],this.eventEmitter=new Mu(t.on)}return P(e,[{key:"commit",value:function(e,t){this.reportLogNode(e,{timestamp:Date.now(),logObject:JM({},t)})}},{key:"log",value:function(e,t,n,r){if(this.logger.log(e,t,n),hu[t]>=this.reportLevelMaskIndex){var i={timestamp:Date.now(),logObject:$M(JM({},r),{level:t,message:n})};this.eventEmitter.emit(t,i),this.reportLogNode(e,i)}}},{key:"isSupportedEvents",value:function(e){return e in this.events}},{key:"reportLogNode",value:function(e,t){try{this.reporter.report(t,e)}catch(e){console.warn(e)}}}]),e}(),aT=Y(n(62100)),oT=aT.Reader,sT=aT.Writer,cT=aT.util,uT=aT.roots.default||(aT.roots.default={}),lT=uT.WhiteBoardPlayer=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=cT.Long?cT.Long.fromBits(0,0,!1):0,e.prototype.uuid="",e.prototype.region="",e.prototype.slice="",e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.vid=0,e.prototype.clientIP="",e.prototype.netlessUA="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=sT.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(18).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(26).string(e.region),null!=e.slice&&Object.hasOwnProperty.call(e,"slice")&&t.uint32(34).string(e.slice),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(42).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(50).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(58).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(66).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(74).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(82).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(90).string(e.os),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(98).string(e.createdAt),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(106).string(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(114).string(e.message),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(120).int32(e.vid),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(130).string(e.clientIP),null!=e.netlessUA&&Object.hasOwnProperty.call(e,"netlessUA")&&t.uint32(138).string(e.netlessUA),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof oT||(e=oT.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new uT.WhiteBoardPlayer;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.uuid=e.string();break;case 3:r.region=e.string();break;case 4:r.slice=e.string();break;case 5:r.team=e.string();break;case 6:r.app=e.string();break;case 7:r.akkoVersion=e.string();break;case 8:r.sdkVersion=e.string();break;case 9:r.nativeVersion=e.string();break;case 10:r.platform=e.string();break;case 11:r.os=e.string();break;case 12:r.createdAt=e.string();break;case 13:r.level=e.string();break;case 14:r.message=e.string();break;case 15:r.vid=e.int32();break;case 16:r.clientIP=e.string();break;case 17:r.netlessUA=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof oT||(e=new oT(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=M(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||cT.isInteger(e.lts)||e.lts&&cT.isInteger(e.lts.low)&&cT.isInteger(e.lts.high)?null!=e.uuid&&e.hasOwnProperty("uuid")&&!cT.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!cT.isString(e.region)?"region: string expected":null!=e.slice&&e.hasOwnProperty("slice")&&!cT.isString(e.slice)?"slice: string expected":null!=e.team&&e.hasOwnProperty("team")&&!cT.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!cT.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!cT.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!cT.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!cT.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!cT.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!cT.isString(e.os)?"os: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!cT.isString(e.createdAt)?"createdAt: string expected":null!=e.level&&e.hasOwnProperty("level")&&!cT.isString(e.level)?"level: string expected":null!=e.message&&e.hasOwnProperty("message")&&!cT.isString(e.message)?"message: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!cT.isInteger(e.vid)?"vid: integer expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!cT.isString(e.clientIP)?"clientIP: string expected":null!=e.netlessUA&&e.hasOwnProperty("netlessUA")&&!cT.isString(e.netlessUA)?"netlessUA: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof uT.WhiteBoardPlayer)return e;var t=new uT.WhiteBoardPlayer;return null!=e.lts&&(cT.Long?(t.lts=cT.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==M(e.lts)&&(t.lts=new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.slice&&(t.slice=String(e.slice)),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.level&&(t.level=String(e.level)),null!=e.message&&(t.message=String(e.message)),null!=e.vid&&(t.vid=0|e.vid),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),null!=e.netlessUA&&(t.netlessUA=String(e.netlessUA)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(cT.Long){var r=new cT.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.uuid="",n.region="",n.slice="",n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.createdAt="",n.level="",n.message="",n.vid=0,n.clientIP="",n.netlessUA=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?cT.Long.prototype.toString.call(e.lts):t.longs===Number?new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.slice&&e.hasOwnProperty("slice")&&(n.slice=e.slice),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.level&&e.hasOwnProperty("level")&&(n.level=e.level),null!=e.message&&e.hasOwnProperty("message")&&(n.message=e.message),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),null!=e.netlessUA&&e.hasOwnProperty("netlessUA")&&(n.netlessUA=e.netlessUA),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,aT.util.toJSONOptions)},e}(),hT=uT.WhiteBoardQualityConnection=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=cT.Long?cT.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.isReconnection="",e.prototype.retryCount="",e.prototype.buildWebSocketDuration="",e.prototype.buildMagixDuration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=sT.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.isReconnection&&Object.hasOwnProperty.call(e,"isReconnection")&&t.uint32(114).string(e.isReconnection),null!=e.retryCount&&Object.hasOwnProperty.call(e,"retryCount")&&t.uint32(122).string(e.retryCount),null!=e.buildWebSocketDuration&&Object.hasOwnProperty.call(e,"buildWebSocketDuration")&&t.uint32(130).string(e.buildWebSocketDuration),null!=e.buildMagixDuration&&Object.hasOwnProperty.call(e,"buildMagixDuration")&&t.uint32(138).string(e.buildMagixDuration),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(146).string(e.createdAt),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(152).int32(e.vid),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(162).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof oT||(e=oT.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new uT.WhiteBoardQualityConnection;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 14:r.isReconnection=e.string();break;case 15:r.retryCount=e.string();break;case 16:r.buildWebSocketDuration=e.string();break;case 17:r.buildMagixDuration=e.string();break;case 18:r.createdAt=e.string();break;case 19:r.vid=e.int32();break;case 20:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof oT||(e=new oT(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=M(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||cT.isInteger(e.lts)||e.lts&&cT.isInteger(e.lts.low)&&cT.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!cT.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!cT.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!cT.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!cT.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!cT.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!cT.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!cT.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!cT.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!cT.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!cT.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!cT.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!cT.isString(e.session)?"session: string expected":null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&!cT.isString(e.isReconnection)?"isReconnection: string expected":null!=e.retryCount&&e.hasOwnProperty("retryCount")&&!cT.isString(e.retryCount)?"retryCount: string expected":null!=e.buildWebSocketDuration&&e.hasOwnProperty("buildWebSocketDuration")&&!cT.isString(e.buildWebSocketDuration)?"buildWebSocketDuration: string expected":null!=e.buildMagixDuration&&e.hasOwnProperty("buildMagixDuration")&&!cT.isString(e.buildMagixDuration)?"buildMagixDuration: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!cT.isString(e.createdAt)?"createdAt: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!cT.isInteger(e.vid)?"vid: integer expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!cT.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof uT.WhiteBoardQualityConnection)return e;var t=new uT.WhiteBoardQualityConnection;return null!=e.lts&&(cT.Long?(t.lts=cT.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==M(e.lts)&&(t.lts=new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.isReconnection&&(t.isReconnection=String(e.isReconnection)),null!=e.retryCount&&(t.retryCount=String(e.retryCount)),null!=e.buildWebSocketDuration&&(t.buildWebSocketDuration=String(e.buildWebSocketDuration)),null!=e.buildMagixDuration&&(t.buildMagixDuration=String(e.buildMagixDuration)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.vid&&(t.vid=0|e.vid),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(cT.Long){var r=new cT.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.isReconnection="",n.retryCount="",n.buildWebSocketDuration="",n.buildMagixDuration="",n.createdAt="",n.vid=0,n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?cT.Long.prototype.toString.call(e.lts):t.longs===Number?new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&(n.isReconnection=e.isReconnection),null!=e.retryCount&&e.hasOwnProperty("retryCount")&&(n.retryCount=e.retryCount),null!=e.buildWebSocketDuration&&e.hasOwnProperty("buildWebSocketDuration")&&(n.buildWebSocketDuration=e.buildWebSocketDuration),null!=e.buildMagixDuration&&e.hasOwnProperty("buildMagixDuration")&&(n.buildMagixDuration=e.buildMagixDuration),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,aT.util.toJSONOptions)},e}(),dT=uT.WhiteBoardQualityDisconnection=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=cT.Long?cT.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.duration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.isReconnection="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=sT.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.duration&&Object.hasOwnProperty.call(e,"duration")&&t.uint32(122).string(e.duration),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(130).string(e.createdAt),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(136).int32(e.vid),null!=e.isReconnection&&Object.hasOwnProperty.call(e,"isReconnection")&&t.uint32(146).string(e.isReconnection),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(154).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof oT||(e=oT.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new uT.WhiteBoardQualityDisconnection;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 15:r.duration=e.string();break;case 16:r.createdAt=e.string();break;case 17:r.vid=e.int32();break;case 18:r.isReconnection=e.string();break;case 19:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof oT||(e=new oT(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=M(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||cT.isInteger(e.lts)||e.lts&&cT.isInteger(e.lts.low)&&cT.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!cT.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!cT.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!cT.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!cT.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!cT.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!cT.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!cT.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!cT.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!cT.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!cT.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!cT.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!cT.isString(e.session)?"session: string expected":null!=e.duration&&e.hasOwnProperty("duration")&&!cT.isString(e.duration)?"duration: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!cT.isString(e.createdAt)?"createdAt: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!cT.isInteger(e.vid)?"vid: integer expected":null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&!cT.isString(e.isReconnection)?"isReconnection: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!cT.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof uT.WhiteBoardQualityDisconnection)return e;var t=new uT.WhiteBoardQualityDisconnection;return null!=e.lts&&(cT.Long?(t.lts=cT.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==M(e.lts)&&(t.lts=new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.duration&&(t.duration=String(e.duration)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.vid&&(t.vid=0|e.vid),null!=e.isReconnection&&(t.isReconnection=String(e.isReconnection)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(cT.Long){var r=new cT.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.duration="",n.createdAt="",n.vid=0,n.isReconnection="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?cT.Long.prototype.toString.call(e.lts):t.longs===Number?new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.duration&&e.hasOwnProperty("duration")&&(n.duration=e.duration),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&(n.isReconnection=e.isReconnection),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,aT.util.toJSONOptions)},e}(),pT=uT.WhiteBoardQualitySample=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=cT.Long?cT.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.maxRTT="",e.prototype.minRTT="",e.prototype.averageRTT="",e.prototype.maxQueue="",e.prototype.minQueue="",e.prototype.averageQueue="",e.prototype.maxInterval="",e.prototype.minInterval="",e.prototype.averageInterval="",e.prototype.vid=0,e.prototype.createdAt="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=sT.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.maxRTT&&Object.hasOwnProperty.call(e,"maxRTT")&&t.uint32(114).string(e.maxRTT),null!=e.minRTT&&Object.hasOwnProperty.call(e,"minRTT")&&t.uint32(122).string(e.minRTT),null!=e.averageRTT&&Object.hasOwnProperty.call(e,"averageRTT")&&t.uint32(130).string(e.averageRTT),null!=e.maxQueue&&Object.hasOwnProperty.call(e,"maxQueue")&&t.uint32(138).string(e.maxQueue),null!=e.minQueue&&Object.hasOwnProperty.call(e,"minQueue")&&t.uint32(146).string(e.minQueue),null!=e.averageQueue&&Object.hasOwnProperty.call(e,"averageQueue")&&t.uint32(154).string(e.averageQueue),null!=e.maxInterval&&Object.hasOwnProperty.call(e,"maxInterval")&&t.uint32(162).string(e.maxInterval),null!=e.minInterval&&Object.hasOwnProperty.call(e,"minInterval")&&t.uint32(170).string(e.minInterval),null!=e.averageInterval&&Object.hasOwnProperty.call(e,"averageInterval")&&t.uint32(178).string(e.averageInterval),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(184).int32(e.vid),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(194).string(e.createdAt),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(202).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof oT||(e=oT.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new uT.WhiteBoardQualitySample;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 14:r.maxRTT=e.string();break;case 15:r.minRTT=e.string();break;case 16:r.averageRTT=e.string();break;case 17:r.maxQueue=e.string();break;case 18:r.minQueue=e.string();break;case 19:r.averageQueue=e.string();break;case 20:r.maxInterval=e.string();break;case 21:r.minInterval=e.string();break;case 22:r.averageInterval=e.string();break;case 23:r.vid=e.int32();break;case 24:r.createdAt=e.string();break;case 25:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof oT||(e=new oT(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=M(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||cT.isInteger(e.lts)||e.lts&&cT.isInteger(e.lts.low)&&cT.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!cT.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!cT.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!cT.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!cT.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!cT.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!cT.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!cT.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!cT.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!cT.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!cT.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!cT.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!cT.isString(e.session)?"session: string expected":null!=e.maxRTT&&e.hasOwnProperty("maxRTT")&&!cT.isString(e.maxRTT)?"maxRTT: string expected":null!=e.minRTT&&e.hasOwnProperty("minRTT")&&!cT.isString(e.minRTT)?"minRTT: string expected":null!=e.averageRTT&&e.hasOwnProperty("averageRTT")&&!cT.isString(e.averageRTT)?"averageRTT: string expected":null!=e.maxQueue&&e.hasOwnProperty("maxQueue")&&!cT.isString(e.maxQueue)?"maxQueue: string expected":null!=e.minQueue&&e.hasOwnProperty("minQueue")&&!cT.isString(e.minQueue)?"minQueue: string expected":null!=e.averageQueue&&e.hasOwnProperty("averageQueue")&&!cT.isString(e.averageQueue)?"averageQueue: string expected":null!=e.maxInterval&&e.hasOwnProperty("maxInterval")&&!cT.isString(e.maxInterval)?"maxInterval: string expected":null!=e.minInterval&&e.hasOwnProperty("minInterval")&&!cT.isString(e.minInterval)?"minInterval: string expected":null!=e.averageInterval&&e.hasOwnProperty("averageInterval")&&!cT.isString(e.averageInterval)?"averageInterval: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!cT.isInteger(e.vid)?"vid: integer expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!cT.isString(e.createdAt)?"createdAt: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!cT.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof uT.WhiteBoardQualitySample)return e;var t=new uT.WhiteBoardQualitySample;return null!=e.lts&&(cT.Long?(t.lts=cT.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==M(e.lts)&&(t.lts=new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.maxRTT&&(t.maxRTT=String(e.maxRTT)),null!=e.minRTT&&(t.minRTT=String(e.minRTT)),null!=e.averageRTT&&(t.averageRTT=String(e.averageRTT)),null!=e.maxQueue&&(t.maxQueue=String(e.maxQueue)),null!=e.minQueue&&(t.minQueue=String(e.minQueue)),null!=e.averageQueue&&(t.averageQueue=String(e.averageQueue)),null!=e.maxInterval&&(t.maxInterval=String(e.maxInterval)),null!=e.minInterval&&(t.minInterval=String(e.minInterval)),null!=e.averageInterval&&(t.averageInterval=String(e.averageInterval)),null!=e.vid&&(t.vid=0|e.vid),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(cT.Long){var r=new cT.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.maxRTT="",n.minRTT="",n.averageRTT="",n.maxQueue="",n.minQueue="",n.averageQueue="",n.maxInterval="",n.minInterval="",n.averageInterval="",n.vid=0,n.createdAt="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?cT.Long.prototype.toString.call(e.lts):t.longs===Number?new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.maxRTT&&e.hasOwnProperty("maxRTT")&&(n.maxRTT=e.maxRTT),null!=e.minRTT&&e.hasOwnProperty("minRTT")&&(n.minRTT=e.minRTT),null!=e.averageRTT&&e.hasOwnProperty("averageRTT")&&(n.averageRTT=e.averageRTT),null!=e.maxQueue&&e.hasOwnProperty("maxQueue")&&(n.maxQueue=e.maxQueue),null!=e.minQueue&&e.hasOwnProperty("minQueue")&&(n.minQueue=e.minQueue),null!=e.averageQueue&&e.hasOwnProperty("averageQueue")&&(n.averageQueue=e.averageQueue),null!=e.maxInterval&&e.hasOwnProperty("maxInterval")&&(n.maxInterval=e.maxInterval),null!=e.minInterval&&e.hasOwnProperty("minInterval")&&(n.minInterval=e.minInterval),null!=e.averageInterval&&e.hasOwnProperty("averageInterval")&&(n.averageInterval=e.averageInterval),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,aT.util.toJSONOptions)},e}(),fT=uT.WhiteBoardRealtime=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=cT.Long?cT.Long.fromBits(0,0,!1):0,e.prototype.akkoVersion="",e.prototype.app="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.os="",e.prototype.platform="",e.prototype.region="",e.prototype.sdkVersion="",e.prototype.session="",e.prototype.team="",e.prototype.userId="",e.prototype.uuid="",e.prototype.vid=0,e.prototype.nativeVersion="",e.prototype.clientIP="",e.prototype.suid="",e.prototype.netlessUA="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=sT.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(18).string(e.akkoVersion),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(34).string(e.createdAt),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(42).string(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(50).string(e.message),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(58).string(e.os),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(66).string(e.platform),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(74).string(e.region),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(82).string(e.sdkVersion),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(90).string(e.session),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(98).string(e.team),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(106).string(e.userId),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(114).string(e.uuid),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(120).int32(e.vid),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(130).string(e.nativeVersion),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(138).string(e.clientIP),null!=e.suid&&Object.hasOwnProperty.call(e,"suid")&&t.uint32(146).string(e.suid),null!=e.netlessUA&&Object.hasOwnProperty.call(e,"netlessUA")&&t.uint32(154).string(e.netlessUA),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof oT||(e=oT.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new uT.WhiteBoardRealtime;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.akkoVersion=e.string();break;case 3:r.app=e.string();break;case 4:r.createdAt=e.string();break;case 5:r.level=e.string();break;case 6:r.message=e.string();break;case 7:r.os=e.string();break;case 8:r.platform=e.string();break;case 9:r.region=e.string();break;case 10:r.sdkVersion=e.string();break;case 11:r.session=e.string();break;case 12:r.team=e.string();break;case 13:r.userId=e.string();break;case 14:r.uuid=e.string();break;case 15:r.vid=e.int32();break;case 16:r.nativeVersion=e.string();break;case 17:r.clientIP=e.string();break;case 18:r.suid=e.string();break;case 19:r.netlessUA=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof oT||(e=new oT(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=M(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||cT.isInteger(e.lts)||e.lts&&cT.isInteger(e.lts.low)&&cT.isInteger(e.lts.high)?null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!cT.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.app&&e.hasOwnProperty("app")&&!cT.isString(e.app)?"app: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!cT.isString(e.createdAt)?"createdAt: string expected":null!=e.level&&e.hasOwnProperty("level")&&!cT.isString(e.level)?"level: string expected":null!=e.message&&e.hasOwnProperty("message")&&!cT.isString(e.message)?"message: string expected":null!=e.os&&e.hasOwnProperty("os")&&!cT.isString(e.os)?"os: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!cT.isString(e.platform)?"platform: string expected":null!=e.region&&e.hasOwnProperty("region")&&!cT.isString(e.region)?"region: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!cT.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.session&&e.hasOwnProperty("session")&&!cT.isString(e.session)?"session: string expected":null!=e.team&&e.hasOwnProperty("team")&&!cT.isString(e.team)?"team: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!cT.isString(e.userId)?"userId: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!cT.isString(e.uuid)?"uuid: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!cT.isInteger(e.vid)?"vid: integer expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!cT.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!cT.isString(e.clientIP)?"clientIP: string expected":null!=e.suid&&e.hasOwnProperty("suid")&&!cT.isString(e.suid)?"suid: string expected":null!=e.netlessUA&&e.hasOwnProperty("netlessUA")&&!cT.isString(e.netlessUA)?"netlessUA: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof uT.WhiteBoardRealtime)return e;var t=new uT.WhiteBoardRealtime;return null!=e.lts&&(cT.Long?(t.lts=cT.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==M(e.lts)&&(t.lts=new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.app&&(t.app=String(e.app)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.level&&(t.level=String(e.level)),null!=e.message&&(t.message=String(e.message)),null!=e.os&&(t.os=String(e.os)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.region&&(t.region=String(e.region)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.session&&(t.session=String(e.session)),null!=e.team&&(t.team=String(e.team)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.vid&&(t.vid=0|e.vid),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),null!=e.suid&&(t.suid=String(e.suid)),null!=e.netlessUA&&(t.netlessUA=String(e.netlessUA)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(cT.Long){var r=new cT.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.akkoVersion="",n.app="",n.createdAt="",n.level="",n.message="",n.os="",n.platform="",n.region="",n.sdkVersion="",n.session="",n.team="",n.userId="",n.uuid="",n.vid=0,n.nativeVersion="",n.clientIP="",n.suid="",n.netlessUA=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?cT.Long.prototype.toString.call(e.lts):t.longs===Number?new cT.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.level&&e.hasOwnProperty("level")&&(n.level=e.level),null!=e.message&&e.hasOwnProperty("message")&&(n.message=e.message),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),null!=e.suid&&e.hasOwnProperty("suid")&&(n.suid=e.suid),null!=e.netlessUA&&e.hasOwnProperty("netlessUA")&&(n.netlessUA=e.netlessUA),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,aT.util.toJSONOptions)},e}();!function(e){e.Connected="connected",e.ConnectFailed="connectFailed",e.Sample="sample"}(rT||(rT={}));var vT,mT=Object.freeze({Realtime:Object.freeze({eventID:9115,proto:fT}),Player:Object.freeze({eventID:9118,proto:lT})}),gT=Object.freeze({QualityConnection:Object.freeze({eventID:9120,proto:hT}),QualityDisconnection:Object.freeze({eventID:9121,proto:dT}),QualitySample:Object.freeze({eventID:9123,proto:pT})});function yT(e,t){var n,r=function(){var e=window.__nativeTags;if("object"==M(e)&&null!==e){var t=e.nativeVersion,n=e.platform;if("string"==typeof t&&"string"==typeof n)return{nativeVersion:t,platform:n}}return null}(),i={team:e,app:t,platform:(null==r?void 0:r.platform)||"browser",akkoVersion:He,sdkVersion:yx.sdkVersion,nativeVersion:null==r?void 0:r.nativeVersion,os:null==(n=window.navigator)?void 0:n.platform,netlessUA:bT()};for(var a in i)void 0===i[a]&&delete i[a];return i}function bT(){var e=window.__netlessUA;if("string"==typeof e)return e.slice(0,255).split(/\s+/).filter((function(e){return e.includes("/")})).join(" ")}!function(e){e.AlwaysReport="alwaysReport",e.BanReport="banReport",e.DependsOnRemote="dependsOnRemote"}(vT||(vT={}));var kT=function(){function e(t,n,r){C(this,e),this.teamUUID=t,this.appUUID=n,this.loggerHub=this.createLoggerHub(r)}return P(e,[{key:"createLoggerHub",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="[White]",r=t.reportDebugLogMode||vT.AlwaysReport;switch(r){case vT.BanReport:e=new du({prefix:n,levelMask:t.printLevelMask});break;case vT.AlwaysReport:case vT.DependsOnRemote:var i=yx.log.argusOptions,a=i.reportResourceURL,o=i.vid;e=new iT({vid:o,reportResourceURL:a,prefix:n,reportLevelMask:t.reportLevelMask,printLevelMask:t.printLevelMask,timestampKey:"createdAt",events:mT,on:t.callbacksWhenReceiveLog});break;default:throw new Error("unrecognized LoggerReportMode ".concat(JSON.stringify(r)))}return e}},{key:"createRealtimeLogger",value:function(e,t,n){var r=Object.freeze(H(W({},yT(this.teamUUID,this.appUUID)),{uuid:e,uid:t,suid:t,region:n}));return vu(this.loggerHub,"Realtime",r)}},{key:"createPlayerLogger",value:function(e){var t=Object.freeze(H(W({},yT(this.teamUUID,this.appUUID)),{region:e}));return vu(this.loggerHub,"Player",t)}}]),e}(),wT=function(){function e(t,n){C(this,e);var r=yx.log.argusOptions,i=r.reportResourceURL,a=r.vid;this.loggerHub=new iT({vid:a,reportResourceURL:i,timestampKey:"createdAt",events:gT}),this.teamUUID=t,this.appUUID=n}return P(e,[{key:"createQualityConnectionCommitter",value:function(e,t){var n=Object.freeze(H(W({},yT(this.teamUUID,this.appUUID)),{kind:rT.Connected,uuid:e,region:t}));return ku(this.loggerHub,"QualityConnection",n)}},{key:"createQualityDisconnectionCommitter",value:function(e,t){var n=Object.freeze(H(W({},yT(this.teamUUID,this.appUUID)),{kind:rT.ConnectFailed,uuid:e,region:t}));return ku(this.loggerHub,"QualityDisconnection",n)}},{key:"createQualitySampleCommitter",value:function(e,t){var n=Object.freeze(H(W({},yT(this.teamUUID,this.appUUID)),{kind:rT.Sample,uuid:e,region:t}));return ku(this.loggerHub,"QualitySample",n)}}]),e}();function ST(e){return e}var xT,CT=1024;!function(e){e.Desktop="desktop",e.Phone="phone",e.Pad="pad",e.TV="tv"}(xT||(xT={}));var IT=function(){function e(t){var n;C(this,e),this.version=yx.sdkVersion;var r=this.parseAppIdentifier(t.appIdentifier),i=r.teamUUID,a=r.appUUID;if(t.deviceType&&t.screenType)this.deviceType=t.deviceType,this.screenType=t.screenType;else if(t.deviceType&&!t.screenType)this.deviceType=t.deviceType,this.screenType=t.deviceType===up.Touch?xT.Phone:xT.Desktop;else if(!t.deviceType&&t.screenType)this.deviceType=up.Surface,this.screenType=t.screenType;else{switch(Px.default.deviceType){case"mouseOnly":case"hybrid":this.screenType=xT.Desktop;break;case"touchOnly":this.screenType=xT.Phone}this.deviceType=up.Surface}if(t.renderEngine===rP.SVG||this.isCanvasRenderEngineAvailable()?t.renderEngine?this.renderEngine=t.renderEngine:this.renderEngine=rP.Canvas:this.renderEngine=rP.SVG,this.region=t.region||yx.defaultRegion,this.pptParams=t.pptParams,void 0!==(null==(n=t.loggerOptions)?void 0:n.disableReportLog))throw new Error("loggserOptions.disableReportLog is deprecated. please replace it with reportDebugLogMode or reportQualityMode");this.enableReportQuality(t.loggerOptions)&&(this.qualityLoggerFactory=new wT(i,a)),this.whiteLoggerFactory=new kT(i,a,t.loggerOptions),this.akkoApp=new eu({appIdentifier:t.appIdentifier,observerAdapter:new Dx,clientVersion:yx.sdkVersion,enableAnimationFrame:!0,jsxFactory:Mx.createElement,escapeObjectFilter:Mx.isValidElement,reconnectionOptions:t.reconnectionOptions,netStateAdapter:e.netState,convertIdToUrl:t.urlInterrupter||function(e){return e},configsInterrupter:ST,shuntApiHosts:yx.shuntApiHosts,onAkkoSetupFailed:t.onWhiteSetupFailed}),this.preloadDynamicPPT=!!t.preloadDynamicPPT,this.fonts=Object.freeze(W({},t.fonts)),this.handToolKey=t.handToolKey,this.fontFamily=t.fontFamily,this.disableCurveAnimes=e.defaultValue(t.disableCurveAnimes,!0),this.disableNewPencilStroke=e.defaultValue(t.disableNewPencilStroke,!1),this.disableRotation=!!t.disableRotation,this.urlInterrupter=t.urlInterrupter||function(e){return e},this.boundless=new wp(this.deviceType),this.plugins=this.assertPlugins(t.plugins),this.invisiblePlugins=this.assertInvisiblePlugins(t.invisiblePlugins),this.wrappedComponents=Object.freeze(t.wrappedComponents?p(t.wrappedComponents):[]),this.useMobXState=!!t.useMobXState,this.onlyCallbackRemoteStateModify=!!t.onlyCallbackRemoteStateModify,SM.injectDefaultStyleIfNotInjectBefore()}var t,n,r;return P(e,[{key:"joinRoom",value:(r=u(regeneratorRuntime.mark((function t(n,r){var i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.uuid,!n.useMultiViews||!n.cursorAdapter){t.next=3;break}throw new Error("cannot pass cursorAdapter when open useMultiViews");case 3:return a=n.region||this.region,o=this.standardizeUserPayload(n.uid,n.userPayload),s=this.whiteLoggerFactory.createRealtimeLogger(i,o.uid,a),c=WM(n.floatBar),u=this.qualityLoggerFactory&&{connection:this.qualityLoggerFactory.createQualityConnectionCommitter(i,a),disconnection:this.qualityLoggerFactory.createQualityDisconnectionCommitter(i,a),sample:this.qualityLoggerFactory.createQualitySampleCommitter(i,a)},l=new FM({whiteLogger:s,qualityComitters:u,region:a,floatBarOptions:c,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!n.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(n.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,n.wrappedComponents),akkoApp:this.akkoApp,preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,undoCacheScenesCount:e.defaultValue(n.undoCacheScenesCount,12),cameraBound:this.standardizeCameraBound(n.cameraBound),userPayload:o,disableDeviceInputs:!!n.disableDeviceInputs,disableCameraTransform:n.disableCameraTransform,disableMagixEventDispatchLimit:!!n.disableMagixEventDispatchLimit,disableEraseImage:e.defaultValue(n.disableEraseImage,!0),disableOthersSelectingBox:!!n.disableOthersSelectingBox,disablePencilWrittingLimitFrequency:!!n.disablePencilWrittingLimitFrequency,disableCurveAnimes:this.disableCurveAnimes,disableRotation:this.disableRotation,disableNewPencilStroke:this.disableNewPencilStroke,enableTextareHub:!!c||!n.disableTextOperations,useMultiViews:n.useMultiViews,onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,cursorAdapter:n.cursorAdapter,hotKeys:n.hotKeys,rejectWhenReadonlyErrorLevel:n.rejectWhenReadonlyErrorLevel,eraserRadiusCursor:new uC(s),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,callbacks:r}),t.next=6,l.connect({uuid:i,region:a,roomToken:n.roomToken,userPayload:o,deviceType:this.deviceType,isWritable:e.defaultValue(n.isWritable,!0),enableDrawPoint:e.defaultValue(n.enableDrawPoint,!1),disableNewPencil:e.defaultValue(n.disableNewPencil,!0)});case 6:return t.abrupt("return",l);case 7:case"end":return t.stop()}}),t,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"isPlayable",value:(n=u(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={region:t.region||this.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration},e.next=3,this.akkoApp.searchSlices(n);case 3:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"replayRoom",value:(t=u(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.mediaURL){e.next=2;break}throw new Error("mediaURL was deprecated. please to see https://github.com/netless-io/netless-combine-player");case 2:if(!t.useMultiViews||!t.cursorAdapter){e.next=4;break}throw new Error("cannot pass cursorAdapter when open useMultiViews");case 4:return r=t.region||this.region,i=this.whiteLoggerFactory.createPlayerLogger(r),a=new UM({logger:i,region:r,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(t.cameraBound),onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,disableCameraTransform:t.disableCameraTransform,disableOthersSelectingBox:!!t.disableOthersSelectingBox,disableNewPencilStroke:this.disableNewPencilStroke,useMultiViews:t.useMultiViews,cursorAdapter:t.cursorAdapter,disableCurveAnimes:this.disableCurveAnimes,disableRotation:this.disableRotation,eraserRadiusCursor:new uC(i),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,callbacks:n}),e.next=7,a.setupReconstructor({akkoApp:this.akkoApp,region:r,slice:t.slice,room:t.room,roomToken:t.roomToken,beginTimestamp:t.beginTimestamp,duration:t.duration});case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"standardizeUserPayload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;if(void 0===e)throw new Error("expect uid on parameters");if("string"!=typeof e)throw new Error("invalid uid. ".concat(e," should be string"));if(e.length>CT)throw new Error("invalid uid. length cannot over ".concat(CT));if("object"!=M(n)||null===n)throw new Error("invalid payload. ".concat(n," should be object"));if("uid"in(n=W({},n))&&n.uid!==e)throw new Error("payload did have uid ".concat(n.uid," that is not equals to ").concat(e));return n.uid=e,n}},{key:"pptConverter",value:function(e){return new MC(e)}},{key:"standardizeCameraBound",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return W({maxContentMode:aI(10),minContentMode:aI(.1),width:1/0,height:1/0},e)}},{key:"enableReportQuality",value:function(e){return(null==e?void 0:e.reportQualityMode)!==vT.BanReport}},{key:"isCanvasRenderEngineAvailable",value:function(){var e=document.createElement("canvas");if(void 0===e)return!1;var t=e.getContext("2d");if(null===t)return!1;for(var n=0,r=["setTransform","translate","scale","drawImage","getTransform","resetTransform","clearRect","fillStyle","lineWidth","strokeStyle","lineJoin","lineCap","beginPath","moveTo","quadraticCurveTo","bezierCurveTo","stroke","lineTo","arc","fill","ellipse","setLineDash","strokeRect","closePath"];n<r.length;n++){if(!(r[n]in t))return!1}return!0}},{key:"parseAppIdentifier",value:function(e){if(!/^[0-9a-zA-Z\-_]+\/[0-9a-zA-Z\-_]+$/.test(e))throw new Error("find invalid appIdentifier: ".concat(JSON.stringify(e)));var t=l(e.split("/"),2);return{teamUUID:t[0],appUUID:t[1]}}},{key:"assertPlugins",value:function(e){var t;return e&&(e instanceof KP?t=e:console.warn("plugins is not instance of Plugins. plugins will not be working. you should call createPlugins() to create it")),t||(t=new KP({})),t}},{key:"assertInvisiblePlugins",value:function(e){var t=[];if(e){var n,r=T(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.isValidInvisiblePluginClass(i)&&t.push(i)}}catch(e){r.e(e)}finally{r.f()}}return Object.freeze(t)}},{key:"isValidInvisiblePluginClass",value:function(e){if("string"!=typeof e.kind)return console.warn("invisible plugin class is invalid. expect `public static readonly kind: string = 'xxx';`"),!1;for(var t=e.prototype;null!==t;){if(t===ZP.prototype)return!0;t=Object.getPrototypeOf(t)}return console.warn("invisible plugin class is not extends InvisiblePlugin"),!1}},{key:"mergeArray",value:function(e,t){var n=p(e);if(t){var r,i=T(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;-1===e.indexOf(a)&&n.push(a)}}catch(e){i.e(e)}finally{i.f()}}return n}}],[{key:"defaultValue",value:function(e,t){return void 0===e?t:e}}]),e}(),PT=IT;PT.netState=new Fx;var MT=yx.sdkVersion;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */},90646:function(e,t,n){n.r(t),n.d(t,{v1:function(){return p},v3:function(){return S},v4:function(){return x},v5:function(){return M}});var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16);function a(){if(!r)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}for(var o=[],s=0;s<256;++s)o[s]=(s+256).toString(16).substr(1);var c,u,l=function(e,t){var n=t||0,r=o;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")},h=0,d=0;var p=function(e,t,n){var r=t&&n||0,i=t||[],o=(e=e||{}).node||c,s=void 0!==e.clockseq?e.clockseq:u;if(null==o||null==s){var p=e.random||(e.rng||a)();null==o&&(o=c=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==s&&(s=u=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:d+1,m=f-h+(v-d)/1e4;if(m<0&&void 0===e.clockseq&&(s=s+1&16383),(m<0||f>h)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");h=f,d=v,u=s;var g=(1e4*(268435455&(f+=122192928e5))+v)%4294967296;i[r++]=g>>>24&255,i[r++]=g>>>16&255,i[r++]=g>>>8&255,i[r++]=255&g;var y=f/4294967296*1e4&268435455;i[r++]=y>>>8&255,i[r++]=255&y,i[r++]=y>>>24&15|16,i[r++]=y>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var b=0;b<6;++b)i[r+b]=o[b];return t||l(i)};function f(e,t,n){var r=function(e,r,i,a){var o=i&&a||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)),"string"==typeof r&&(r=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(r)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(r)||16!==r.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var s=n(r.concat(e));if(s[6]=15&s[6]|t,s[8]=63&s[8]|128,i)for(var c=0;c<16;++c)i[o+c]=s[c];return i||l(s)};try{r.name=e}catch(e){}return r.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",r.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",r}function v(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function m(e,t,n,r,i,a){return v((o=v(v(t,e),v(r,a)))<<(s=i)|o>>>32-s,n);var o,s}function g(e,t,n,r,i,a,o){return m(t&n|~t&r,e,t,i,a,o)}function y(e,t,n,r,i,a,o){return m(t&r|n&~r,e,t,i,a,o)}function b(e,t,n,r,i,a,o){return m(t^n^r,e,t,i,a,o)}function k(e,t,n,r,i,a,o){return m(n^(t|~r),e,t,i,a,o)}var w=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var n=0;n<t.length;n++)e[n]=t.charCodeAt(n)}return function(e){var t,n,r,i=[],a=32*e.length,o="0123456789abcdef";for(t=0;t<a;t+=8)n=e[t>>5]>>>t%32&255,r=parseInt(o.charAt(n>>>4&15)+o.charAt(15&n),16),i.push(r);return i}(function(e,t){var n,r,i,a,o;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var s=1732584193,c=-271733879,u=-1732584194,l=271733878;for(n=0;n<e.length;n+=16)r=s,i=c,a=u,o=l,s=g(s,c,u,l,e[n],7,-680876936),l=g(l,s,c,u,e[n+1],12,-389564586),u=g(u,l,s,c,e[n+2],17,606105819),c=g(c,u,l,s,e[n+3],22,-1044525330),s=g(s,c,u,l,e[n+4],7,-176418897),l=g(l,s,c,u,e[n+5],12,1200080426),u=g(u,l,s,c,e[n+6],17,-1473231341),c=g(c,u,l,s,e[n+7],22,-45705983),s=g(s,c,u,l,e[n+8],7,1770035416),l=g(l,s,c,u,e[n+9],12,-1958414417),u=g(u,l,s,c,e[n+10],17,-42063),c=g(c,u,l,s,e[n+11],22,-1990404162),s=g(s,c,u,l,e[n+12],7,1804603682),l=g(l,s,c,u,e[n+13],12,-40341101),u=g(u,l,s,c,e[n+14],17,-1502002290),s=y(s,c=g(c,u,l,s,e[n+15],22,1236535329),u,l,e[n+1],5,-165796510),l=y(l,s,c,u,e[n+6],9,-1069501632),u=y(u,l,s,c,e[n+11],14,643717713),c=y(c,u,l,s,e[n],20,-373897302),s=y(s,c,u,l,e[n+5],5,-701558691),l=y(l,s,c,u,e[n+10],9,38016083),u=y(u,l,s,c,e[n+15],14,-660478335),c=y(c,u,l,s,e[n+4],20,-405537848),s=y(s,c,u,l,e[n+9],5,568446438),l=y(l,s,c,u,e[n+14],9,-1019803690),u=y(u,l,s,c,e[n+3],14,-187363961),c=y(c,u,l,s,e[n+8],20,1163531501),s=y(s,c,u,l,e[n+13],5,-1444681467),l=y(l,s,c,u,e[n+2],9,-51403784),u=y(u,l,s,c,e[n+7],14,1735328473),s=b(s,c=y(c,u,l,s,e[n+12],20,-1926607734),u,l,e[n+5],4,-378558),l=b(l,s,c,u,e[n+8],11,-2022574463),u=b(u,l,s,c,e[n+11],16,1839030562),c=b(c,u,l,s,e[n+14],23,-35309556),s=b(s,c,u,l,e[n+1],4,-1530992060),l=b(l,s,c,u,e[n+4],11,1272893353),u=b(u,l,s,c,e[n+7],16,-155497632),c=b(c,u,l,s,e[n+10],23,-1094730640),s=b(s,c,u,l,e[n+13],4,681279174),l=b(l,s,c,u,e[n],11,-358537222),u=b(u,l,s,c,e[n+3],16,-722521979),c=b(c,u,l,s,e[n+6],23,76029189),s=b(s,c,u,l,e[n+9],4,-640364487),l=b(l,s,c,u,e[n+12],11,-421815835),u=b(u,l,s,c,e[n+15],16,530742520),s=k(s,c=b(c,u,l,s,e[n+2],23,-995338651),u,l,e[n],6,-198630844),l=k(l,s,c,u,e[n+7],10,1126891415),u=k(u,l,s,c,e[n+14],15,-1416354905),c=k(c,u,l,s,e[n+5],21,-57434055),s=k(s,c,u,l,e[n+12],6,1700485571),l=k(l,s,c,u,e[n+3],10,-1894986606),u=k(u,l,s,c,e[n+10],15,-1051523),c=k(c,u,l,s,e[n+1],21,-2054922799),s=k(s,c,u,l,e[n+8],6,1873313359),l=k(l,s,c,u,e[n+15],10,-30611744),u=k(u,l,s,c,e[n+6],15,-1560198380),c=k(c,u,l,s,e[n+13],21,1309151649),s=k(s,c,u,l,e[n+4],6,-145523070),l=k(l,s,c,u,e[n+11],10,-1120210379),u=k(u,l,s,c,e[n+2],15,718787259),c=k(c,u,l,s,e[n+9],21,-343485551),s=v(s,r),c=v(c,i),u=v(u,a),l=v(l,o);return[s,c,u,l]}(function(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e[t/8])<<t%32;return n}(e),8*e.length))},S=f("v3",48,w);var x=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||l(i)};function C(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function I(e,t){return e<<t|e>>>32-t}var P=function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=new Array(r.length);for(var i=0;i<r.length;i++)e[i]=r.charCodeAt(i)}e.push(128);var a=e.length/4+2,o=Math.ceil(a/16),s=new Array(o);for(i=0;i<o;i++){s[i]=new Array(16);for(var c=0;c<16;c++)s[i][c]=e[64*i+4*c]<<24|e[64*i+4*c+1]<<16|e[64*i+4*c+2]<<8|e[64*i+4*c+3]}for(s[o-1][14]=8*(e.length-1)/Math.pow(2,32),s[o-1][14]=Math.floor(s[o-1][14]),s[o-1][15]=8*(e.length-1)&4294967295,i=0;i<o;i++){for(var u=new Array(80),l=0;l<16;l++)u[l]=s[i][l];for(l=16;l<80;l++)u[l]=I(u[l-3]^u[l-8]^u[l-14]^u[l-16],1);var h=n[0],d=n[1],p=n[2],f=n[3],v=n[4];for(l=0;l<80;l++){var m=Math.floor(l/20),g=I(h,5)+C(m,d,p,f)+v+t[m]+u[l]>>>0;v=f,f=p,p=I(d,30)>>>0,d=h,h=g}n[0]=n[0]+h>>>0,n[1]=n[1]+d>>>0,n[2]=n[2]+p>>>0,n[3]=n[3]+f>>>0,n[4]=n[4]+v>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]},M=f("v5",80,P)}}]);